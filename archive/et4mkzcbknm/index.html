<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vue项目加载第3方js优化"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vue项目加载第3方js优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/et4mkzcbknm/",
				"appid": "1613049289050283", 
				"title": "vue项目加载第3方js优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-09T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/bw59nhomm0n/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ewby7mvkjjf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&text=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&text=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&title=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&is_video=false&description=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&title=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&title=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&title=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fet4mkzcbknm%2f&title=vue%e9%a1%b9%e7%9b%ae%e5%8a%a0%e8%bd%bd%e7%ac%ac3%e6%96%b9js%e4%bc%98%e5%8c%96"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vue项目加载第3方js优化</h1><div class="meta"><div class="postdate"><time datetime="2019-01-09" itemprop="datePublished">2019-01-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e项目写到最后需要优化的时候，发现有很多首屏用不到的第3方js都写在index.html里，严重拖慢的网页的加载速度，这里的第3方组件大多不能通过npm或其他模块安装，所以不能直接用vue里的异步组件，比如高德地图的jssdk和它的ui组件，最简单的方法就是在document里插入script。 所以就有了下面的方案。\x3c\/p\x3e\n\x3ch4\x3e先定义一个把js插入到document里的方法\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# asyncLoadJs.js\nexport default function asyncLoadJs (url) {\n  return Q.Promise((resolve, reject) =\x3e {\n    let hasLoaded = $(\x27script[src=\x26quot;\x27\x2burl\x2b\x27\x26quot;]\x27).length \x3e 0\n    if (hasLoaded) {\n      resolve()\n      return\n    }\n\n    let script = document.createElement(\x27script\x27)\n    script.type = \x27text\/javascript\x27\n    script.src = url\n    document.body.appendChild(script)\n    script.onload = () =\x3e {\n      resolve()\n    }\n    script.onerror = () =\x3e {\n      reject()\n    }\n  })\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e# asyncLoadJs.js\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncLoadJs\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Q.Promise(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hasLoaded = $(\x3cspan class=\x22hljs-string\x22\x3e\x27script[src=\x22\x27\x3c\/span\x3e\x2burl\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x22]\x27\x3c\/span\x3e).length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hasLoaded) {\n      resolve()\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e)\n    script.type = \x3cspan class=\x22hljs-string\x22\x3e\x27text\/javascript\x27\x3c\/span\x3e\n    script.src = url\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(script)\n    script.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      resolve()\n    }\n    script.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      reject()\n    }\n  })\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e在按第3方js依赖的不同 分成各个函数\x3c\/h4\x3e\n\x3cp\x3e这里以我项目里的高德地图组件为例，它需要一个主jssdk库和一个提供ui的库，ui库是依赖主库的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# asyncLoadJs.js\nexport function loadAMapJS () {\n  return Q.Promise((resolve, reject) =\x3e {\n    asyncLoadJs(\x27https:\/\/webapi.amap.com\/maps?v=1.3\x26amp;key=[你自己的key]\x26amp;plugin=AMap.ToolBar,AMap.Geolocation,AMap.Autocomplete\x27)\n      .then(() =\x3e {\n        return asyncLoadJs(\x27https:\/\/webapi.amap.com\/ui\/1.0\/main.js\x27)\n      })\n      .then(() =\x3e {\n        resolve()\n      })\n      .catch(err =\x3e {\n        reject(err)\n      })\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e# asyncLoadJs.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e function loadAMapJS () {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Q.Promise(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(resolve, reject)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    asyncLoadJs(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/webapi.amap.com\/maps?v=1.3\x26amp;key=[你自己的key]\x26amp;plugin=AMap.ToolBar,AMap.Geolocation,AMap.Autocomplete\x27\x3c\/span\x3e)\n      .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e asyncLoadJs(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/webapi.amap.com\/ui\/1.0\/main.js\x27\x3c\/span\x3e)\n      })\n      .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        resolve()\n      })\n      .\x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(err =\x26gt; {\n        reject(err)\n      })\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e在组件生命周期中使用异步加载\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# position-picker.vue\n\x3cscript\x3e\n    import {loadAMapJS} from \x27..\/..\/libs\/asyncLoadJs\x27\n    \n    let loadedAMapJS = false \/\/ 是否加载完js\n    \n    export default {\n        created () {\n          \/\/ 判断是否加载过\n          if (!loadedAMapJS) {\n            loadAMapJS().then(() =\x3e {\n              loadedAMapJS = true\n            })\n          }\n        },\n        mounted () {\n          \/\/ 循环判断有没有加载完 写在mounted生命周期里是应为高德的api依赖dom\n          let interval = setInterval(() =\x3e {\n            if (loadedAMapJS) {\n              clearInterval(interval)\n              this.init()\n            }\n          }, 300)\n        },\n        init () {\n            let AMap = window.AMap\n            let AMapUI = window.AMapUI\n            AMapUI.loadUI([\x27misc\/PositionPicker\x27], function (PositionPicker) {\n              self.map = new AMap.Map(self.$refs[\x27map\x27], {\n                zoom: 16,\n                scrollWheel: false\n              })\n              ...其他代码\n            })\n        }\n    }\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e# position-picker.vue\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {loadAMapJS} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/libs\/asyncLoadJs\x27\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e loadedAMapJS = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是否加载完js\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n        created () {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否加载过\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!loadedAMapJS) {\n            loadAMapJS().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n              loadedAMapJS = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n            })\n          }\n        },\n        mounted () {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 循环判断有没有加载完 写在mounted生命周期里是应为高德的api依赖dom\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e interval = setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (loadedAMapJS) {\n              clearInterval(interval)\n              \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.init()\n            }\n          }, \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e)\n        },\n        init () {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e AMap = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.AMap\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e AMapUI = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.AMapUI\n            AMapUI.loadUI([\x3cspan class=\x22hljs-string\x22\x3e\x27misc\/PositionPicker\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ePositionPicker\x3c\/span\x3e) \x3c\/span\x3e{\n              self.map = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AMap.Map(self.$refs[\x3cspan class=\x22hljs-string\x22\x3e\x27map\x27\x3c\/span\x3e], {\n                \x3cspan class=\x22hljs-attr\x22\x3ezoom\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3escrollWheel\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n              })\n              ...其他代码\n            })\n        }\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e一个页面有多个第3方组件的问题\x3c\/h4\x3e\n\x3cp\x3e如果一个页面有多个第3方组件，那只定义一个是否加载完的标志位是不够的，因为组件基本是同时created的，在dom中插入script标签后都会返回resolve，其实这时js是没有加载完的，这时可以加一个是否是第一次请求js的变量。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# position-picker.vue\n\x3cscript\x3e\n    import {loadAMapJS} from \x27..\/..\/libs\/asyncLoadJs\x27\n    \n    let loadedAMapJS = false \/\/ 是否加载完js\n    let firstLoadingAMapJS = true \/\/ 否是第一次请求\n    \n    export default {\n        created () {\n          \/\/ 判断是否加载过\n          if (!loadedAMapJS \x26amp;\x26amp; firstLoadingAMapJS) {\n            firstLoadingAMapJS = false \/\/ 马上置为false 只让第一个created组件去请求js\n            loadAMapJS().then(() =\x3e {\n              loadedAMapJS = true\n            }).catch(() =\x3e {\n              firstLoadingAMapJS = true \/\/ 出错置为true 下次进来还是能重新请求js\n            })\n          }\n        }\n        ...\n    }\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e# position-picker.vue\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {loadAMapJS} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/libs\/asyncLoadJs\x27\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e loadedAMapJS = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是否加载完js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e firstLoadingAMapJS = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 否是第一次请求\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n        created () {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否加载过\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!loadedAMapJS \x26amp;\x26amp; firstLoadingAMapJS) {\n            firstLoadingAMapJS = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 马上置为false 只让第一个created组件去请求js\x3c\/span\x3e\n            loadAMapJS().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n              loadedAMapJS = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n            }).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n              firstLoadingAMapJS = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 出错置为true 下次进来还是能重新请求js\x3c\/span\x3e\n            })\n          }\n        }\n        ...\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e注意事项\x3c\/h4\x3e\n\x3cp\x3e在computed或watch中，如果需要用到第3方js方法的地方必须先判断第3方js是否加载完，不然会报错的~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vue项目加载第3方js优化</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010094303">https://segmentfault.com/a/1190000010094303</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/et4mkzcbknm/" target="_blank">https://alili.tech/archive/et4mkzcbknm/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/z09muaar7j/">2年前端应该会哪些技能<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/ke982v6qrfg/">CSS 性能优化笔记<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/if1i2hs28ah/">H5打造3d场景不完全攻略（二）: Amazing CSS3D<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/s4apghsr7o/">JS原生一步步实现前端路由和单页面应用<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/hjgkntbgqek/">JavaScript 中对大量数据的多重过滤<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/h1hfvr2a2nj/">JavaScript 中的错误处理机制<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/a0ukpm125gm/">JavaScript 数组分组的实现<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/fwosouhbhmj/">JavaScript 类型转换深度学习<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/z193p9xv2p/">JavaScript设计模式之发布-订阅模式（观察者模式）-Part1<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/6i7sr0vgkxm/">Javascript中的时间<aside class="dates">2019-02-01</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>