<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="76行代码如何完成一个双轮平衡小车？"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>76行代码如何完成一个双轮平衡小车？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/vyiqwpclc2j/",
				"appid": "1613049289050283", 
				"title": "76行代码如何完成一个双轮平衡小车？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-28T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qmproxiq6s/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/wz4vg4iksd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&text=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&text=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&title=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&is_video=false&description=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&title=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&title=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&title=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvyiqwpclc2j%2f&title=76%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%a6%82%e4%bd%95%e5%ae%8c%e6%88%90%e4%b8%80%e4%b8%aa%e5%8f%8c%e8%bd%ae%e5%b9%b3%e8%a1%a1%e5%b0%8f%e8%bd%a6%ef%bc%9f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">76行代码如何完成一个双轮平衡小车？</h1><div class="meta"><div class="postdate"><time datetime="2019-01-28" itemprop="datePublished">2019-01-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3eRuff Lite\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eRuff Lite 是 Ruff 团队针对 MCU（MicroController Unit，微控制器）推出的 Ruff OS\x3cbr\x3e，具有高实时性，占用内存小等特点。目前官方支持的开发板为TI TM4C1294-LaunchPad ，Ruff Lite支持的硬件接口包括：GPIO、UART、I2C、ADC、PWM、QEI。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e原理简介\x3c\/h2\x3e\n\x3cp\x3e两轮自动平衡车是一个典型的自动控制系统，由执行元件（直流电机），传感模块（陀螺仪和编码器）和主控平台控制系统（Ruff 开发板）组成。直流电机控制两轮正反转，陀螺仪检测车身姿态，编码器检测电机转速，这两组传感器数据反馈给控制系统，经由 PID 控制算法计算，给出控制直流电机的控制量，通过这一闭环过程，从而形成负反馈，保证车身平衡\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e物件清单\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e主控平台\x3c\/h3\x3e\n\x3cp\x3eRuff Lite 开发版 （型号 TM4C1294-V1 ）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080467?w=4032\x26amp;h=3024\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080467?w=4032\x26amp;h=3024\x22 alt=\x22tm4c1294\x22 title=\x22tm4c1294\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e传感器及执行元件\x3c\/h3\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e陀螺仪模块 （型号 GY-521）\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080468?w=4032\x26amp;h=3024\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080468?w=4032\x26amp;h=3024\x22 alt=\x22gy-521\x22 title=\x22gy-521\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e直流电机驱动模块 （型号 TB6612FNG ）\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080469?w=4032\x26amp;h=3024\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080469?w=4032\x26amp;h=3024\x22 alt=\x22tb6612fng\x22 title=\x22tb6612fng\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e编码器模块（随直流电机一体）（型号 MG513-30 ）\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080470?w=1900\x26amp;h=1902\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080470?w=1900\x26amp;h=1902\x22 alt=\x22mg513-30_1\x22 title=\x22mg513-30_1\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/uploads\/default\/original\/2X\/c\/c98313916b9ad52c4557868e9be0b14ba7083c3f.jpg\x22 src=\x22https:\/\/static.alili.tech\/uploads\/default\/original\/2X\/c\/c98313916b9ad52c4557868e9be0b14ba7083c3f.jpg\x22 alt=\x22mg513-30_2\x22 title=\x22mg513-30_2\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eMG513-30 是该直流电机的型号，由电机驱动模块进行驱动，这里我们用它自带的编码器模块\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e其它\x3c\/h3\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e机械元件\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080471?w=4032\x26amp;h=3024\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080471?w=4032\x26amp;h=3024\x22 alt=\x22mechanicals\x22 title=\x22mechanicals\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e12V 锂电池\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008080472?w=4032\x26amp;h=3024\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008080472?w=4032\x26amp;h=3024\x22 alt=\x2212v_battery\x22 title=\x2212v_battery\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e电压转换模块（12V-5V）\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/uploads\/default\/original\/2X\/1\/14b024438cfe0441f03064c11c1c8a19ce94a6c1.jpg\x22 src=\x22https:\/\/static.alili.tech\/uploads\/default\/original\/2X\/1\/14b024438cfe0441f03064c11c1c8a19ce94a6c1.jpg\x22 alt=\x2212v-5v\x22 title=\x2212v-5v\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e直流电机 12V 供电，开发板 5V 供电\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e开发步骤\x3c\/h2\x3e\n\x3ch5\x3e1. 初始化 APP，选择 tm4c1294-v1 开发板（对应 TI TM4C1294-LaunchPad）\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap init --board tm4c1294-v1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap init --board tm4c1294-v1\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e2. 添加陀螺仪驱动，id 为 gyro，型号选择 GY-521，其余参数默认\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap device add gyro (GY-521)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap device add gyro (GY-521)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e3. 添加电机驱动，id 为 motor，型号选择 TB6612FNG\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap device add motor (TB6612FNG)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap device add motor (TB6612FNG)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e4. 添加编码器驱动，id 为 encoder，型号选择 MG513-30，其余参数默认\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap device add encoder (MG513-30)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap device add encoder (MG513-30)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e5. 编写控制算法\x3c\/h5\x3e\n\x3cp\x3e（见下文）\x3c\/p\x3e\n\x3ch5\x3e6. 调试\x3c\/h5\x3e\n\x3cp\x3e（见下文）\x3c\/p\x3e\n\x3ch5\x3e7. 扫描开发板\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap scan\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap scan\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e7. 部署应用\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ rap deploy\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ rap deploy\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e控制算法\x3c\/h2\x3e\n\x3cp\x3ePID（比例-积分-微分）控制算法是工程上最常用的自动控制算法，参数 P 实现基本控制作用，参数 D 避免系统震荡，参数I用来消除系统静差，本平衡小车系统由 PID 算法进行控制，从而保持平衡\x3c\/p\x3e\n\x3cp\x3e平衡车内部有两个反馈环，一个是由陀螺仪反馈姿态倾角和角速度构成的 \x3cstrong\x3e直立环\x3c\/strong\x3e，一个是由编码器反馈直流电机转速构成的 \x3cstrong\x3e速度环\x3c\/strong\x3e，由此构成一个串级 PID 控制系统（见下图），速度环控制的输出作为直立环控制的输入，直立环由 \x3cstrong\x3ePD 控制\x3c\/strong\x3e（比例-微分控制）系统构成，保证小车的基本平衡（参数 P 的作用）和避免震荡（参数 D 的作用），速度环由 \x3cstrong\x3ePI 控制\x3c\/strong\x3e（比例-积分控制）系统，消除姿态倾角的静差（参数I的作用）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/uploads\/default\/original\/2X\/7\/74b64bc3a2b0292543ebbbc0eb7afd21b3cfc0ba.png\x22 src=\x22https:\/\/static.alili.tech\/uploads\/default\/original\/2X\/7\/74b64bc3a2b0292543ebbbc0eb7afd21b3cfc0ba.png\x22 alt=\x22control_block\x22 title=\x22control_block\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e具体 PID 算法的原理及推导过程请参考自控控制专业书籍，这里只对算法作用和各个参数的意义进行简要说明\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e控制程序\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3esrc\/index.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.ready(function(error) {\n    if (error) {\n        console.log(\x27error\x27, error);\n        return;\n    }\n\n    var gyro = $(\x27#gyro\x27); \/\/ 陀螺仪传感器（GY-521）\n    var enc = $(\x27#encoder\x27); \/\/ 编码器传感器（MG513-30）\n    var motor = $(\x27#motor\x27); \/\/ 电机驱动控制器（TB6612FNG）\n\n    \/\/ 直立环PD控制\n    var getBalancePwm = function (actualAngle, actualGyro) {\n        var targetAngle = 0.8; \/\/ 小车静止平衡时的姿态角度\n        var kP = 80; \/\/ 直立环比例(P)控制参数\n        var kD = 2; \/\/ 直立环微分(D)控制参数\n\n        \/\/ 直立环控制分量\n        var balancePwm = kP * (actualAngle - targetAngle) \x2b kD * actualGyro;\n        return balancePwm \/ 1000;\n    };\n\n    \/\/ 速度环PI控制\n    var encoder = 0;\n    var sumEncoder = 0;\n    var getVelocityPwm = function (actualLEncoder, actualREncoder) {\n        var targetVelocity = 0; \/\/ 小车静止平衡时的电机输出转速\n        var kP = 3; \/\/ 速度环比例(P)控制参数\n        var kI = kP \/ 200; \/\/ 速度环积分(I)控制参数\n\n        \/\/ FIR二阶低通滤波\n        encoder = 0.2 * (actualLEncoder \x2b actualREncoder - targetVelocity) \x2b 0.8 * encoder;\n        sumEncoder \x2b= encoder;\n\n        \/\/ 积分限幅\n        if (sumEncoder \x3e= 3000) {\n            sumEncoder = 3000;\n        }\n        if (sumEncoder \x3c= -3000) {\n            sumEncoder = -3000;\n        }\n\n        \/\/ 速度换控制分量\n        var velocityPwm = kP * encoder \x2b kI * sumEncoder;\n        return (velocityPwm \/ 1000);\n    };\n\n    var cycle = 20; \/\/ 采样\/控制周期均为20ms，即1s采样\/控制50次\n    var gyroAcquire, encAcquire, balanceControl;\n\n    var angleX = 0;\n    var gyroY = 0;\n    var rpm = 0;\n\n    \/\/ 每隔20ms，获取陀螺仪沿X轴的姿态倾角和角速度\n    gyroAcquire = setInterval(function() {\n        gyro.getFusedMotionX(cycle, function (error, _angleX, _gyroY) {\n            angleX = _angleX;\n            gyroY = _gyroY;\n        });\n    }, cycle);\n\n    \/\/ 每隔20ms，获取编码器的速度值\n    encAcquire = setInterval(function() {\n        enc.getRpm(function (error, _rpm) {\n            rpm = _rpm;\n        });\n    }, cycle);\n\n    \/\/ 每隔20ms，利用反馈值计算控制量，控制电机正反转\n    balanceControl = setInterval(function() {\n        var balancePwm = getBalancePwm(angleX, gyroY);\n        var velocityPwm = getVelocityPwm(rpm, rpm);\n        var pwmDuty = balancePwm - velocityPwm;\n\n        if (pwmDuty \x3e= 0) {\n            if (pwmDuty \x3e= 1) {\n                pwmDuty = 1;\n            }\n            \/\/ 控制车身前进（电机A正转B反转，A与B相差180度安装）\n            motor.forwardRotateA(pwmDuty);\n            motor.backwardRotateB(pwmDuty);\n        } else {\n            if (pwmDuty \x3c= -1) {\n                pwmDuty = -1;\n            }\n            \/\/ 控制车身后退（电机A反转B正转，A与B相差180度安装）\n            motor.backwardRotateA(-pwmDuty);\n            motor.forwardRotateB(-pwmDuty);\n        }\n\n        \/\/ 若倾角超过30度，停止整个控制系统运行\n        if (angleX \x3e= 30 || angleX \x3c= -30) {\n            \/\/ 停止陀螺仪采样\n            clearInterval(gyroAcquire);\n            \/\/ 停止编码器采样\n            clearInterval(encAcquire);\n            \/\/ 停止电机控制逻辑\n            clearInterval(balanceControl);\n            \/\/ 停止电机A\/B转动\n            motor.stopRotateA();\n            motor.stopRotateB();\n        }\n    }, cycle);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e$.ready(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, error);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gyro = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#gyro\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 陀螺仪传感器（GY-521）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e enc = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#encoder\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编码器传感器（MG513-30）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e motor = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#motor\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 电机驱动控制器（TB6612FNG）\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 直立环PD控制\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getBalancePwm = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eactualAngle, actualGyro\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e targetAngle = \x3cspan class=\x22hljs-number\x22\x3e0.8\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 小车静止平衡时的姿态角度\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e kP = \x3cspan class=\x22hljs-number\x22\x3e80\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 直立环比例(P)控制参数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e kD = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 直立环微分(D)控制参数\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 直立环控制分量\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e balancePwm = kP * (actualAngle - targetAngle) \x2b kD * actualGyro;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e balancePwm \/ \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e;\n    };\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度环PI控制\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e encoder = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sumEncoder = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getVelocityPwm = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eactualLEncoder, actualREncoder\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e targetVelocity = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 小车静止平衡时的电机输出转速\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e kP = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度环比例(P)控制参数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e kI = kP \/ \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度环积分(I)控制参数\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ FIR二阶低通滤波\x3c\/span\x3e\n        encoder = \x3cspan class=\x22hljs-number\x22\x3e0.2\x3c\/span\x3e * (actualLEncoder \x2b actualREncoder - targetVelocity) \x2b \x3cspan class=\x22hljs-number\x22\x3e0.8\x3c\/span\x3e * encoder;\n        sumEncoder \x2b= encoder;\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 积分限幅\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (sumEncoder \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e) {\n            sumEncoder = \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (sumEncoder \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e-3000\x3c\/span\x3e) {\n            sumEncoder = \x3cspan class=\x22hljs-number\x22\x3e-3000\x3c\/span\x3e;\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度换控制分量\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e velocityPwm = kP * encoder \x2b kI * sumEncoder;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (velocityPwm \/ \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    };\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cycle = \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 采样\/控制周期均为20ms，即1s采样\/控制50次\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gyroAcquire, encAcquire, balanceControl;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e angleX = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gyroY = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rpm = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每隔20ms，获取陀螺仪沿X轴的姿态倾角和角速度\x3c\/span\x3e\n    gyroAcquire = setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        gyro.getFusedMotionX(cycle, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, _angleX, _gyroY\x3c\/span\x3e) \x3c\/span\x3e{\n            angleX = _angleX;\n            gyroY = _gyroY;\n        });\n    }, cycle);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每隔20ms，获取编码器的速度值\x3c\/span\x3e\n    encAcquire = setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        enc.getRpm(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, _rpm\x3c\/span\x3e) \x3c\/span\x3e{\n            rpm = _rpm;\n        });\n    }, cycle);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每隔20ms，利用反馈值计算控制量，控制电机正反转\x3c\/span\x3e\n    balanceControl = setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e balancePwm = getBalancePwm(angleX, gyroY);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e velocityPwm = getVelocityPwm(rpm, rpm);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e pwmDuty = balancePwm - velocityPwm;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pwmDuty \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pwmDuty \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                pwmDuty = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 控制车身前进（电机A正转B反转，A与B相差180度安装）\x3c\/span\x3e\n            motor.forwardRotateA(pwmDuty);\n            motor.backwardRotateB(pwmDuty);\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pwmDuty \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n                pwmDuty = \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 控制车身后退（电机A反转B正转，A与B相差180度安装）\x3c\/span\x3e\n            motor.backwardRotateA(-pwmDuty);\n            motor.forwardRotateB(-pwmDuty);\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若倾角超过30度，停止整个控制系统运行\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (angleX \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e30\x3c\/span\x3e || angleX \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e-30\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 停止陀螺仪采样\x3c\/span\x3e\n            clearInterval(gyroAcquire);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 停止编码器采样\x3c\/span\x3e\n            clearInterval(encAcquire);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 停止电机控制逻辑\x3c\/span\x3e\n            clearInterval(balanceControl);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 停止电机A\/B转动\x3c\/span\x3e\n            motor.stopRotateA();\n            motor.stopRotateB();\n        }\n    }, cycle);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e调试\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e目标角度调试\x3c\/h3\x3e\n\x3cp\x3e装好整个机械元件后，要进行目标角度调试，即 targetAngle 变量，具体方法，将控制 motor 前后转动的代码全部注释掉，然后在 balanceControl 这个函数中，打印 angleX，得到小车趋于平衡静止时的角度，应该大约在正负3度以内。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e算法参数调试\x3c\/h3\x3e\n\x3cp\x3e首先确定参数的极性。\x3c\/p\x3e\n\x3cp\x3e先屏蔽掉外反馈环 PI 控制，保持 kP 和 kD 参数不变，看是否小车有平衡的趋势，及车轮是否会向倾倒的一侧转动，若是，则 kP 和 kD 参数为正数不需要改变，若否，则 kP 和 kI 参数需要改为负数。\x3c\/p\x3e\n\x3cp\x3e之后屏蔽掉内反馈环 PD 控制，保持 kI 和 kD 参数不变，用手去转动连接编码器的那个车轮，看是否是此PI控制是正反馈，即给车轮一个小的转动，车轮是否会一直加速到最大速度，若是，则 kP 和 kD 参数为正数不需要改变，若否，则 kP 和 kI 参数需要改为负数（上述程序中只需要改 kP 即可，kI 为 kP\/200）。\x3c\/p\x3e\n\x3cp\x3e然后确定参数的数值。一般情况下，整个机械元件装稳定后，PD 算法参数（kP 和 kD）和 PI 算法中的参数（kP 和 kI）应该不需要变动就可以直接运行在你的平衡小车上。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3eFAQ\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3eRuff MPU版（ruff-mbd-v1）可以作为主控平台么？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e不能，因为底层的 OpenWRT（基于 Linux）不是实时操作系统，系统启动后会运行很多进程，Ruff 进程不一定时刻占有 CPU，因此不能稳定地每隔一个控制周期（这里是 20ms）获得传感器数据，不满足控制系统的实时性要求。而 MCU 版 Ruff 的底层操作系统是 Nuttx RTOS，能够保证实时操作。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e控制系统中控制周期是多少？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e控制周期为 20ms，即1秒内控制系统控制 50 次。每个控制周期需要做的内容包括 1) 获取陀螺仪和编码器两个传感器的数据，2) 传入直立环和速度环算法中进行计算得到控制量，3) 将控制量作用于直流电机上。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e用Ruff MCU开发板开发平衡车与用其它开发板（如 stm32）进行裸板开发，有什么相同点与不同点？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e相同点是都满足实时性控制的要求（如本案例的 20ms 控制周期）。\x3c\/p\x3e\n\x3cp\x3e不同点主要体现在 \x3cstrong\x3e开发效率\x3c\/strong\x3e和 \x3cstrong\x3e可移植性\x3c\/strong\x3e两个方面，若用其它 MCU 开发板进行裸板开发，要面对 \x3cstrong\x3e硬件接口协议\x3c\/strong\x3e（I2C接口陀螺仪，QEI接口编码器，PWM 和 GPIO 接口的直流电机控制器），\x3cstrong\x3e外设模块协议\x3c\/strong\x3e（比如给陀螺仪发送什么命令获取到加速度值和角速度值）和 \x3cstrong\x3e硬件定时器中断\x3c\/strong\x3e（通过配置寄存器设置20ms定时器中断）等其它问题，且代码不具备可移植性和复用性，但在整个开发过程中若用 Ruff 开发，可直面业务逻辑，即自动控制算法，而不用关心硬件模块的任何细节，你面对的只有外设模块的 API，并且由于没有任何硬件平台的逻辑，程序本身具备可复用性。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>76行代码如何完成一个双轮平衡小车？</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008080464">https://segmentfault.com/a/1190000008080464</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/vyiqwpclc2j/" target="_blank">https://alili.tech/archive/vyiqwpclc2j/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>