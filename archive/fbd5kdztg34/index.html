<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="使用Docker Compose部署Django和Vue.js应用"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>使用Docker Compose部署Django和Vue.js应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fbd5kdztg34/",
				"appid": "1613049289050283", 
				"title": "使用Docker Compose部署Django和Vue.js应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-08T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/czpb7jpq2y7/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tdj2egk7sgk/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&text=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&text=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&title=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&is_video=false&description=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&title=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&title=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&title=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffbd5kdztg34%2f&title=%e4%bd%bf%e7%94%a8Docker%20Compose%e9%83%a8%e7%bd%b2Django%e5%92%8cVue.js%e5%ba%94%e7%94%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">使用Docker Compose部署Django和Vue.js应用</h1><div class="meta"><div class="postdate"><time datetime="2019-01-08" itemprop="datePublished">2019-01-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3cp\x3e本文主要内容关于使用docker-compose实践部署后端django-rest-framework和前端vue.js应用。记录其中遇到的一些坑以及解决办法。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e准备Docker-compose环境\x3c\/h1\x3e\n\x3cp\x3e系统：Ubuntu 16.04(阿里云)\x3cbr\x3e代码中用户名：test\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e安装Docker\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# install docker\n## prepare\necho \x27Preparing...\x27\nsudo apt update\nsudo apt upgrade -y\nsudo apt install -y linux-image-extra-$(uname -r) linux-image-extra-virtual\n## docker\necho \x27Installing docker...\x27\nsudo apt remove -y docker-ce docker-engine docker.io\nwget -qO- http:\/\/acs-public-mirror.oss-cn-hangzhou.aliyuncs.com\/docker-engine\/internet | sh\nsudo apt autoremove -y\n\nsudo usermod -aG docker ${USER}\n\n## docker Aliyun accelerator\n## https:\/\/cr.console.aliyun.com\/#\/accelerator\necho \x27Configuring docker registry mirrors...\x27\nsudo mkdir -p \/etc\/docker\nsudo tee \/etc\/docker\/daemon.json \x3c\x3c-\x27EOF\x27\n{\n  \x26quot;registry-mirrors\x26quot;: [\x26quot;https:\/\/\x3cyour-own\x3e.mirror.aliyuncs.com\x26quot;]\n}\nEOF\n\nexists(){\n  command -v \x26quot;$1\x26quot; \x3e\/dev\/null 2\x3e\x26amp;1\n}\n\necho \x27Installing docker-compose...\x27\nif ! exists pip; then\n    sudo apt install python-pip\nfi\nsudo python `which pip` install docker-compose\n\necho \x27Restarting docker...\x27\nsudo systemctl daemon-reload\nsudo systemctl restart docker\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# install docker\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e## prepare\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Preparing...\x27\x3c\/span\x3e\nsudo apt update\nsudo apt upgrade -y\nsudo apt install -y linux-image-extra-$(uname -r) linux-image-extra-virtual\n\x3cspan class=\x22hljs-comment\x22\x3e## docker\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Installing docker...\x27\x3c\/span\x3e\nsudo apt remove -y docker-ce docker-engine docker.io\nwget -qO- http:\/\/acs-public-mirror.oss-cn-hangzhou.aliyuncs.com\/docker-engine\/internet | sh\nsudo apt autoremove -y\n\nsudo usermod \x3cspan class=\x22hljs-_\x22\x3e-a\x3c\/span\x3eG docker \x3cspan class=\x22hljs-variable\x22\x3e${USER}\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e## docker Aliyun accelerator\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e## https:\/\/cr.console.aliyun.com\/#\/accelerator\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Configuring docker registry mirrors...\x27\x3c\/span\x3e\nsudo mkdir -p \/etc\/docker\nsudo tee \/etc\/docker\/daemon.json \x26lt;\x26lt;-\x3cspan class=\x22hljs-string\x22\x3e\x27EOF\x27\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22registry-mirrors\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/\x26lt;your-own\x26gt;.mirror.aliyuncs.com\x22\x3c\/span\x3e]\n}\nEOF\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eexists\x3c\/span\x3e\x3c\/span\x3e(){\n  \x3cspan class=\x22hljs-built_in\x22\x3ecommand\x3c\/span\x3e -v \x3cspan class=\x22hljs-string\x22\x3e\x22\x3cspan class=\x22hljs-variable\x22\x3e$1\x3c\/span\x3e\x22\x3c\/span\x3e \x26gt;\/dev\/null 2\x26gt;\x26amp;1\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Installing docker-compose...\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ! exists pip; \x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e\n    sudo apt install python-pip\n\x3cspan class=\x22hljs-keyword\x22\x3efi\x3c\/span\x3e\nsudo python `\x3cspan class=\x22hljs-built_in\x22\x3ewhich\x3c\/span\x3e pip` install docker-compose\n\n\x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Restarting docker...\x27\x3c\/span\x3e\nsudo systemctl daemon-reload\nsudo systemctl restart docker\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e部署\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e目录结构\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n├── .env \/\/ 环境变量\n├── docker-compose.yml\n├── backend \/\/ 放置后台django文件\n├── frontend \/\/ 放置前端vue编译后代码\n└── nginx \/\/ nginx相关配置\n    ├── backend.conf\n    ├── Dockerfile\n    └── frontend.conf\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e.\n├── \x3cspan class=\x22hljs-selector-class\x22\x3e.env\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 环境变量\x3c\/span\x3e\n├── docker-compose\x3cspan class=\x22hljs-selector-class\x22\x3e.yml\x3c\/span\x3e\n├── backend \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 放置后台django文件\x3c\/span\x3e\n├── frontend \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 放置前端vue编译后代码\x3c\/span\x3e\n└── nginx \x3cspan class=\x22hljs-comment\x22\x3e\/\/ nginx相关配置\x3c\/span\x3e\n    ├── backend\x3cspan class=\x22hljs-selector-class\x22\x3e.conf\x3c\/span\x3e\n    ├── Dockerfile\n    └── frontend.conf\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e具体配置\x3c\/h3\x3e\n\x3ch4\x3e\x3ccode\x3edocker-compose.yml\x3c\/code\x3e\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22version: \x273\x27\n\nservices:\n  web:\n    restart: always\n    build: .\/backend\n    expose:\n      - \x26quot;8000\x26quot;\n    volumes:\n      - .\/backend:\/code\n    env_file: .env\n    links:\n      - db\n    depends_on:\n      - db\n    command: [\x26quot;\/code\/wait-for-it.sh\x26quot;, \x26quot;db:3306\x26quot;, \x26quot;--\x26quot;, \x26quot;bash\x26quot;,\x26quot;startup.sh\x26quot;]\n  nginx:\n    restart: always\n    build: .\/nginx\n    ports:\n      - \x26quot;80:80\x26quot;\n    volumes:\n      - .\/frontend:\/usr\/share\/nginx\/html\/frontend:ro\n      - .\/backend\/public:\/usr\/share\/nginx\/\/html\/backend\/public:ro\n    links:\n      - web\n    depends_on:\n      - web\n  db:\n    restart: always\n    image: mysql:latest\n    env_file: .env\n    volumes:\n      - .\/data\/initsql:\/docker-entrypoint-initdb.d\n      - .\/data\/db:\/var\/lib\/mysql\n    command: [mysqld, --character-set-server=utf8, --collation-server=utf8_unicode_ci]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22yaml hljs\x22\x3e\x3ccode class=\x22yaml\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3eversion:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-attr\x22\x3eservices:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  web:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    restart:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ealways\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    build:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/backend\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    expose:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x228000\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    volumes:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/backend:\/code\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    env_file:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.env\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    links:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3edb\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    depends_on:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3edb\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    command:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x22\/code\/wait-for-it.sh\x22,\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22db:3306\x22\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22--\x22\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22bash\x22\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x22startup.sh\x22]\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  nginx:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    restart:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ealways\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    build:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/nginx\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    ports:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x2280:80\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    volumes:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/frontend:\/usr\/share\/nginx\/html\/frontend:ro\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/backend\/public:\/usr\/share\/nginx\/\/html\/backend\/public:ro\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    links:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eweb\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    depends_on:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eweb\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  db:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    restart:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ealways\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    image:\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emysql:latest\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    env_file:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.env\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    volumes:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/data\/initsql:\/docker-entrypoint-initdb.d\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e      -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/data\/db:\/var\/lib\/mysql\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    command:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[mysqld,\x3c\/span\x3e \x3cspan class=\x22hljs-bullet\x22\x3e--character-set-server=utf8,\x3c\/span\x3e \x3cspan class=\x22hljs-bullet\x22\x3e--collation-server=utf8_unicode_ci]\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一次使用docker-compose部署，从网上参考了许多例子。但是由于docker-compose个版本的语法改动不小，遇到很多坑：\x3c\/p\x3e\n\x3ch4\x3e不同容器共享数据(host主机上的数据)\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cp\x3e有些例子使用\x3ccode\x3evolumes_from\x3c\/code\x3e，但是version 3已经删除该设置项\x3ca href=\x22https:\/\/docs.docker.com\/compose\/compose-file\/compose-versioning\/#version-3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e更新变化\x3c\/a\x3e。\x3cbr\x3e官方推荐在根节点（与\x3ccode\x3eservices\x3c\/code\x3e同级）下配置\x3ccode\x3evolumes\x3c\/code\x3e，但是没法映射到host主机的文件，有个插件\x3ca href=\x22https:\/\/github.com\/CWSpear\/local-persist\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3elocal-persist\x3c\/code\x3e\x3c\/a\x3e可以做到，但是不想依赖第三方插件。只能使用麻烦点的写法：在每个service的\x3ccode\x3evolume\x3c\/code\x3e设置项里重复映射host主机的文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22web:\n  volumes:\n    - .\/backend:\/code\nnginx:\n  volumes:\n    - .\/backend\/public:\/usr\/share\/nginx\/\/html\/backend\/public:ro\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22yaml hljs\x22\x3e\x3ccode class=\x22yaml\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3eweb:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  volumes:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e    -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/backend:\/code\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3enginx:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  volumes:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e    -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/backend\/public:\/usr\/share\/nginx\/\/html\/backend\/public:ro\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e不同容器互相通信\x3c\/h4\x3e\n\x3cblockquote\x3e使用links实现容器间通信。配置需要访问的容器于links配置项下，没什么毛病。\x3c\/blockquote\x3e\n\x3ch4\x3e容器启动顺序\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cp\x3e实现容器按顺序启动，需要用到\x3ccode\x3edepends_on\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e但是会有一个问题：\x3ccode\x3edepends_on\x3c\/code\x3e只保证启动顺序，而我们的实际需求是：web容器启动的commands必须等到mysql完全启动，web容器的command才可以执行。因为我们加了\x3ccode\x3erestart: always\x3c\/code\x3e，所以会导致web容器不断重启直到db容器启动完成。\x3c\/p\x3e\n\x3cp\x3e我的解决办法是：给web容器的启动命令加上对mysql服务可用的查询，使用了一个查询脚本\x3ca href=\x22https:\/\/github.com\/vishnubob\/wait-for-it\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewait-for-it\x3c\/a\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22command: [\x26quot;\/code\/wait-for-it.sh\x26quot;, \x26quot;db:3306\x26quot;, \x26quot;--\x26quot;, \x26quot;bash\x26quot;,\x26quot;startup.sh\x26quot;]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22dockerfile hljs\x22\x3e\x3ccode class=\x22dockerfile\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3ecommand: [\x3cspan class=\x22hljs-string\x22\x3e\x22\/code\/wait-for-it.sh\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22db:3306\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22--\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22bash\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22startup.sh\x22\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e环境变量\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cp\x3e会有多个容器使用相同环境变量的情况，所以都放在\x3ccode\x3e.env\x3c\/code\x3e文件里\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22DEBUG=false\n\nMYSQL_HOST=db\nMYSQL_DATABASE=mydb\nMYSQL_ROOT_PASSWORD=mypass\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ini\x22\x3e\x3ccode class=\x22shell\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3eDEBUG\x3c\/span\x3e=\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-attr\x22\x3eMYSQL_HOST\x3c\/span\x3e=db\n\x3cspan class=\x22hljs-attr\x22\x3eMYSQL_DATABASE\x3c\/span\x3e=mydb\n\x3cspan class=\x22hljs-attr\x22\x3eMYSQL_ROOT_PASSWORD\x3c\/span\x3e=mypass\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e关于Mysql官方镜像配置\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e可以定义volume持久化数据库文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22volumes:\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22yaml hljs\x22\x3e\x3ccode class=\x22yaml\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3evolumes:\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n- 如果有初始数据需要导入，可以定义volume映射到`\/docker-entrypoint-initdb.d`：\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dockerfile\x22\x3e\x3ccode\x3e\n- 如果有初始数据需要导入，可以定义\x3cspan class=\x22hljs-keyword\x22\x3evolume\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e映射到`\/docker-entrypoint-initdb.d`：\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3evolumes:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22- .\/data\/initsql:\/docker-entrypoint-initdb.d\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dockerfile\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e- .\/data\/initsql:\/docker-\x3cspan class=\x22hljs-keyword\x22\x3eentrypoint\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e-initdb.d\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22注意： 该配置只有在`\/var\/lib\/mysql\/`下的`mysql`目录不存在时才会生效。也就是说，一旦容器启动过一次，之后就在也不会导入`\/docker-entrypoint-initdb.d`里的文件，除非手动清空`\/var\/lib\/mysql\/`（或host主机的`.\/data\/db`目录）。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autohotkey\x22\x3e\x3ccode\x3e注意： 该配置只有在`\/var\/lib\/mysql\/`下的`mysql`目录不存在时才会生效。也就是说，一旦容器启动过一次，之后就在也不会导入`\/docker-entrypoint-initdb.d`里的文件，除非手动清空`\/var\/lib\/mysql\/`（或host主机的`.\/data\/db`目录）。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e关于Nginx容器配置\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3ccode\x3eDockerfile\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22FROM nginx:alpine\n\nRUN rm \/etc\/nginx\/conf.d\/default.conf\n\nADD frontend.conf \/etc\/nginx\/conf.d\/\nADD backend.conf \/etc\/nginx\/conf.d\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22dockerfile hljs\x22\x3e\x3ccode class=\x22dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e nginx:alpine\n\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e rm \/etc\/nginx\/conf.d\/default.conf\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e frontend.conf \/etc\/nginx\/conf.d\/\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e backend.conf \/etc\/nginx\/conf.d\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3efrontend.conf\x3c\/code\x3e - vue app build files\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22server {\n    listen 80 deferred;\n    server_name new.bylie.cn;\n\n    root \/usr\/share\/nginx\/html\/frontend;\n\n    location \/ {\n        try_files $uri $uri\/ \/index.html =404;\n    }\n\n    # redirect server error pages to the static page \/50x.html\n    #\n    error_page   500 502 503 504  \/50x.html;\n    location = \/50x.html {\n        root   \/usr\/share\/nginx\/html;\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22nginx hljs\x22\x3e\x3ccode class=\x22nginx\x22\x3e\x3cspan class=\x22hljs-section\x22\x3eserver\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3elisten\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e80\x3c\/span\x3e deferred;\n    \x3cspan class=\x22hljs-attribute\x22\x3eserver_name\x3c\/span\x3e new.bylie.cn;\n\n    \x3cspan class=\x22hljs-attribute\x22\x3eroot\x3c\/span\x3e \/usr\/share\/nginx\/html\/frontend;\n\n    \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e \/ {\n        \x3cspan class=\x22hljs-attribute\x22\x3etry_files\x3c\/span\x3e \x3cspan class=\x22hljs-variable\x22\x3e$uri\x3c\/span\x3e \x3cspan class=\x22hljs-variable\x22\x3e$uri\x3c\/span\x3e\/ \/index.html =\x3cspan class=\x22hljs-number\x22\x3e404\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e# redirect server error pages to the static page \/50x.html\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e#\x3c\/span\x3e\n    \x3cspan class=\x22hljs-attribute\x22\x3eerror_page\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e502\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e503\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e504\x3c\/span\x3e  \/50x.html;\n    \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e = \/50x.html {\n        \x3cspan class=\x22hljs-attribute\x22\x3eroot\x3c\/span\x3e   \/usr\/share\/nginx\/html;\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ebackend.conf\x3c\/code\x3e - django app\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22server {\n    # use \x27listen 80 deferred;\x27 for Linux\n    # use \x27listen 80 accept_filter=httpready;\x27 for FreeBSD\n    listen 80 deferred;\n    client_max_body_size 5M;\n\n    # set the correct host(s) for your site\n    server_name service.bylie.cn;\n\n    keepalive_timeout 5;\n\n    location \/public {\n        root \/usr\/share\/nginx\/html\/backend;\n    }\n\n    location \/ {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        # enable this if and only if you use HTTPS\n        # proxy_set_header X-Forwarded-Proto https;\n        proxy_set_header Host $http_host;\n        # we don\x27t want nginx trying to do something clever with\n        # redirects, we set the Host: header above already.\n        proxy_redirect off;\n        proxy_pass http:\/\/web:8000;\n    }\n\n    error_page   500 502 503 504  \/50x.html;\n    location = \/50x.html {\n        root   html;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22nginx hljs\x22\x3e\x3ccode class=\x22nginx\x22\x3e\x3cspan class=\x22hljs-section\x22\x3eserver\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e# use \x27listen 80 deferred;\x27 for Linux\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e# use \x27listen 80 accept_filter=httpready;\x27 for FreeBSD\x3c\/span\x3e\n    \x3cspan class=\x22hljs-attribute\x22\x3elisten\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e80\x3c\/span\x3e deferred;\n    \x3cspan class=\x22hljs-attribute\x22\x3eclient_max_body_size\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5M\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e# set the correct host(s) for your site\x3c\/span\x3e\n    \x3cspan class=\x22hljs-attribute\x22\x3eserver_name\x3c\/span\x3e service.bylie.cn;\n\n    \x3cspan class=\x22hljs-attribute\x22\x3ekeepalive_timeout\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e \/public {\n        \x3cspan class=\x22hljs-attribute\x22\x3eroot\x3c\/span\x3e \/usr\/share\/nginx\/html\/backend;\n    }\n\n    \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e \/ {\n        \x3cspan class=\x22hljs-attribute\x22\x3eproxy_set_header\x3c\/span\x3e X-Forwarded-For \x3cspan class=\x22hljs-variable\x22\x3e$proxy_add_x_forwarded_for\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e# enable this if and only if you use HTTPS\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e# proxy_set_header X-Forwarded-Proto https;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attribute\x22\x3eproxy_set_header\x3c\/span\x3e Host \x3cspan class=\x22hljs-variable\x22\x3e$http_host\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e# we don\x27t want nginx trying to do something clever with\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e# redirects, we set the Host: header above already.\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attribute\x22\x3eproxy_redirect\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eoff\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-attribute\x22\x3eproxy_pass\x3c\/span\x3e http:\/\/web:8000;\n    }\n\n    \x3cspan class=\x22hljs-attribute\x22\x3eerror_page\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e502\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e503\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e504\x3c\/span\x3e  \/50x.html;\n    \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e = \/50x.html {\n        \x3cspan class=\x22hljs-attribute\x22\x3eroot\x3c\/span\x3e   html;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e备份数据库到host主机\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22docker-compose exec db sh -c \x27exec mysqldump -uroot -p\x26quot;$MYSQL_ROOT_PASSWORD\x26quot; --databases ${MYSQL_DATABASE}\x27 \x3e .\/backup\/database.sql\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode class=\x22shell\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3edocker-compose exec \x3cspan class=\x22hljs-keyword\x22\x3edb\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3esh\x3c\/span\x3e -c \x27exec mysqldump -uroot -p\x3cspan class=\x22hljs-string\x22\x3e\x22$MYSQL_ROOT_PASSWORD\x22\x3c\/span\x3e --databases \x3cspan class=\x22hljs-variable\x22\x3e${MYSQL_DATABASE}\x3c\/span\x3e\x27 \x26gt; .\/backup\/database.sql\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e关于django web容器配置\x3c\/h4\x3e\n\x3cblockquote\x3e\n\x3cp\x3e比较简单\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eDockerfile\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22FROM python:3\n\nENV PYTHONUNBUFFERED 1\nRUN mkdir \/code\nWORKDIR \/code\nADD requirements.txt \/tmp\/\nRUN pip install -r \/tmp\/requirements.txt\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22dockerfile hljs\x22\x3e\x3ccode class=\x22dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e python:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eENV\x3c\/span\x3e PYTHONUNBUFFERED \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e mkdir \/code\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eWORKDIR\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \/code\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e requirements.txt \/tmp\/\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e pip install -r \/tmp\/requirements.txt\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e启动脚本\x3ccode\x3estartup.sh\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#!\/usr\/bin\/env bash\npython manage.py collectstatic --noinput \x26amp;\x26amp;\npython manage.py migrate \x26amp;\x26amp;\ngunicorn django_web_app.wsgi:application -w 2 -b :8000\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs bash\x22\x3e\x3ccode class=\x22shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/usr\/bin\/env bash\x3c\/span\x3e\npython manage.py collectstatic --noinput \x26amp;\x26amp;\npython manage.py migrate \x26amp;\x26amp;\ngunicorn django_web_app.wsgi:application -w 2 -b :8000\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当容器运行起来之后，可能需要导入一些初始数据或者fixtures，我写了一个init的django custom command，手动执行该command：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22docker-compose exec web python manage.py init\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mel\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3edocker-compose \x3cspan class=\x22hljs-keyword\x22\x3eexec\x3c\/span\x3e web \x3cspan class=\x22hljs-keyword\x22\x3epython\x3c\/span\x3e manage.py init\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>使用Docker Compose部署Django和Vue.js应用</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010227994">https://segmentfault.com/a/1190000010227994</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fbd5kdztg34/" target="_blank">https://alili.tech/archive/fbd5kdztg34/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5fmk2pl6rab/">2016年前端开发者深度调研，看看别人使用什么技术体系<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/stp6408xnu/">Bootstrap使用模态框modal实现表单提交弹出框<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/fu7a86e9uyh/">CSS水平垂直居中总结<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/r0w29esklr/">JS 里怎么给数组填充默认值<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/i00hiszlr1/">JavaScript - EventEmitter 背后的秘密<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/u2la0cn9do/">JavaScript 精度丢失问题<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/3txhfn3ejcb/">Nodejs进阶：如何玩转子进程（child_process）<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/yr7v8e9fao/">Promise介绍--规范篇<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/9lyxyz4wc6g/">QQ音乐API整理<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/84zzlljmes4/">SegmentFault 技术周刊 Vol.14 - 进阶 Vue 2.0<aside class="dates">2019-01-30</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>