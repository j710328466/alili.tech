<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="从redux-thunk到redux-saga实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>从redux-thunk到redux-saga实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/mntkx8nlch8/",
				"appid": "1613049289050283", 
				"title": "从redux-thunk到redux-saga实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-11T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hcorf22bqh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/11jwxjgd200b/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&text=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&text=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&title=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&is_video=false&description=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&title=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&title=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&title=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmntkx8nlch8%2f&title=%e4%bb%8eredux-thunk%e5%88%b0redux-saga%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">从redux-thunk到redux-saga实践</h1><div class="meta"><div class="postdate"><time datetime="2019-01-11" itemprop="datePublished">2019-01-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e文章同步于Github \x3ca href=\x22https:\/\/github.com\/Pines-Cheng\/blog\/issues\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePines-Cheng\/blog\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e简介\x3c\/h2\x3e\n\x3cblockquote\x3e本质都是为了解决异步action的问题\x3c\/blockquote\x3e\n\x3cp\x3eRedux Saga可以理解为一个和系统交互的常驻进程，其中，Saga可简单定义如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Saga = Worker \x2b Watcher\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ini\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3eSaga\x3c\/span\x3e = Worker \x2b Watcher\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3esaga特点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3esaga的应用场景是复杂异步，如长时事务\x3ccode\x3eLLT(long live transcation)\x3c\/code\x3e等业务场景。\x3c\/li\x3e\n\x3cli\x3e方便测试，可以使用takeEvery打印logger。\x3c\/li\x3e\n\x3cli\x3e提供\x3ccode\x3etakeLatest\/takeEvery\/throttle\x3c\/code\x3e方法，可以便利的实现对事件的仅关注最近事件、关注每一次、事件限频\x3c\/li\x3e\n\x3cli\x3e提供\x3ccode\x3ecancel\/delay\x3c\/code\x3e方法，可以便利的取消、延迟异步请求\x3c\/li\x3e\n\x3cli\x3e提供\x3ccode\x3erace(effects),[…effects]\x3c\/code\x3e方法来支持竞态和并行场景\x3c\/li\x3e\n\x3cli\x3e提供channel机制支持外部事件\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eRedux Saga适用于对事件操作有细粒度需求的场景，同时他们也提供了更好的可测试性。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3ethunk VS saga\x3c\/h2\x3e\n\x3cp\x3e这里有一个简单的需求，登录页面，使用\x3ccode\x3eredux-thunk\x3c\/code\x3e与\x3ccode\x3easync \/ await\x3c\/code\x3e。组件可能看起来像这样，像平常一样分派操作。\x3c\/p\x3e\n\x3cp\x3e组件部分二者应该是大同小异：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { login } from \x27redux\/auth\x27;\n\nclass LoginForm extends Component {\n\n  onClick(e) {\n    e.preventDefault();\n    const { user, pass } = this.refs;\n    this.props.dispatch(login(user.value, pass.value));\n  }\n\n  render() {\n    return (\x3cdiv\x3e\n        \x3cinput type=\x26quot;text\x26quot; ref=\x26quot;user\x26quot; \/\x3e\n        \x3cinput type=\x26quot;password\x26quot; ref=\x26quot;pass\x26quot; \/\x3e\n        \x3cbutton onClick={::this.onClick}\x3eSign In\x3c\/button\x3e\n    \x3c\/div\x3e);\n  } \n}\n\nexport default connect((state) =\x3e ({}))(LoginForm);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { login } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\/auth\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLoginForm\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n\n  onClick(e) {\n    e.preventDefault();\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { user, pass } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refs;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.dispatch(login(user.value, pass.value));\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x26lt;div\x26gt;\n        \x26lt;input type=\x22text\x22 ref=\x22user\x22 \/\x26gt;\n        \x26lt;input type=\x22password\x22 ref=\x22pass\x22 \/\x26gt;\n        \x26lt;button onClick={::this.onClick}\x26gt;Sign In\x26lt;\/button\x26gt;\n    \x26lt;\/div\x26gt;);\n  } \n}\n\nexport default connect((state) =\x26gt; ({}))(LoginForm);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e使用redux-thunk\x3c\/h3\x3e\n\x3cp\x3e登录的action文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ auth.js\n\nimport request from \x27axios\x27;\nimport { loadUserData } from \x27.\/user\x27;\n\n\/\/ define constants\n\/\/ define initial state\n\/\/ export default reducer\n\nexport const login = (user, pass) =\x3e async (dispatch) =\x3e {\n    try {\n        dispatch({ type: LOGIN_REQUEST });\n        let { data } = await request.post(\x27\/login\x27, { user, pass });\n        await dispatch(loadUserData(data.uid));\n        dispatch({ type: LOGIN_SUCCESS, data });\n    } catch(error) {\n        dispatch({ type: LOGIN_ERROR, error });\n    }\n}\n\n\/\/ more actions...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ auth.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e request \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27axios\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { loadUserData } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/user\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ define constants\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ define initial state\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ export default reducer\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e login = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3euser, pass\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (dispatch) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_REQUEST });\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e request.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, { user, pass });\n        \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e dispatch(loadUserData(data.uid));\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_SUCCESS, data });\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(error) {\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_ERROR, error });\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ more actions...\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e更新用户数据的页面：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ user.js\n\nimport request from \x27axios\x27;\n\n\/\/ define constants\n\/\/ define initial state\n\/\/ export default reducer\n\nexport const loadUserData = (uid) =\x3e async (dispatch) =\x3e {\n    try {\n        dispatch({ type: USERDATA_REQUEST });\n        let { data } = await request.get(`\/users\/${uid}`);\n        dispatch({ type: USERDATA_SUCCESS, data });\n    } catch(error) {\n        dispatch({ type: USERDATA_ERROR, error });\n    }\n}\n\n\/\/ more actions...\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ user.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e request \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27axios\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ define constants\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ define initial state\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ export default reducer\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e loadUserData = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3euid\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (dispatch) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_REQUEST });\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e request.get(\x3cspan class=\x22hljs-string\x22\x3e`\/users\/\x3cspan class=\x22hljs-subst\x22\x3e${uid}\x3c\/span\x3e`\x3c\/span\x3e);\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_SUCCESS, data });\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(error) {\n        dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_ERROR, error });\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ more actions...\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e使用redux-saga\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function* loginSaga() {\n  while(true) {\n    const { user, pass } = yield take(LOGIN_REQUEST) \/\/等待 Store 上指定的 action LOGIN_REQUEST\n    try {\n      let { data } = yield call(request.post, \x27\/login\x27, { user, pass }); \/\/阻塞，请求后台数据\n      yield fork(loadUserData, data.uid); \/\/非阻塞执行loadUserData\n      yield put({ type: LOGIN_SUCCESS, data }); \/\/发起一个action，类似于dispatch\n    } catch(error) {\n      yield put({ type: LOGIN_ERROR, error });\n    }  \n  }\n}\n\nexport function* loadUserData(uid) {\n  try {\n    yield put({ type: USERDATA_REQUEST });\n    let { data } = yield call(request.get, `\/users\/${uid}`);\n    yield put({ type: USERDATA_SUCCESS, data });\n  } catch(error) {\n    yield put({ type: USERDATA_ERROR, error });\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eloginSaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { user, pass } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(LOGIN_REQUEST) \x3cspan class=\x22hljs-comment\x22\x3e\/\/等待 Store 上指定的 action LOGIN_REQUEST\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(request.post, \x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, { user, pass }); \x3cspan class=\x22hljs-comment\x22\x3e\/\/阻塞，请求后台数据\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(loadUserData, data.uid); \x3cspan class=\x22hljs-comment\x22\x3e\/\/非阻塞执行loadUserData\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_SUCCESS, data }); \x3cspan class=\x22hljs-comment\x22\x3e\/\/发起一个action，类似于dispatch\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(error) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_ERROR, error });\n    }  \n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eloadUserData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euid\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_REQUEST });\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(request.get, \x3cspan class=\x22hljs-string\x22\x3e`\/users\/\x3cspan class=\x22hljs-subst\x22\x3e${uid}\x3c\/span\x3e`\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_SUCCESS, data });\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(error) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: USERDATA_ERROR, error });\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们使用形式\x3ccode\x3eyield call(func，… args)\x3c\/code\x3e调用api函数。调用不会执行效果，它只是创建一个简单的对象，如\x3ccode\x3e{type：’CALL’，func，args}\x3c\/code\x3e。执行被委托给redux-saga中间件，该中间件负责执行函数并且用其结果恢复generatorr。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e优点\x3c\/h3\x3e\n\x3cp\x3e相比Redux Thunk，使用Redux Saga有几处明显的变化：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e在组件中，不再\x3ccode\x3edispatch(action creator)\x3c\/code\x3e，而是\x3ccode\x3edispatch(pure action)\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e组件中不再关注由谁来处理当前action，action经由root saga分发\x3c\/li\x3e\n\x3cli\x3e具体业务处理方法中，通过提供的call\/put等帮助方法，声明式的进行方法调用\x3c\/li\x3e\n\x3cli\x3e使用\x3ccode\x3eES6 Generator\x3c\/code\x3e语法，简化异步代码语法\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e除开上述这些不同点，Redux Saga真正的威力，在于其提供了一系列帮助方法，使得对于各类事件可以进行更细粒度的控制，从而完成更加复杂的操作。\x3c\/p\x3e\n\x3ch4\x3e方便测试\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const iterator = loginSaga()\n\nassert.deepEqual(iterator.next().value, take(LOGIN_REQUEST))\n\n\/\/ resume the generator with some dummy action\nconst mockAction = {user: \x27...\x27, pass: \x27...\x27}\nassert.deepEqual(\n  iterator.next(mockAction).value, \n  call(request.post, \x27\/login\x27, mockAction)\n)\n\n\/\/ simulate an error result\nconst mockError = \x27invalid user\/password\x27\nassert.deepEqual(\n  iterator.throw(mockError).value, \n  put({ type: LOGIN_ERROR, error: mockError })\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e iterator = loginSaga()\n\nassert.deepEqual(iterator.next().value, take(LOGIN_REQUEST))\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ resume the generator with some dummy action\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mockAction = {\x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epass\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e}\nassert.deepEqual(\n  iterator.next(mockAction).value, \n  call(request.post, \x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, mockAction)\n)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ simulate an error result\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mockError = \x3cspan class=\x22hljs-string\x22\x3e\x27invalid user\/password\x27\x3c\/span\x3e\nassert.deepEqual(\n  iterator.throw(mockError).value, \n  put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOGIN_ERROR, \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: mockError })\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，我们通过简单地将模拟数据注入迭代器的下一个方法来检查api调用结果。模拟数据比模拟函数更简单。\x3c\/p\x3e\n\x3ch4\x3e监听过滤action\x3c\/h4\x3e\n\x3cp\x3e通过\x3ccode\x3eyield take(ACTION)\x3c\/code\x3e可以方便自由的对action进行拦截和过滤。Thunks由每个新动作的动作创建者调用(例如LOGIN_REQUEST)。即动作被不断地推送到thunk，并且thunk不能控制何时停止处理那些动作。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e复杂应用场景\x3c\/h2\x3e\n\x3cp\x3e假设例如我们要添加以下要求：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e处理LOGOUT用户操作\x3c\/li\x3e\n\x3cli\x3e在第一次成功登录时，服务器返回token，该token在expires_in字段中存储的一些后到期。我们必须在每隔expires_in毫秒时间后的重新向后台刷新授权\x3c\/li\x3e\n\x3cli\x3e考虑到在等待api调用的结果(初始登录或刷新)时，用户可以在其间注销\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你将如何实现这一点与thunk？同时还为整个流程提供全面的测试覆盖？\x3c\/p\x3e\n\x3cp\x3e可是如果你使用redux-saga：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* authorize(credentials) {\n  const token = yield call(api.authorize, credentials)\n  yield put( login.success(token) )\n  return token\n}\n\nfunction* authAndRefreshTokenOnExpiry(name, password) {\n  let token = yield call(authorize, {name, password})\n  while(true) {\n    yield call(delay, token.expires_in)\n    token = yield call(authorize, {token})\n  }\n}\n\nfunction* watchAuth() {\n  while(true) {\n    try {\n      const {name, password} = yield take(LOGIN_REQUEST)\n\n      yield race([\n        take(LOGOUT),\n        call(authAndRefreshTokenOnExpiry, name, password)\n      ])\n\n      \/\/ user logged out, next while iteration will wait for the\n      \/\/ next LOGIN_REQUEST action\n\n    } catch(error) {\n      yield put( login.error(error) )\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eauthorize\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecredentials\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e token = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(api.authorize, credentials)\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put( login.success(token) )\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e token\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eauthAndRefreshTokenOnExpiry\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename, password\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e token = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(authorize, {name, password})\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(delay, token.expires_in)\n    token = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(authorize, {token})\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchAuth\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {name, password} = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(LOGIN_REQUEST)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e race([\n        take(LOGOUT),\n        call(authAndRefreshTokenOnExpiry, name, password)\n      ])\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ user logged out, next while iteration will wait for the\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ next LOGIN_REQUEST action\x3c\/span\x3e\n\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(error) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put( login.error(error) )\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的例子中，我们使用race表示了并发要求。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e如果take(LOGOUT)赢得比赛(即用户点击注销按钮)。比赛将自动取消\x3ccode\x3eauthAndRefreshTokenOnExpiry\x3c\/code\x3e后台任务。\x3c\/li\x3e\n\x3cli\x3e如果\x3ccode\x3eauthAndRefreshTokenOnExpiry\x3c\/code\x3e在调用(授权，{token})调用的中间被阻止，它也将被取消。取消自动向下传播。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e其他特殊场景\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e同时执行多个任务\x3c\/h3\x3e\n\x3cp\x3e有时候我们需要在几个ajax请求执行完之后，再执行对应的操作。redux-thunk需要借助第三方的库，而redux-saga是直接实现的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { call } from \x27redux-saga\/effects\x27\n\n\/\/ 正确写法, effects 将会同步执行\nconst [users, repos] = yield [\n  call(fetch, \x27\/users\x27),\n  call(fetch, \x27\/repos\x27)\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { call } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 正确写法, effects 将会同步执行\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e [users, repos] = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e [\n  call(fetch, \x3cspan class=\x22hljs-string\x22\x3e\x27\/users\x27\x3c\/span\x3e),\n  call(fetch, \x3cspan class=\x22hljs-string\x22\x3e\x27\/repos\x27\x3c\/span\x3e)\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当我们需要 yield 一个包含 effects 的数组， generator 会被阻塞直到所有的 effects 都执行完毕，或者当一个 effect 被拒绝 （就像 Promise.all 的行为）。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e监听action\x3c\/h3\x3e\n\x3cp\x3e在redux-saga中，我们可以使用了辅助函数 takeEvery 在每个 action 来到时派生一个新的任务。 这多少有些模仿 redux-thunk 的行为：举个例子，每次一个组件调用 \x3ccode\x3efetchProducts Action \x3c\/code\x3e创建器（Action Creator），Action 创建器就会发起一个 thunk 来执行控制流。\x3c\/p\x3e\n\x3cp\x3e在现实情况中，takeEvery 只是一个在强大的低阶 API 之上构建的辅助函数。 在这一节中我们将看到一个新的 Effect，即 take。take 让我们通过全面控制 action 观察进程来构建复杂的控制流成为可能。\x3c\/p\x3e\n\x3cp\x3e让我们开始一个简单的 Saga 例子，这个 Saga 将监听所有发起到 store 的 action，然后将它们记录到控制台。\x3c\/p\x3e\n\x3cp\x3e使用 takeEvery(\x27\x3cem\x3e\x27)（\x3c\/em\x3e 代表通配符模式），我们就能捕获发起的所有类型的 action。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { takeEvery } from \x27redux-saga\x27\n\nfunction* watchAndLog(getState) {\n  yield* takeEvery(\x27*\x27, function* logger(action) {\n    console.log(\x27action\x27, action)\n    console.log(\x27state after\x27, getState())\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { takeEvery } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchAndLog\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egetState\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e* takeEvery(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3elogger\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27action\x27\x3c\/span\x3e, action)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state after\x27\x3c\/span\x3e, getState())\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在我们知道如何使用 take Effect 来实现和上面相同的功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { take } from \x27redux-saga\/effects\x27\n\nfunction* watchAndLog(getState) {\n  while(true) {\n    const action = yield take(\x27*\x27)\n    console.log(\x27action\x27, action)\n    console.log(\x27state after\x27, getState())\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { take } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchAndLog\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egetState\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27action\x27\x3c\/span\x3e, action)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state after\x27\x3c\/span\x3e, getState())\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3etake 就像我们更早之前看到的 call 和 put。它创建另一个命令对象，告诉 middleware 等待一个特定的 action。 正如在 call Effect 的情况中，middleware 会暂停 Generator，直到返回的 Promise 被 resolve。 在 take 的情况中，它将会暂停 Generator 直到一个匹配的 action 被发起了。 在以上的例子中，watchAndLog 处于暂停状态，直到任意的一个 action 被发起。\x3c\/p\x3e\n\x3cp\x3e注意，我们运行了一个无限循环的 while(true)。记住这是一个 Generator 函数，它不具备 从运行至完成 的行为\x3ccode\x3e（run-to-completion behavior）\x3c\/code\x3e。 Generator 将在每次迭代上阻塞以等待 action 发起。\x3c\/p\x3e\n\x3cp\x3e一个简单的例子，假设在我们的 Todo 应用中，我们希望监听用户的操作，并在用户初次创建完三条 Todo 信息时显示祝贺信息。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { take, put } from \x27redux-saga\/effects\x27\n\nfunction* watchFirstThreeTodosCreation() {\n  for(let i = 0; i \x3c 3; i\x2b\x2b) {\n    const action = yield take(\x27TODO_CREATED\x27)\n  }\n  yield put({type: \x27SHOW_CONGRATULATION\x27})\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { take, put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchFirstThreeTodosCreation\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(\x3cspan class=\x22hljs-string\x22\x3e\x27TODO_CREATED\x27\x3c\/span\x3e)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27SHOW_CONGRATULATION\x27\x3c\/span\x3e})\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e与 while(true) 不同，我们运行一个只迭代三次的 for 循环。在 take 初次的 3 个 TODO_CREATED action 之后， \x3ccode\x3ewatchFirstThreeTodosCreation Saga\x3c\/code\x3e 将会使应用显示一条祝贺信息然后中止。这意味着 Generator 会被回收并且相应的监听不会再发生。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e任务取消\x3c\/h3\x3e\n\x3cp\x3e一旦任务被 fork，可以使用 \x3ccode\x3eyield cancel(task)\x3c\/code\x3e 来中止任务执行。取消正在运行的任务，将抛出 \x3ccode\x3eSagaCancellationException\x3c\/code\x3e 错误。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e防抖动\x3c\/h3\x3e\n\x3cp\x3e为了对 action 队列进行防抖动，可以在被 fork 的任务里放置一个 delay。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const delay = (ms) =\x3e new Promise(resolve =\x3e setTimeout(resolve, ms))\n\nfunction* handleInput(input) {\n  \/\/ 500ms 防抖动\n  yield call(delay, 500)\n  ...\n}\n\nfunction* watchInput() {\n  let task\n  while(true) {\n    const { input } = yield take(\x27INPUT_CHANGED\x27)\n    if(task)\n      yield cancel(task)\n    task = yield fork(handleInput, input)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e delay = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ems\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e setTimeout(resolve, ms))\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ehandleInput\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3einput\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 500ms 防抖动\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(delay, \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e)\n  ...\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchInput\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e task\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { input } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(\x3cspan class=\x22hljs-string\x22\x3e\x27INPUT_CHANGED\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(task)\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e cancel(task)\n    task = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(handleInput, input)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的示例中，handleInput 在执行之前等待了 500ms。如果用户在此期间输入了更多文字，我们将收到更多的 \x3ccode\x3eINPUT_CHANGED action\x3c\/code\x3e。 并且由于 handleInput 仍然会被 delay 阻塞，所以在执行自己的逻辑之前它会被 watchInput 取消。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e常用\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3eEffect\x3c\/h3\x3e\n\x3cp\x3e一个 effect 就是一个纯文本 JavaScript 对象，包含一些将被 saga middleware 执行的指令。\x3c\/p\x3e\n\x3cp\x3e使用 redux-saga 提供的工厂函数来创建 effect。 举个例子，你可以使用 \x3ccode\x3ecall(myfunc, \x27arg1\x27, \x27arg2\x27) \x3c\/code\x3e指示 middleware 调用 \x3ccode\x3emyfunc(\x27arg1\x27, \x27arg2\x27)\x3c\/code\x3e 并将结果返回给 yield 了 effect 的那个 Generator。\x3c\/p\x3e\n\x3cp\x3e从 Saga 内触发异步操作（Side Effect）总是由 yield 一些声明式的 Effect 来完成的 （你也可以直接 yield Promise，但是这会让测试变得困难。使用 Effect 诸如 call 和 put，与高阶 API 如 takeEvery 相结合，让我们实现与 redux-thunk 同样的东西， 但又有额外的易于测试的好处。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3etask\x3c\/h3\x3e\n\x3cp\x3e一个 task 就像是一个在后台运行的进程。在基于 redux-saga 的应用程序中，可以同时运行多个 task。通过 fork 函数来创建 task：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* saga() {\n  ...\n  const task = yield fork(otherSaga, ...args)\n  ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3esaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  ...\n  const task = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(otherSaga, ...args)\n  ...\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eWatcher\/Worker\x3c\/h3\x3e\n\x3cp\x3e指的是一种使用两个单独的 Saga 来组织控制流的方式。\x3c\/p\x3e\n\x3cp\x3eWatcher: 监听发起的 action 并在每次接收到 action 时 fork 一个 worker。\x3c\/p\x3e\n\x3cp\x3eWorker: 处理 action 并结束它。\x3c\/p\x3e\n\x3cp\x3e示例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* watcher() {\n  while(true) {\n    const action = yield take(ACTION)\n    yield fork(worker, action.payload)\n  }\n}\n\nfunction* worker(payload) {\n  \/\/ ... do some stuff\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatcher\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(ACTION)\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(worker, action.payload)\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eworker\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epayload\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... do some stuff\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3etake(pattern)\x3c\/h3\x3e\n\x3cp\x3e创建一条 Effect 描述信息，指示 middleware 等待 Store 上指定的 action。 Generator 会暂停，直到一个与 pattern 匹配的 action 被发起。\x3c\/p\x3e\n\x3cp\x3e用以下规则来解释 pattern：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e如果调用 take 时参数为空，或者传入 \x27*\x27，那将会匹配所有发起的 action（例如，take() 会匹配所有的 action）。\x3c\/li\x3e\n\x3cli\x3e如果是一个函数，action 会在 pattern(action) 返回为 true 时被匹配（例如，\x3ccode\x3etake(action =\x26gt; action.entities\x3c\/code\x3e) 会匹配那些 entities 字段为真的 action）。\x3c\/li\x3e\n\x3cli\x3e如果是一个字符串，action 会在 \x3ccode\x3eaction.type === pattern \x3c\/code\x3e时被匹配（例如，take(INCREMENT_ASYNC)）。\x3c\/li\x3e\n\x3cli\x3e如果参数是一个数组，会针对数组所有项，匹配与 action.type 相等的 action（例如，\x3ccode\x3etake([INCREMENT, DECREMENT])\x3c\/code\x3e 会匹配 INCREMENT 或 DECREMENT 类型的 action）。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eput(action)\x3c\/h3\x3e\n\x3cp\x3e用于触发 action，功能上类似于dispatch。\x3c\/p\x3e\n\x3cp\x3e创建一条\x3ccode\x3edispatch Effect\x3c\/code\x3e 描述信息，指示 middleware 发起一个 action 到 Store。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eaction: Object - 完整信息可查看 \x3ca href=\x22http:\/\/redux.js.org\/docs\/api\/Store.html#dispatch\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux 的 dispatch 文档\x3c\/a\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e直接使用dispatch：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/...\n\nfunction* fetchProducts(dispatch)\n  const products = yield call(Api.fetch, \x27\/products\x27)\n  dispatch({ type: \x27PRODUCTS_RECEIVED\x27, products })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3efetchProducts\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-title\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproducts\x3c\/span\x3e = \x3cspan class=\x22hljs-title\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecall\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eApi.fetch, \x3cspan class=\x22hljs-string\x22\x3e\x27\/products\x27\x3c\/span\x3e\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-title\x22\x3edispatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ type: \x3cspan class=\x22hljs-string\x22\x3e\x27PRODUCTS_RECEIVED\x27\x3c\/span\x3e, products }\x3c\/span\x3e)\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该解决方案与我们在上一节中看到的从 Generator 内部直接调用函数，有着相同的缺点。如果我们想要测试 fetchProducts 接收到 AJAX 响应之后执行 dispatch， 我们还需要模拟 dispatch 函数。\x3c\/p\x3e\n\x3cp\x3e相反，我们需要同样的声明式的解决方案。只需创建一个对象来指示 middleware 我们需要发起一些 action，然后让 middleware 执行真实的 dispatch。 这种方式我们就可以同样的方式测试 Generator 的 dispatch：只需检查 yield 后的 Effect，并确保它包含正确的指令。\x3c\/p\x3e\n\x3cp\x3eredux-saga 为此提供了另外一个函数 put，这个函数用于创建 \x3ccode\x3edispatch Effect\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { call, put } from \x27redux-saga\/effects\x27\n\/\/...\n\nfunction* fetchProducts() {\n  const products = yield call(Api.fetch, \x27\/products\x27)\n  \/\/ 创建并 yield 一个 dispatch Effect\n  yield put({ type: \x27PRODUCTS_RECEIVED\x27, products })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { call, put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3efetchProducts\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e products = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(Api.fetch, \x3cspan class=\x22hljs-string\x22\x3e\x27\/products\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建并 yield 一个 dispatch Effect\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27PRODUCTS_RECEIVED\x27\x3c\/span\x3e, products })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在，我们可以像上一节那样轻易地测试 Generator：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { call, put } from \x27redux-saga\/effects\x27\nimport Api from \x27...\x27\n\nconst iterator = fetchProducts()\n\n\/\/ 期望一个 call 指令\nassert.deepEqual(\n  iterator.next().value,\n  call(Api.fetch, \x27\/products\x27),\n  \x26quot;fetchProducts should yield an Effect call(Api.fetch, \x27.\/products\x27)\x26quot;\n)\n\n\/\/ 创建一个假的响应对象\nconst products = {}\n\n\/\/ 期望一个 dispatch 指令\nassert.deepEqual(\n  iterator.next(products).value,\n  put({ type: \x27PRODUCTS_RECEIVED\x27, products }),\n  \x26quot;fetchProducts should yield an Effect put({ type: \x27PRODUCTS_RECEIVED\x27, products })\x26quot;\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { call, put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Api \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e iterator = fetchProducts()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 期望一个 call 指令\x3c\/span\x3e\nassert.deepEqual(\n  iterator.next().value,\n  call(Api.fetch, \x3cspan class=\x22hljs-string\x22\x3e\x27\/products\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-string\x22\x3e\x22fetchProducts should yield an Effect call(Api.fetch, \x27.\/products\x27)\x22\x3c\/span\x3e\n)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个假的响应对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e products = {}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 期望一个 dispatch 指令\x3c\/span\x3e\nassert.deepEqual(\n  iterator.next(products).value,\n  put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27PRODUCTS_RECEIVED\x27\x3c\/span\x3e, products }),\n  \x3cspan class=\x22hljs-string\x22\x3e\x22fetchProducts should yield an Effect put({ type: \x27PRODUCTS_RECEIVED\x27, products })\x22\x3c\/span\x3e\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3ecall(fn, ...args)\x3c\/h3\x3e\n\x3cp\x3e用于调用异步逻辑，支持 promise 。\x3c\/p\x3e\n\x3cp\x3e创建一条 Effect 描述信息，指示 middleware 调用 fn 函数并以 args 为参数。fn 既可以是一个普通函数，也可以是一个 Generator 函数。\x3c\/p\x3e\n\x3cp\x3emiddleware 调用这个函数并检查它的结果。\x3c\/p\x3e\n\x3cp\x3e如果结果是一个 Generator 对象，middleware 会执行它，就像在启动 \x3ccode\x3eGenerator （startup Generators\x3c\/code\x3e，启动时被传给 middleware）时做的。 如果有子级 Generator，那么在子级 Generator 正常结束前，父级 Generator 会暂停，这种情况下，父级 Generator 将会在子级 Generator 返回后继续执行，或者直到子级 Generator 被某些错误中止， 如果是这种情况，将在父级 Generator 中抛出一个错误。\x3c\/p\x3e\n\x3cp\x3e如果结果是一个 Promise，middleware 会暂停直到这个 Promise 被 resolve，resolve 后 Generator 会继续执行。 或者直到 Promise 被 reject 了，如果是这种情况，将在 Generator 中抛出一个错误。\x3cbr\x3e当 Generator 中抛出了一个错误，如果有一个 try\/catch 包裹当前的 yield 指令，控制权将被转交给 catch。 否则，Generator 会被错误中止，并且如果这个 Generator 被其他 Generator 调用了，错误将会传到调用的 Generator。\x3c\/p\x3e\n\x3cp\x3eyield fork(fn ...args) 的结果是一个 Task 对象 —— 一个具备某些有用的方法和属性的对象\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3efork(fn, ...args)\x3c\/h3\x3e\n\x3cp\x3e创建一条 Effect 描述信息，指示 middleware 以 无阻塞调用 方式执行 fn。\x3c\/p\x3e\n\x3cp\x3efork 类似于 call，可以用来调用普通函数和 Generator 函数。但 fork 的调用是无阻塞的，在等待 fn 返回结果时，middleware 不会暂停 Generator。 相反，一旦 fn 被调用，Generator 立即恢复执行。\x3cbr\x3efork 与 race 类似，是一个中心化的 Effect，管理 Sagas 间的并发。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3erace(effects)\x3c\/h3\x3e\n\x3cp\x3e创建一条 Effect 描述信息，指示 middleware 在多个 Effect 之间执行一个 race（类似 Promise.race([...]) 的行为）。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3eapi\x3c\/h2\x3e\n\x3cp\x3eredux-saga的其他详细API列举如下，API详解可以查看\x3ca href=\x22http:\/\/leonshi.com\/redux-saga-in-chinese\/docs\/api\/index.html#forkfn-args\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPI 参考\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3eMiddleware API\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3ecreateSagaMiddleware(...sagas)\x3c\/li\x3e\n\x3cli\x3emiddleware.run(saga, ...args)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eSaga Helpers\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3etakeEvery(pattern, saga, ...args)\x3c\/li\x3e\n\x3cli\x3etakeLatest(pattern, saga, ..args)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eEffect creators\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3etake(pattern)\x3c\/li\x3e\n\x3cli\x3eput(action)\x3c\/li\x3e\n\x3cli\x3ecall(fn, ...args)\x3c\/li\x3e\n\x3cli\x3ecall([context, fn], ...args)\x3c\/li\x3e\n\x3cli\x3eapply(context, fn, args)\x3c\/li\x3e\n\x3cli\x3ecps(fn, ...args)\x3c\/li\x3e\n\x3cli\x3ecps([context, fn], ...args)\x3c\/li\x3e\n\x3cli\x3efork(fn, ...args)\x3c\/li\x3e\n\x3cli\x3efork([context, fn], ...args)\x3c\/li\x3e\n\x3cli\x3ejoin(task)\x3c\/li\x3e\n\x3cli\x3ecancel(task)\x3c\/li\x3e\n\x3cli\x3eselect(selector, ...args)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eEffect combinators\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3erace(effects)\x3c\/li\x3e\n\x3cli\x3e[...effects] (aka parallel effects)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eInterfaces\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eTask\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eExternal API\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3erunSaga(iterator, {subscribe, dispatch, getState}, [monitor])\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader21\x22\x3e参考\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/leonshi.com\/redux-saga-in-chinese\/docs\/introduction\/BeginnerTutorial.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e初级教程\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.10tiao.com\/html\/184\/201704\/2247485137\/1.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e探索Redux的最佳实践\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/p\/23012870\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-saga 实践总结\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/yanqiw.github.io\/react\/2017\/03\/05\/redux-saga.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux Saga实践\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/codeday.me\/bug\/20170417\/9310.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-saga vs redux-thunk的优点\/缺点\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/p\/22405838\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux的全家桶与最佳实践\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>从redux-thunk到redux-saga实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009928167">https://segmentfault.com/a/1190000009928167</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/mntkx8nlch8/" target="_blank">https://alili.tech/archive/mntkx8nlch8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>