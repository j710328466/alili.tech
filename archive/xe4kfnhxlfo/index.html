<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Seneca ：NodeJS 微服务框架入门指南"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Seneca ：NodeJS 微服务框架入门指南 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/xe4kfnhxlfo/",
				"appid": "1613049289050283", 
				"title": "Seneca ：NodeJS 微服务框架入门指南 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-25T02:30:24"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ffpl5ftnw2u/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/z94br1a9g2o/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&text=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&text=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&title=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&is_video=false&description=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&title=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&title=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&title=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxe4kfnhxlfo%2f&title=Seneca%20%ef%bc%9aNodeJS%20%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Seneca ：NodeJS 微服务框架入门指南</h1><div class="meta"><div class="postdate"><time datetime="2019-01-25" itemprop="datePublished">2019-01-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e原文：\x3ca href=\x22http:\/\/onmr.com\/press\/getting-started-seneca.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/onmr.com\/press\/getting-started-seneca.html\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/senecajs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSeneca\x3c\/a\x3e 是一个能让您快速构建基于消息的微服务系统的工具集，你不需要知道各种服务本身被部署在何处，不需要知道具体有多少服务存在，也不需要知道他们具体做什么，任何你业务逻辑之外的服务（如数据库、缓存或者第三方集成等）都被隐藏在微服务之后。\x3c\/p\x3e\n\x3cp\x3e这种解耦使您的系统易于连续构建与更新，Seneca 能做到这些，原因在于它的三大核心功能：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e模式匹配\x3c\/strong\x3e：不同于脆弱的服务发现，模式匹配旨在告诉这个世界你真正关心的消息是什么；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e无依赖传输\x3c\/strong\x3e：你可以以多种方式在服务之间发送消息，所有这些都隐藏至你的业务逻辑之后；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e组件化\x3c\/strong\x3e：功能被表示为一组可以一起组成微服务的插件。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e在 Seneca 中，消息就是一个可以有任何你喜欢的内部结构的 \x3ccode\x3eJSON\x3c\/code\x3e 对象，它们可以通过 HTTP\/HTTPS、TCP、消息队列、发布\/订阅服务或者任何能传输数据的方式进行传输，而对于作为消息生产者的你来讲，你只需要将消息发送出去即可，完全不需要关心哪些服务来接收它们。\x3c\/p\x3e\n\x3cp\x3e然后，你又想告诉这个世界，你想要接收一些消息，这也很简单，你只需在 Seneca 中作一点匹配模式配置即可，匹配模式也很简单，只是一个键值对的列表，这些键值对被用于匹配 \x3ccode\x3eJSON\x3c\/code\x3e 消息的极组属性。\x3c\/p\x3e\n\x3cp\x3e在本文接下来的内容中，我们将一同基于 Seneca 构建一些微服务。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e模式（ \x3cem\x3ePatterns\x3c\/em\x3e ）\x3c\/h1\x3e\n\x3cp\x3e让我们从一点特别简单的代码开始，我们将创建两个微服务，一个会进行数学计算，另一个去调用它：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)();\n\nseneca.add(\x27role:math, cmd:sum\x27, (msg, reply) =\x3e {\n  reply(null, { answer: ( msg.left \x2b msg.right )})\n});\n\nseneca.act({\n  role: \x27math\x27,\n  cmd: \x27sum\x27,\n  left: 1,\n  right: 2\n}, (err, result) =\x3e {\n  if (err) {\n    return console.error(err);\n  }\n  console.log(result);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)();\n\nseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math, cmd:sum\x27\x3c\/span\x3e, (msg, reply) =\x26gt; {\n  reply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: ( msg.left \x2b msg.right )})\n});\n\nseneca.act({\n  \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n}, (err, result) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err);\n  }\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将上面的代码，保存至一个 \x3ccode\x3ejs\x3c\/code\x3e 文件中，然后执行它，你可能会在 \x3ccode\x3econsole\x3c\/code\x3e 中看到类似下面这样的消息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\x26quot;kind\x26quot;:\x26quot;notice\x26quot;,\x26quot;notice\x26quot;:\x26quot;hello seneca 4y8daxnikuxp\/1483577040151\/58922\/3.2.2\/-\x26quot;,\x26quot;level\x26quot;:\x26quot;info\x26quot;,\x26quot;when\x26quot;:1483577040175}\n(node:58922) DeprecationWarning: \x27root\x27 is deprecated, use \x27global\x27\n{ answer: 3 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e{\x3cspan class=\x22hljs-string\x22\x3e\x22kind\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22hello seneca 4y8daxnikuxp\/1483577040151\/58922\/3.2.2\/-\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22level\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22info\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e:1483577040175}\n(node:58922) DeprecationWarning: \x3cspan class=\x22hljs-string\x22\x3e\x27root\x27\x3c\/span\x3e is deprecated, use \x3cspan class=\x22hljs-string\x22\x3e\x27global\x27\x3c\/span\x3e\n{ answer: 3 }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到目前为止，所有这一切都发生在同一个进程中，没有网络流量产生，进程内的函数调用也是基于消息传输。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eseneca.add\x3c\/code\x3e 方法，添加了一个新的动作模式（_Action Pattern_）至 \x3ccode\x3eSeneca\x3c\/code\x3e 实例中，它有两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3epattern\x3c\/code\x3e ：用于匹配 Seneca 实例中 \x3ccode\x3eJSON\x3c\/code\x3e 消息体的模式；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eaction\x3c\/code\x3e ：当模式被匹配时执行的操作\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3eseneca.act\x3c\/code\x3e 方法同样有两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emsg\x3c\/code\x3e ：作为纯对象提供的待匹配的入站消息；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erespond\x3c\/code\x3e ：用于接收并处理响应信息的回调函数。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e让我们再把所有代码重新过一次：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22seneca.add(\x27role:math, cmd:sum\x27, (msg, reply) =\x3e {\n  reply(null, { answer: ( msg.left \x2b msg.right )})\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math, cmd:sum\x27\x3c\/span\x3e, (msg, reply) =\x26gt; {\n  reply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: ( msg.left \x2b msg.right )})\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的代码中的 \x3ccode\x3eAction\x3c\/code\x3e 函数，计算了匹配到的消息体中两个属性 \x3ccode\x3eleft\x3c\/code\x3e 与 \x3ccode\x3eright\x3c\/code\x3e 的值的和，并不是所有的消息都会被创建一个响应，但是在绝大多数情况下，是需要有响应的， Seneca 提供了用于响应消息的回调函数。\x3c\/p\x3e\n\x3cp\x3e在匹配模式中， \x3ccode\x3erole:math, cmd:sum\x3c\/code\x3e 匹配到了下面这个消息体：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  role: \x27math\x27,\n  cmd: \x27sum\x27,\n  left: 1,\n  right: 2\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e并得到计自结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  answer: 3\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于 \x3ccode\x3erole\x3c\/code\x3e 与 \x3ccode\x3ecmd\x3c\/code\x3e 这两个属性，它们没有什么特别的，只是恰好被你用于匹配模式而已。\x3c\/p\x3e\n\x3cp\x3e接着，\x3ccode\x3eseneca.act\x3c\/code\x3e 方法，发送了一条消息，它有两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emsg\x3c\/code\x3e ：发送的消息主体\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eresponse_callback\x3c\/code\x3e ：如果该消息有任何响应，该回调函数都会被执行。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e响应的回调函数可接收两个参数： \x3ccode\x3eerror\x3c\/code\x3e 与 \x3ccode\x3eresult\x3c\/code\x3e ，如果有任何错误发生（比如，发送出去的消息未被任何模式匹配），则第一个参数将是一个 \x3ccode\x3eError\x3c\/code\x3e 对象，而如果程序按照我们所预期的方向执行了的话，那么，第二个参数将接收到响应结果，在我们的示例中，我们只是简单的将接收到的响应结果打印至了 \x3ccode\x3econsole\x3c\/code\x3e 而已。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22seneca.act({\n  role: \x27math\x27,\n  cmd: \x27sum\x27,\n  left: 1,\n  right: 2\n}, (err, result) =\x3e {\n  if (err) {\n    return console.error(err);\n  }\n  console.log(result);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eseneca.act({\n  \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n}, (err, result) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err);\n  }\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/sum.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esum.js\x3c\/a\x3e 示例文件，向你展示了如何定义并创建一个 Action 以及如何呼起一个 Action，但它们都发生在一个进程中，接下来，我们很快就会展示如何拆分成不同的代码和多个进程。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e匹配模式如何工作？\x3c\/h1\x3e\n\x3cp\x3e模式----而不是网络地址或者会话，让你可以更加容易的扩展或增强您的系统，这样做，让添加新的微服务变得更简单。\x3c\/p\x3e\n\x3cp\x3e现在让我们给系统再添加一个新的功能----计算两个数字的乘积。\x3c\/p\x3e\n\x3cp\x3e我们想要发送的消息看起来像下面这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  role: \x27math\x27,\n  cmd: \x27product\x27,\n  left: 3,\n  right: 4\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27product\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而后获得的结果看起来像下面这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  answer: 12\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e知道怎么做了吧？你可以像 \x3ccode\x3erole: math, cmd: sum\x3c\/code\x3e 模式这样，创建一个 \x3ccode\x3erole: math, cmd: product\x3c\/code\x3e 操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22seneca.add(\x27role:math, cmd:product\x27, (msg, reply) =\x3e {\n  reply(null, { answer: ( msg.left * msg.right )})\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math, cmd:product\x27\x3c\/span\x3e, (msg, reply) =\x26gt; {\n  reply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: ( msg.left * msg.right )})\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，调用该操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22seneca.act({\n  role: \x27math\x27,\n  cmd: \x27product\x27,\n  left: 3,\n  right: 4\n}, (err, result) =\x3e {\n  if (err) {\n    return console.error(err);\n  }\n  console.log(result);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eseneca.act({\n  \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27product\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n}, (err, result) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err);\n  }\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/product.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eproduct.js\x3c\/a\x3e ，你将得到你想要的结果。\x3c\/p\x3e\n\x3cp\x3e将这两个方法放在一起，代码像是下面这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)();\n\nseneca.add(\x27role:math, cmd:sum\x27, (msg, reply) =\x3e {\n  reply(null, { answer: ( msg.left \x2b msg.right )})\n});\n\nseneca.add(\x27role:math, cmd:product\x27, (msg, reply) =\x3e {\n  reply(null, { answer: ( msg.left * msg.right )})\n});\n\nseneca.act({role: \x27math\x27, cmd: \x27sum\x27, left: 1, right: 2}, console.log)\n      .act({role: \x27math\x27, cmd: \x27product\x27, left: 3, right: 4}, console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)();\n\nseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math, cmd:sum\x27\x3c\/span\x3e, (msg, reply) =\x26gt; {\n  reply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: ( msg.left \x2b msg.right )})\n});\n\nseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math, cmd:product\x27\x3c\/span\x3e, (msg, reply) =\x26gt; {\n  reply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: ( msg.left * msg.right )})\n});\n\nseneca.act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n      .act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27product\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/sum-product.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esum-product.js\x3c\/a\x3e 后，你将得到下面这样的结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22null { answer: 3 }\nnull { answer: 12 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enull { answer: 3 }\nnull { answer: 12 }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面合并到一起的代码中，我们发现， \x3ccode\x3eseneca.act\x3c\/code\x3e 是可以进行链式调用的，\x3ccode\x3eSeneca\x3c\/code\x3e 提供了一个链式API，调式调用是顺序执行的，但是不是串行，所以，返回的结果的顺序可能与调用顺序并不一样。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e扩展模式以增加新功能\x3c\/h1\x3e\n\x3cp\x3e模式让你可以更加容易的扩展程序的功能，与 \x3ccode\x3eif...else...\x3c\/code\x3e 语法不同的是，你可以通过增加更多的匹配模式以达到同样的功能。\x3c\/p\x3e\n\x3cp\x3e下面让我们扩展一下 \x3ccode\x3erole: math, cmd: sum\x3c\/code\x3e 操作，它只接收整型数字，那么，怎么做？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22seneca.add({role: \x27math\x27, cmd: \x27sum\x27, integer: true}, function (msg, respond) {\n  var sum = Math.floor(msg.left) \x2b Math.floor(msg.right)\n  respond(null, {answer: sum})\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eseneca.add({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3einteger\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.left) \x2b \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.right)\n  respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: sum})\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在，下面这条消息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5, integer: true}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3einteger\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将得到下面这样的结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{answer: 3}  \/\/ == 1 \x2b 2，小数部分已经被移除了\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{\x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e}  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ == 1 \x2b 2，小数部分已经被移除了\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码可在 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/sum-integer.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esum-integer.js\x3c\/a\x3e 中查看。\x3c\/p\x3e\n\x3cp\x3e现在，你的两个模式都存在于系统中了，而且还存在交叉部分，那么 \x3ccode\x3eSeneca\x3c\/code\x3e 最终会将消息匹配至哪条模式呢？原则是：更多匹配项目被匹配到的优先，被匹配到的属性越多，则优先级越高。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/pattern-priority-testing.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epattern-priority-testing.js\x3c\/a\x3e 可以给我们更加直观的测试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)()\n\nseneca.add({role: \x27math\x27, cmd: \x27sum\x27}, function (msg, respond) {\n  var sum = msg.left \x2b msg.right\n  respond(null, {answer: sum})\n})\n\n\/\/ 下面两条消息都匹配 role: math, cmd: sum\n\nseneca.act({role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5}, console.log)\nseneca.act({role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5, integer: true}, console.log)\n\nsetTimeout(() =\x3e {\n  seneca.add({role: \x27math\x27, cmd: \x27sum\x27, integer: true}, function (msg, respond) {\n    var sum = Math.floor(msg.left) \x2b Math.floor(msg.right)\n    respond(null, { answer: sum })\n  })\n\n  \/\/ 下面这条消息同样匹配 role: math, cmd: sum\n  seneca.act({role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5}, console.log)\n\n  \/\/ 但是，也匹配 role:math,cmd:sum,integer:true\n  \/\/ 但是因为更多属性被匹配到，所以，它的优先级更高\n  seneca.act({role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5, integer: true}, console.log)\n}, 100)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n\nseneca.add({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = msg.left \x2b msg.right\n  respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: sum})\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下面两条消息都匹配 role: math, cmd: sum\x3c\/span\x3e\n\nseneca.act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\nseneca.act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3einteger\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  seneca.add({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3einteger\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.left) \x2b \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.right)\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: sum })\n  })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下面这条消息同样匹配 role: math, cmd: sum\x3c\/span\x3e\n  seneca.act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 但是，也匹配 role:math,cmd:sum,integer:true\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 但是因为更多属性被匹配到，所以，它的优先级更高\x3c\/span\x3e\n  seneca.act({\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3einteger\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n}, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e输出结果应该像下面这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22null { answer: 4 }\nnull { answer: 4 }\nnull { answer: 4 }\nnull { answer: 3 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enull { answer: 4 }\nnull { answer: 4 }\nnull { answer: 4 }\nnull { answer: 3 }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的代码中，因为系统中只存在 \x3ccode\x3erole: math, cmd: sum\x3c\/code\x3e 模式，所以，都匹配到它，但是当 100ms 后，我们给系统中添加了一个 \x3ccode\x3erole: math, cmd: sum, integer: true\x3c\/code\x3e 模式之后，结果就不一样了，匹配到更多的操作将有更高的优先级。\x3c\/p\x3e\n\x3cp\x3e这种设计，可以让我们的系统可以更加简单的添加新的功能，不管是在开发环境还是在生产环境中，你都可以在不需要修改现有代码的前提下即可更新新的服务，你只需要先好新的服务，然后启动新服务即可。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e基于模式的代码复用\x3c\/h1\x3e\n\x3cp\x3e模式操作还可以调用其它的操作，所以，这样我们可以达到代码复用的需求：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)()\n\nseneca.add(\x27role: math, cmd: sum\x27, function (msg, respond) {\n  var sum = msg.left \x2b msg.right\n  respond(null, {answer: sum})\n})\n\nseneca.add(\x27role: math, cmd: sum, integer: true\x27, function (msg, respond) {\n  \/\/ 复用 role:math, cmd:sum\n  this.act({\n    role: \x27math\x27,\n    cmd: \x27sum\x27,\n    left: Math.floor(msg.left),\n    right: Math.floor(msg.right)\n  }, respond)\n})\n\n\/\/ 匹配 role:math,cmd:sum\nseneca.act(\x27role: math, cmd: sum, left: 1.5, right: 2.5\x27,console.log)\n\n\/\/ 匹配 role:math,cmd:sum,integer:true\nseneca.act(\x27role: math, cmd: sum, left: 1.5, right: 2.5, integer: true\x27, console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n\nseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role: math, cmd: sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = msg.left \x2b msg.right\n  respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: sum})\n})\n\nseneca.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role: math, cmd: sum, integer: true\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 复用 role:math, cmd:sum\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act({\n    \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.left),\n    \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(msg.right)\n  }, respond)\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 匹配 role:math,cmd:sum\x3c\/span\x3e\nseneca.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role: math, cmd: sum, left: 1.5, right: 2.5\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 匹配 role:math,cmd:sum,integer:true\x3c\/span\x3e\nseneca.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role: math, cmd: sum, left: 1.5, right: 2.5, integer: true\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的示例代码中，我们使用了 \x3ccode\x3ethis.act\x3c\/code\x3e 而不是前面的 \x3ccode\x3eseneca.act\x3c\/code\x3e，那是因为，在 \x3ccode\x3eaction\x3c\/code\x3e 函数中，上下文关系变量 \x3ccode\x3ethis\x3c\/code\x3e ，引用了当前的 \x3ccode\x3eseneca\x3c\/code\x3e 实例，这样你就可以在任何一个 \x3ccode\x3eaction\x3c\/code\x3e 函数中，访问到该 \x3ccode\x3eaction\x3c\/code\x3e 调用的整个上下文。\x3c\/p\x3e\n\x3cp\x3e在上面的代码中，我们使用了 JSON 缩写形式来描述模式与消息， 比如，下面是对象字面量：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{role: \x27math\x27, cmd: \x27sum\x27, left: 1.5, right: 2.5}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{\x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e缩写模式为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27role: math, cmd: sum, left: 1.5, right: 2.5\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coq\x22\x3e\x3ccode class=\x22text\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x27role: math, cmd: \x3cspan class=\x22hljs-built_in\x22\x3esum\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eright\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2.5\x3c\/span\x3e\x27\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/rjrodger\/jsonic\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejsonic\x3c\/a\x3e 这种格式，提供了一种以字符串字面量来表达对象的简便方式，这使得我们可以创建更加简单的模式和消息。\x3c\/p\x3e\n\x3cp\x3e上面的代码保存在了 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/sum-reuse.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esum-reuse.js\x3c\/a\x3e 文件中。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e模式是唯一的\x3c\/h1\x3e\n\x3cp\x3e你定义的 Action 模式都是唯一了，它们只能触发一个函数，模式的解析规则如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e更多我属性优先级更高\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e若模式具有相同的数量的属性，则按字母顺序匹配\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e规则被设计得很简单，这使得你可以更加简单的了解到到底是哪个模式被匹配了。\x3c\/p\x3e\n\x3cp\x3e下面这些示例可以让你更容易理解：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ea: 1, b: 2\x3c\/code\x3e 优先于 \x3ccode\x3ea: 1\x3c\/code\x3e， 因为它有更多的属性；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ea: 1, b: 2\x3c\/code\x3e 优先于 \x3ccode\x3ea: 1, c: 3\x3c\/code\x3e，因为 \x3ccode\x3eb\x3c\/code\x3e 在 \x3ccode\x3ec\x3c\/code\x3e 字母的前面；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ea: 1, b: 2, d: 4\x3c\/code\x3e 优先于 \x3ccode\x3ea: 1, c: 3, d:4\x3c\/code\x3e，因为 \x3ccode\x3eb\x3c\/code\x3e 在 \x3ccode\x3ec\x3c\/code\x3e 字母的前面；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ea: 1, b:2, c:3\x3c\/code\x3e 优先于 \x3ccode\x3ea:1, b: 2\x3c\/code\x3e，因为它有更多的属性；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ea: 1, b:2, c:3\x3c\/code\x3e 优先于 \x3ccode\x3ea:1, c:3\x3c\/code\x3e，因为它有更多的属性。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e很多时间，提供一种可以让你不需要全盘修改现有 Action 函数的代码即可增加它功能的方法是很有必要的，比如，你可能想为某一个消息增加更多自定义的属性验证方法，捕获消息统计信息，添加额外的数据库结果中，或者控制消息流速等。\x3c\/p\x3e\n\x3cp\x3e我下面的示例代码中，加法操作期望 \x3ccode\x3eleft\x3c\/code\x3e 和 \x3ccode\x3eright\x3c\/code\x3e 属性是有限数，此外，为了调试目的，将原始输入参数附加到输出的结果中也是很有用的，您可以使用以下代码添加验证检查和调试信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)()\n\nseneca\n  .add(\n    \x27role:math,cmd:sum\x27,\n    function(msg, respond) {\n      var sum = msg.left \x2b msg.right\n      respond(null, {\n        answer: sum\n      })\n    })\n\n\/\/ 重写 role:math,cmd:sum with ，添加额外的功能\n.add(\n  \x27role:math,cmd:sum\x27,\n  function(msg, respond) {\n\n    \/\/ bail out early if there\x27s a problem\n    if (!Number.isFinite(msg.left) ||\n      !Number.isFinite(msg.right)) {\n      return respond(new Error(\x26quot;left 与 right 值必须为数字。\x26quot;))\n    }\n\n    \/\/ 调用上一个操作函数 role:math,cmd:sum\n    this.prior({\n      role: \x27math\x27,\n      cmd: \x27sum\x27,\n      left: msg.left,\n      right: msg.right,\n\n    }, function(err, result) {\n      if (err) return respond(err)\n\n      result.info = msg.left \x2b \x27\x2b\x27 \x2b msg.right\n      respond(null, result)\n    })\n  })\n\n\/\/ 增加了的 role:math,cmd:sum\n.act(\x27role:math,cmd:sum,left:1.5,right:2.5\x27,\n  console.log \/\/ 打印 { answer: 4, info: \x271.5\x2b2.5\x27 }\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n\nseneca\n  .add(\n    \x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = msg.left \x2b msg.right\n      respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, {\n        \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: sum\n      })\n    })\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重写 role:math,cmd:sum with ，添加额外的功能\x3c\/span\x3e\n.add(\n  \x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ bail out early if there\x27s a problem\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.isFinite(msg.left) ||\n      !\x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.isFinite(msg.right)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e respond(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22left 与 right 值必须为数字。\x22\x3c\/span\x3e))\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用上一个操作函数 role:math,cmd:sum\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.prior({\n      \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: msg.left,\n      \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: msg.right,\n\n    }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, result\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e respond(err)\n\n      result.info = msg.left \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e \x2b msg.right\n      respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, result)\n    })\n  })\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 增加了的 role:math,cmd:sum\x3c\/span\x3e\n.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1.5,right:2.5\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打印 { answer: 4, info: \x271.5\x2b2.5\x27 }\x3c\/span\x3e\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eseneca\x3c\/code\x3e 实例提供了一个名为 \x3ccode\x3eprior\x3c\/code\x3e 的方法，让可以在当前的 \x3ccode\x3eaction\x3c\/code\x3e 方法中，调用被其重写的旧操作函数。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eprior\x3c\/code\x3e 函数接受两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emsg\x3c\/code\x3e：消息体\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eresponse_callback\x3c\/code\x3e：回调函数\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e在上面的示例代码中，已经演示了如何修改入参与出参，修改这些参数与值是可选的，比如，可以再添加新的重写，以增加日志记录功能。\x3c\/p\x3e\n\x3cp\x3e在上面的示例中，也同样演示了如何更好的进行错误处理，我们在真正进行操作之前，就验证的数据的正确性，若传入的参数本身就有错误，那么我们直接就返回错误信息，而不需要等待真正计算的时候由系统去报错了。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e错误消息应该只被用于描述错误的输入或者内部失败信息等，比如，如果你执行了一些数据库的查询，返回没有任何数据，这并不是一个错误，而仅仅只是数据库的事实的反馈，但是如果连接数据库失败，那就是一个错误了。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e上面的代码可以在 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/sum-valid.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esum-valid.js\x3c\/a\x3e 文件中找到。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3e使用插件组织模式\x3c\/h1\x3e\n\x3cp\x3e一个 \x3ccode\x3eseneca\x3c\/code\x3e 实例，其实就只是多个 \x3ccode\x3eAction Patterm\x3c\/code\x3e 的集合而已，你可以使用命名空间的方式来组织操作模式，例如在前面的示例中，我们都使用了 \x3ccode\x3erole: math\x3c\/code\x3e，为了帮助日志记录和调试， \x3ccode\x3eSeneca\x3c\/code\x3e 还支持一个简约的插件支持。\x3c\/p\x3e\n\x3cp\x3e同样，Seneca插件只是一组操作模式的集合，它可以有一个名称，用于注释日志记录条目，还可以给插件一组选项来控制它们的行为，插件还提供了以正确的顺序执行初始化函数的机制，例如，您希望在尝试从数据库读取数据之前建立数据库连接。\x3c\/p\x3e\n\x3cp\x3e简单来说，Seneca插件就只是一个具有单个参数选项的函数，你将这个插件定义函数传递给 \x3ccode\x3eseneca.use\x3c\/code\x3e 方法，下面这个是最小的Seneca插件（其实它什么也没做！）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function minimal_plugin(options) {\n  console.log(options)\n}\n\nrequire(\x27seneca\x27)()\n  .use(minimal_plugin, {foo: \x27bar\x27})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eminimal_plugin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(options)\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(minimal_plugin, {\x3cspan class=\x22hljs-attr\x22\x3efoo\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27bar\x27\x3c\/span\x3e})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eseneca.use\x3c\/code\x3e 方法接受两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eplugin\x3c\/code\x3e ：插件定义函数或者一个插件名称；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eoptions\x3c\/code\x3e ：插件配置选项\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e上面的示例代码执行后，打印出来的日志看上去是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\x26quot;kind\x26quot;:\x26quot;notice\x26quot;,\x26quot;notice\x26quot;:\x26quot;hello seneca 3qk0ij5t2bta\/1483584697034\/62768\/3.2.2\/-\x26quot;,\x26quot;level\x26quot;:\x26quot;info\x26quot;,\x26quot;when\x26quot;:1483584697057}\n(node:62768) DeprecationWarning: \x27root\x27 is deprecated, use \x27global\x27\n{ foo: \x27bar\x27 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e{\x3cspan class=\x22hljs-string\x22\x3e\x22kind\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22hello seneca 3qk0ij5t2bta\/1483584697034\/62768\/3.2.2\/-\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22level\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22info\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e:1483584697057}\n(node:62768) DeprecationWarning: \x3cspan class=\x22hljs-string\x22\x3e\x27root\x27\x3c\/span\x3e is deprecated, use \x3cspan class=\x22hljs-string\x22\x3e\x27global\x27\x3c\/span\x3e\n{ foo: \x3cspan class=\x22hljs-string\x22\x3e\x27bar\x27\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eSeneca 还提供了详细日志记录功能，可以提供为开发或者生产提供更多的日志信息，通常的，日志级别被设置为 \x3ccode\x3eINFO\x3c\/code\x3e，它并不会打印太多日志信息，如果想看到所有的日志信息，试试以下面这样的方式启动你的服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node minimal-plugin.js --seneca.log.all\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode minimal-plugin.js --seneca.log.all\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e会不会被吓一跳？当然，你还可以过滤日志信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node minimal-plugin.js --seneca.log.all | grep plugin:define\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode minimal-plugin.js --seneca.log.all | grep plugin:define\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过日志我们可以看到， seneca 加载了很多内置的插件，比如 \x3ccode\x3ebasic\x3c\/code\x3e、\x3ccode\x3etransport\x3c\/code\x3e、\x3ccode\x3eweb\x3c\/code\x3e 以及 \x3ccode\x3emem-store\x3c\/code\x3e，这些插件为我们提供了创建微服务的基础功能，同样，你应该也可以看到 \x3ccode\x3eminimal_plugin\x3c\/code\x3e 插件。\x3c\/p\x3e\n\x3cp\x3e现在，让我们为这个插件添加一些操作模式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function math(options) {\n\n  this.add(\x27role:math,cmd:sum\x27, function (msg, respond) {\n    respond(null, { answer: msg.left \x2b msg.right })\n  })\n\n  this.add(\x27role:math,cmd:product\x27, function (msg, respond) {\n    respond(null, { answer: msg.left * msg.right })\n  })\n\n}\n\nrequire(\x27seneca\x27)()\n  .use(math)\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27, console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emath\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left \x2b msg.right })\n  })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:product\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left * msg.right })\n  })\n\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(math)\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-plugin.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-plugin.js\x3c\/a\x3e 文件，得到下面这样的信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22null { answer: 3 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enull { answer: 3 }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看打印出来的一条日志：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;actid\x26quot;: \x26quot;7ubgm65mcnfl\/uatuklury90r\x26quot;,\n  \x26quot;msg\x26quot;: {\n    \x26quot;role\x26quot;: \x26quot;math\x26quot;,\n    \x26quot;cmd\x26quot;: \x26quot;sum\x26quot;,\n    \x26quot;left\x26quot;: 1,\n    \x26quot;right\x26quot;: 2,\n    \x26quot;meta$\x26quot;: {\n      \x26quot;id\x26quot;: \x26quot;7ubgm65mcnfl\/uatuklury90r\x26quot;,\n      \x26quot;tx\x26quot;: \x26quot;uatuklury90r\x26quot;,\n      \x26quot;pattern\x26quot;: \x26quot;cmd:sum,role:math\x26quot;,\n      \x26quot;action\x26quot;: \x26quot;(bjx5u38uwyse)\x26quot;,\n      \x26quot;plugin_name\x26quot;: \x26quot;math\x26quot;,\n      \x26quot;plugin_tag\x26quot;: \x26quot;-\x26quot;,\n      \x26quot;prior\x26quot;: {\n        \x26quot;chain\x26quot;: [],\n        \x26quot;entry\x26quot;: true,\n        \x26quot;depth\x26quot;: 0\n      },\n      \x26quot;start\x26quot;: 1483587274794,\n      \x26quot;sync\x26quot;: true\n    },\n    \x26quot;plugin$\x26quot;: {\n      \x26quot;name\x26quot;: \x26quot;math\x26quot;,\n      \x26quot;tag\x26quot;: \x26quot;-\x26quot;\n    },\n    \x26quot;tx$\x26quot;: \x26quot;uatuklury90r\x26quot;\n  },\n  \x26quot;entry\x26quot;: true,\n  \x26quot;prior\x26quot;: [],\n  \x26quot;meta\x26quot;: {\n    \x26quot;plugin_name\x26quot;: \x26quot;math\x26quot;,\n    \x26quot;plugin_tag\x26quot;: \x26quot;-\x26quot;,\n    \x26quot;plugin_fullname\x26quot;: \x26quot;math\x26quot;,\n    \x26quot;raw\x26quot;: {\n      \x26quot;role\x26quot;: \x26quot;math\x26quot;,\n      \x26quot;cmd\x26quot;: \x26quot;sum\x26quot;\n    },\n    \x26quot;sub\x26quot;: false,\n    \x26quot;client\x26quot;: false,\n    \x26quot;args\x26quot;: {\n      \x26quot;role\x26quot;: \x26quot;math\x26quot;,\n      \x26quot;cmd\x26quot;: \x26quot;sum\x26quot;\n    },\n    \x26quot;rules\x26quot;: {},\n    \x26quot;id\x26quot;: \x26quot;(bjx5u38uwyse)\x26quot;,\n    \x26quot;pattern\x26quot;: \x26quot;cmd:sum,role:math\x26quot;,\n    \x26quot;msgcanon\x26quot;: {\n      \x26quot;cmd\x26quot;: \x26quot;sum\x26quot;,\n      \x26quot;role\x26quot;: \x26quot;math\x26quot;\n    },\n    \x26quot;priorpath\x26quot;: \x26quot;\x26quot;\n  },\n  \x26quot;client\x26quot;: false,\n  \x26quot;listen\x26quot;: false,\n  \x26quot;transport\x26quot;: {},\n  \x26quot;kind\x26quot;: \x26quot;act\x26quot;,\n  \x26quot;case\x26quot;: \x26quot;OUT\x26quot;,\n  \x26quot;duration\x26quot;: 35,\n  \x26quot;result\x26quot;: {\n    \x26quot;answer\x26quot;: 3\n  },\n  \x26quot;level\x26quot;: \x26quot;debug\x26quot;,\n  \x26quot;plugin_name\x26quot;: \x26quot;math\x26quot;,\n  \x26quot;plugin_tag\x26quot;: \x26quot;-\x26quot;,\n  \x26quot;pattern\x26quot;: \x26quot;cmd:sum,role:math\x26quot;,\n  \x26quot;when\x26quot;: 1483587274829\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22actid\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x227ubgm65mcnfl\/uatuklury90r\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22msg\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22role\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22cmd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sum\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22left\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22right\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22meta$\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x227ubgm65mcnfl\/uatuklury90r\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22tx\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22uatuklury90r\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22pattern\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cmd:sum,role:math\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22action\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22(bjx5u38uwyse)\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_tag\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22-\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22prior\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-string\x22\x3e\x22chain\x22\x3c\/span\x3e: [],\n        \x3cspan class=\x22hljs-string\x22\x3e\x22entry\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x22depth\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      },\n      \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1483587274794\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22plugin$\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22tag\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22-\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22tx$\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22uatuklury90r\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22entry\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22prior\x22\x3c\/span\x3e: [],\n  \x3cspan class=\x22hljs-string\x22\x3e\x22meta\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_tag\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22-\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_fullname\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22raw\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22role\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22cmd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sum\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22sub\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22client\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22args\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22role\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22cmd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sum\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22rules\x22\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22(bjx5u38uwyse)\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22pattern\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cmd:sum,role:math\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22msgcanon\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22cmd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sum\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22role\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22priorpath\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22client\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22listen\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22transport\x22\x3c\/span\x3e: {},\n  \x3cspan class=\x22hljs-string\x22\x3e\x22kind\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22act\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22case\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22OUT\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22duration\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e35\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22result\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22answer\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22level\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22debug\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22math\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22plugin_tag\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22-\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22pattern\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cmd:sum,role:math\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1483587274829\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所有的该插件的日志都被自动的添加了 \x3ccode\x3eplugin\x3c\/code\x3e 属性。\x3c\/p\x3e\n\x3cp\x3e在 Seneca 的世界中，我们通过插件组织各种操作模式集合，这让日志与调试变得更简单，然后你还可以将多个插件合并成为各种微服务，在接下来的章节中，我们将创建一个 \x3ccode\x3emath\x3c\/code\x3e 服务。\x3c\/p\x3e\n\x3cp\x3e插件通过需要进行一些初始化的工作，比如连接数据库等，但是，你并不需要在插件的定义函数中去执行这些初始化，定义函数被设计为同步执行的，因为它的所有操作都是在定义一个插件，事实上，你不应该在定义函数中调用 \x3ccode\x3eseneca.act\x3c\/code\x3e 方法，只调用 \x3ccode\x3eseneca.add\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e要初始化插件，你需要定义一个特殊的匹配模式 \x3ccode\x3einit: \x26lt;plugin-name\x26gt;\x3c\/code\x3e，对于每一个插件，将按顺序调用此操作模式，\x3ccode\x3einit\x3c\/code\x3e 函数必须调用其 \x3ccode\x3ecallback\x3c\/code\x3e 函数，并且不能有错误发生，如果插件初始化失败，则 Seneca 会立即退出 Node 进程。所以的插件初始化工作都必须在任何操作执行之前完成。\x3c\/p\x3e\n\x3cp\x3e为了演示初始化，让我们向 \x3ccode\x3emath\x3c\/code\x3e 插件添加简单的自定义日志记录，当插件启动时，它打开一个日志文件，并将所有操作的日志写入文件，文件需要成功打开并且可写，如果这失败，微服务启动就应该失败。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const fs = require(\x27fs\x27)\n\nfunction math(options) {\n\n  \/\/ 日志记录函数，通过 init 函数创建\n  var log\n\n  \/\/ 将所有模式放在一起会上我们查找更方便\n  this.add(\x27role:math,cmd:sum\x27,     sum)\n  this.add(\x27role:math,cmd:product\x27, product)\n\n  \/\/ 这就是那个特殊的初始化操作\n  this.add(\x27init:math\x27, init)\n\n  function init(msg, respond) {\n    \/\/ 将日志记录至一个特写的文件中\n    fs.open(options.logfile, \x27a\x27, function (err, fd) {\n\n      \/\/ 如果不能读取或者写入该文件，则返回错误，这会导致 Seneca 启动失败\n      if (err) return respond(err)\n\n      log = makeLog(fd)\n      respond()\n    })\n  }\n\n  function sum(msg, respond) {\n    var out = { answer: msg.left \x2b msg.right }\n    log(\x27sum \x27\x2bmsg.left\x2b\x27\x2b\x27\x2bmsg.right\x2b\x27=\x27\x2bout.answer\x2b\x27\\n\x27)\n    respond(null, out)\n  }\n\n  function product(msg, respond) {\n    var out = { answer: msg.left * msg.right }\n    log(\x27product \x27\x2bmsg.left\x2b\x27*\x27\x2bmsg.right\x2b\x27=\x27\x2bout.answer\x2b\x27\\n\x27)\n    respond(null, out)\n  }\n\n  function makeLog(fd) {\n    return function (entry) {\n      fs.write(fd, new Date().toISOString()\x2b\x27 \x27\x2bentry, null, \x27utf8\x27, function (err) {\n        if (err) return console.log(err)\n\n        \/\/ 确保日志条目已刷新\n        fs.fsync(fd, function (err) {\n          if (err) return console.log(err)\n        })\n      })\n    }\n  }\n}\n\nrequire(\x27seneca\x27)()\n  .use(math, {logfile:\x27.\/math.log\x27})\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27, console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emath\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 日志记录函数，通过 init 函数创建\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e log\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将所有模式放在一起会上我们查找更方便\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum\x27\x3c\/span\x3e,     sum)\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:product\x27\x3c\/span\x3e, product)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这就是那个特殊的初始化操作\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27init:math\x27\x3c\/span\x3e, init)\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einit\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将日志记录至一个特写的文件中\x3c\/span\x3e\n    fs.open(options.logfile, \x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, fd\x3c\/span\x3e) \x3c\/span\x3e{\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果不能读取或者写入该文件，则返回错误，这会导致 Seneca 启动失败\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e respond(err)\n\n      log = makeLog(fd)\n      respond()\n    })\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esum\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e out = { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left \x2b msg.right }\n    log(\x3cspan class=\x22hljs-string\x22\x3e\x27sum \x27\x3c\/span\x3e\x2bmsg.left\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e\x2bmsg.right\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e\x2bout.answer\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e)\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, out)\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproduct\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e out = { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left * msg.right }\n    log(\x3cspan class=\x22hljs-string\x22\x3e\x27product \x27\x3c\/span\x3e\x2bmsg.left\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e\x2bmsg.right\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e\x2bout.answer\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e)\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, out)\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emakeLog\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efd\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eentry\x3c\/span\x3e) \x3c\/span\x3e{\n      fs.write(fd, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().toISOString()\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e\x2bentry, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err)\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 确保日志条目已刷新\x3c\/span\x3e\n        fs.fsync(fd, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err)\n        })\n      })\n    }\n  }\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(math, {\x3cspan class=\x22hljs-attr\x22\x3elogfile\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27.\/math.log\x27\x3c\/span\x3e})\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面这个插件的代码中，匹配模式被组织在插件的顶部，以便它们更容易被看到，函数在这些模式下面一点被定义，您还可以看到如何使用选项提供自定义日志文件的位置（不言而喻，这不是生产日志！）。\x3c\/p\x3e\n\x3cp\x3e初始化函数 \x3ccode\x3einit\x3c\/code\x3e 执行一些异步文件系统工作，因此必须在执行任何操作之前完成。 如果失败，整个服务将无法初始化。要查看失败时的操作，可以尝试将日志文件位置更改为无效的，例如 \x3ccode\x3e\/math.log\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e以上代码可以在 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-plugin-init.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-plugin-init.js\x3c\/a\x3e 文件中找到。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3e创建微服务\x3c\/h1\x3e\n\x3cp\x3e现在让我们把 \x3ccode\x3emath\x3c\/code\x3e 插件变成一个真正的微服务。首先，你需要组织你的插件。 \x3ccode\x3emath\x3c\/code\x3e 插件的业务逻辑 ---- 即它提供的功能，与它以何种方式与外部世界通信是分开的，你可能会暴露一个Web服务，也有可能在消息总线上监听。\x3c\/p\x3e\n\x3cp\x3e将业务逻辑（即插件定义）放在其自己的文件中是有意义的。 Node.js 模块即可完美的实现，创建一个名为 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath.js\x3c\/a\x3e 的文件，内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = function math(options) {\n\n  this.add(\x27role:math,cmd:sum\x27, function sum(msg, respond) {\n    respond(null, { answer: msg.left \x2b msg.right })\n  })\n\n  this.add(\x27role:math,cmd:product\x27, function product(msg, respond) {\n    respond(null, { answer: msg.left * msg.right })\n  })\n\n  this.wrap(\x27role:math\x27, function (msg, respond) {\n    msg.left  = Number(msg.left).valueOf()\n    msg.right = Number(msg.right).valueOf()\n    this.prior(msg, respond)\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emath\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esum\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left \x2b msg.right })\n  })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:product\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproduct\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eanswer\x3c\/span\x3e: msg.left * msg.right })\n  })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.wrap(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    msg.left  = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e(msg.left).valueOf()\n    msg.right = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e(msg.right).valueOf()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.prior(msg, respond)\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，我们可以在需要引用它的文件中像下面这样添加到我们的微服务系统中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 下面这两种方式都是等价的（还记得我们前面讲过的 `seneca.use` 方法的两个参数吗？）\nrequire(\x27seneca\x27)()\n  .use(require(\x27.\/math.js\x27))\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27, console.log)\n\nrequire(\x27seneca\x27)()\n  .use(\x27math\x27) \/\/ 在当前目录下找到 `.\/math.js`\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27, console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下面这两种方式都是等价的（还记得我们前面讲过的 `seneca.use` 方法的两个参数吗？）\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/math.js\x27\x3c\/span\x3e))\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在当前目录下找到 `.\/math.js`\x3c\/span\x3e\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eseneca.wrap\x3c\/code\x3e 方法可以匹配一组模式，同使用相同的动作扩展函数覆盖至所有被匹配的模式，这与为每一个组模式手动调用 \x3ccode\x3eseneca.add\x3c\/code\x3e 去扩展可以得到一样的效果，它需要两个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3epin\x3c\/code\x3e ：模式匹配模式\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eaction\x3c\/code\x3e ：扩展的 \x3ccode\x3eaction\x3c\/code\x3e 函数\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3epin\x3c\/code\x3e 是一个可以匹配到多个模式的模式，它可以匹配到多个模式，比如 \x3ccode\x3erole:math\x3c\/code\x3e 这个 \x3ccode\x3epin\x3c\/code\x3e 可以匹配到 \x3ccode\x3erole:math, cmd:sum\x3c\/code\x3e 与 \x3ccode\x3erole:math, cmd:product\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e在上面的示例中，我们在最后面的 \x3ccode\x3ewrap\x3c\/code\x3e 函数中，确保了，任何传递给 \x3ccode\x3erole:math\x3c\/code\x3e 的消息体中 \x3ccode\x3eleft\x3c\/code\x3e 与 \x3ccode\x3eright\x3c\/code\x3e 值都是数字，即使我们传递了字符串，也可以被自动的转换为数字。\x3c\/p\x3e\n\x3cp\x3e有时，查看 Seneca 实例中有哪些操作是被重写了是很有用的，你可以在启动应用时，加上 \x3ccode\x3e--seneca.print.tree\x3c\/code\x3e 参数即可，我们先创建一个 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-tree.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-tree.js\x3c\/a\x3e 文件，填入以下内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .use(\x27math\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后再执行它：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22❯ node math-tree.js --seneca.print.tree\n{\x26quot;kind\x26quot;:\x26quot;notice\x26quot;,\x26quot;notice\x26quot;:\x26quot;hello seneca abs0eg4hu04h\/1483589278500\/65316\/3.2.2\/-\x26quot;,\x26quot;level\x26quot;:\x26quot;info\x26quot;,\x26quot;when\x26quot;:1483589278522}\n(node:65316) DeprecationWarning: \x27root\x27 is deprecated, use \x27global\x27\nSeneca action patterns for instance: abs0eg4hu04h\/1483589278500\/65316\/3.2.2\/-\n├─┬ cmd:sum\n│ └─┬ role:math\n│   └── # math, (15fqzd54pnsp),\n│       # math, (qqrze3ub5vhl), sum\n└─┬ cmd:product\n  └─┬ role:math\n    └── # math, (qnh86mgin4r6),\n        # math, (4nrxi5f6sp69), product\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e❯ node math-tree.js --seneca.print.tree\n{\x3cspan class=\x22hljs-string\x22\x3e\x22kind\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22notice\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22hello seneca abs0eg4hu04h\/1483589278500\/65316\/3.2.2\/-\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22level\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22info\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e:1483589278522}\n(node:65316) DeprecationWarning: \x3cspan class=\x22hljs-string\x22\x3e\x27root\x27\x3c\/span\x3e is deprecated, use \x3cspan class=\x22hljs-string\x22\x3e\x27global\x27\x3c\/span\x3e\nSeneca action patterns \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e instance: abs0eg4hu04h\/1483589278500\/65316\/3.2.2\/-\n├─┬ cmd:sum\n│ └─┬ role:math\n│   └── \x3cspan class=\x22hljs-comment\x22\x3e# math, (15fqzd54pnsp),\x3c\/span\x3e\n│       \x3cspan class=\x22hljs-comment\x22\x3e# math, (qqrze3ub5vhl), sum\x3c\/span\x3e\n└─┬ cmd:product\n  └─┬ role:math\n    └── \x3cspan class=\x22hljs-comment\x22\x3e# math, (qnh86mgin4r6),\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e# math, (4nrxi5f6sp69), product\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从上面你可以看到很多的键\/值对，并且以树状结构展示了重写，所有的 \x3ccode\x3eAction\x3c\/code\x3e 函数展示的格式都是 \x3ccode\x3e#plugin, (action-id), function-name\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e但是，到现在为止，所有的操作都还存在于同一个进程中，接下来，让我们先创建一个名为 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-service.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-service.js\x3c\/a\x3e 的文件，填入以下内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .use(\x27math\x27)\n  .listen()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\n  .listen()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后启动该脚本，即可启动我们的微服务，它会启动一个进程，并通过 \x3ccode\x3e10101\x3c\/code\x3e 端口监听HTTP请求，它不是一个 Web 服务器，在此时， \x3ccode\x3eHTTP\x3c\/code\x3e 仅仅作为消息的传输机制。\x3c\/p\x3e\n\x3cp\x3e你现在可以访问 \x3ca href=\x22http:\/\/localhost:10101\/act?role=math\x26amp;cmd=sum\x26amp;left=1\x26amp;right=2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:10101\/act?ro...\x3c\/a\x3e 即可看到结果，或者使用 \x3ccode\x3ecurl\x3c\/code\x3e 命令：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22curl -d \x27{\x26quot;role\x26quot;:\x26quot;math\x26quot;,\x26quot;cmd\x26quot;:\x26quot;sum\x26quot;,\x26quot;left\x26quot;:1,\x26quot;right\x26quot;:2}\x27 http:\/\/localhost:10101\/act\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3ecurl \x3cspan class=\x22hljs-_\x22\x3e-d\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27{\x22role\x22:\x22math\x22,\x22cmd\x22:\x22sum\x22,\x22left\x22:1,\x22right\x22:2}\x27\x3c\/span\x3e http:\/\/localhost:10101\/act\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e两种方式都可以看到结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\x26quot;answer\x26quot;:3}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{\x3cspan class=\x22hljs-string\x22\x3e\x22answer\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，你需要一个微服务客户端 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-client.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-client.js\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .client()\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27,console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .client()\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打开一个新的终端，执行该脚本：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22null { answer: 3 } { id: \x277uuptvpf8iff\/9wfb26kbqx55\x27,\n  accept: \x27043di4pxswq7\/1483589685164\/65429\/3.2.2\/-\x27,\n  track: undefined,\n  time:\n   { client_sent: \x270\x27,\n     listen_recv: \x270\x27,\n     listen_sent: \x270\x27,\n     client_recv: 1483589898390 } }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enull { answer: 3 } { id: \x3cspan class=\x22hljs-string\x22\x3e\x277uuptvpf8iff\/9wfb26kbqx55\x27\x3c\/span\x3e,\n  accept: \x3cspan class=\x22hljs-string\x22\x3e\x27043di4pxswq7\/1483589685164\/65429\/3.2.2\/-\x27\x3c\/span\x3e,\n  track: undefined,\n  time:\n   { client_sent: \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e,\n     listen_recv: \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e,\n     listen_sent: \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e,\n     client_recv: 1483589898390 } }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 \x3ccode\x3eSeneca\x3c\/code\x3e 中，我们通过 \x3ccode\x3eseneca.listen\x3c\/code\x3e 方法创建微服务，然后通过 \x3ccode\x3eseneca.client\x3c\/code\x3e 去与微服务进行通信。在上面的示例中，我们使用的都是 Seneca 的默认配置，比如 \x3ccode\x3eHTTP\x3c\/code\x3e 协议监听 \x3ccode\x3e10101\x3c\/code\x3e 端口，但 \x3ccode\x3eseneca.listen\x3c\/code\x3e 与 \x3ccode\x3eseneca.client\x3c\/code\x3e 方法都可以接受下面这些参数，以达到定抽的功能：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eport\x3c\/code\x3e ：可选的数字，表示端口号；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehost\x3c\/code\x3e ：可先的字符串，表示主机名或者IP地址；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3espec\x3c\/code\x3e ：可选的对象，完整的定制对象\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e注意\x3c\/strong\x3e：在 Windows 系统中，如果未指定 \x3ccode\x3ehost\x3c\/code\x3e， 默认会连接 \x3ccode\x3e0.0.0.0\x3c\/code\x3e，这是没有任何用处的，你可以设置 \x3ccode\x3ehost\x3c\/code\x3e 为 \x3ccode\x3elocalhost\x3c\/code\x3e。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e只要 \x3ccode\x3eclient\x3c\/code\x3e 与 \x3ccode\x3elisten\x3c\/code\x3e 的端口号与主机一致，它们就可以进行通信：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eseneca.client(8080) → seneca.listen(8080)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eseneca.client(8080, \x27192.168.0.2\x27) → seneca.listen(8080, \x27192.168.0.2\x27)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eseneca.client({ port: 8080, host: \x27192.168.0.2\x27 }) → seneca.listen({ port: 8080, host: \x27192.168.0.2\x27 })\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eSeneca 为你提供的 \x3cstrong\x3e无依赖传输\x3c\/strong\x3e 特性，让你在进行业务逻辑开发时，不需要知道消息如何传输或哪些服务会得到它们，而是在服务设置代码或配置中指定，比如 \x3ccode\x3emath.js\x3c\/code\x3e 插件中的代码永远不需要改变，我们就可以任意的改变传输方式。\x3c\/p\x3e\n\x3cp\x3e虽然 \x3ccode\x3eHTTP\x3c\/code\x3e 协议很方便，但是并不是所有时间都合适，另一个常用的协议是 \x3ccode\x3eTCP\x3c\/code\x3e，我们可以很容易的使用 \x3ccode\x3eTCP\x3c\/code\x3e 协议来进行数据的传输，尝试下面这两个文件：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-service-tcp.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-service-tcp.js\x3c\/a\x3e :\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .use(\x27math\x27)\n  .listen({type: \x27tcp\x27})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\n  .listen({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-client-tcp.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-client-tcp.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .client({type: \x27tcp\x27})\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27,console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .client({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e})\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e默认情况下， \x3ccode\x3eclient\/listen\x3c\/code\x3e 并未指定哪些消息将发送至哪里，只是本地定义了模式的话，会发送至本地的模式中，否则会全部发送至服务器中，我们可以通过一些配置来定义哪些消息将发送到哪些服务中，你可以使用一个 \x3ccode\x3epin\x3c\/code\x3e 参数来做这件事情。\x3c\/p\x3e\n\x3cp\x3e让我们来创建一个应用，它将通过 TCP 发送所有 \x3ccode\x3erole:math\x3c\/code\x3e 消息至服务，而把其它的所有消息都在发送至本地：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-pin-service.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-pin-service.js\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n\n  .use(\x27math\x27)\n\n  \/\/ 监听 role:math 消息\n  \/\/ 重要：必须匹配客户端\n  .listen({ type: \x27tcp\x27, pin: \x27role:math\x27 })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听 role:math 消息\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重要：必须匹配客户端\x3c\/span\x3e\n  .listen({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-pin-client.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-pin-client.js\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n\n  \/\/ 本地模式\n  .add(\x27say:hello\x27, function (msg, respond){ respond(null, {text: \x26quot;Hi!\x26quot;}) })\n\n  \/\/ 发送 role:math 模式至服务\n  \/\/ 注意：必须匹配服务端\n  .client({ type: \x27tcp\x27, pin: \x27role:math\x27 })\n\n  \/\/ 远程操作\n  .act(\x27role:math,cmd:sum,left:1,right:2\x27,console.log)\n\n  \/\/ 本地操作\n  .act(\x27say:hello\x27,console.log)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 本地模式\x3c\/span\x3e\n  .add(\x3cspan class=\x22hljs-string\x22\x3e\x27say:hello\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e)\x3c\/span\x3e{ respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Hi!\x22\x3c\/span\x3e}) })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送 role:math 模式至服务\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意：必须匹配服务端\x3c\/span\x3e\n  .client({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 远程操作\x3c\/span\x3e\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math,cmd:sum,left:1,right:2\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 本地操作\x3c\/span\x3e\n  .act(\x3cspan class=\x22hljs-string\x22\x3e\x27say:hello\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以通过各种过滤器来自定义日志的打印，以跟踪消息的流动，使用 \x3ccode\x3e--seneca...\x3c\/code\x3e 参数，支持以下配置：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edate-time\x3c\/code\x3e： log 条目何时被创建；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eseneca-id\x3c\/code\x3e： Seneca process ID；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3elevel\x3c\/code\x3e：\x3ccode\x3eDEBUG\x3c\/code\x3e、\x3ccode\x3eINFO\x3c\/code\x3e、\x3ccode\x3eWARN\x3c\/code\x3e、\x3ccode\x3eERROR\x3c\/code\x3e 以及 \x3ccode\x3eFATAL\x3c\/code\x3e 中任何一个；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3etype\x3c\/code\x3e：条目编码，比如 \x3ccode\x3eact\x3c\/code\x3e、\x3ccode\x3eplugin\x3c\/code\x3e 等；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eplugin\x3c\/code\x3e：插件名称，不是插件内的操作将表示为 \x3ccode\x3eroot$\x3c\/code\x3e；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecase\x3c\/code\x3e： 条目的事件：\x3ccode\x3eIN\x3c\/code\x3e、\x3ccode\x3eADD\x3c\/code\x3e、\x3ccode\x3eOUT\x3c\/code\x3e 等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eaction-id\/transaction-id\x3c\/code\x3e：跟踪标识符，_在网络中永远保持一致_；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3epin\x3c\/code\x3e：\x3ccode\x3eaction\x3c\/code\x3e 匹配模式；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emessage\x3c\/code\x3e：入\/出参消息体\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果你运行上面的进程，使用了 \x3ccode\x3e--seneca.log.all\x3c\/code\x3e，则会打印出所有日志，如果你只想看 \x3ccode\x3emath\x3c\/code\x3e 插件打印的日志，可以像下面这样启动服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node math-pin-service.js --seneca.log=plugin:math\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode math-pin-service.js --seneca.log=plugin:math\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3eWeb 服务集成\x3c\/h1\x3e\n\x3cp\x3eSeneca不是一个Web框架。 但是，您仍然需要将其连接到您的Web服务API，你永远要记住的是，不要将你的内部行为模式暴露在外面，这不是一个好的安全的实践，相反的，你应该定义一组API模式，比如用属性 \x3ccode\x3erole：api\x3c\/code\x3e，然后你可以将它们连接到你的内部微服务。\x3c\/p\x3e\n\x3cp\x3e下面是我们定义 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/api.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eapi.js\x3c\/a\x3e 插件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = function api(options) {\n\n  var validOps = { sum:\x27sum\x27, product:\x27product\x27 }\n\n  this.add(\x27role:api,path:calculate\x27, function (msg, respond) {\n    var operation = msg.args.params.operation\n    var left = msg.args.query.left\n    var right = msg.args.query.right\n    this.act(\x27role:math\x27, {\n      cmd:   validOps[operation],\n      left:  left,\n      right: right,\n    }, respond)\n  })\n\n  this.add(\x27init:api\x27, function (msg, respond) {\n    this.act(\x27role:web\x27,{routes:{\n      prefix: \x27\/api\x27,\n      pin: \x27role:api,path:*\x27,\n      map: {\n        calculate: { GET:true, suffix:\x27\/{operation}\x27 }\n      }\n    \x22}}\x22, respond)\n  })\n\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapi\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e validOps = { \x3cspan class=\x22hljs-attr\x22\x3esum\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eproduct\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27product\x27\x3c\/span\x3e }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:api,path:calculate\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e operation = msg.args.params.operation\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e left = msg.args.query.left\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e right = msg.args.query.right\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e:   validOps[operation],\n      \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e:  left,\n      \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: right,\n    }, respond)\n  })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27init:api\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:web\x27\x3c\/span\x3e,{\x3cspan class=\x22hljs-attr\x22\x3eroutes\x3c\/span\x3e:{\n      \x3cspan class=\x22hljs-attr\x22\x3eprefix\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/api\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:api,path:*\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emap\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3ecalculate\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3eGET\x3c\/span\x3e:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3esuffix\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27\/{operation}\x27\x3c\/span\x3e }\n      }\n    \x22}}\x22, respond)\n  })\n\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，我们使用 \x3ccode\x3ehapi\x3c\/code\x3e 作为Web框架，建了 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/hapi-app.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehapi-app.js\x3c\/a\x3e 应用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Hapi = require(\x27hapi\x27);\nconst Seneca = require(\x27seneca\x27);\nconst SenecaWeb = require(\x27seneca-web\x27);\n\nconst config = {\n  adapter: require(\x27seneca-web-adapter-hapi\x27),\n  context: (() =\x3e {\n    const server = new Hapi.Server();\n    server.connection({\n      port: 3000\n    });\n\n    server.route({\n      path: \x27\/routes\x27,\n      method: \x27get\x27,\n      handler: (request, reply) =\x3e {\n        const routes = server.table()[0].table.map(route =\x3e {\n          return {\n            path: route.path,\n            method: route.method.toUpperCase(),\n            description: route.settings.description,\n            tags: route.settings.tags,\n            vhost: route.settings.vhost,\n            cors: route.settings.cors,\n            jsonp: route.settings.jsonp,\n          }\n        })\n        reply(routes)\n      }\n    });\n\n    return server;\n  })()\n};\n\nconst seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x27math\x27)\n  .use(\x27api\x27)\n  .ready(() =\x3e {\n    const server = seneca.export(\x27web\/context\x27)();\n    server.start(() =\x3e {\n      server.log(\x27server started on: \x27 \x2b server.info.uri);\n    });\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Hapi = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27hapi\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e SenecaWeb = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca-web\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = {\n  \x3cspan class=\x22hljs-attr\x22\x3eadapter\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca-web-adapter-hapi\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Hapi.Server();\n    server.connection({\n      \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e\n    });\n\n    server.route({\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/routes\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27get\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ehandler\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, reply\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routes = server.table()[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].table.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eroute\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: route.path,\n            \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: route.method.toUpperCase(),\n            \x3cspan class=\x22hljs-attr\x22\x3edescription\x3c\/span\x3e: route.settings.description,\n            \x3cspan class=\x22hljs-attr\x22\x3etags\x3c\/span\x3e: route.settings.tags,\n            \x3cspan class=\x22hljs-attr\x22\x3evhost\x3c\/span\x3e: route.settings.vhost,\n            \x3cspan class=\x22hljs-attr\x22\x3ecors\x3c\/span\x3e: route.settings.cors,\n            \x3cspan class=\x22hljs-attr\x22\x3ejsonp\x3c\/span\x3e: route.settings.jsonp,\n          }\n        })\n        reply(routes)\n      }\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e server;\n  })()\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27api\x27\x3c\/span\x3e)\n  .ready(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = seneca.export(\x3cspan class=\x22hljs-string\x22\x3e\x27web\/context\x27\x3c\/span\x3e)();\n    server.start(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      server.log(\x3cspan class=\x22hljs-string\x22\x3e\x27server started on: \x27\x3c\/span\x3e \x2b server.info.uri);\n    });\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e启动 \x3ccode\x3ehapi-app.js\x3c\/code\x3e 之后，访问 \x3ca href=\x22http:\/\/localhost:3000\/routes\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/routes\x3c\/a\x3e，你便可以看到下面这样的信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  {\n    \x26quot;path\x26quot;: \x26quot;\/routes\x26quot;,\n    \x26quot;method\x26quot;: \x26quot;GET\x26quot;,\n    \x26quot;cors\x26quot;: false\n  },\n  {\n    \x26quot;path\x26quot;: \x26quot;\/api\/calculate\/{operation}\x26quot;,\n    \x26quot;method\x26quot;: \x26quot;GET\x26quot;,\n    \x26quot;cors\x26quot;: false\n  }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e[\n  {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/routes\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22method\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22GET\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22cors\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  },\n  {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/api\/calculate\/{operation}\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22method\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22GET\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22cors\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这表示，我们已经成功的将模式匹配更新至 \x3ccode\x3ehapi\x3c\/code\x3e 应用的路由中。访问 \x3ca href=\x22http:\/\/localhost:3000\/api\/calculate\/sum?left=1\x26amp;right=2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/api\/cal...\x3c\/a\x3e ，将得到结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\x26quot;answer\x26quot;:3}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{\x3cspan class=\x22hljs-string\x22\x3e\x22answer\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的示例中，我们直接将 \x3ccode\x3emath\x3c\/code\x3e 插件也加载到了 \x3ccode\x3eseneca\x3c\/code\x3e 实例中，其实我们可以更加合理的进行这种操作，如 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/hapi-app-client.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehapi-app-client.js\x3c\/a\x3e 文件所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\nconst seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x27api\x27)\n  .client({type: \x27tcp\x27, pin: \x27role:math\x27})\n  .ready(() =\x3e {\n    const server = seneca.export(\x27web\/context\x27)();\n    server.start(() =\x3e {\n      server.log(\x27server started on: \x27 \x2b server.info.uri);\n    });\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e...\nconst seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27api\x27\x3c\/span\x3e)\n  .client({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e})\n  .ready(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = seneca.export(\x3cspan class=\x22hljs-string\x22\x3e\x27web\/context\x27\x3c\/span\x3e)();\n    server.start(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      server.log(\x3cspan class=\x22hljs-string\x22\x3e\x27server started on: \x27\x3c\/span\x3e \x2b server.info.uri);\n    });\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们不注册 \x3ccode\x3emath\x3c\/code\x3e 插件，而是使用 \x3ccode\x3eclient\x3c\/code\x3e 方法，将 \x3ccode\x3erole:math\x3c\/code\x3e 发送给 \x3ccode\x3emath-pin-service.js\x3c\/code\x3e 的服务，并且使用的是 \x3ccode\x3etcp\x3c\/code\x3e 连接，没错，你的微服务就是这样成型了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e注意：永远不要使用外部输入创建操作的消息体，永远显示地在内部创建，这可以有效避免注入攻击。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在上面的的初始化函数中，调用了一个 \x3ccode\x3erole:web\x3c\/code\x3e 的模式操作，并且定义了一个 \x3ccode\x3eroutes\x3c\/code\x3e 属性，这将定义一个URL地址与操作模式的匹配规则，它有下面这些参数：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eprefix\x3c\/code\x3e：URL 前缀\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3epin\x3c\/code\x3e： 需要映射的模式集\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emap\x3c\/code\x3e：要用作 URL Endpoint 的 \x3ccode\x3epin\x3c\/code\x3e 通配符属性列表\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你的URL地址将开始于 \x3ccode\x3e\/api\/\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3erol:api, path:*\x3c\/code\x3e 这个 \x3ccode\x3epin\x3c\/code\x3e 表示，映射任何有 \x3ccode\x3erole=\x22api\x22\x3c\/code\x3e 键值对，同时 \x3ccode\x3epath\x3c\/code\x3e 属性被定义了的模式，在本例中，只有 \x3ccode\x3erole:api,path:calculate\x3c\/code\x3e 符合该模式。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3emap\x3c\/code\x3e 属性是一个对象，它有一个 \x3ccode\x3ecalculate\x3c\/code\x3e 属性，对应的URL地址开始于：\x3ccode\x3e\/api\/calculate\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e按着， \x3ccode\x3ecalculate\x3c\/code\x3e 的值是一个对象，它表示了 \x3ccode\x3eHTTP\x3c\/code\x3e 的 \x3ccode\x3eGET\x3c\/code\x3e 方法是被允许的，并且URL应该有参数化的后缀（后缀就类于 \x3ccode\x3ehapi\x3c\/code\x3e 的 \x3ccode\x3eroute\x3c\/code\x3e 规则中一样）。\x3c\/p\x3e\n\x3cp\x3e所以，你的完整地址是 \x3ccode\x3e\/api\/calculate\/{operation}\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e然后，其它的消息属性都将从 URL query 对象或者 JSON body 中获得，在本示例中，因为使用的是 GET 方法，所以没有 body。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eSenecaWeb\x3c\/code\x3e 将会通过 \x3ccode\x3emsg.args\x3c\/code\x3e 来描述一次请求，它包括：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ebody\x3c\/code\x3e：HTTP 请求的 \x3ccode\x3epayload\x3c\/code\x3e 部分；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3equery\x3c\/code\x3e：请求的 \x3ccode\x3equerystring\x3c\/code\x3e；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eparams\x3c\/code\x3e：请求的路径参数。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e现在，启动前面我们创建的微服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node math-pin-service.js --seneca.log=plugin:math\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode math-pin-service.js --seneca.log=plugin:math\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后再启动我们的应用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node hapi-app.js --seneca.log=plugin:web,plugin:api\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode hapi-app.js --seneca.log=plugin:web,plugin:api\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e访问下面的地址：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/localhost:3000\/api\/calculate\/product?left=2\x26amp;right=3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/api\/cal...\x3c\/a\x3e 得到 \x3ccode\x3e{\x22answer\x22:6}\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/localhost:3000\/api\/calculate\/sum?left=2\x26amp;right=3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/api\/cal...\x3c\/a\x3e 得到 \x3ccode\x3e{\x22answer\x22:5}\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e数据持久化\x3c\/h1\x3e\n\x3cp\x3e一个真实的系统，肯定需要持久化数据，在Seneca中，你可以执行任何您喜欢的操作，使用任何类型的数据库层，但是，为什么不使用模式匹配和微服务的力量，使你的开发更轻松？\x3c\/p\x3e\n\x3cp\x3e模式匹配还意味着你可以推迟有关微服务数据的争论，比如服务是否应该\x22拥有\x22数据，服务是否应该访问共享数据库等，模式匹配意味着你可以在随后的任何时间重新配置你的系统。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/senecajs\/seneca-entity\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eseneca-entity\x3c\/a\x3e 提供了一个简单的数据抽象层（ORM），基于以下操作：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eload\x3c\/code\x3e：根据实体标识加载一个实体；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esave\x3c\/code\x3e：创建或更新（如果你提供了一个标识的话）一个实体；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3elist\x3c\/code\x3e：列出匹配查询条件的所有实体；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eremove\x3c\/code\x3e：删除一个标识指定的实体。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e它们的匹配模式分别是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eload\x3c\/code\x3e： \x3ccode\x3erole:entity,cmd:load,name:\x26lt;entity-name\x26gt;\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esave\x3c\/code\x3e： \x3ccode\x3erole:entity,cmd:save,name:\x26lt;entity-name\x26gt;\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3elist\x3c\/code\x3e： \x3ccode\x3erole:entity,cmd:list,name:\x26lt;entity-name\x26gt;\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eremove\x3c\/code\x3e： \x3ccode\x3erole:entity,cmd:remove,name:\x26lt;entity-name\x26gt;\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e任何实现了这些模式的插件都可以被用于提供数据库（比如 \x3ca href=\x22https:\/\/www.npmjs.com\/package\/seneca-mysql-store\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMySQL\x3c\/a\x3e）访问。\x3c\/p\x3e\n\x3cp\x3e当数据的持久化与其它的一切都基于相同的机制提供时，微服务的开发将变得更容易，而这种机制，便是模式匹配消息。\x3c\/p\x3e\n\x3cp\x3e由于直接使用数据持久性模式可能变得乏味，所以 \x3ccode\x3eseneca\x3c\/code\x3e 实体还提供了一个更熟悉的 \x3ccode\x3eActiveRecord\x3c\/code\x3e 风格的接口，要创建记录对象，请调用 \x3ccode\x3eseneca.make\x3c\/code\x3e 方法。 记录对象有方法 \x3ccode\x3eload$\x3c\/code\x3e、\x3ccode\x3esave$\x3c\/code\x3e、\x3ccode\x3elist$\x3c\/code\x3e 以及 \x3ccode\x3eremove$\x3c\/code\x3e（所有方法都带有 \x3ccode\x3e$\x3c\/code\x3e 后缀，以防止与数据字段冲突），数据字段只是对象属性。\x3c\/p\x3e\n\x3cp\x3e通过 \x3ccode\x3enpm\x3c\/code\x3e 安装 \x3ccode\x3eseneca-entity\x3c\/code\x3e， 然后在你的应用中使用 \x3ccode\x3eseneca.use()\x3c\/code\x3e 方法加载至你的 \x3ccode\x3eseneca\x3c\/code\x3e 实例。\x3c\/p\x3e\n\x3cp\x3e现在让我们先创建一个简单的数据实体，它保存 \x3ccode\x3ebook\x3c\/code\x3e 的详情。\x3c\/p\x3e\n\x3cp\x3e文件 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebook.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)();\nseneca.use(\x27basic\x27).use(\x27entity\x27);\n\nconst book = seneca.make(\x27book\x27);\nbook.title = \x27Action in Seneca\x27;\nbook.price = 9.99;\n\n\/\/ 发送 role:entity,cmd:save,name:book 消息\nbook.save$( console.log );\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)();\nseneca.use(\x3cspan class=\x22hljs-string\x22\x3e\x27basic\x27\x3c\/span\x3e).use(\x3cspan class=\x22hljs-string\x22\x3e\x27entity\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e book = seneca.make(\x3cspan class=\x22hljs-string\x22\x3e\x27book\x27\x3c\/span\x3e);\nbook.title = \x3cspan class=\x22hljs-string\x22\x3e\x27Action in Seneca\x27\x3c\/span\x3e;\nbook.price = \x3cspan class=\x22hljs-number\x22\x3e9.99\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送 role:entity,cmd:save,name:book 消息\x3c\/span\x3e\nbook.save$( \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log );\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的示例中，我们还使用了 \x3ca href=\x22https:\/\/github.com\/senecajs\/seneca-basic\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eseneca-basic\x3c\/a\x3e，它是 \x3ccode\x3eseneca-entity\x3c\/code\x3e 依赖的插件。\x3c\/p\x3e\n\x3cp\x3e执行上面的代码之后，我们可以看到下面这样的日志：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22❯ node book.js\nnull $-\/-\/book;id=byo81d;{title:Action in Seneca,price:9.99}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e❯ node book.js\nnull $-\/-\/book;id=byo81d;{title:Action \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e Seneca,price:9.99}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3eSeneca 内置了 \x3ca href=\x22https:\/\/www.npmjs.com\/package\/seneca-mem-store\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emem-store\x3c\/a\x3e，这使得我们在本示例中，不需要使用任何其它数据库的支持也能进行完整的数据库持久操作（虽然，它并不是真正的持久化了）。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e由于数据的持久化永远都是使用的同样的消息模式集，所以，你可以非常简单的交互数据库，比如，你可能在开发的过程中使用的是 \x3ca href=\x22https:\/\/www.npmjs.com\/package\/seneca-mongo-store\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMongoDB\x3c\/a\x3e，而后，开发完成之后，在生产环境中使用 \x3ca href=\x22https:\/\/www.npmjs.com\/package\/seneca-postgres-store\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePostgres\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e下面让我他创建一个简单的线上书店，我们可以通过它，快速的添加新书、获取书的详细信息以及购买一本书：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book-store.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebook-store.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = function(options) {\n\n  \/\/ 从数据库中，查询一本ID为 `msg.id` 的书，我们使用了 `load$` 方法\n  this.add(\x27role:store, get:book\x27, function(msg, respond) {\n    this.make(\x27book\x27).load$(msg.id, respond);\n  });\n\n  \/\/ 向数据库中添加一本书，书的数据为 `msg.data`，我们使用了 `data$` 方法\n  this.add(\x27role:store, add:book\x27, function(msg, respond) {\n    this.make(\x27book\x27).data$(msg.data).save$(respond);\n  });\n\n  \/\/ 创建一条新的支付订单（在真实的系统中，经常是由商品详情布中的 *购买* 按钮触\n  \/\/ 发的事件），先是查询出ID为 `msg.id` 的书本，若查询出错，则直接返回错误，\n  \/\/ 否则，将书本的信息复制给 `purchase` 实体，并保存该订单，然后，我们发送了\n  \/\/ 一条 `role:store,info:purchase` 消息（但是，我们并不接收任何响应），\n  \/\/ 这条消息只是通知整个系统，我们现在有一条新的订单产生了，但是我并不关心谁会\n  \/\/ 需要它。\n  this.add(\x27role:store, cmd:purchase\x27, function(msg, respond) {\n    this.make(\x27book\x27).load$(msg.id, function(err, book) {\n      if (err) return respond(err);\n\n      this\n        .make(\x27purchase\x27)\n        .data$({\n          when: Date.now(),\n          bookId: book.id,\n          title: book.title,\n          price: book.price,\n        })\n        .save$(function(err, purchase) {\n          if (err) return respond(err);\n\n          this.act(\x27role:store,info:purchase\x27, {\n            purchase: purchase\n          });\n          respond(null, purchase);\n        });\n    });\n  });\n\n  \/\/ 最后，我们实现了 `role:store, info:purchase` 模式，就只是简单的将信息\n  \/\/ 打印出来， `seneca.log` 对象提供了 `debug`、`info`、`warn`、`error`、\n  \/\/ `fatal` 方法用于打印相应级别的日志。\n  this.add(\x27role:store, info:purchase\x27, function(msg, respond) {\n    this.log.info(\x27purchase\x27, msg.purchase);\n    respond();\n  });\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 从数据库中，查询一本ID为 `msg.id` 的书，我们使用了 `load$` 方法\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store, get:book\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.make(\x3cspan class=\x22hljs-string\x22\x3e\x27book\x27\x3c\/span\x3e).load$(msg.id, respond);\n  });\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 向数据库中添加一本书，书的数据为 `msg.data`，我们使用了 `data$` 方法\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store, add:book\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.make(\x3cspan class=\x22hljs-string\x22\x3e\x27book\x27\x3c\/span\x3e).data$(msg.data).save$(respond);\n  });\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一条新的支付订单（在真实的系统中，经常是由商品详情布中的 *购买* 按钮触\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发的事件），先是查询出ID为 `msg.id` 的书本，若查询出错，则直接返回错误，\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 否则，将书本的信息复制给 `purchase` 实体，并保存该订单，然后，我们发送了\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一条 `role:store,info:purchase` 消息（但是，我们并不接收任何响应），\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这条消息只是通知整个系统，我们现在有一条新的订单产生了，但是我并不关心谁会\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 需要它。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store, cmd:purchase\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.make(\x3cspan class=\x22hljs-string\x22\x3e\x27book\x27\x3c\/span\x3e).load$(msg.id, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, book\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e respond(err);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n        .make(\x3cspan class=\x22hljs-string\x22\x3e\x27purchase\x27\x3c\/span\x3e)\n        .data$({\n          \x3cspan class=\x22hljs-attr\x22\x3ewhen\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now(),\n          \x3cspan class=\x22hljs-attr\x22\x3ebookId\x3c\/span\x3e: book.id,\n          \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: book.title,\n          \x3cspan class=\x22hljs-attr\x22\x3eprice\x3c\/span\x3e: book.price,\n        })\n        .save$(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, purchase\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e respond(err);\n\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store,info:purchase\x27\x3c\/span\x3e, {\n            \x3cspan class=\x22hljs-attr\x22\x3epurchase\x3c\/span\x3e: purchase\n          });\n          respond(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, purchase);\n        });\n    });\n  });\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后，我们实现了 `role:store, info:purchase` 模式，就只是简单的将信息\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打印出来， `seneca.log` 对象提供了 `debug`、`info`、`warn`、`error`、\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ `fatal` 方法用于打印相应级别的日志。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store, info:purchase\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.log.info(\x3cspan class=\x22hljs-string\x22\x3e\x27purchase\x27\x3c\/span\x3e, msg.purchase);\n    respond();\n  });\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，我们可以创建一个简单的单元测试，以验证我们前面创建的程序：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book-store-test.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eboot-store-test.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 使用 Node 内置的 `assert` 模块\nconst assert = require(\x27assert\x27)\n\nconst seneca = require(\x27seneca\x27)()\n  .use(\x27basic\x27)\n  .use(\x27entity\x27)\n  .use(\x27book-store\x27)\n  .error(assert.fail)\n\n\/\/ 添加一本书\naddBook()\n\nfunction addBook() {\n  seneca.act(\n    \x27role:store,add:book,data:{title:Action in Seneca,price:9.99}\x27,\n    function(err, savedBook) {\n\n      this.act(\n        \x27role:store,get:book\x27, {\n          id: savedBook.id\n        },\n        function(err, loadedBook) {\n\n          assert.equal(loadedBook.title, savedBook.title)\n\n          purchase(loadedBook);\n        }\n      )\n    }\n  )\n}\n\nfunction purchase(book) {\n  seneca.act(\n    \x27role:store,cmd:purchase\x27, {\n      id: book.id\n    },\n    function(err, purchase) {\n      assert.equal(purchase.bookId, book.id)\n    }\n  )\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用 Node 内置的 `assert` 模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e assert = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27assert\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27basic\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27entity\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27book-store\x27\x3c\/span\x3e)\n  .error(assert.fail)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加一本书\x3c\/span\x3e\naddBook()\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddBook\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  seneca.act(\n    \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,add:book,data:{title:Action in Seneca,price:9.99}\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, savedBook\x3c\/span\x3e) \x3c\/span\x3e{\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\n        \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,get:book\x27\x3c\/span\x3e, {\n          \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: savedBook.id\n        },\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, loadedBook\x3c\/span\x3e) \x3c\/span\x3e{\n\n          assert.equal(loadedBook.title, savedBook.title)\n\n          purchase(loadedBook);\n        }\n      )\n    }\n  )\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epurchase\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ebook\x3c\/span\x3e) \x3c\/span\x3e{\n  seneca.act(\n    \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,cmd:purchase\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: book.id\n    },\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, purchase\x3c\/span\x3e) \x3c\/span\x3e{\n      assert.equal(purchase.bookId, book.id)\n    }\n  )\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行该测试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22❯ node book-store-test.js\n[\x26quot;purchase\x26quot;,{\x26quot;entity$\x26quot;:\x26quot;-\/-\/purchase\x26quot;,\x26quot;when\x26quot;:1483607360925,\x26quot;bookId\x26quot;:\x26quot;a2mlev\x26quot;,\x26quot;title\x26quot;:\x26quot;Action in Seneca\x26quot;,\x26quot;price\x26quot;:9.99,\x26quot;id\x26quot;:\x26quot;i28xoc\x26quot;}]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e❯ node book-store-test.js\n[\x3cspan class=\x22hljs-string\x22\x3e\x22purchase\x22\x3c\/span\x3e,{\x3cspan class=\x22hljs-string\x22\x3e\x22entity$\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22-\/-\/purchase\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e:1483607360925,\x3cspan class=\x22hljs-string\x22\x3e\x22bookId\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22a2mlev\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Action in Seneca\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22price\x22\x3c\/span\x3e:9.99,\x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22i28xoc\x22\x3c\/span\x3e}]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在一个生产应用中，我们对于上面的订单数据，可能会有单独的服务进行监控，而不是像上面这样，只是打印一条日志出来，那么，我们现在来创建一个新的服务，用于收集订单数据：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book-store-stats.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebook-store-stats.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const stats = {};\n\nrequire(\x27seneca\x27)()\n  .add(\x27role:store,info:purchase\x27, function(msg, respond) {\n    const id = msg.purchase.bookId;\n    stats[id] = stats[id] || 0;\n    stats[id]\x2b\x2b;\n    console.log(stats);\n    respond();\n  })\n  .listen({\n    port: 9003,\n    host: \x27localhost\x27,\n    pin: \x27role:store,info:purchase\x27\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e stats = {};\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:store,info:purchase\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e id = msg.purchase.bookId;\n    stats[id] = stats[id] || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    stats[id]\x2b\x2b;\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(stats);\n    respond();\n  })\n  .listen({\n    \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9003\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,info:purchase\x27\x3c\/span\x3e\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，更新 \x3ccode\x3ebook-store-test.js\x3c\/code\x3e 文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const seneca = require(\x27seneca\x27)()\n  .use(\x27basic\x27)\n  .use(\x27entity\x27)\n  .use(\x27book-store\x27)\n  .client({port:9003,host: \x27localhost\x27, pin:\x27role:store,info:purchase\x27})\n  .error(assert.fail);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27basic\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27entity\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27book-store\x27\x3c\/span\x3e)\n  .client({\x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e9003\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27role:store,info:purchase\x27\x3c\/span\x3e})\n  .error(assert.fail);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时，当有新的订单产生时，就会通知到订单监控服务了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e将所有服务集成到一起\x3c\/h2\x3e\n\x3cp\x3e通过上面的所有步骤，我们现在已经有四个服务了：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book-store-stats.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebook-store-stats.js\x3c\/a\x3e ： 用于收集书店的订单信息；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/book-store-service.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebook-store-service.js\x3c\/a\x3e ：提供书店相关的功能；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/math-pin-service.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emath-pin-service.js\x3c\/a\x3e：提供一些数学相关的服务；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/app-all.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eapp-all.js\x3c\/a\x3e：Web 服务\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3ebook-store-stats\x3c\/code\x3e 与 \x3ccode\x3emath-pin-service\x3c\/code\x3e 我们已经有了，所以，直接启动即可：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node math-pin-service.js --seneca.log.all\nnode book-store-stats.js --seneca.log.all\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enode math-pin-service.js --seneca.log.all\nnode book-store-stats.js --seneca.log.all\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在，我们需要一个 \x3ccode\x3ebook-store-service\x3c\/code\x3e ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27seneca\x27)()\n  .use(\x27basic\x27)\n  .use(\x27entity\x27)\n  .use(\x27book-store\x27)\n  .listen({\n    port: 9002,\n    host: \x27localhost\x27,\n    pin: \x27role:store\x27\n  })\n  .client({\n    port: 9003,\n    host: \x27localhost\x27,\n    pin: \x27role:store,info:purchase\x27\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)()\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27basic\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27entity\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27book-store\x27\x3c\/span\x3e)\n  .listen({\n    \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9002\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:store\x27\x3c\/span\x3e\n  })\n  .client({\n    \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9003\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,info:purchase\x27\x3c\/span\x3e\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该服务接收任何 \x3ccode\x3erole:store\x3c\/code\x3e 消息，但同时又将任何 \x3ccode\x3erole:store,info:purchase\x3c\/code\x3e 消息发送至网络，\x3cstrong\x3e永远都要记住， client 与 listen 的 pin 配置必须完全一致\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e现在，我们可以启动该服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node book-store-service.js --seneca.log.all\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode book-store-service.js --seneca.log.all\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，创建我们的 \x3ccode\x3eapp-all.js\x3c\/code\x3e，首选，复制 \x3ccode\x3eapi.js\x3c\/code\x3e 文件到 \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/api-all.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eapi-all.js\x3c\/a\x3e，这是我们的API。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = function api(options) {\n\n  var validOps = {\n    sum: \x27sum\x27,\n    product: \x27product\x27\n  }\n\n  this.add(\x27role:api,path:calculate\x27, function(msg, respond) {\n    var operation = msg.args.params.operation\n    var left = msg.args.query.left\n    var right = msg.args.query.right\n    this.act(\x27role:math\x27, {\n      cmd: validOps[operation],\n      left: left,\n      right: right,\n    }, respond)\n  });\n\n  this.add(\x27role:api,path:store\x27, function(msg, respond) {\n    let id = null;\n    if (msg.args.query.id) id = msg.args.query.id;\n    if (msg.args.body.id) id = msg.args.body.id;\n\n    const operation = msg.args.params.operation;\n    const storeMsg = {\n      role: \x27store\x27,\n      id: id\n    };\n    if (\x27get\x27 === operation) storeMsg.get = \x27book\x27;\n    if (\x27purchase\x27 === operation) storeMsg.cmd = \x27purchase\x27;\n    this.act(storeMsg, respond);\n  });\n\n  this.add(\x27init:api\x27, function(msg, respond) {\n    this.act(\x27role:web\x27, {\n      routes: {\n        prefix: \x27\/api\x27,\n        pin: \x27role:api,path:*\x27,\n        map: {\n          calculate: {\n            GET: true,\n            suffix: \x27\/{operation}\x27\n          },\n          store: {\n            GET: true,\n            POST: true,\n            suffix: \x27\/{operation}\x27\n          }\n        }\n      }\n    }, respond)\n  })\n\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapi\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e validOps = {\n    \x3cspan class=\x22hljs-attr\x22\x3esum\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sum\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eproduct\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27product\x27\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:api,path:calculate\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e operation = msg.args.params.operation\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e left = msg.args.query.left\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e right = msg.args.query.right\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3ecmd\x3c\/span\x3e: validOps[operation],\n      \x3cspan class=\x22hljs-attr\x22\x3eleft\x3c\/span\x3e: left,\n      \x3cspan class=\x22hljs-attr\x22\x3eright\x3c\/span\x3e: right,\n    }, respond)\n  });\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27role:api,path:store\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e id = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (msg.args.query.id) id = msg.args.query.id;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (msg.args.body.id) id = msg.args.body.id;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e operation = msg.args.params.operation;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e storeMsg = {\n      \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27store\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: id\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27get\x27\x3c\/span\x3e === operation) storeMsg.get = \x3cspan class=\x22hljs-string\x22\x3e\x27book\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27purchase\x27\x3c\/span\x3e === operation) storeMsg.cmd = \x3cspan class=\x22hljs-string\x22\x3e\x27purchase\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(storeMsg, respond);\n  });\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.add(\x3cspan class=\x22hljs-string\x22\x3e\x27init:api\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg, respond\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.act(\x3cspan class=\x22hljs-string\x22\x3e\x27role:web\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3eroutes\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eprefix\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/api\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:api,path:*\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3emap\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3ecalculate\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3eGET\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3esuffix\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/{operation}\x27\x3c\/span\x3e\n          },\n          \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3eGET\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3ePOST\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3esuffix\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/{operation}\x27\x3c\/span\x3e\n          }\n        }\n      }\n    }, respond)\n  })\n\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后， \x3ca href=\x22https:\/\/github.com\/pantao\/getting-started-seneca\/blob\/master\/app-all.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eapp-all.js\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Hapi = require(\x27hapi\x27);\nconst Seneca = require(\x27seneca\x27);\nconst SenecaWeb = require(\x27seneca-web\x27);\n\nconst config = {\n  adapter: require(\x27seneca-web-adapter-hapi\x27),\n  context: (() =\x3e {\n    const server = new Hapi.Server();\n    server.connection({\n      port: 3000\n    });\n\n    server.route({\n      path: \x27\/routes\x27,\n      method: \x27get\x27,\n      handler: (request, reply) =\x3e {\n        const routes = server.table()[0].table.map(route =\x3e {\n          return {\n            path: route.path,\n            method: route.method.toUpperCase(),\n            description: route.settings.description,\n            tags: route.settings.tags,\n            vhost: route.settings.vhost,\n            cors: route.settings.cors,\n            jsonp: route.settings.jsonp,\n          }\n        })\n        reply(routes)\n      }\n    });\n\n    return server;\n  })()\n};\n\nconst seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x27basic\x27)\n  .use(\x27entity\x27)\n  .use(\x27math\x27)\n  .use(\x27api-all\x27)\n  .client({\n    type: \x27tcp\x27,\n    pin: \x27role:math\x27\n  })\n  .client({\n    port: 9002,\n    host: \x27localhost\x27,\n    pin: \x27role:store\x27\n  })\n  .ready(() =\x3e {\n    const server = seneca.export(\x27web\/context\x27)();\n    server.start(() =\x3e {\n      server.log(\x27server started on: \x27 \x2b server.info.uri);\n    });\n  });\n\n\/\/ 创建一本示例书籍\nseneca.act(\n  \x27role:store,add:book\x27, {\n    data: {\n      title: \x27Action in Seneca\x27,\n      price: 9.99\n    }\n  },\n  console.log\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Hapi = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27hapi\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Seneca = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e SenecaWeb = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca-web\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = {\n  \x3cspan class=\x22hljs-attr\x22\x3eadapter\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca-web-adapter-hapi\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Hapi.Server();\n    server.connection({\n      \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e\n    });\n\n    server.route({\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/routes\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27get\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ehandler\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, reply\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routes = server.table()[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].table.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eroute\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: route.path,\n            \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: route.method.toUpperCase(),\n            \x3cspan class=\x22hljs-attr\x22\x3edescription\x3c\/span\x3e: route.settings.description,\n            \x3cspan class=\x22hljs-attr\x22\x3etags\x3c\/span\x3e: route.settings.tags,\n            \x3cspan class=\x22hljs-attr\x22\x3evhost\x3c\/span\x3e: route.settings.vhost,\n            \x3cspan class=\x22hljs-attr\x22\x3ecors\x3c\/span\x3e: route.settings.cors,\n            \x3cspan class=\x22hljs-attr\x22\x3ejsonp\x3c\/span\x3e: route.settings.jsonp,\n          }\n        })\n        reply(routes)\n      }\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e server;\n  })()\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seneca = Seneca()\n  .use(SenecaWeb, config)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27basic\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27entity\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27math\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27api-all\x27\x3c\/span\x3e)\n  .client({\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tcp\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:math\x27\x3c\/span\x3e\n  })\n  .client({\n    \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9002\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epin\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27role:store\x27\x3c\/span\x3e\n  })\n  .ready(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = seneca.export(\x3cspan class=\x22hljs-string\x22\x3e\x27web\/context\x27\x3c\/span\x3e)();\n    server.start(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      server.log(\x3cspan class=\x22hljs-string\x22\x3e\x27server started on: \x27\x3c\/span\x3e \x2b server.info.uri);\n    });\n  });\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一本示例书籍\x3c\/span\x3e\nseneca.act(\n  \x3cspan class=\x22hljs-string\x22\x3e\x27role:store,add:book\x27\x3c\/span\x3e, {\n    \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Action in Seneca\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eprice\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9.99\x3c\/span\x3e\n    }\n  },\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e启动该服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node app-all.js --seneca.log.all\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode app-all.js --seneca.log.all\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从控制台我们可以看到下面这样的消息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22null $-\/-\/book;id=0r7mg7;{title:Action in Seneca,price:9.99}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enull $-\/-\/book;id=0r7mg7;{title:Action \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e Seneca,price:9.99}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这表示成功创建了一本ID为 \x3ccode\x3e0r7mg7\x3c\/code\x3e 的书籍，现在，我们访问 \x3ca href=\x22http:\/\/localhost:3000\/api\/store\/get?id=0r7mg7\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/api\/store\/get?id=0r7mg7\x3c\/a\x3e 即可查看该ID的书籍详情（ID是随机的，所以，你生成的ID可能并不是这样的）。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/localhost:3000\/routes\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/routes\x3c\/a\x3e 可以查看所有的路由。\x3c\/p\x3e\n\x3cp\x3e然后我们可创建一个新的购买订单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22curl -d \x27{\x26quot;id\x26quot;:\x26quot;0r7mg7\x26quot;}\x27 -H \x26quot;content-type:application\/json\x26quot; http:\/\/localhost:3000\/api\/store\/purchase\n{\x26quot;when\x26quot;:1483609872715,\x26quot;bookId\x26quot;:\x26quot;0r7mg7\x26quot;,\x26quot;title\x26quot;:\x26quot;Action in Seneca\x26quot;,\x26quot;price\x26quot;:9.99,\x26quot;id\x26quot;:\x26quot;8suhf4\x26quot;}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3ecurl \x3cspan class=\x22hljs-_\x22\x3e-d\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27{\x22id\x22:\x220r7mg7\x22}\x27\x3c\/span\x3e -H \x3cspan class=\x22hljs-string\x22\x3e\x22content-type:application\/json\x22\x3c\/span\x3e http:\/\/localhost:3000\/api\/store\/purchase\n{\x3cspan class=\x22hljs-string\x22\x3e\x22when\x22\x3c\/span\x3e:1483609872715,\x3cspan class=\x22hljs-string\x22\x3e\x22bookId\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x220r7mg7\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Action in Seneca\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22price\x22\x3c\/span\x3e:9.99,\x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x228suhf4\x22\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e访问 \x3ca href=\x22http:\/\/localhost:3000\/api\/calculate\/sum?left=2\x26amp;right=3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\/api\/calculate\/sum?left=2\x26amp;right=3\x3c\/a\x3e 可以得到 \x3ccode\x3e{\x22answer\x22:5}\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e最佳 Seneca 应用结构实践\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e推荐你这样做\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e将业务逻辑与执行分开，放在单独的插件中，比如不同的Node模块、不同的项目甚至同一个项目下不同的文件都是可以的；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e使用执行脚本撰写您的应用程序，不要害怕为不同的上下文使用不同的脚本，它们看上去应该很短，比如像下面这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var SOME_CONFIG = process.env.SOME_CONFIG || \x27some-default-value\x27\n\nrequire(\x27seneca\x27)({ some_options: 123 })\n\n  \/\/ 已存在的 Seneca 插件\n  .use(\x27community-plugin-0\x27)\n  .use(\x27community-plugin-1\x27, {some_config: SOME_CONFIG})\n  .use(\x27community-plugin-2\x27)\n\n  \/\/ 业务逻辑插件\n  .use(\x27project-plugin-module\x27)\n  .use(\x27..\/plugin-repository\x27)\n  .use(\x27.\/lib\/local-plugin\x27)\n\n  .listen( ... )\n  .client( ... )\n\n  .ready( function() {\n    \/\/ 当 Seneca 启动成功之后的自定义脚本\n  })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e SOME_CONFIG = process.env.SOME_CONFIG || \x3cspan class=\x22hljs-string\x22\x3e\x27some-default-value\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27seneca\x27\x3c\/span\x3e)({ \x3cspan class=\x22hljs-attr\x22\x3esome_options\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 已存在的 Seneca 插件\x3c\/span\x3e\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27community-plugin-0\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27community-plugin-1\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3esome_config\x3c\/span\x3e: SOME_CONFIG})\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27community-plugin-2\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 业务逻辑插件\x3c\/span\x3e\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27project-plugin-module\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/plugin-repository\x27\x3c\/span\x3e)\n  .use(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/lib\/local-plugin\x27\x3c\/span\x3e)\n\n  .listen( ... )\n  .client( ... )\n\n  .ready( \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当 Seneca 启动成功之后的自定义脚本\x3c\/span\x3e\n  })\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e插件加载顺序很重要，这当然是一件好事，可以主上你对消息的成有绝对的控制权。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e不推荐你这样做\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e将 Seneca 应用的启动与初始化同其它框架的启动与初始化放在一起了，永远记住，保持事务的简单；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e将 Seneca 实例当做变量到处传递。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Seneca ：NodeJS 微服务框架入门指南</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008501410">https://segmentfault.com/a/1190000008501410</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/xe4kfnhxlfo/" target="_blank">https://alili.tech/archive/xe4kfnhxlfo/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/t61hviqrk8g/">1-vuejs2.0实战：仿豆瓣app项目，创建自定义组件tabbar<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/zsxxn0n7jj/">2-vuejs2.0实战：仿豆瓣app项目，创建组件header,tabbar路由跳转<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/4ns5cwxsi05/">40 行代码内实现一个 React.js<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/imbao5um82/">50行代码搞定无限滑动幻灯片<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/kfss2f33qsh/">CSS效果篇--CSS3实现5种预载动画效果<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/4tsylfrtz8w/">ES6—类的实现原理<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/mzd8glfuhd/">H5实例教学--从AnimateCC到CreateJS入门<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/xhjgf527wvr/">H5实例教学--微信内嵌视频1（案例浅析）<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/0hqst6af5tx/">HTML&#43;CSS&#43;JAVASCRIPT 高仿低配网页版网易云音乐播放器<aside class="dates">2019-01-26</aside></a></li><li><a href="/archive/14vf08gpmnw/">HTTP验证大法(Basic Auth,Session, JWT, Oauth, Openid)<aside class="dates">2019-01-26</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>