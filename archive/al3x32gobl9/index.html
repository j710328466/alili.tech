<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 React&#43;Redux&#43;Immutable 做俄罗斯方块"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 React&#43;Redux&#43;Immutable 做俄罗斯方块 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/al3x32gobl9/",
				"appid": "1613049289050283", 
				"title": "用 React&#43;Redux&#43;Immutable 做俄罗斯方块 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ol0iq6xh65c/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/48d12cl9t0n/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&text=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&text=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&title=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&is_video=false&description=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&title=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&title=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&title=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fal3x32gobl9%2f&title=%e7%94%a8%20React%2bRedux%2bImmutable%20%e5%81%9a%e4%bf%84%e7%bd%97%e6%96%af%e6%96%b9%e5%9d%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 React&#43;Redux&#43;Immutable 做俄罗斯方块</h1><div class="meta"><div class="postdate"><time datetime="2019-01-29" itemprop="datePublished">2019-01-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e俄罗斯方块是一直各类程序语言热衷实现的经典游戏，JavsScript的实现版本也有很多，用React 做好俄罗斯方块则成了我一个目标。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e戳 \x3ca href=\x22https:\/\/chvin.github.io\/react-tetris\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/chvin.github.io\/react-tetris\x3c\/a\x3e 玩一玩！\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e开源地址：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/chvin\/react-tetris\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e效果预览\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1Ag7CNXXXXXaoXXXXXXXXXXXX-320-483.gif\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1Ag7CNXXXXXaoXXXXXXXXXXXX-320-483.gif\x22 alt=\x22效果预览\x22 title=\x22效果预览\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e正常速度的录制，体验流畅。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e响应式\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1AdjZNXXXXXcCapXXXXXXXXXX-480-343.gif\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1AdjZNXXXXXcCapXXXXXXXXXX-480-343.gif\x22 alt=\x22响应式\x22 title=\x22响应式\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e不仅指屏幕的自适应，而是\x3ccode\x3e在PC使用键盘、在手机使用手指的响应式操作\x3c\/code\x3e：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1kvJyOVXXXXbhaFXXXXXXXXXX-320-555.gif\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1kvJyOVXXXXbhaFXXXXXXXXXX-320-555.gif\x22 alt=\x22手机\x22 title=\x22手机\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e数据持久化\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1EY7cNXXXXXXraXXXXXXXXXXX-320-399.gif\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1EY7cNXXXXXXraXXXXXXXXXXX-320-399.gif\x22 alt=\x22数据持久化\x22 title=\x22数据持久化\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e玩单机游戏最怕什么？断电。通过订阅 \x3ccode\x3estore.subscribe\x3c\/code\x3e，将state储存在localStorage，精确记录所有状态。网页关了刷新了、程序崩溃了、手机没电了，重新打开连接，都可以继续。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eRedux 状态预览\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1hGQqNXXXXXX3XFXXXXXXXXXX-640-381.gif\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1hGQqNXXXXXX3XFXXXXXXXXXX-640-381.gif\x22 alt=\x22Redux状态预览\x22 title=\x22Redux状态预览\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eRedux设计管理了所有应存的状态，这是上面持久化的保证。\x3c\/p\x3e\n\x3cp\x3e游戏框架使用的是 React \x2b Redux，其中再加入了 Immutable，用它的实例来做来Redux的state。（有关React和Redux的介绍可以看：\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2015\/03\/react.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact入门实例\x3c\/a\x3e、\x3ca href=\x22https:\/\/camsong.github.io\/redux-in-chinese\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux中文文档\x3c\/a\x3e）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e1、什么是 Immutable？\x3c\/h2\x3e\n\x3cp\x3eImmutable 是一旦创建，就不能再被更改的数据。对 Immutable 对象的任何修改或添加删除操作都会返回一个新的 Immutable 对象。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e初识\x3c\/h3\x3e\n\x3cp\x3e让我们看下面一段代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function keyLog(touchFn) {\n  let data = { key: \x27value\x27 };\n  f(data);\n  console.log(data.key); \/\/ 猜猜会打印什么？\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ekeyLog\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etouchFn\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e data = { \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27value\x27\x3c\/span\x3e };\n  f(data);\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.key); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 猜猜会打印什么？\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不查看f，不知道它对 \x3ccode\x3edata\x3c\/code\x3e 做了什么，无法确认会打印什么。但如果 \x3ccode\x3edata\x3c\/code\x3e 是 Immutable，你可以确定打印的是 \x3ccode\x3evalue\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function keyLog(touchFn) {\n  let data = Immutable.Map({ key: \x27value\x27 });\n  f(data);\n  console.log(data.get(\x27key\x27));  \/\/ value\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ekeyLog\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etouchFn\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e data = Immutable.Map({ \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27value\x27\x3c\/span\x3e });\n  f(data);\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.get(\x3cspan class=\x22hljs-string\x22\x3e\x27key\x27\x3c\/span\x3e));  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ value\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eJavaScript 中的\x3ccode\x3eObject\x3c\/code\x3e与\x3ccode\x3eArray\x3c\/code\x3e等使用的是引用赋值，新的对象简单的引用了原始对象，改变新也将影响旧的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22foo = {a: 1};  bar = foo;  bar.a = 2;\nfoo.a \/\/ 2\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3efoo = {\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e};  bar = foo;  bar.a = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\nfoo.a \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e虽然这样做可以节约内存，但当应用复杂后，造成了状态不可控，是很大的隐患，节约的内存优点变得得不偿失。\x3c\/p\x3e\n\x3cp\x3eImmutable则不一样，相应的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22foo = Immutable.Map({ a: 1 });  bar = foo.set(\x27a\x27, 2);\nfoo.get(\x27a\x27) \/\/ 1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3efoo = Immutable.Map({ \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e });  bar = foo.set(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\nfoo.get(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e简洁\x3c\/h3\x3e\n\x3cp\x3e在\x3ccode\x3eRedux\x3c\/code\x3e中，它的最优做法是每个\x3ccode\x3ereducer\x3c\/code\x3e都返回一个新的对象（数组），所以我们常常会看到这样的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ reducer\n...\nreturn [\n   ...oldArr.slice(0, 3),\n   newValue,\n   ...oldArr.slice(4)\n];\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ reducer\x3c\/span\x3e\n...\nreturn [\n   ...oldArr.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e),\n   newValue,\n   ...oldArr.slice(\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e)\n];\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了返回新的对象（数组），不得不有上面奇怪的样子，而在使用更深的数据结构时会变的更棘手。\x3cbr\x3e让我们看看Immutable的做法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ reducer\n...\nreturn oldArr.set(4, newValue);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ reducer\x3c\/span\x3e\n...\nreturn oldArr.set(\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, newValue);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是不是很简洁？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e关于 “===”\x3c\/h3\x3e\n\x3cp\x3e我们知道对于\x3ccode\x3eObject\x3c\/code\x3e与\x3ccode\x3eArray\x3c\/code\x3e的\x3ccode\x3e===\x3c\/code\x3e比较，是对引用地址的比较而不是“值比较”，如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{a:1, b:2, c:3} === {a:1, b:2, c:3}; \/\/ false\n[1, 2, [3, 4]] === [1, 2, [3, 4]]; \/\/ false\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e{\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e} === {\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e}; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ false\x3c\/span\x3e\n[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, [\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]] === [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, [\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]]; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ false\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于上面只能采用 deepCopy\x3ccode\x3e、\x3c\/code\x3edeepCompare`来遍历比较，不仅麻烦且好性能。\x3c\/p\x3e\n\x3cp\x3e我们感受来一下\x3ccode\x3eImmutable\x3c\/code\x3e的做法！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22map1 = Immutable.Map({a:1, b:2, c:3});\nmap2 = Immutable.Map({a:1, b:2, c:3});\nImmutable.is(map1, map2); \/\/ true\n\n\/\/ List1 = Immutable.List([1, 2, Immutable.List[3, 4]]);\nList1 = Immutable.fromJS([1, 2, [3, 4]]);\nList2 = Immutable.fromJS([1, 2, [3, 4]]);\nImmutable.is(List1, List2); \/\/ true\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3emap1 = Immutable.Map({\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e});\nmap2 = Immutable.Map({\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e});\nImmutable.is(map1, map2); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ List1 = Immutable.List([1, 2, Immutable.List[3, 4]]);\x3c\/span\x3e\nList1 = Immutable.fromJS([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, [\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]]);\nList2 = Immutable.fromJS([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, [\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]]);\nImmutable.is(List1, List2); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e似乎有阵清风吹过。\x3c\/p\x3e\n\x3cp\x3eReact 做性能优化时有一个\x3ccode\x3e大招\x3c\/code\x3e，就是使用 \x3ccode\x3eshouldComponentUpdate()\x3c\/code\x3e，但它默认返回 \x3ccode\x3etrue\x3c\/code\x3e，即始终会执行 \x3ccode\x3erender()\x3c\/code\x3e 方法，后面做 Virtual DOM 比较。\x3c\/p\x3e\n\x3cp\x3e在使用原生属性时，为了得出shouldComponentUpdate正确的\x3ccode\x3etrue\x3c\/code\x3e or \x3ccode\x3efalse\x3c\/code\x3e，不得不用deepCopy、deepCompare来算出答案，消耗的性能很不划算。而在有了Immutable之后，使用上面的方法对深层结构的比较就变的易如反掌。\x3c\/p\x3e\n\x3cp\x3e对于「俄罗斯方块」，试想棋盘是一个\x3ccode\x3e二维数组\x3c\/code\x3e，可以移动的方块则是\x3ccode\x3e形状(也是二维数组)\x3c\/code\x3e\x2b\x3ccode\x3e坐标\x3c\/code\x3e。棋盘与方块的叠加则组成了最后的结果\x3ccode\x3eMatrix\x3c\/code\x3e。游戏中上面的属性都由\x3ccode\x3eImmutable\x3c\/code\x3e构建，通过它的比较方法，可以轻松写好\x3ccode\x3eshouldComponentUpdate\x3c\/code\x3e。源代码：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/src\/components\/matrix\/index.js#L35\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/src\/components\/matrix\/index.js#L35\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eImmutable学习资料：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/facebook.github.io\/immutable-js\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eImmutable.js\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/camsong\/blog\/issues\/3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eImmutable 详解及 React 中实践\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e2、如何在Redux中使用Immutable\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e目标：将\x3ccode\x3estate\x3c\/code\x3e -\x26gt; Immutable化。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e关键的库：\x3ca href=\x22https:\/\/github.com\/gajus\/redux-immutable\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egajus\/redux-immutable\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e将原来 Redux提供的combineReducers改由上面的库提供：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ rootReduers.js\n\/\/ import { combineReducers } from \x27redux\x27; \/\/ 旧的方法\nimport { combineReducers } from \x27redux-immutable\x27; \/\/ 新的方法\n\nimport prop1 from \x27.\/prop1\x27;\nimport prop2 from \x27.\/prop2\x27;\nimport prop3 from \x27.\/prop3\x27;\n\nconst rootReducer = combineReducers({\n  prop1, prop2, prop3,\n});\n\n\n\/\/ store.js\n\/\/ 创建store的方法和常规一样\nimport { createStore } from \x27redux\x27;\nimport rootReducer from \x27.\/reducers\x27;\n\nconst store = createStore(rootReducer);\nexport default store;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ rootReduers.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ import { combineReducers } from \x27redux\x27; \/\/ 旧的方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { combineReducers } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-immutable\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新的方法\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e prop1 \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/prop1\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e prop2 \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/prop2\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e prop3 \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/prop3\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rootReducer = combineReducers({\n  prop1, prop2, prop3,\n});\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ store.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建store的方法和常规一样\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e rootReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(rootReducer);\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e store;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过新的\x3ccode\x3ecombineReducers\x3c\/code\x3e将把store对象转化成Immutable，在container中使用时也会略有不同（但这正是我们想要的）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const mapStateToProps = (state) =\x3e ({\n  prop1: state.get(\x27prop1\x27),\n  prop2: state.get(\x27prop2\x27),\n  prop3: state.get(\x27prop3\x27),\n  next: state.get(\x27next\x27),\n});\nexport default connect(mapStateToProps)(App);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mapStateToProps = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e ({\n  \x3cspan class=\x22hljs-attr\x22\x3eprop1\x3c\/span\x3e: state.get(\x3cspan class=\x22hljs-string\x22\x3e\x27prop1\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3eprop2\x3c\/span\x3e: state.get(\x3cspan class=\x22hljs-string\x22\x3e\x27prop2\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3eprop3\x3c\/span\x3e: state.get(\x3cspan class=\x22hljs-string\x22\x3e\x27prop3\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3enext\x3c\/span\x3e: state.get(\x3cspan class=\x22hljs-string\x22\x3e\x27next\x27\x3c\/span\x3e),\n});\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(mapStateToProps)(App);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e3、Web Audio Api\x3c\/h2\x3e\n\x3cp\x3e游戏里有很多不同的音效，而实际上只引用了一个音效文件：\x3cdiv\x3e\x3cspan class=\x22mejs__offscreen\x22\x3eAudio Player\x3c\/span\x3e\x3cdiv id=\x22mep_0\x22 class=\x22mejs__container mejs__container-keyboard-inactive mejs__audio\x22 tabindex=\x220\x22 role=\x22application\x22 aria-label=\x22Audio Player\x22 style=\x22width: 825px; height: 40px; min-width: 241px;\x22\x3e\x3cdiv class=\x22mejs__inner\x22\x3e\x3cdiv class=\x22mejs__mediaelement\x22\x3e\x3cmediaelementwrapper id=\x22mejs_5673696829988848\x22\x3e\x3caudio src=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/build\/music.mp3\x22 preload=\x22auto\x22 id=\x22mejs_5673696829988848_html5\x22 style=\x22width: 100%; height: 100%;\x22\x3e\x3c\/audio\x3e\x3c\/mediaelementwrapper\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__layers\x22\x3e\x3cdiv class=\x22mejs__poster mejs__layer\x22 style=\x22display: none; width: 100%; height: 100%;\x22\x3e\x3c\/div\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__controls\x22\x3e\x3cdiv class=\x22mejs__button mejs__playpause-button mejs__play\x22\x3e\x3cbutton type=\x22button\x22 aria-controls=\x22mep_0\x22 title=\x22Play\x22 aria-label=\x22Play\x22 tabindex=\x220\x22\x3e\x3c\/button\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__time mejs__currenttime-container\x22 role=\x22timer\x22 aria-live=\x22off\x22\x3e\x3cspan class=\x22mejs__currenttime\x22\x3e00:00\x3c\/span\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__time-rail\x22\x3e\x3cspan class=\x22mejs__time-total mejs__time-slider\x22 role=\x22slider\x22 tabindex=\x220\x22 aria-label=\x22Time Slider\x22 aria-valuemin=\x220\x22 aria-valuemax=\x22NaN\x22 aria-valuenow=\x220\x22 aria-valuetext=\x2200:00\x22\x3e\x3cspan class=\x22mejs__time-buffering\x22 style=\x22display: none;\x22\x3e\x3c\/span\x3e\x3cspan class=\x22mejs__time-loaded\x22\x3e\x3c\/span\x3e\x3cspan class=\x22mejs__time-current\x22\x3e\x3c\/span\x3e\x3cspan class=\x22mejs__time-hovered no-hover\x22\x3e\x3c\/span\x3e\x3cspan class=\x22mejs__time-handle\x22\x3e\x3cspan class=\x22mejs__time-handle-content\x22\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22mejs__time-float\x22\x3e\x3cspan class=\x22mejs__time-float-current\x22\x3e00:00\x3c\/span\x3e\x3cspan class=\x22mejs__time-float-corner\x22\x3e\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__time mejs__duration-container\x22\x3e\x3cspan class=\x22mejs__duration\x22\x3e00:00\x3c\/span\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__button mejs__volume-button mejs__mute\x22\x3e\x3cbutton type=\x22button\x22 aria-controls=\x22mep_0\x22 title=\x22Mute\x22 aria-label=\x22Mute\x22 tabindex=\x220\x22\x3e\x3c\/button\x3e\x3c\/div\x3e\x3ca class=\x22mejs__horizontal-volume-slider\x22 href=\x22javascript:void(0);\x22 aria-label=\x22Volume Slider\x22 aria-valuemin=\x220\x22 aria-valuemax=\x22100\x22 role=\x22slider\x22\x3e\x3cspan class=\x22mejs__offscreen\x22\x3eUse Up\/Down Arrow keys to increase or decrease volume.\x3c\/span\x3e\x3cdiv class=\x22mejs__horizontal-volume-total\x22\x3e\x3cdiv class=\x22mejs__horizontal-volume-current\x22 style=\x22left: 0px; width: 100%;\x22\x3e\x3c\/div\x3e\x3cdiv class=\x22mejs__horizontal-volume-handle\x22 style=\x22left: 100%;\x22\x3e\x3c\/div\x3e\x3c\/div\x3e\x3c\/a\x3e\x3c\/div\x3e\x3c\/div\x3e\x3c\/div\x3e\x3c\/div\x3e\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/build\/music.mp3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22 download=\x22music.mp3\x22\x3e下载音频\x3c\/a\x3e。借助\x3ccode\x3eWeb Audio Api\x3c\/code\x3e能够以毫秒级精确、高频率的播放音效，这是\x3ccode\x3e\x26lt;audio\x26gt;\x3c\/code\x3e标签所做不到的。在游戏进行中按住方向键移动方块，便可以听到高频率的音效。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1fYgzNXXXXXXnXpXXXXXXXXXX-633-358.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1fYgzNXXXXXXnXpXXXXXXXXXX-633-358.png\x22 alt=\x22网页音效进阶\x22 title=\x22网页音效进阶\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eWAA\x3c\/code\x3e 是一套全新的相对独立的接口系统，对音频文件拥有更高的处理权限以及更专业的内置音频效果，是W3C的推荐接口，能专业处理“音速、音量、环境、音色可视化、高频、音向”等需求，下图介绍了WAA的使用流程。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1nBf1NXXXXXagapXXXXXXXXXX-520-371.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1nBf1NXXXXXagapXXXXXXXXXX-520-371.png\x22 alt=\x22流程\x22 title=\x22流程\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e其中Source代表一个音频源，Destination代表最终的输出，多个Source合成出了Destination。\x3cbr\x3e源代码：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/src\/unit\/music.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/src\/unit\/music.js\x3c\/a\x3e 实现了ajax加载mp3，并转为WAA，控制播放的过程。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eWAA\x3c\/code\x3e 在各个浏览器的最新2个版本下的支持情况（\x3ca href=\x22http:\/\/caniuse.com\/#search=webaudio\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCanIUse\x3c\/a\x3e）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHd2t\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHd2t\x22 alt=\x22浏览器支持\x22 title=\x22浏览器支持\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到IE阵营与大部分安卓机不能使用，其他ok。\x3c\/p\x3e\n\x3cp\x3eWeb Audio Api 学习资料：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Web_Audio_API\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWeb API 接口| MDN\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.html5rocks.com\/en\/tutorials\/webaudio\/intro\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGetting Started with Web Audio API\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e4、游戏在体验上的优化\x3c\/h2\x3e\n\x3cp\x3e技术：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e按下方向键水平移动和竖直移动的触发频率是不同的，游戏可以定义触发频率，代替原生的事件频率，源代码：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/src\/unit\/event.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/src\/unit\/event.js\x3c\/a\x3e ；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e左右移动可以 delay 掉落的速度，但在撞墙移动的时候 delay 的稍小；在速度为6级时 通过delay 会保证在一行内水平完整移动一次；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e对按钮同时注册\x3ccode\x3etouchstart\x3c\/code\x3e和\x3ccode\x3emousedown\x3c\/code\x3e事件，以供响应式游戏。当\x3ccode\x3etouchstart\x3c\/code\x3e发生时，不会触发\x3ccode\x3emousedown\x3c\/code\x3e，而当\x3ccode\x3emousedown\x3c\/code\x3e发生时，由于鼠标移开事件元素可以不触发\x3ccode\x3emouseup\x3c\/code\x3e，将同时监听\x3ccode\x3emouseout\x3c\/code\x3e 模拟 mouseup`。源代码：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/src\/components\/keyboard\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/src\/components\/keyboard\/index.js\x3c\/a\x3e；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e监听了 \x3ccode\x3evisibilitychange\x3c\/code\x3e 事件，当页面被隐藏切换的时候，游戏将不会进行，切换回来将继续，这个\x3ccode\x3efocus\x3c\/code\x3e状态也被写进了Redux中。所以当用手机玩来\x3ccode\x3e电话\x3c\/code\x3e时，游戏进度将保存；PC开着游戏干别的也不会听到gameover，这有点像 \x3ccode\x3eios\x3c\/code\x3e 应用的切换。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在\x3ccode\x3e任意\x3c\/code\x3e时刻刷新网页，（比如消除方块时、游戏结束时）也能还原当前状态；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e游戏中唯一用到的图片，其他都是CSS；\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/img.alicdn.com\/tps\/TB1qq7kNXXXXXacXFXXXXXXXXXX-400-186.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/img.alicdn.com\/tps\/TB1qq7kNXXXXXacXFXXXXXXXXXX-400-186.png\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e游戏兼容 Chrome、Firefox、IE9\x2b、Edge等；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e玩法：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e可以在游戏未开始时制定初始的棋盘（十个级别）和速度（六个级别）；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一次消除1行得100分、2行得300分、3行得700分、4行得1500分；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e方块掉落速度会随着消除的行数增加（每20行增加一个级别）；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e5、开发中的经验梳理\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e为所有的\x3ccode\x3ecomponent\x3c\/code\x3e都编写了\x3ccode\x3eshouldComponentUpdate\x3c\/code\x3e，在手机上的性能相对有显著的提升。中大型应用在遇到性能上的问题的时候，写好shouldComponentUpdate 一定会帮你一把。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e无状态组件`（\x3ca href=\x22https:\/\/medium.com\/@joshblack\/stateless-components-in-react-0-14-f9798f8b992d#.xjqnbfx4e\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eStateless Functional Components\x3c\/a\x3e）是没有生命周期的。而因为上条因素，所有组件都需要生命周期 shouldComponentUpdate，所以未使用无状态组件。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在 webpack.config.js\x3ccode\x3e 中的 devServer属性写入\x3c\/code\x3ehost: \x270.0.0.0\x27`，可以在开发时用ip访问，不局限在localhost；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eredux中的\x3ccode\x3estore\x3c\/code\x3e并非只能通过connect将方法传递给\x3ccode\x3econtainer\x3c\/code\x3e，可以跳出组件，在别的文件拿出来做流程控制(dispatch)，源代码：\x3ca href=\x22https:\/\/github.com\/chvin\/react-tetris\/blob\/master\/src\/control\/states.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/src\/control\/states.js\x3c\/a\x3e；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用 react\x2bredux 做持久化非常的方便，只要将redux状态储存，在每一个reduers做初始化的时候读取就好。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e通过配置 .eslintrc.js\x3ccode\x3e 与 webpack.config.js\x3c\/code\x3e ，项目中集成了 ESLint` 检验。使用 ESLint 可以使编码按规范编写，有效地控制代码质量。不符规范的代码在开发时（或build时）都能通过IDE与控制台发现错误。 参考：\x3ca href=\x22https:\/\/github.com\/dwqs\/react-style-guide\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAirbnb: React使用规范\x3c\/a\x3e；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e6、总结\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e作为一个 React 的练手应用，在实现的过程中发现小小的“方块”还是有很多的细节可以优化和打磨，这时就是考验一名前端工程师的细心和功力的时候。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e优化的方向既有 React 的本身，比如哪些状态由 Redux存，哪些状态给组件的state就好；而跳出框架又有产品的很多特点可以玩，为了达到你的需求，这些都将自然的推进技术的发展。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一个项目从零开始，功能一点一滴慢慢累积，就会盖成高楼，不要畏难，有想法就敲起来吧。 ^_^\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 React+Redux+Immutable 做俄罗斯方块</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007878885">https://segmentfault.com/a/1190000007878885</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/al3x32gobl9/" target="_blank">https://alili.tech/archive/al3x32gobl9/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>