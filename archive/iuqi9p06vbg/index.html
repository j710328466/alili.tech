<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 canvas 实现 Web 手势解锁"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 canvas 实现 Web 手势解锁 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/iuqi9p06vbg/",
				"appid": "1613049289050283", 
				"title": "用 canvas 实现 Web 手势解锁 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-17T02:30:25"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/pvp1m0q8mc/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/brbah5n9jpp/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&text=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&text=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&title=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&is_video=false&description=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&title=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&title=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&title=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiuqi9p06vbg%2f&title=%e7%94%a8%20canvas%20%e5%ae%9e%e7%8e%b0%20Web%20%e6%89%8b%e5%8a%bf%e8%a7%a3%e9%94%81"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 canvas 实现 Web 手势解锁</h1><div class="meta"><div class="postdate"><time datetime="2019-01-17" itemprop="datePublished">2019-01-17</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近参加 360 暑假的前端星计划，有一个在线作业，截止日期是 3 月 30 号，让手动实现一个 H5 手势解锁，具体的效果就像原生手机的九宫格解锁那样。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/wx2.sinaimg.cn\/mw690\/e3dde130gy1fe7f1fpkyhj20zk0nm145.jpg\x22 src=\x22https:\/\/static.alili.techhttp:\/\/wx2.sinaimg.cn\/mw690\/e3dde130gy1fe7f1fpkyhj20zk0nm145.jpg\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e实现的最终效果就像下面这张图这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p1.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p1.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e基本要求是这样的：将密码保存到 \x3ccode\x3elocalStorage\x3c\/code\x3e 里，开始的时候会从本地读取密码，如果没有就让用户设置密码，密码最少为五位数，少于五位要提示错误。需要对第一次输入的密码进行验证，两次一样才能保持，然后是验证密码，能够对用户输入的密码进行验证。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eH5 手势解锁\x3c\/h2\x3e\n\x3cp\x3e扫码在线查看：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/url2.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/url2.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e或者点击查看\x3ca href=\x22http:\/\/songjz.coding.me\/H5HandLock\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e手机版\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e项目 GitHub 地址，\x3ca href=\x22https:\/\/github.com\/songjinzhong\/H5HandLock\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eH5HandLock\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e首先，我要说明一下，对于这个项目，我是参考别人的，\x3ca href=\x22https:\/\/github.com\/lvming6816077\/H5lock\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eH5lock\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e我觉得一个比较合理的解法应该是利用 canvas 来实现，不知道有没有大神用 css 来实现。如果纯用 css 的话，可以将连线先设置 \x3ccode\x3edisplay: none\x3c\/code\x3e，当手指划过的时候，显示出来。光设置这些应该就非常麻烦吧。\x3c\/p\x3e\n\x3cp\x3e之前了解过 canvas，但没有真正的写过，下面就来介绍我这几天学习 canvas 并实现 H5 手势解锁的过程。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e准备及布局设置\x3c\/h2\x3e\n\x3cp\x3e我这里用了一个比较常规的做法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(function(w){\n  var handLock = function(option){}\n\n  handLock.prototype = {\n    init : function(){},\n    ...\n  }\n\n  w.handLock = handLock;\n})(window)\n\n\/\/ 使用\nnew handLock({\n  el: document.getElementById(\x27id\x27),\n  ...\n}).init();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ew\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e handLock = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoption\x3c\/span\x3e)\x3c\/span\x3e{}\n\n  handLock.prototype = {\n    \x3cspan class=\x22hljs-attr\x22\x3einit\x3c\/span\x3e : \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{},\n    ...\n  }\n\n  w.handLock = handLock;\n})(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e handLock({\n  \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e),\n  ...\n}).init();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e常规方法，比较易懂和操作，弊端就是，可以被随意的修改。\x3c\/p\x3e\n\x3cp\x3e传入的参数中要包含一个 dom 对象，会在这个 dom 对象內创建一个 canvas。当然还有一些其他的 dom 参数，比如 message，info 等。\x3c\/p\x3e\n\x3cp\x3e关于 css 的话，懒得去新建文件了，就直接內联了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3ecanvas\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e1. 学习 canvas 并搞定画圆\x3c\/h3\x3e\n\x3cp\x3eMDN 上面有个简易的教程，大致浏览了一下，感觉还行。\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Canvas_API\/Tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCanvas教程\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e先创建一个 \x3ccode\x3ecanvas\x3c\/code\x3e，然后设置其大小，并通过 \x3ccode\x3egetContext\x3c\/code\x3e 方法获得绘画的上下文：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var canvas = document.createElement(\x27canvas\x27);\ncanvas.width = canvas.height = width;\nthis.el.appendChild(canvas);\n\nthis.ctx = canvas.getContext(\x272d\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27canvas\x27\x3c\/span\x3e);\ncanvas.width = canvas.height = width;\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.appendChild(canvas);\n\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx = canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后呢，先画 \x3ccode\x3en*n\x3c\/code\x3e 个圆出来：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22createCircles: function(){\n  var ctx = this.ctx,\n    drawCircle = this.drawCircle,\n    n = this.n;\n  this.r = ctx.canvas.width \/ (2 \x2b 4 * n) \/\/ 这里是参考的，感觉这种画圆的方式挺合理的，方方圆圆\n  r = this.r;\n  this.circles = []; \/\/ 用来存储圆心的位置\n  for(var i = 0; i \x3c n; i\x2b\x2b){\n    for(var j = 0; j \x3c n; j\x2b\x2b){\n      var p = {\n        x: j * 4 * r \x2b 3 * r,\n        y: i * 4 * r \x2b 3 * r,\n        id: i * 3 \x2b j\n      }\n      this.circles.push(p);\n    }\n  }\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); \/\/ 为了防止重复画\n  this.circles.forEach(function(v){\n    drawCircle(ctx, v.x, v.y); \/\/ 画每个圆\n  })\n},\n\ndrawCircle: function(ctx, x, y){ \/\/ 画圆函数\n  ctx.strokeStyle = \x27#FFFFFF\x27;\n  ctx.lineWidth = 2;\n  ctx.beginPath();\n  ctx.arc(x, y, this.r, 0, Math.PI * 2, true);\n  ctx.closePath();\n  ctx.stroke();\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ecreateCircles: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ctx = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx,\n    drawCircle = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawCircle,\n    n = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.n;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.r = ctx.canvas.width \/ (\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e * n) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里是参考的，感觉这种画圆的方式挺合理的，方方圆圆\x3c\/span\x3e\n  r = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.r;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.circles = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用来存储圆心的位置\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; n; i\x2b\x2b){\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; j \x26lt; n; j\x2b\x2b){\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = {\n        \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: j * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e * r \x2b \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e * r,\n        \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e * r \x2b \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e * r,\n        \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: i * \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e \x2b j\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.circles.push(p);\n    }\n  }\n  ctx.clearRect(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, ctx.canvas.width, ctx.canvas.height); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了防止重复画\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.circles.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e)\x3c\/span\x3e{\n    drawCircle(ctx, v.x, v.y); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画每个圆\x3c\/span\x3e\n  })\n},\n\n\x3cspan class=\x22hljs-attr\x22\x3edrawCircle\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ectx, x, y\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画圆函数\x3c\/span\x3e\n  ctx.strokeStyle = \x3cspan class=\x22hljs-string\x22\x3e\x27#FFFFFF\x27\x3c\/span\x3e;\n  ctx.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n  ctx.beginPath();\n  ctx.arc(x, y, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.r, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n  ctx.closePath();\n  ctx.stroke();\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e画圆函数，需要注意：如何确定圆的半径和每个圆的圆心坐标（这个我是参考的），如果以圆心为中点，每个圆上下左右各扩展一个半径的距离，同时为了防止四边太挤，四周在填充一个半径的距离。那么得到的半径就是 \x3ccode\x3ewidth \/ ( 4 * n \x2b 2)\x3c\/code\x3e，对应也可以算出每个圆所在的圆心坐标，也有一套公式，\x3cstrong\x3eGET\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2. 画线\x3c\/h3\x3e\n\x3cp\x3e画线需要借助 touch event 来完成，也就是，当我们 \x3ccode\x3etouchstart\x3c\/code\x3e 的时候，传入开始时的相对坐标，作为线的一端，当我们 \x3ccode\x3etouchmove\x3c\/code\x3e 的时候，获得坐标，作为线的另一端，当我们 \x3ccode\x3etouchend\x3c\/code\x3e 的时候，开始画线。\x3c\/p\x3e\n\x3cp\x3e这只是一个测试画线功能，具体的后面再进行修改。\x3c\/p\x3e\n\x3cp\x3e有两个函数，获得当前 touch 的相对坐标：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22getTouchPos: function(e){ \/\/ 获得触摸点的相对位置\n  var rect = e.target.getBoundingClientRect();\n  var p = { \/\/ 相对坐标\n    x: e.touches[0].clientX - rect.left,\n    y: e.touches[0].clientY - rect.top\n  };\n  return p;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3egetTouchPos: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获得触摸点的相对位置\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rect = e.target.getBoundingClientRect();\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 相对坐标\x3c\/span\x3e\n    x: e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX - rect.left,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY - rect.top\n  };\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e p;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e画线：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22drawLine: function(p1, p2){ \/\/ 画线\n  this.ctx.beginPath();\n  this.ctx.lineWidth = 3;\n  this.ctx.moveTo(p1.x, p2.y);\n  this.ctx.lineTo(p.x, p.y);\n  this.ctx.stroke();\n  this.ctx.closePath();\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edrawLine: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep1, p2\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画线\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.beginPath();\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.moveTo(p1.x, p2.y);\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.lineTo(p.x, p.y);\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.stroke();\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.closePath();\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后就是监听 canvas 的 \x3ccode\x3etouchstart\x3c\/code\x3e、\x3ccode\x3etouchmove\x3c\/code\x3e、和 \x3ccode\x3etouchend\x3c\/code\x3e 事件了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3. 画折线\x3c\/h3\x3e\n\x3cp\x3e所谓的画折线，就是，将已经触摸到的点连起来，可以把它看作是画折线。\x3c\/p\x3e\n\x3cp\x3e首先，要用两个数组，一个数组用于已经 touch 过的点，另一个数组用于存储未 touch 的点，然后在 move 监听时候，对 touch 的相对位置进行判断，如果触到点，就把该点从未 touch 移到 touch 中，然后，画折线，思路也很简单。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22drawLine: function(p){ \/\/ 画折线\n  this.ctx.beginPath();\n  this.ctx.lineWidth = 3;\n  this.ctx.moveTo(this.touchCircles[0].x, this.touchCircles[0].y);\n  for (var i = 1 ; i \x3c this.touchCircles.length ; i\x2b\x2b) {\n    this.ctx.lineTo(this.touchCircles[i].x, this.touchCircles[i].y);\n  }\n  this.ctx.lineTo(p.x, p.y);\n  this.ctx.stroke();\n  this.ctx.closePath();\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edrawLine: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画折线\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.beginPath();\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.moveTo(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].x, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].y);\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e ; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length ; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.lineTo(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].x, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].y);\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.lineTo(p.x, p.y);\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.stroke();\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.closePath();\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22judgePos: function(p){ \/\/ 判断 触点 是否在 circle 內\n  for(var i = 0; i \x3c this.restCircles.length; i\x2b\x2b){\n    temp = this.restCircles[i];\n    if(Math.abs(p.x - temp.x) \x3c r \x26amp;\x26amp; Math.abs(p.y - temp.y) \x3c r){\n      this.touchCircles.push(temp);\n      this.restCircles.splice(i, 1);\n      this.touchFlag = true;\n      break;\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ejudgePos: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断 触点 是否在 circle 內\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.restCircles.length; i\x2b\x2b){\n    temp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.restCircles[i];\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(p.x - temp.x) \x26lt; r \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(p.y - temp.y) \x26lt; r){\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.push(temp);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.restCircles.splice(i, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchFlag = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e4. 标记已画\x3c\/h3\x3e\n\x3cp\x3e前面已经说了，我们把已经 touch 的点（圆）放到数组中，这个时候需要将这些已经 touch 的点给标记一下，在圆心处画一个小实心圆：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22drawPoints: function(){\n  for (var i = 0 ; i \x3c this.touchCircles.length ; i\x2b\x2b) {\n    this.ctx.fillStyle = \x27#FFFFFF\x27;\n    this.ctx.beginPath();\n    this.ctx.arc(this.touchCircles[i].x, this.touchCircles[i].y, this.r \/ 2, 0, Math.PI * 2, true);\n    this.ctx.closePath();\n    this.ctx.fill();\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edrawPoints: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length ; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.fillStyle = \x3cspan class=\x22hljs-string\x22\x3e\x27#FFFFFF\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.beginPath();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.arc(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].x, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].y, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.r \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.closePath();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx.fill();\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同时添加一个 reset 函数，当 touchend 的时候调用，400ms 调用 reset 重置 canvas。\x3c\/p\x3e\n\x3cp\x3e到现在为止，一个 H5 手势解锁的简易版已经基本完成。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3epassword\x3c\/h2\x3e\n\x3cp\x3e为了要实现记住和重置密码的功能，把 password 保存在 localStorage 中，但首先要添加必要的 html 和样式。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e1. 添加 message 和 单选框\x3c\/h3\x3e\n\x3cp\x3e为了尽可能的使界面简洁（越丑越好），直接在 body 后面添加了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;select\x26quot;\x3e\n  \x3cdiv class=\x26quot;message\x26quot;\x3e请输入手势密码\x3c\/div\x3e\n  \x3cdiv class=\x26quot;radio\x26quot;\x3e\n    \x3clabel\x3e\x3cinput type=\x26quot;radio\x26quot; name=\x26quot;pass\x26quot;\x3e设置手势密码\x3c\/label\x3e\n    \x3clabel\x3e\x3cinput type=\x26quot;radio\x26quot; name=\x26quot;pass\x26quot;\x3e验证手势密码\x3c\/label\x3e\n  \x3c\/div\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22select\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22message\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e请输入手势密码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22radio\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22radio\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22pass\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e设置手势密码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22radio\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22pass\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e验证手势密码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将添加到 dom 已 option 的形式传给 handLock：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var el = document.getElementById(\x27handlock\x27),\n  info = el.getElementsByClassName(\x27info\x27)[0],\n  select = document.getElementById(\x27select\x27),\n  message = select.getElementsByClassName(\x27message\x27)[0],\n  radio = select.getElementsByClassName(\x27radio\x27)[0],\n  setPass = radio.children[0].children[0],\n  checkPass = radio.children[1].children[0];\nnew handLock({\n  el: el,\n  info: info,\n  message: message,\n  setPass: setPass,\n  checkPass: checkPass,\n  n: 3\n}).init();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e el = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27handlock\x27\x3c\/span\x3e),\n  info = el.getElementsByClassName(\x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n  select = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27select\x27\x3c\/span\x3e),\n  message = select.getElementsByClassName(\x3cspan class=\x22hljs-string\x22\x3e\x27message\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n  radio = select.getElementsByClassName(\x3cspan class=\x22hljs-string\x22\x3e\x27radio\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n  setPass = radio.children[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].children[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n  checkPass = radio.children[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].children[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e handLock({\n  \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: el,\n  \x3cspan class=\x22hljs-attr\x22\x3einfo\x3c\/span\x3e: info,\n  \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: message,\n  \x3cspan class=\x22hljs-attr\x22\x3esetPass\x3c\/span\x3e: setPass,\n  \x3cspan class=\x22hljs-attr\x22\x3echeckPass\x3c\/span\x3e: checkPass,\n  \x3cspan class=\x22hljs-attr\x22\x3en\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n}).init();\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e2. info 信息显示\x3c\/h3\x3e\n\x3cp\x3e关于 info 信息显示，自己写了一个悬浮窗，然后默认为 \x3ccode\x3edisplay: none\x3c\/code\x3e，然后写了一个 \x3ccode\x3eshowInfo\x3c\/code\x3e 函数用来显示提示信息，直接调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22showInfo: function(message, timer){ \/\/ 专门用来显示 info\n  var info = this.dom.info;\n  info.innerHTML = message;\n  info.style.display = \x27block\x27;\n  setTimeout(function(){\n    info.style.display = \x27\x27;\n  }, 1000)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eshowInfo: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, timer\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 专门用来显示 info\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e info = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.info;\n  info.innerHTML = message;\n  info.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e;\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    info.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n  }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于 info 的样式，在 html 中呢。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e3. 关于密码\x3c\/h3\x3e\n\x3cp\x3e先不考虑从 localStorage 读取到情况，新加一个 lsPass 对象，专门用于存储密码，由于密码情况比较多，比如设置密码，二次确认密码，验证密码，为了方便管理，暂时设置了密码的三种模式，分别是：\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3emodel：1 验证密码模式\x3c\/p\x3e\n\x3cp\x3emodel：2 设置密码模式\x3c\/p\x3e\n\x3cp\x3emodel：3 设置密码二次验证\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e具体看下面这个图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/llc.jpeg\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/llc.jpeg\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这三种 model ，只要处理好它们之间如何跳转就 ok 了，即状态的改变。\x3c\/p\x3e\n\x3cp\x3e所以就有了 initPass：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22initPass: function(){ \/\/ 将密码初始化\n  this.lsPass = w.localStorage.getItem(\x27HandLockPass\x27) ? {\n    model: 1,\n    pass: w.localStorage.getItem(\x27HandLockPass\x27).split(\x27-\x27)\n  } : { model: 2 };\n  this.updateMessage();\n},\n\nupdateMessage: function(){ \/\/ 根据当前模式，更新 dom\n  if(this.lsPass.model == 2){\n    this.dom.setPass.checked = true;\n    this.dom.message.innerHTML = \x27请设置手势密码\x27;\n  }else if(this.lsPass.model == 1){\n    this.dom.checkPass.checked = true;\n    this.dom.message.innerHTML = \x27请验证手势密码\x27;\n  }else if(this.lsPass.model = 3){\n    this.dom.setPass.checked = true;\n    this.dom.message.innerHTML = \x27请再次输入密码\x27;\n  }\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3einitPass: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将密码初始化\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass = w.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x27HandLockPass\x27\x3c\/span\x3e) ? {\n    \x3cspan class=\x22hljs-attr\x22\x3emodel\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epass\x3c\/span\x3e: w.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x27HandLockPass\x27\x3c\/span\x3e).split(\x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e)\n  } : { \x3cspan class=\x22hljs-attr\x22\x3emodel\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e };\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateMessage();\n},\n\n\x3cspan class=\x22hljs-attr\x22\x3eupdateMessage\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据当前模式，更新 dom\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model == \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.setPass.checked = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.message.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27请设置手势密码\x27\x3c\/span\x3e;\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.checkPass.checked = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.message.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27请验证手势密码\x27\x3c\/span\x3e;\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.setPass.checked = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.message.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27请再次输入密码\x27\x3c\/span\x3e;\n  }\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有必要再来介绍一下 lsPass 的格式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.lsPass = {\n  model：1, \/\/ 表示当前的模式\n  pass: [0, 1, 2, 4, 5] \/\/ 表示当前的密码，可能不存在\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass = {\n  model：\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 表示当前的模式\x3c\/span\x3e\n  pass: [\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e] \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 表示当前的密码，可能不存在\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为之前已经有了一个基本的实现框架，现在只需要在 touchend 之后，写一个函数，功能就是先对当前的 model 进行判断，实现对应的功能，这里要用到 touchCircles 数组，表示密码的顺序：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22checkPass: function(){\n  var succ, model = this.lsPass.model; \/\/succ 以后会用到\n  if(model == 2){ \/\/ 设置密码\n    if(this.touchCircles.length \x3c 5){ \/\/ 验证密码长度\n      succ = false;\n      this.showInfo(\x27密码长度至少为 5！\x27, 1000);\n    }else{\n      succ = true;\n      this.lsPass.temp = []; \/\/ 将密码放到临时区存储\n      for(var i = 0; i \x3c this.touchCircles.length; i\x2b\x2b){\n        this.lsPass.temp.push(this.touchCircles[i].id);\n      }\n      this.lsPass.model = 3;\n      this.showInfo(\x27请再次输入密码\x27, 1000);\n      this.updateMessage();\n    }\n  }else if(model == 3){\/\/ 确认密码\n    var flag = true;\n    \/\/ 先要验证密码是否正确\n    if(this.touchCircles.length == this.lsPass.temp.length){\n      var tc = this.touchCircles, lt = this.lsPass.temp;\n      for(var i = 0; i \x3c tc.length; i\x2b\x2b){\n        if(tc[i].id != lt[i]){\n          flag = false;\n        }\n      }\n    }else{\n      flag = false;\n    }\n    if(!flag){\n      succ = false;\n      this.showInfo(\x27两次密码不一致，请重新输入\x27, 1000);\n      this.lsPass.model = 2; \/\/ 由于密码不正确，重新回到 model 2\n      this.updateMessage();\n    }else{\n      succ = true; \/\/ 密码正确，localStorage 存储，并设置状态为 model 1\n      w.localStorage.setItem(\x27HandLockPass\x27, this.lsPass.temp.join(\x27-\x27)); \/\/ 存储字符串\n      this.lsPass.model = 1; \n      this.lsPass.pass = this.lsPass.temp;\n      this.updateMessage();\n    }\n    delete this.lsPass.temp; \/\/ 很重要，一定要删掉，bug\n  }else if(model == 1){ \/\/ 验证密码\n    var tc = this.touchCircles, lp = this.lsPass.pass, flag = true;\n    if(tc.length == lp.length){\n      for(var i = 0; i \x3c tc.length; i\x2b\x2b){\n        if(tc[i].id != lp[i]){\n          flag = false;\n        }\n      }\n    }else{\n      flag = false;\n    }\n    if(!flag){\n      succ = false;\n      this.showInfo(\x27很遗憾，密码错误\x27, 1000);\n    }else{\n      succ = true;\n      this.showInfo(\x27恭喜你，验证通过\x27, 1000);\n    }\n  }\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echeckPass: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e succ, model = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model; \x3cspan class=\x22hljs-comment\x22\x3e\/\/succ 以后会用到\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(model == \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置密码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length \x26lt; \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证密码长度\x3c\/span\x3e\n      succ = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27密码长度至少为 5！\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      succ = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将密码放到临时区存储\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length; i\x2b\x2b){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp.push(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].id);\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27请再次输入密码\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateMessage();\n    }\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(model == \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e){\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 确认密码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e flag = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先要验证密码是否正确\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length == \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp.length){\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tc = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles, lt = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp;\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; tc.length; i\x2b\x2b){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(tc[i].id != lt[i]){\n          flag = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        }\n      }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      flag = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!flag){\n      succ = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27两次密码不一致，请重新输入\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 由于密码不正确，重新回到 model 2\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateMessage();\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      succ = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 密码正确，localStorage 存储，并设置状态为 model 1\x3c\/span\x3e\n      w.localStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x27HandLockPass\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp.join(\x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存储字符串\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; \n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.pass = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateMessage();\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.temp; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 很重要，一定要删掉，bug\x3c\/span\x3e\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(model == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证密码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tc = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles, lp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lsPass.pass, flag = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(tc.length == lp.length){\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; tc.length; i\x2b\x2b){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(tc[i].id != lp[i]){\n          flag = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        }\n      }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      flag = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!flag){\n      succ = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27很遗憾，密码错误\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      succ = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27恭喜你，验证通过\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    }\n  }\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e密码的设置要参考前面那张图，要时刻警惕状态的改变。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e4. 手动重置密码\x3c\/h3\x3e\n\x3cp\x3e思路也很简单，就是添加点击事件，点击之后，改变 model 即可，点击事件如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.dom.setPass.addEventListener(\x27click\x27, function(e){\n  self.lsPass.model = 2; \/\/ 改变 model 为设置密码\n  self.updateMessage(); \/\/ 更新 message\n  self.showInfo(\x27请设置密码\x27, 1000);\n})\nthis.dom.checkPass.addEventListener(\x27click\x27, function(e){\n  if(self.lsPass.pass){\n    self.lsPass.model = 1;\n    self.updateMessage();\n    self.showInfo(\x27请验证密码\x27, 1000)\n  }else{\n    self.showInfo(\x27请先设置密码\x27, 1000);\n    self.updateMessage();\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.setPass.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n  self.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 改变 model 为设置密码\x3c\/span\x3e\n  self.updateMessage(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新 message\x3c\/span\x3e\n  self.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27请设置密码\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n})\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.checkPass.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(self.lsPass.pass){\n    self.lsPass.model = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n    self.updateMessage();\n    self.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27请验证密码\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    self.showInfo(\x3cspan class=\x22hljs-string\x22\x3e\x27请先设置密码\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    self.updateMessage();\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eps：这里面还有几个小的 bug\x3c\/strong\x3e，因为 model 只有 3 个，所以设置的时候，当点击重置密码的时候，没有设置密码成功，又切成验证密码状态，此时无法提升沿用旧密码，原因是 \x3cstrong\x3emodel 只有三个\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e5. 添加 touchend 颜色变化\x3c\/h3\x3e\n\x3cp\x3e实现这个基本上就大功告成了，这个功能最主要的是给用户一个提醒，若用户划出的密码符合规范，显示绿色，若不符合规范或错误，显示红色警告。\x3c\/p\x3e\n\x3cp\x3e因为之前已经设置了一个 succ 变量，专门用于重绘。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22drawEndCircles: function(color){ \/\/ end 时重绘已经 touch 的圆\n  for(var i = 0; i \x3c this.touchCircles.length; i\x2b\x2b){\n    this.drawCircle(this.touchCircles[i].x, this.touchCircles[i].y, color);\n  }\n},\n\n\/\/ 调用\nif(succ){\n  this.drawEndCircles(\x27#2CFF26\x27); \/\/ 绿色\n}else{\n  this.drawEndCircles(\x27red\x27); \/\/ 红色\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edrawEndCircles: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecolor\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ end 时重绘已经 touch 的圆\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length; i\x2b\x2b){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawCircle(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].x, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[i].y, color);\n  }\n},\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(succ){\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawEndCircles(\x3cspan class=\x22hljs-string\x22\x3e\x27#2CFF26\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 绿色\x3c\/span\x3e\n}\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawEndCircles(\x3cspan class=\x22hljs-string\x22\x3e\x27red\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 红色\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么，一个可以演示的版本就生成了，尽管还存在一些 bug，随后会来解决。（详情分支 password）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e一些 bugs\x3c\/h2\x3e\n\x3cp\x3e有些 bugs 在做的时候就发现了，一些 bug 后来用手机测试的时候才发现，比如，我用 chrome 的时候，没有察觉这个 bug，当我用 android 手机 chrome 浏览器测试的时候，发现当我 touchmove 向下的时候，会触发浏览器的下拉刷新，解决办法：加了一个 \x3ccode\x3epreventDefault\x3c\/code\x3e，没想到居然成功了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.canvas.addEventListener(\x27touchmove\x27, function(e){\n  e.preventDefault ? e.preventDefault() : null;\n  var p = self.getTouchPos(e);\n  if(self.touchFlag){\n    self.update(p);\n  }else{\n    self.judgePos(p);\n  }\n}, false)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.canvas.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27touchmove\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n  e.preventDefault ? e.preventDefault() : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = self.getTouchPos(e);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(self.touchFlag){\n    self.update(p);\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    self.judgePos(p);\n  }\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e关于 showInfo\x3c\/h3\x3e\n\x3cp\x3e由于showInfo 中有 setTimeout 函数，可以看到函数里的演出为 1s，导致如果我们操作的速度比较快，在 1s 内连续 show 了很多个 info，后面的 info 会被第一个 info 的 setTimeout 弄乱，显示的时间小于 1s，或更短。比如，当重复点击设置手势密码和验证手势密码，会产生这个 bug。\x3c\/p\x3e\n\x3cp\x3e解决办法有两个，一个是增加一个专门用于显示的数组，每次从数组中取值然后显示。另一种解题思路和防抖动的思路很像，就是当有一个新的 show 到来时，把之前的那个 setTimeout 清除掉。\x3c\/p\x3e\n\x3cp\x3e这里采用第二种思路：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22showInfo: function(message, timer){ \/\/ 专门用来显示 info\n  clearTimeout(this.showInfo.timer);\n  var info = this.dom.info;\n  info.innerHTML = message;\n  info.style.display = \x27block\x27;\n  this.showInfo.timer = setTimeout(function(){\n    info.style.display = \x27\x27;\n  }, timer || 1000)\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eshowInfo: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, timer\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 专门用来显示 info\x3c\/span\x3e\n  clearTimeout(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo.timer);\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e info = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dom.info;\n  info.innerHTML = message;\n  info.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.showInfo.timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    info.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n  }, timer || \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e解决小尾巴\x3c\/h3\x3e\n\x3cp\x3e所谓的小尾巴，如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p5.jpeg\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p5.jpeg\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e解决办法也很简单，在 touchend 的时候，先进行 \x3ccode\x3eclearRect\x3c\/code\x3e 就 ok 了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3e关于优化\x3c\/h2\x3e\n\x3cp\x3e性能优化一直都是一个大问题，不要以为前端不需要考虑内存，就可以随便写代码。\x3c\/p\x3e\n\x3cp\x3e之前在设计自己网页的时候，用到了滚动，鼠标滑轮轻轻一碰，滚动函数就执行了几十多则几百次，之前也考虑过解决办法。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e优化 canvas 部分\x3c\/h3\x3e\n\x3cp\x3e对于 touchmove 函数，原理都是一样的，手指一划，就执行了 n 多次，这个问题后面在解决，先来看另一个问题。\x3c\/p\x3e\n\x3cp\x3etouchmove 是一个高频函数，看到这里，如果你并没有仔细看我的代码，那你对我采用的 canvas 画图方式可能不太了解，下面这个是 touchmove 函数干了哪些事：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e先判断，如果当前处于未选中一个密码状态，则继续监视当前的位置，直到选中第一个密码，进入第二步；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e进入 update 函数，update 函数主要干四件事，重绘圆（密码）、判断当前位置、重绘点、重绘线；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e第二步是一个很揪心的动作，为什么每次都要重绘圆，点和线呢？\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p1.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p1.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上面这个图可以很好的说明问题，因为在设置或验证密码的过程中，我们需要用一条线来连接触点到当前的最后一个密码，并且当 touchmove 的时候，能看到它们在变化。这个功能很棒，可以勾勒出 touchmove 的轨迹。\x3c\/p\x3e\n\x3cp\x3e但是，这就必须要时刻刷新 canvas，性能大大地降低，\x3cstrong\x3e刷新的那可是整个 canvas。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e因为 canvas 只有一个，既要画背景圆（密码），又要画已选密码的点，和折线。这其中好多步骤，自始至终只需要一次就好了，比如背景圆，只需在启动的时候画一次，已选密码，只要当 touchCircles 新加元素的时候才会用一次，还不用重绘，只要画就可以了。折线分成两部分，一部分是已选密码之间的连线，还有就是最后一个密码点到当前触点之间的连线。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e如果有两个 canvas 就好了，一个存储静态的，一个专门用于重绘\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e为什么不可以有呢！\x3c\/p\x3e\n\x3cp\x3e我的解决思路是，现在有两个 canvas，一个在底层，作为描绘静态的圆、点和折线，另一个在上层，一方面监听 touchmove 事件，另一方面不停地重绘最后一个密码点的圆心到当前触点之间的线。如果这样可以的话，touchmove 函数执行一次的效率大大提高。\x3c\/p\x3e\n\x3cp\x3e插入第二个 canvas：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var canvas2 = canvas.cloneNode(canvas, true);\ncanvas2.style.position = \x27absolute\x27;\/\/让上层 canvas 覆盖底层 canvas\ncanvas2.style.top = \x270\x27;\ncanvas2.style.left = \x270\x27;\nthis.el.appendChild(canvas2);\nthis.ctx2 = canvas2.getContext(\x272d\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas2 = canvas.cloneNode(canvas, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\ncanvas2.style.position = \x3cspan class=\x22hljs-string\x22\x3e\x27absolute\x27\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/让上层 canvas 覆盖底层 canvas\x3c\/span\x3e\ncanvas2.style.top = \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e;\ncanvas2.style.left = \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.appendChild(canvas2);\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2 = canvas2.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e要改换对第二个 ctx2 进行 touch 监听，并设置一个 \x3ccode\x3ethis.reDraw\x3c\/code\x3e 参数，表示有新的密码添加进来，需要对点和折线添加新内容， update 函数要改成这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22update: function(p){ \/\/ 更新 touchmove\n  this.judgePos(p); \/\/ 每次都要判断\n  this.drawLine2TouchPos(p); \/\/ 新加函数，用于绘最后一个密码点点圆心到触点之间的线\n  if(this.reDraw){ \/\/ 有新的密码加进来\n    this.reDraw = false;\n    this.drawPoints(); \/\/ 添加新点\n    this.drawLine();\/\/ 添加新线\n  }\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eupdate: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新 touchmove\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.judgePos(p); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每次都要判断\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawLine2TouchPos(p); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新加函数，用于绘最后一个密码点点圆心到触点之间的线\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.reDraw){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 有新的密码加进来\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.reDraw = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawPoints(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加新点\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.drawLine();\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加新线\x3c\/span\x3e\n  }\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22drawLine2TouchPos: function(p){\n  var len = this.touchCircles.length;\n  if(len \x3e= 1){\n    this.ctx2.clearRect(0, 0, this.width, this.width); \/\/ 先清空\n    this.ctx2.beginPath();\n    this.ctx2.lineWidth = 3;\n    this.ctx2.moveTo(this.touchCircles[len - 1].x, this.touchCircles[len - 1].y);\n    this.ctx2.lineTo(p.x, p.y);\n    this.ctx2.stroke();\n    this.ctx2.closePath();\n  }\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edrawLine2TouchPos: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e len = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles.length;\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(len \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.clearRect(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先清空\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.beginPath();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.moveTo(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[len - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].x, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchCircles[len - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].y);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.lineTo(p.x, p.y);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.stroke();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ctx2.closePath();\n  }\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e相应的 drawPoints 和 drawLine 函数也要对应修改，由原理画所有的，到现在只需要画新加的。\x3c\/p\x3e\n\x3cp\x3e效果怎么样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p2.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p2.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3emove 函数执行多次，而其他函数只有当新密码加进来的时候才执行一次。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3e加入节流函数\x3c\/h3\x3e\n\x3cp\x3e之前也已经说过了，这个 touchmove 函数执行的次数比较多，尽管我们已经用两个 canvas 对重绘做了很大的优化，但 touchmove 还是有点大开销。\x3c\/p\x3e\n\x3cp\x3e这个时候我想到了防抖动和节流，首先防抖动肯定是不行的，万一我一直处于 touch 状态，重绘会延迟死的，这个时候节流会好一些。\x3ca href=\x22http:\/\/www.codeceo.com\/article\/web-high-performance-scroll.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e防抖和节流\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e先写一个节流函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22throttle: function(func, delay, mustRun){\n  var timer, startTime = new Date(), self = this;\n  return function(){\n    var curTime = new Date(), args = arguments;\n    clearTimeout(timer);\n    if(curTime - startTime \x3e= mustRun){\n      startTime = curTime;\n      func.apply(self, args);\n    }else{\n      timer = setTimeout(function(){\n        func.apply(self, args);\n      }, delay)\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ethrottle: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efunc, delay, mustRun\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timer, startTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(), self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e curTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(), args = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e;\n    clearTimeout(timer);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(curTime - startTime \x26gt;= mustRun){\n      startTime = curTime;\n      func.apply(self, args);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        func.apply(self, args);\n      }, delay)\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e节流函数的意思：在延迟为 delay 的时间内，如果函数再次触发，则重新计时，这个功能和防抖动是一样的，第三个参数 mustRun 是一个时间间隔，表示在时间间隔大于 mustRun 后的一个函数可以立即直接执行。\x3c\/p\x3e\n\x3cp\x3e然后对 touchmove 的回调函数进行改造：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var t = this.throttle(function(e){\n  e.preventDefault ? e.preventDefault() : null;\n  e.stopPropagation ? e.stopPropagation() : null;\n  var p = this.getTouchPos(e);\n  if(this.touchFlag){\n    this.update(p);\n  }else{\n    this.judgePos(p);\n  }\n}, 16, 16)\nthis.canvas2.addEventListener(\x27touchmove\x27, t, false)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e t = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.throttle(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n  e.preventDefault ? e.preventDefault() : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  e.stopPropagation ? e.stopPropagation() : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getTouchPos(e);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchFlag){\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.update(p);\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.judgePos(p);\n  }\n}, \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.canvas2.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27touchmove\x27\x3c\/span\x3e, t, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于 delay 和 mustRun 的时间间隔问题，web 性能里有一个 16ms 的概念，就是说如果要达到每秒 60 帧，间隔为 1000\/60 大约为 16 ms。如果间隔大于 16ms 则 fps 会比 60 低。\x3c\/p\x3e\n\x3cp\x3e鉴于此，我们这里将 delay 和 mustRun 都设为 16，在极端的情况下，也就是最坏的情况下，或许需要 15 \x2b 15 = 30ms 才会执行一次，这个时候要设置两个 8 才合理，不过考虑到手指活动是一个连续的过程，怎么可能会每 15 秒执行一次，经过在线测试，发现设置成 16 效果还不错。\x3c\/p\x3e\n\x3cp\x3e性能真的能优化吗，我们来看两个图片，do 和 wantdo 表示真实执行和放到节流函数中排队准备执行。\x3c\/p\x3e\n\x3cp\x3e当 touchmove 速度一般或很快的时候：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p3.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p3.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当 touchmove 速度很慢的时候：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/omuedc5n9.bkt.clouddn.com\/p4.png\x22 src=\x22https:\/\/static.alili.techhttp:\/\/omuedc5n9.bkt.clouddn.com\/p4.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看出来，滑动过程中，速度一般和快速，平均优化了一半，慢速效果也优化了 20 到 30% 之间，平时手势锁解锁时候，肯定速度很快。可见，节流的优化还是很明显的。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e关键是，优化之后的流程性，没有受到任何影响。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e这个节流函数最终还是出现了一个 bug：由于是延迟执行的，导致 \x3ccode\x3ee.preventDefault\x3c\/code\x3e 失效，在手机浏览器向下滑会出现刷新的情况，这也算事件延迟的一个危害吧。\x3c\/p\x3e\n\x3cp\x3e解决办法：在节流函数提前取消默认事件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22throttle: function(func, delay, mustRun){\n  var timer, startTime = new Date(), self = this;\n  return function(e){\n    if(e){\n      e.preventDefault ? e.preventDefault() : null; \/\/提前取消默认事件，不要等到 setTimeout\n      e.stopPropagation ? e.stopPropagation() : null;\n    }\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ethrottle: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efunc, delay, mustRun\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timer, startTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(), self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(e){\n      e.preventDefault ? e.preventDefault() : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/提前取消默认事件，不要等到 setTimeout\x3c\/span\x3e\n      e.stopPropagation ? e.stopPropagation() : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    }\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e大概花了三天左右的时间，将这个 H5 的手势解锁给完成，自己还是比较满意的，虽然可能达不到评委老师的认可，不过自己在做的过程中，学习到了很多新知识。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3e参考\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/lvming6816077\/H5lock\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eH5lock\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Canvas_API\/Tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCanvas教程\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/wangkongming\/archive\/2013\/08\/30\/3291081.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejs获取单选框里面的值\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/www.codeceo.com\/article\/web-high-performance-scroll.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端高性能滚动 scroll 及页面渲染优化\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e欢迎来\x3ca href=\x22http:\/\/yuren.space\/blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e我的博客\x3c\/a\x3e交流。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 canvas 实现 Web 手势解锁</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008923731">https://segmentfault.com/a/1190000008923731</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/iuqi9p06vbg/" target="_blank">https://alili.tech/archive/iuqi9p06vbg/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>