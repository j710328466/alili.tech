<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/pqcvzrawkwk/",
				"appid": "1613049289050283", 
				"title": "Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-06T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/05huib7ptdlp/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ffuzj2appxc/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&text=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&text=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&title=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&is_video=false&description=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&title=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&title=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&title=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpqcvzrawkwk%2f&title=Vue%e5%85%a8%e5%ae%b6%e6%a1%b6%2bSocket.io%2bExpress%2fKoa2%e6%89%93%e9%80%a0%e7%bd%91%e9%a1%b5%e7%89%88%e6%89%8b%e6%9c%baQQ"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ</h1><div class="meta"><div class="postdate"><time datetime="2019-01-06" itemprop="datePublished">2019-01-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e\x3cstrong\x3e介绍\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3eVue全家桶\x2bSocket.io\x2bExpress\/Koa2打造的网页版手机QQ(web app),高仿手机QQ7.1.0版本\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e\x3cstrong\x3e预览\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3e在线预览地址：\x3ca href=\x22https:\/\/qq.lenshen.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/qq.lenshen.com\x3c\/a\x3e （为了体验到最佳的效果，提供了3个测试账号，需要账号才能登陆哦，具体账号和密码下面有讲）\x3cbr\x3e现在项目已开源，源码：\x3ca href=\x22https:\/\/github.com\/lensh\/vue-qq\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/lensh\/vue-qq\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e目前已经实现了QQ的核心功能，如消息列表、好友列表、新朋友、好友申请、实时群聊、实时私聊、聊天设置、屏蔽对方聊天、特别关心、会员等级、个性名片、添加好友、删除好友、好友分组、查找用户、登录、注销、切换用户、右滑显示侧栏等等。后期会考虑增加更多功能。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e\x3cstrong\x3e技术栈\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3eVue2.0：实现前端页面构建\x3cbr\x3eVuex：实现不同组件间的状态共享\x3cbr\x3eVue-router：页面路由切换,实现单页的核心\x3cbr\x3evueg：页面复杂场景切换效果\x3cbr\x3eSocket.io：实现实时消息推送\x3cbr\x3eaxios：一个基于 Promise 的 HTTP 库，向后端发起请求\x3cbr\x3eExpress、Koa2：开发环境使用Express，生产环境使用Koa2\x3cbr\x3eES6、ES7、ES8：服务端和客户端均使用ES6语法，promise\/async\/await 处理异步\x3cbr\x3elocalStorage：本地保存用户信息\x3cbr\x3eWebpack：模块打包，前端项目构建工具首选\x3cbr\x3eSASS(SCSS)：CSS预处理语言\x3cbr\x3eFlex：flex弹性布局，简单适配手机、PC端\x3cbr\x3eCSS3：CSS3过渡动画及样式\x3cbr\x3eIScroll：模拟原生app的列表滚动效果(ListView)\x3cbr\x3eMySQL：MySQL关系型数据库持久化数据（考虑到表与表之间关系复杂，需要多表查询，最复杂的时候是六张表联查，用MySQL会比Mongodb好得多）\x3cbr\x3ejsonp：跨域请求数据\x3cbr\x3epm2：服务端使用pm2部署，常驻进程，比forever好用得多（\x3ca href=\x22https:\/\/github.com\/Unitech\/pm2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/Unitech\/pm2\x3c\/a\x3e）\x3cbr\x3enginx：nginx代理端口转发，三级域名配置\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e\x3cstrong\x3e使用方式\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3e先将根目录下的qq.sql导入到你的MySQL数据库里(可以使用Navicat)，用户名为root，登录密码为空。启动MySQL服务。然后使用cnpm install 安装所有依赖(最好用cnpm安装，因为项目依赖很多，npm用的是国外的镜像，在网络不稳定的情况下很有可能会导致安装失败，而且下载速度远远慢于国内的cnpm)，最后运行npm run dev。服务器部署运行项目只需要npm run pm2，这样就可以常驻进程，不过前提是得先全局安装pm2。\x3c\/p\x3e\n\x3cp\x3e尽量使用Chrome浏览器体验最佳效果。另外提供了三个测试账号，默认用户的密码都是6个1:\x3c\/p\x3e\n\x3cp\x3eqq:986992484 密码:111111\x3c\/p\x3e\n\x3cp\x3eqq:986992483 密码:111111\x3c\/p\x3e\n\x3cp\x3eqq:986992482 密码:111111\x3c\/p\x3e\n\x3cp\x3e如果你想体验实时聊天的酷炫效果，那么你可以打开两个浏览器，用上面不同的账号登录即可。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e\x3cstrong\x3e截图\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3e消息页面\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRSQM?w=530\x26amp;h=642\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRSQM?w=530\x26amp;h=642\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e联系人页面\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRSQV?w=497\x26amp;h=641\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRSQV?w=497\x26amp;h=641\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e群聊\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRSQ9?w=488\x26amp;h=641\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRSQ9?w=488\x26amp;h=641\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e私聊\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRSRe?w=489\x26amp;h=640\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRSRe?w=489\x26amp;h=640\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e\x3cstrong\x3e分析\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e1. 服务端使用ES6语法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e不需要使用babel转码以及一系列的配置，只需要将node升级到V8版本，V8已经很好地支持了ES6\/ES7\/ES8等最新特性，这是目前最好的办法。升级到V8版本，可以直接到nodejs中文网(\x3ca href=\x22http:\/\/nodejs.cn\/download\/)\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/nodejs.cn\/download\/)\x3c\/a\x3e 下载即可，也可以使用NVM切换node版本。\x3c\/p\x3e\n\x3cp\x3e升级到V8后，还不支持通过import\/export关键字来导入导出模块(因为服务端已经有了CommonJS规范，如果再使用import\/export的话就有点冲突了)，如果一定要使用import\/export关键字，这时可以在服务端的入口文件首行添加以下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x26quot;babel-core\/register\x26quot;)({\n    presets: [\x27es2015\x27, \x27stage-0\x27]\n})\nrequire(\x26quot;babel-polyfill\x26quot;)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3erequire\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22babel-core\/register\x22\x3c\/span\x3e)\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e({\n    presets: [\x3cspan class=\x22hljs-string\x22\x3e\x27es2015\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27stage-0\x27\x3c\/span\x3e]\n})\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3erequire\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22babel-polyfill\x22\x3c\/span\x3e)\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的代码不可以使用import来导入，必须使用require，同时需要通过npm安装babel-core、babel-preset-es2015、babel-preset-stage-0、babel-polyfill等依赖。这样就可以愉快地使用import\/export了。\x3c\/p\x3e\n\x3cp\x3e服务端代码片段如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ ES6 import\/export\nimport express from \x27express\x27\nimport loginRouter from \x27.\/router\/login\x27\nimport registerRouter from \x27.\/router\/register\x27\nimport friendRouter from \x27.\/router\/friend\x27\nimport messageRouter from \x27.\/router\/message\x27\nimport userRouter from \x27.\/router\/user\x27\n\nconst apiRouter = express.Router()\n\napiRouter\n    .use(\x27\/login\x27, loginRouter)\n    .use(\x27\/register\x27, registerRouter)\n    .use(\x27\/friend\x27, friendRouter)\n    .use(\x27\/message\x27, messageRouter)\n    .use(\x27\/user\x27, userRouter)\n\nexport default apiRouter\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e ES6 \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e\/\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e express \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e loginRouter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\/login\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e registerRouter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\/register\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e friendRouter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\/friend\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e messageRouter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\/message\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e userRouter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\/user\x27\x3c\/span\x3e\n\nconst apiRouter = express.Router()\n\napiRouter\n    .use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, loginRouter)\n    .use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/register\x27\x3c\/span\x3e, registerRouter)\n    .use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/friend\x27\x3c\/span\x3e, friendRouter)\n    .use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/message\x27\x3c\/span\x3e, messageRouter)\n    .use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e, userRouter)\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e apiRouter\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ ES8 async\/await\nimport express from \x27express\x27\nimport login from \x27..\/..\/controller\/login\x27\n\nconst loginRouter = express.Router()\n\nloginRouter\n    .get(\x27\/:user\/:pwd\x27, async(req, res) =\x3e { \/\/ 登录\n        const result = await login.login(req, res)\n        res.json(result)\n    })\n\nexport default loginRouter\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ES8 async\/await\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e express from \x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e login from \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/controller\/login\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e loginRouter = express.Router()\n\nloginRouter\n    .\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/:user\/:pwd\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e(req, res) =\x26gt; { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e login.login(req, res)\n        res.json(result)\n    })\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e loginRouter\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e2.Socket.io\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e服务端(结合Express\/Koa):\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Server\nimport express from \x27express\x27\nimport http from \x27http\x27\nimport socketio from \x27socket.io\x27\n\nconst app = express()\nconst server = http.createServer(app)\nconst io = socketio(server)\nserver.listen(3000)\n\nio.on(\x27connection\x27, (socket)=\x3e{\n  socket.emit(\x27news\x27, { hello: \x27world\x27 })\n  socket.on(\x27my other event\x27, function (data) {\n     console.log(data)\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Server\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e express \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e http \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27http\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e socketio \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27socket.io\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = express()\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = http.createServer(app)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e io = socketio(server)\nserver.listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\n\nio.on(\x3cspan class=\x22hljs-string\x22\x3e\x27connection\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3esocket\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n  socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27news\x27\x3c\/span\x3e, { hello: \x3cspan class=\x22hljs-string\x22\x3e\x27world\x27\x3c\/span\x3e })\n  socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27my other event\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n     \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data)\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e客户端：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Client\n\n\x3cscript src=\x26quot;http:\/\/localhost:3000\/socket.io\/socket.io.js\x26quot;\x3e\x3c\/script\x3e\n\x3cscript\x3e\n  const socket = io.connect(\x27http:\/\/localhost:3000\x27)\n  socket.on(\x27news\x27, (data)=\x3e{\n    socket.emit(\x27my other event\x27, { my: \x27data\x27 })\n  })\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\/\/ Client\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/localhost:3000\/socket.io\/socket.io.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22actionscript\x22\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e socket = io.connect(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:3000\x27\x3c\/span\x3e)\n  socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27news\x27\x3c\/span\x3e, (data)=\x26gt;{\n    socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27my other event\x27\x3c\/span\x3e, { my: \x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e })\n  })\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3esocket.io最核心的两个api就是emit 和 on了 ，服务端和客户端都有这两个api。通过 emit 和 on可以实现服务器与客户端之间的双向通信。\x3c\/p\x3e\n\x3cp\x3eemit ：发射一个事件，第一个参数为事件名，第二个参数为要发送的数据，第三个参数为回调函数（如需对方接受到信息后立即得到确认时，则需要用到回调函数）。\x3c\/p\x3e\n\x3cp\x3eon ：监听一个 emit 发射的事件，第一个参数为要监听的事件名，第二个参数为回调函数，用来接收对方发来的数据，该函数的第一个参数为接收的数据。\x3c\/p\x3e\n\x3cp\x3e服务端常用API：\x3c\/p\x3e\n\x3cp\x3esocket.emit()：向建立该连接的客户端发送消息\x3c\/p\x3e\n\x3cp\x3esocket.on()：监听客户端发送信息\x3c\/p\x3e\n\x3cp\x3eio.to(socketid).emit()：向指定客户端发送消息\x3c\/p\x3e\n\x3cp\x3eio.sockets.socket(socketid).emit()：向指定客户端发送消息，新版本用io.sockets.socket[socketid].emit() ，数组访问\x3c\/p\x3e\n\x3cp\x3esocket.broadcast.emit()：向除去建立该连接的客户端的所有客户端广播\x3c\/p\x3e\n\x3cp\x3eio.sockets.emit()：向所有客户端广播\x3c\/p\x3e\n\x3cp\x3e客户端常用API：\x3c\/p\x3e\n\x3cp\x3esocket.emit()：向服务端发送消息\x3c\/p\x3e\n\x3cp\x3esocket.on()：监听服务端发来的信息\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e\x3cstrong\x3e最后\x3c\/strong\x3e\x3c\/h2\x3e\n\x3cp\x3e源码地址：\x3ca href=\x22https:\/\/github.com\/lensh\/vue-qq\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/lensh\/vue-qq\x3c\/a\x3e，如果觉得不错，就毫不吝啬地给个star吧。后期项目还会继续更新和完善。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Vue全家桶+Socket.io+Express/Koa2打造网页版手机QQ</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010451790">https://segmentfault.com/a/1190000010451790</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/pqcvzrawkwk/" target="_blank">https://alili.tech/archive/pqcvzrawkwk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/t42iv2yle7e/">2016-我的前端之路:工具化与工程化<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/xlhryjzdso/">2016年总结--成长<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/4wvjfeus9ur/">2016年末总结，我的前端之路<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/w7062tmcw3/">3D 视差效果<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5jt1iw1t77b/">AlloyTouch实战--60行代码搞定QQ看点资料卡<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/kquf0fxkw2j/">ES6，你不得不学！<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/r5b6g4133jh/">Emmet-前端开发神器<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5dbaikv4emi/">FreeCodeCamp中级算法题答案<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/iuyeljg6lm/">JSONP是什么<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/23ftsgrtzzc/">JS中的观察者模式(发布订阅)<aside class="dates">2019-01-29</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>