<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="preact源码学习（1）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>preact源码学习（1） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/hsvwrdkx2lb/",
				"appid": "1613049289050283", 
				"title": "preact源码学习（1） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-07T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/g5l3ptw8769/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/1jy6155nahh/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&text=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&text=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&title=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&is_video=false&description=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&title=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&title=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&title=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhsvwrdkx2lb%2f&title=preact%e6%ba%90%e7%a0%81%e5%ad%a6%e4%b9%a0%ef%bc%881%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">preact源码学习（1）</h1><div class="meta"><div class="postdate"><time datetime="2019-01-07" itemprop="datePublished">2019-01-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3epreact是目前最小的react兼容库了，因此学习它对提升anujs有很大的帮助。\x3c\/p\x3e\n\x3cp\x3epreact的一些模块非常简单。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/vnode.js\nexport function VNode() {}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/vnode.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVNode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一句话一个模块，其实这个在preact-compat 会被扩展原型。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/util.js\n\/\/糅杂，相当于es6的Object.assign\nexport function extend(obj, props) {\n    for (let i in props) obj[i] = props[i];\n    return obj;\n}\n\n\/\/用于异步执行一个函数，Promise比setTimeout的执行间隔太短\nexport const defer = typeof Promise==\x27function\x27 ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/util.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/糅杂，相当于es6的Object.assign\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eextend\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, props\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e props) obj[i] = props[i];\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于异步执行一个函数，Promise比setTimeout的执行间隔太短\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defer = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e==\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve().then.bind(\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve()) : setTimeout;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有关异步的内容可以看我的书《javascript框架设计》，这里有详细介绍。这其实也涉及到microtask, macrotask的概念，有兴趣的人可以搜索一下。\x3c\/p\x3e\n\x3cp\x3epreact的工具模块是我见过的库中最精简的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/options.js\n\nexport default {\n\n    \/\/ 用于同步刷新组件\n    \/\/syncComponentUpdates: true,\n\n    \/\/ 用于扩展VNode实例\n    \/\/vnode(vnode) { }\n\n    \/\/ 在组件插入DOM时调用，不同于componentDidMount，它是专门给框架或组件内部使用，比如说chrome debug tools这样的工具进行扩展\n    \/\/ afterMount(component) { }\n\n    \/\/ 同上，内置的后门\n    \/\/ afterUpdate(component) { }\n\n    \/\/ 同上，内置的后门\n    \/\/ beforeUnmount(component) { }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/options.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用于同步刷新组件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/syncComponentUpdates: true,\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用于扩展VNode实例\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/vnode(vnode) { }\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在组件插入DOM时调用，不同于componentDidMount，它是专门给框架或组件内部使用，比如说chrome debug tools这样的工具进行扩展\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ afterMount(component) { }\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同上，内置的后门\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ afterUpdate(component) { }\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同上，内置的后门\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ beforeUnmount(component) { }\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eoptions这个模块是用于扩展preact的功能，从而兼容官方react。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ constants.js\n\/\/ 各种渲染模式\n\nexport const NO_RENDER = 0; \/\/不渲染\nexport const SYNC_RENDER = 1;\/\/React.render就是同步\nexport const FORCE_RENDER = 2;\/\/forceUpdate\nexport const ASYNC_RENDER = 3;\/\/组件的更新是异步\n\n\nexport const ATTR_KEY = \x27__preactattr_\x27;\/\/在节点中添加的属性\n\n\/\/用于识别那些样式不用自动添加px的正则\nexport const IS_NON_DIMENSIONAL = \/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord\/i;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ constants.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 各种渲染模式\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e NO_RENDER = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/不渲染\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e SYNC_RENDER = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/React.render就是同步\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e FORCE_RENDER = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/forceUpdate\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ASYNC_RENDER = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/组件的更新是异步\x3c\/span\x3e\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ATTR_KEY = \x3cspan class=\x22hljs-string\x22\x3e\x27__preactattr_\x27\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/在节点中添加的属性\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于识别那些样式不用自动添加px的正则\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e IS_NON_DIMENSIONAL = \x3cspan class=\x22hljs-regexp\x22\x3e\/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord\/i\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面是h.js，其实就是React.createElement，这里做了一个不同于react的操作，就是立即将children扁平化，并且在扁平化过程成进行hydrate操作。hydrate是最早出现于inferno(另一个著名的react-like框架)，并相邻的简单数据类型合并成一个字符串。因为在react的虚拟DOM体系中，字符串相当于一个文本节点。减少children中的个数，就相当减少实际生成的文本节点的数量，也减少了以后diff的数量，能有效提高性能。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ h.js\nimport { VNode } from \x27.\/vnode\x27;\nimport options from \x27.\/options\x27;\n\n\nconst stack = [];\n\nconst EMPTY_CHILDREN = [];\n\/**\n* nodeName相当于react的type\n* attributes相当于react的props\n* 这是preact早期设计不周，这个标新立异导致它在兼容官方react要走许多弯路\n*\/\nexport function h(nodeName, attributes) {\n    let children=EMPTY_CHILDREN, lastSimple, child, simple, i;\n    for (i=arguments.length; i-- \x3e 2; ) {\n        stack.push(arguments[i]);\n    }\n    if (attributes \x26amp;\x26amp; attributes.children!=null) {\n        if (!stack.length) stack.push(attributes.children);\n        delete attributes.children;\n    }\n    while (stack.length) {\n        if ((child = stack.pop()) \x26amp;\x26amp; child.pop!==undefined) {\n            for (i=child.length; i--; ) stack.push(child[i]);\n        }\n        else {\n            \/\/减少比较类型\n            if (typeof child===\x27boolean\x27) child = null;\n\n            if ((simple = typeof nodeName!==\x27function\x27)) {\n                \/\/转化为字符串\n                if (child==null) child = \x27\x27;\n                \/\/合并相邻简单类型\n                else if (typeof child===\x27number\x27) child = String(child);\n                else if (typeof child!==\x27string\x27) simple = false;\n            }\n\n            if (simple \x26amp;\x26amp; lastSimple) {\n                children[children.length-1] \x2b= child;\n            }\n            else if (children===EMPTY_CHILDREN) {\n                children = [child];\n            }\n            else {\n                children.push(child);\n            }\n\n            lastSimple = simple;\n        }\n    }\n\n    let p = new VNode();\n    p.nodeName = nodeName;\n    p.children = children;\n    p.attributes = attributes==null ? undefined : attributes;\n    p.key = attributes==null ? undefined : attributes.key;\n    \/\/对最终生成的虚拟DOM进行扩展\n       if (options.vnode!==undefined) options.vnode(p);\n\n    return p;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ h.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { VNode } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/vnode\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e options \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/options\x27\x3c\/span\x3e;\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e stack = [];\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e EMPTY_CHILDREN = [];\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n* nodeName相当于react的type\n* attributes相当于react的props\n* 这是preact早期设计不周，这个标新立异导致它在兼容官方react要走许多弯路\n*\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eh\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enodeName, attributes\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e children=EMPTY_CHILDREN, lastSimple, child, simple, i;\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (i=\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length; i-- \x26gt; \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; ) {\n        stack.push(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e[i]);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (attributes \x26amp;\x26amp; attributes.children!=\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!stack.length) stack.push(attributes.children);\n        \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e attributes.children;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (stack.length) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((child = stack.pop()) \x26amp;\x26amp; child.pop!==\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (i=child.length; i--; ) stack.push(child[i]);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/减少比较类型\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e child===\x3cspan class=\x22hljs-string\x22\x3e\x27boolean\x27\x3c\/span\x3e) child = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((simple = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e nodeName!==\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e)) {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/转化为字符串\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (child==\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) child = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/合并相邻简单类型\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e child===\x3cspan class=\x22hljs-string\x22\x3e\x27number\x27\x3c\/span\x3e) child = \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e(child);\n                \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e child!==\x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e) simple = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n            }\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (simple \x26amp;\x26amp; lastSimple) {\n                children[children.length\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e] \x2b= child;\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (children===EMPTY_CHILDREN) {\n                children = [child];\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                children.push(child);\n            }\n\n            lastSimple = simple;\n        }\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e VNode();\n    p.nodeName = nodeName;\n    p.children = children;\n    p.attributes = attributes==\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e ? \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e : attributes;\n    p.key = attributes==\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e ? \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e : attributes.key;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/对最终生成的虚拟DOM进行扩展\x3c\/span\x3e\n       \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.vnode!==\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) options.vnode(p);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e p;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e属性\x3c\/th\x3e\n\x3cth\x3ereact\x3c\/th\x3e\n\x3cth\x3epreact\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e类别\x3c\/td\x3e\n\x3ctd\x3etype\x3c\/td\x3e\n\x3ctd\x3enodeName\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e属性包\x3c\/td\x3e\n\x3ctd\x3eprops\x3c\/td\x3e\n\x3ctd\x3eattributes\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e孩子\x3c\/td\x3e\n\x3ctd\x3eprops.children\x3c\/td\x3e\n\x3ctd\x3echildren\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e数组追踪用的trace by属性\x3c\/td\x3e\n\x3ctd\x3ekey\x3c\/td\x3e\n\x3ctd\x3ekey\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3ecloneElement与createElement是一对的，cloneElement是基于createElement实现\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { extend } from \x27.\/util\x27;\nimport { h } from \x27.\/h\x27;\n\nexport function cloneElement(vnode, props) {\n    return h(\n        vnode.nodeName,\n        extend(extend({}, vnode.attributes), props),\n        arguments.length\x3e2 ? [].slice.call(arguments, 2) : vnode.children\n    );\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { extend } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { h } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/h\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecloneElement\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evnode, props\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e h(\n        vnode.nodeName,\n        extend(extend({}, vnode.attributes), props),\n        \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length\x26gt;\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e ? [].slice.call(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) : vnode.children\n    );\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eReact.Component的实现\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { FORCE_RENDER } from \x27.\/constants\x27;\nimport { extend } from \x27.\/util\x27;\nimport { renderComponent } from \x27.\/vdom\/component\x27;\nimport { enqueueRender } from \x27.\/render-queue\x27;\n\n\/** Base Component class.\n *    Provides `setState()` and `forceUpdate()`, which trigger rendering.\n *    @public\n *\n *    @example\n *    class MyFoo extends Component {\n *        render(props, state) {\n *            return \x3cdiv \/\x3e;\n *        }\n *    }\n *\/\nexport function Component(props, context) {\n    \/\/只有在_dirty为true时才能更新组件\n    this._dirty = true;\n    this.context = context;\n    this.props = props;\n    this.state = this.state || {};\n}\n\n\nextend(Component.prototype, {\n\n    \/** \n     * 立即对state进行合并，而官方react是将state先放到一个数组中\n     *\/\n    setState(state, callback) {\n        let s = this.state;\n        if (!this.prevState) this.prevState = extend({}, s);\n        extend(s, typeof state===\x27function\x27 ? state(s, this.props) : state);\n        if (callback) (this._renderCallbacks = (this._renderCallbacks || [])).push(callback);\n        enqueueRender(this);\n    },\n\n\n    \/\/强制渲染，注意它与setState的实现是不一样的\n    forceUpdate(callback) {\n        if (callback) (this._renderCallbacks = (this._renderCallbacks || [])).push(callback);\n        renderComponent(this, FORCE_RENDER);\n    },\n\n\n    \/\/将方法要求返回虚拟DOM或null\n    render() {}\n\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { FORCE_RENDER } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/constants\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { extend } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { renderComponent } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/vdom\/component\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { enqueueRender } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/render-queue\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/** Base Component class.\n *    Provides `setState()` and `forceUpdate()`, which trigger rendering.\n *    @public\n *\n *    @example\n *    class MyFoo extends Component {\n *        render(props, state) {\n *            return \x26lt;div \/\x26gt;;\n *        }\n *    }\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops, context\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/只有在_dirty为true时才能更新组件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._dirty = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context = context;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props = props;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state || {};\n}\n\n\nextend(Component.prototype, {\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** \n     * 立即对state进行合并，而官方react是将state先放到一个数组中\n     *\/\x3c\/span\x3e\n    setState(state, callback) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e s = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.prevState) \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.prevState = extend({}, s);\n        extend(s, \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e state===\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? state(s, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props) : state);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (callback) (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._renderCallbacks = (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._renderCallbacks || [])).push(callback);\n        enqueueRender(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    },\n\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/强制渲染，注意它与setState的实现是不一样的\x3c\/span\x3e\n    forceUpdate(callback) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (callback) (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._renderCallbacks = (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._renderCallbacks || [])).push(callback);\n        renderComponent(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, FORCE_RENDER);\n    },\n\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将方法要求返回虚拟DOM或null\x3c\/span\x3e\n    render() {}\n\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eComponent依赖两个方法enqueueRender与renderComponent，一个是异步的，一个是同步的。enqueueRender则是基于renderComponent上构建的。\x3c\/p\x3e\n\x3cp\x3e我们看render-queue.js，这模块名与里面的方法名对应不一致，算是一个瑕疵。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import options from \x27.\/options\x27;\nimport { defer } from \x27.\/util\x27;\nimport { renderComponent } from \x27.\/vdom\/component\x27;\nlet items = [];\n\n\/\/用于延迟渲染当前组件（setState）\nexport function enqueueRender(component) {\n    if (!component._dirty \x26amp;\x26amp; (component._dirty = true) \x26amp;\x26amp; items.push(component)==1) {\n        (options.debounceRendering || defer)(rerender);\n    }\n}\nexport function rerender() {\n    let p, list = items;\n    items = [];\n    while ( (p = list.pop()) ) {\n        if (p._dirty) renderComponent(p);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e options \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/options\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { defer } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { renderComponent } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/vdom\/component\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = [];\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于延迟渲染当前组件（setState）\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eenqueueRender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomponent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!component._dirty \x26amp;\x26amp; (component._dirty = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) \x26amp;\x26amp; items.push(component)==\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        (options.debounceRendering || defer)(rerender);\n    }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ererender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e p, list = items;\n    items = [];\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e ( (p = list.pop()) ) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (p._dirty) renderComponent(p);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到这里，比较简单的模块已经介绍完了。render.js？这个模块其实放到vdom文件夹比较合适。读preact的源码，其实可以给我们带来许多启迪，原来组件的渲染是有许多种模式的。这是一个要点。如何每次setState都是同步更新，这性能肯定好差，而异步则要求怎么更新才是最适合。于是有了enqueueRender这样的函数。下一节，我们还会看到_disabled 这样的开差，用来调济更新的频率。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>preact源码学习（1）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010336457">https://segmentfault.com/a/1190000010336457</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/hsvwrdkx2lb/" target="_blank">https://alili.tech/archive/hsvwrdkx2lb/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>