<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="CORS入门讲解"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>CORS入门讲解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/2swlj7tipi4/",
				"appid": "1613049289050283", 
				"title": "CORS入门讲解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-20T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/gdsnlj82nos/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/17zeizkggnl/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&text=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&text=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&title=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&is_video=false&description=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&title=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&title=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&title=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2swlj7tipi4%2f&title=CORS%e5%85%a5%e9%97%a8%e8%ae%b2%e8%a7%a3"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">CORS入门讲解</h1><div class="meta"><div class="postdate"><time datetime="2019-01-20" itemprop="datePublished">2019-01-20</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e\x3cimg src=\x22http:\/\/50linesofco.de\/images\/avatar.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3ch1\x3e\x3ca href=\x22http:\/\/50linesofco.de\/\x22\x3e50 lines of code\x3c\/a\x3e\x3c\/h1\x3e\n\x3cp\x3eThe \/var\/log of \x3ca href=\x22http:\/\/geekonaut.de\x22\x3eMartin Splitt\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/50linesofco.de\/#one\x22\x3eAbout\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/50linesofco.de\/#top\x22\x3eThe greatest\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/50linesofco.de\/#latest\x22\x3eThe latest\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/50linesofco.de\/articles\x22\x3eAll articles\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/twitter.com\/g33konaut\x22\x3eTwitter\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/avgp\x22\x3eGithub\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/50linesofco.de\/rss.xml\x22\x3eRSS\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2\x3eCORS - 目录\x3c\/h2\x3e\n\x3ch1\x3eCORS - 目录\x3c\/h1\x3e\n\x3ch2\x3e总结\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e浏览器为了避免从别的不同源的网站获得资源，会强制执行\x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Same-origin_policy\x22\x3e同源策略\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e同源策略不会阻止不同源的请求，除了请求javascript\x3c\/li\x3e\n\x3cli\x3e带有\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Access_control_CORS\x22\x3eCORS\x3c\/a\x3e头的请求允许跨域请求\x3c\/li\x3e\n\x3cli\x3e带有证书跨域请求（CORS）的注意事项\x3c\/li\x3e\n\x3cli\x3eCORS是一个浏览器强制策略，其他不在浏览器上的应用不会受它影响\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2\x3e其他例子\x3c\/h2\x3e\n\x3cp\x3e这里我会展示一部分代码，更全的代码在这 \x3ca href=\x22https:\/\/github.com\/avgp\/cors-demo-app\x22\x3efull example is available on Github\x3c\/a\x3e.\x3c\/p\x3e\n\x3cp\x3e让我们开始吧，我们做了一个网站接口， 在\x3ccode\x3ehttp:\/\/good.com:8000\/public\x3c\/code\x3e上做了一个公共的API接口\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3eapp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/public\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n  res.send(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify({\n    \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27This is public\x27\x3c\/span\x3e\n  }));\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e同时我们有一个简单的登陆接口，用户需要输入密码并且设置cookie，从而认证用户身份\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs actionscript\x22\x3eapp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.body.password === \x3cspan class=\x22hljs-string\x22\x3e\x27secret\x27\x3c\/span\x3e) {\n    req.session.loggedIn = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    res.send(\x3cspan class=\x22hljs-string\x22\x3e\x27You are now logged in!\x27\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    res.send(\x3cspan class=\x22hljs-string\x22\x3e\x27Wrong password.\x27\x3c\/span\x3e)\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我们设置了一些私有数据仅仅为我们的用户服务\nWe use this to protect some private data we made available to our users at \x3ccode\x3e\/private\x3c\/code\x3e.\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3eapp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/private\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.session.loggedIn === \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    res.send(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify({\n      \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THIS IS PRIVATE\x27\x3c\/span\x3e\n    }))\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    res.send(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify({\n      \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Please login first\x27\x3c\/span\x3e\n    }))\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch2\x3e在其他域通过AJAX访问我们的API\x3c\/h2\x3e\n\x3cp\x3e现在我们的API设计的并不是很精妙，但是我们可以从\/public这个URL请求到一些数据。\n我们的服务端在\x3ccode\x3egood.com:300\/public\x3c\/code\x3e上，客户端在 \x3ccode\x3ethirdparty.com\x3c\/code\x3e这个上，客户端请求可能是这样的：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs coffeescript\x22\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/good.com:3000\/public\x27\x3c\/span\x3e)\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(response =\x26gt; response.text())\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(result)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.textContent = result\n  })\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是这段代码不能工作！\x3c\/p\x3e\n\x3cp\x3e让我们看一下在\x3ccode\x3ehttp:\/\/thirdparty.com\x3c\/code\x3e（客户端）上的network 标签\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/50linesofco.de\/images\/post-images\/cors\/network-before-cors.png\x22 alt=\x22The network request was successful\x22\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到请求失败了，原因在如下的打印中可以找到：  \x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/50linesofco.de\/images\/post-images\/cors\/js-errors-without-cors.png\x22 alt=\x22The console shows that a missing CORS header causes the problem\x22\x3e\x3c\/p\x3e\n\x3cp\x3e奥！我们没有带\x3ccode\x3eAccess-Control-Allow-Origin\x3c\/code\x3e请求头，但是我们为什么需要它并且它有什么好处呢？\x3c\/p\x3e\n\x3ch2\x3e同源策略\x3c\/h2\x3e\n\x3cp\x3e我们不能得到数据的原因是因为 _同源策略 _，这个策略目的在于确保网站不会得到其他网站的数据，并且在浏览器上强制执行\x3c\/p\x3e\n\x3cp\x3e例如：如果你正在浏览\x3ccode\x3eexample.org\x3c\/code\x3e 这个网站，你不会希望这个网站去请求你的银行所在的站点并且得到你的账户信息\x3c\/p\x3e\n\x3cp\x3e同源策略正是为了阻止这样的事情发生\x3c\/p\x3e\n\x3cp\x3e这里的‘同源’由三部分组成：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e同协议（例如：\x3ccode\x3ehttp\x3c\/code\x3e）\x3c\/li\x3e\n\x3cli\x3e同域名（例如：\x3ccode\x3eexam\x3c\/code\x3e）\x3c\/li\x3e\n\x3cli\x3e通端口（例如：\x3ccode\x3e8000\x3c\/code\x3e）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e所以 \x3ccode\x3ehttp:\/\/example.org\x3c\/code\x3e ， \x3ccode\x3ehttp:\/\/www.example.org\x3c\/code\x3e ， \x3ccode\x3ehttps:\/\/example.org\x3c\/code\x3e 是三个不同源的站点\x3c\/p\x3e\n\x3ch2\x3e小心CSRF攻击\x3c\/h2\x3e\n\x3cp\x3e注意有一种叫做\x3cem\x3e跨站请求伪造\x3c\/em\x3e（下文称CSRF）的攻击，并不会受同源策略限制\n在CSRF攻击中，攻击者通过在网站中制造一个请求，例如向你的银行发送一个请求，如果此时你在你的银行里的session仍可用，那么任何网站都可以悄悄制造一个攻击，除非你的银行采取针对CSRF攻击的保护措施\x3c\/p\x3e\n\x3cp\x3e注意尽管受到同源政策的影响，我们在例子中从\x3ccode\x3ethirdparty.com\x3c\/code\x3e向\x3ccode\x3egood.com\x3c\/code\x3e发起的请求还是被执行了，对于CSRF攻击来说并不需要获得响应...\x3c\/p\x3e\n\x3cp\x3e例如，一个通过发起POST请求就可以发送email的接口，攻击者并不在乎我们是否给它一个正确的数据，他们在乎的是邮件是否会发送而不是API是否会返回一个正确的回应。\x3c\/p\x3e\n\x3ch2\x3e改造公共API用于跨域请求（CORS）\x3c\/h2\x3e\n\x3cp\x3e现在我们确实想让第三方网站去访问我们的公共API（例如\x3ccode\x3ethirdparty.com\x3c\/code\x3e），我们按报错提示去添加CORS响应头\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3eapp.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/public\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(...)\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这里我们设置了\x3ccode\x3eAccess-Control-Allow-Origin\x3c\/code\x3e头为\x3ccode\x3e*\x3c\/code\x3e，意味着所有的域都可以访问这个URL资源并且浏览器的回复如下：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/50linesofco.de\/images\/post-images\/cors\/basic-cors.png\x22 alt=\x22The response is available once we set the CORS header\x22\x3e\x3c\/p\x3e\n\x3ch2\x3e非简单请求和预请求\x3c\/h2\x3e\n\x3cp\x3e之前的例子我们称之为\x3cem\x3e简单请求\x3c\/em\x3e，简单请求是\x3ccode\x3eGET\x3c\/code\x3e或者\x3ccode\x3ePOST\x3c\/code\x3e并且只允许一部分请求头和值\x3c\/p\x3e\n\x3cp\x3e现在\x3ccode\x3ethirdparty.com\x3c\/code\x3e改变了接受内容为JSON格式\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs coffeescript\x22\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/good.com:3000\/public\x27\x3c\/span\x3e, {\n  headers: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e\n  }\n})\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(response =\x26gt; response.json())\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(result)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.textContent = result.message\n  })\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是这使我们的请求再次失效，network面板给出了解释：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/50linesofco.de\/images\/post-images\/cors\/cors-preflight.png\x22 alt=\x22The request has been preflighted with an OPTIONS request\x22\x3e\x3c\/p\x3e\n\x3cp\x3e任何不使用\x3ccode\x3eGET\x3c\/code\x3e或者\x3ccode\x3ePOST\x3c\/code\x3e方法或者请求头Content-type包括如下\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3etext\/plain\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eapplication\/x-www-form-urlencoded\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3emultipart\/form-data\x3c\/code\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这些都不是\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Access_control_CORS#Simple_requests\x22\x3e简单请求\x3c\/a\x3e  ，我们称之为\x3cem\x3e预请求\x3c\/em\x3e.\x3c\/p\x3e\n\x3cp\x3e预请求这个机制意味着服务器能决定是否给我们服务，服务器设置 \x3ccode\x3eAccess-Control-Request-Headers\x3c\/code\x3e和\x3ccode\x3eAccess-Control-Request-Method\x3c\/code\x3e两个请求头告诉服务器请求内容，服务器会给我们相应的响应头\x3c\/p\x3e\n\x3cp\x3e现在我们的服务器还不支持预请求，我们需要增加如下：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3eapp.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/public\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Methods\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27GET, OPTIONS\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Headers\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(JSON.stringify({\n    message: \x3cspan class=\x22hljs-string\x22\x3e\x27This is public info\x27\x3c\/span\x3e\n  }))\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在 \x3ccode\x3ethirdparty.com\x3c\/code\x3e又可以得到响应了\x3c\/p\x3e\n\x3ch2\x3e证书和CORS\x3c\/h2\x3e\n\x3cp\x3e现在让我们设置让good.com上的\/private敏感资源可以被访问\x3c\/p\x3e\n\x3cp\x3e设置了这么多CORS选项，其他网站例如\x3ccode\x3eevil.com\x3c\/code\x3e能得到这个敏感资源么\x3c\/p\x3e\n\x3cp\x3e例如：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efetch\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/good.com:3000\/private\x27\x3c\/span\x3e)\x3c\/span\x3e\x3c\/span\x3e\n  .then(response =\x26gt; response.text())\n  .then((result) =\x26gt; {\n    let output = document.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e)\n    output\x3cspan class=\x22hljs-selector-class\x22\x3e.textContent\x3c\/span\x3e = result\n    document\x3cspan class=\x22hljs-selector-class\x22\x3e.body\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.appendChild\x3c\/span\x3e(output)\n  })\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e显然无论我们是否登陆good.com，我们都会看到 \x22Please login first\x22\x3c\/p\x3e\n\x3cp\x3e原因是在good.com上的cookie不会被其他不同源的页面发送。例如evil.com。我们可以告诉客户端发送cookie，即使它是跨域的。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs coffeescript\x22\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/good.com:3000\/private\x27\x3c\/span\x3e, {\n  credentials: \x3cspan class=\x22hljs-string\x22\x3e\x27include\x27\x3c\/span\x3e\n})\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(response =\x26gt; response.text())\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(result)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    let output = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e)\n    output.textContent = result\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(output)\n  })\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是它仍然不工作\x3c\/p\x3e\n\x3cp\x3e想象任何站点都可以制造这样一个带有认证的请求，但是并不会发送正确的cookie，并且得到的响应也不会是正确的\x3c\/p\x3e\n\x3cp\x3e所以，我们不想让evil.com去得到我们的敏感信息,但是如果我们想让thirdparty.com得到\n\x3ccode\x3e\/private\x3c\/code\x3e这个敏感信息呢？我们需要设置请求头\x3ccode\x3eAccess-Control-Allow-Credentials\x3c\/code\x3e为\x3ccode\x3etrue\x3c\/code\x3e\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3eapp.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/private\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Credentials\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27true\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.session.loggedIn === true) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27THIS IS THE SECRET\x27\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27Please login first\x27\x3c\/span\x3e)\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e仍不工作。让所有的认证的请求都可以跨域是非常危险的行为\x3c\/p\x3e\n\x3cp\x3e客户端不会让人们这么容易犯错\x3c\/p\x3e\n\x3cp\x3e当我们想让thirdparty.com得到 \x3ccode\x3e\/private\x3c\/code\x3e的内容时我们可以在响应头中这样声明：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3eapp.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/private\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/thirdparty.com:8000\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Credentials\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27true\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.session.loggedIn === true) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27THIS IS THE SECRET\x27\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27Please login first\x27\x3c\/span\x3e)\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在\x3ccode\x3ehttp:\/\/thirdparty:8000\x3c\/code\x3e有权利去得到敏感数据了，而evil.com是被禁止的\x3c\/p\x3e\n\x3ch2\x3e白名单\x3c\/h2\x3e\n\x3cp\x3e现在我们允许了一个源的请求可以跨域，但是如果我们需要设置多个呢？\nNow we have allowed one origin to do cross origin requests with authentication data. But what if we have multiple third parties?\n在这里，我们可能需要用到白名单\nIn this case, we probably want to use a whitelist:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3econst ALLOWED_ORIGINS = [\n  \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/anotherthirdparty.com:8000\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/thirdparty.com:8000\x27\x3c\/span\x3e\n]\n\napp.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/private\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(ALLOWED_ORIGINS.indexOf(req.headers.origin) \x26gt; -\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Credentials\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27true\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, req.headers.origin)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e { \/\/ allow other origins \x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3emake\x3c\/span\x3e unauthenticated CORS requests\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)        \n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.session.loggedIn === true) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27THIS IS THE SECRET\x27\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eres\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x27Please login first\x27\x3c\/span\x3e)\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3cstrong\x3e提醒: 不要直接设置`req.headers.origin为你的CORS值，这会让所有网站都可以跨域请求你的站点资源.\x3c\/strong\x3e 可能会有例外，但当设置所有站点都为CORS值的时候请慎重考虑\x3c\/p\x3e\n\x3ch2\x3e总结\x3c\/h2\x3e\n\x3cp\x3e在这篇文章中我们学习了 \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Same-origin_policy\x22\x3e同源策略\x3c\/a\x3e并且我们学会了使用\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Access_control_CORS\x22\x3eCORS\x3c\/a\x3e去应对跨域请求\x3c\/p\x3e\n\x3cp\x3e这需要客户端和服务端的支持，并且可能会需要预请求\x3c\/p\x3e\n\x3cp\x3e另外需要注意的是当处理认证的跨域请求时，设置一个白名单可以防止我们泄露隐私数据\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e© Geekonaut. All rights reserved.\x3c\/li\x3e\n\x3cli\x3eDesign: \x3ca href=\x22http:\/\/html5up.net\x22\x3eHTML5 UP\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>CORS入门讲解</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/a-href-50-lines-of-code-a">https://www.zcfy.cc/article/a-href-50-lines-of-code-a</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/2swlj7tipi4/" target="_blank">https://alili.tech/archive/2swlj7tipi4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>