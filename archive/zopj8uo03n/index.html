<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Dva &#43; Ant Design 前后端分离之 React 应用实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Dva &#43; Ant Design 前后端分离之 React 应用实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zopj8uo03n/",
				"appid": "1613049289050283", 
				"title": "Dva &#43; Ant Design 前后端分离之 React 应用实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-27T02:30:59"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/vsnaqjrizb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bbvjoewrh6t/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&text=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&text=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&title=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&is_video=false&description=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&title=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&title=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&title=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzopj8uo03n%2f&title=Dva%20%2b%20Ant%20Design%20%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e4%b9%8b%20React%20%e5%ba%94%e7%94%a8%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Dva &#43; Ant Design 前后端分离之 React 应用实践</h1><div class="meta"><div class="postdate"><time datetime="2019-01-27" itemprop="datePublished">2019-01-27</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e源站链接 \x3ca href=\x22https:\/\/tkvern.com\/20170204\/Dva%20\x2b%20Ant%20Design%20%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E4%B9%8B%20React%20%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/tkvern.com\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e继 \x3ca href=\x22https:\/\/ruby-china.org\/topics\/30594\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRails 从入门到完全放弃 拥抱 Elixir \x2b Phoenix \x2b React \x2b Redux\x3c\/a\x3e 这篇文章被喷之后，笔者很长一段时候没有上社区逛了。现在 \x3ca\x3etkvern\x3c\/a\x3e 又回归了，给大家带来React实践的一些经验，一些踩坑的经验。\x3c\/p\x3e\n\x3cp\x3eRails嘛，很好用，Laravel也好用。Phoenix也好用。都好，哪个方便用哪个。\x3c\/p\x3e\n\x3cp\x3e还有关于\x3cem\x3eTurbolinks\x3c\/em\x3e之争，不能单从页面渲染时间去对比，要综合考虑。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eWhy Dva？\x3c\/h2\x3e\n\x3cp\x3eDva是基于Redux做了一层封装，对于React的state管理，有很多方案，我选择了轻量、简单的Dva。至于Mobx，还没应用到项目中来。先等友军踩踩坑，再往里面跳。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/dvajs\/dva\/issues\/1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWhy dva and what\x27s dva\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/www.github.com\/sorrycc\/blog\/issues\/6\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e支付宝前端应用架构的发展和选择\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e顺便贴下Dva的特性：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e易学易用\x3c\/strong\x3e：仅有 5 个 api，对 redux 用户尤其友好\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eelm 概念\x3c\/strong\x3e：通过 \x3ccode\x3ereducers\x3c\/code\x3e, \x3ccode\x3eeffects\x3c\/code\x3e 和 \x3ccode\x3esubscriptions\x3c\/code\x3e 组织 model\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e支持 mobile 和 react-native\x3c\/strong\x3e：跨平台 (\x3ca href=\x22https:\/\/github.com\/sorrycc\/dva-example-react-native\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-native 例子\x3c\/a\x3e)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e支持 HMR\x3c\/strong\x3e：目前基于 \x3ca href=\x22https:\/\/github.com\/dvajs\/babel-plugin-dva-hmr\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebabel-plugin-dva-hmr\x3c\/a\x3e 支持 components 和 routes 的 HMR\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e动态加载 Model 和路由\x3c\/strong\x3e：按需加载加快访问速度 (\x3ca href=\x22https:\/\/github.com\/dvajs\/dva\/tree\/master\/examples\/dynamic-load\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e例子\x3c\/a\x3e)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e插件机制\x3c\/strong\x3e：比如 \x3ca href=\x22https:\/\/github.com\/dvajs\/dva-loading\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edva-loading\x3c\/a\x3e 可以自动处理 loading 状态，不用一遍遍地写 showLoading 和 hideLoading\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e完善的语法分析库 \x3ca href=\x22https:\/\/github.com\/dvajs\/dva-ast\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edva-ast\x3c\/a\x3e\x3c\/strong\x3e：\x3ca href=\x22https:\/\/github.com\/dvajs\/dva-cli\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edva-cli\x3c\/a\x3e 基于此实现了智能创建 model, router 等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e支持 TypeScript\x3c\/strong\x3e：通过 d.ts (\x3ca href=\x22https:\/\/github.com\/sorrycc\/dva-boilerplate-typescript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e例子\x3c\/a\x3e)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eWhy Ant Design?\x3c\/h2\x3e\n\x3cp\x3e做为传道士，这么好的UI设计语言，肯定不会藏着掖着啦。蚂蚁金服的东西，确实不错，除了Ant Design外，还有Ant Design Mobile、AntV、AntMotion、G2。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eWhy yarn?\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3enpm install\x3c\/code\x3e 太慢，试试\x3ca href=\x22https:\/\/yarnpkg.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eyarn\x3c\/a\x3e吧。建议用\x3ccode\x3enpm install yarn -g\x3c\/code\x3e进行安装。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e开发过程中的前后端分离\x3c\/h2\x3e\n\x3cp\x3e项目开始了，前端视图写完，要开始数据交互了，后端提供的API还没好。\x3c\/p\x3e\n\x3cp\x3e那么问题来了，如何在不依靠后端提供API的情况下，实现数据交互？\x3c\/p\x3e\n\x3cp\x3e使用\x3ca href=\x22http:\/\/mockjs.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMock.js\x3c\/a\x3e可以解决这个问题。先对接好API数据格式，然后使用Mockjs拦截Ajax请求，模拟后端真实数据。\x3c\/p\x3e\n\x3cp\x3e在Mockjs官方提供的API不够用的情况下，还可以使用正则产生模拟数据。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e如何对模拟做数据持久化处理？\x3c\/h3\x3e\n\x3cp\x3e这里给出一个模拟用户数据并持久化的实例实例：\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/mock\/users.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emock\/users.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e代码摘要:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27;\n\nconst qs = require(\x27qs\x27);\nconst mockjs = require(\x27mockjs\x27);\n\nconst Random = mockjs.Random;\n\n\/\/ 数据持久化\nlet tableListData = {};\n\nif (!global.tableListData) {\n  const data = mockjs.mock({\n    \x27data|100\x27: [{\n      \x27id|\x2b1\x27: 1,\n      \x27name\x27: () =\x3e {\n        return Random.cname();\n      },\n      \x27mobile\x27: \/1(3[0-9]|4[57]|5[0-35-9]|7[01678]|8[0-9])\\d{8}\/,\n      \x27avatar\x27: () =\x3e {\n        return Random.image(\x27125x125\x27);\n      },\n      \x27status|1-2\x27: 1,\n      \x27email\x27: () =\x3e {\n        return Random.email(\x27visiondk.com\x27);\n      },\n      \x27isadmin|0-1\x27: 1,\n      \x27created_at\x27: () =\x3e {\n        return Random.datetime(\x27yyyy-MM-dd HH:mm:ss\x27);\n      },\n      \x27updated_at\x27: () =\x3e {\n        return Random.datetime(\x27yyyy-MM-dd HH:mm:ss\x27);\n      },\n    }],\n    page: {\n      total: 100,\n      current: 1,\n    },\n  });\n  tableListData = data;\n  global.tableListData = tableListData;\n} else {\n  tableListData = global.tableListData;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e qs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27qs\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mockjs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27mockjs\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Random = mockjs.Random;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据持久化\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tableListData = {};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!global.tableListData) {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e data = mockjs.mock({\n    \x3cspan class=\x22hljs-string\x22\x3e\x27data|100\x27\x3c\/span\x3e: [{\n      \x3cspan class=\x22hljs-string\x22\x3e\x27id|\x2b1\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Random.cname();\n      },\n      \x3cspan class=\x22hljs-string\x22\x3e\x27mobile\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/1(3[0-9]|4[57]|5[0-35-9]|7[01678]|8[0-9])\\d{8}\/\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27avatar\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Random.image(\x3cspan class=\x22hljs-string\x22\x3e\x27125x125\x27\x3c\/span\x3e);\n      },\n      \x3cspan class=\x22hljs-string\x22\x3e\x27status|1-2\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Random.email(\x3cspan class=\x22hljs-string\x22\x3e\x27visiondk.com\x27\x3c\/span\x3e);\n      },\n      \x3cspan class=\x22hljs-string\x22\x3e\x27isadmin|0-1\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27created_at\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Random.datetime(\x3cspan class=\x22hljs-string\x22\x3e\x27yyyy-MM-dd HH:mm:ss\x27\x3c\/span\x3e);\n      },\n      \x3cspan class=\x22hljs-string\x22\x3e\x27updated_at\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Random.datetime(\x3cspan class=\x22hljs-string\x22\x3e\x27yyyy-MM-dd HH:mm:ss\x27\x3c\/span\x3e);\n      },\n    }],\n    \x3cspan class=\x22hljs-attr\x22\x3epage\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3etotal\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ecurrent\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    },\n  });\n  tableListData = data;\n  global.tableListData = tableListData;\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  tableListData = global.tableListData;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e模拟API怎么写？\x3c\/h3\x3e\n\x3cp\x3e完成持久化处理后，就可以像操作数据库一样进行增、删、改、查\x3c\/p\x3e\n\x3cp\x3e下面是一个删除用户的API\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/mock\/users.js#L106\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emock\/users.js#L106\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27DELETE \/api\/users\x27 (req, res) {\n    setTimeout(() =\x3e {\n      const deleteItem = qs.parse(req.body);\n\n      tableListData.data = tableListData.data.filter((item) =\x3e {\n        if (item.id === deleteItem.id) {\n          return false;\n        }\n\n        return true;\n      });\n\n      tableListData.page.total = tableListData.data.length;\n\n      global.tableListData = tableListData;\n\n      res.json({\n        success: true,\n        data: tableListData.data,\n        page: tableListData.page,\n      });\n    }, 200);\n  },\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x27DELETE \/api\/users\x27\x3c\/span\x3e (req, res) {\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e deleteItem = qs.parse(req.body);\n\n      tableListData.data = tableListData.data.filter(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (item.id === deleteItem.id) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      });\n\n      tableListData.page.total = tableListData.data.length;\n\n      global.tableListData = tableListData;\n\n      res.json({\n        \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: tableListData.data,\n        \x3cspan class=\x22hljs-attr\x22\x3epage\x3c\/span\x3e: tableListData.page,\n      });\n    }, \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e);\n  },\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e还有一步\x3c\/h3\x3e\n\x3cp\x3e模拟数据和API写好了，还需要拦截Ajax请求\x3c\/p\x3e\n\x3cp\x3e修改\x3ccode\x3epackage.json\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  .\n  .\n  .\n  \x26quot;scripts\x26quot;: {\n    \x26quot;start\x26quot;: \x26quot;dora --plugins \\\x26quot;proxy,webpack,webpack-hmr\\\x26quot;\x26quot;,\n    \x26quot;build\x26quot;: \x26quot;atool-build -o ..\/..\/..\/public\x26quot;,\n    \x26quot;test\x26quot;: \x26quot;atool-test-mocha .\/src\/**\/*-test.js\x26quot;\n  }\n  .\n  .\n  .\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e  .\n  .\n  .\n  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22dora --plugins \\\x22proxy,webpack,webpack-hmr\\\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22build\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22atool-build -o ..\/..\/..\/public\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22test\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22atool-test-mocha .\/src\/**\/*-test.js\x22\x3c\/span\x3e\n  }\n  .\n  .\n  .\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果与\x3ccode\x3edora\x3c\/code\x3e有端口冲突可修改\x3ccode\x3edora\x3c\/code\x3e的端口号\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;start\x26quot;: \x26quot;dora --port 8888 --plugins \\\x26quot;proxy,webpack,webpack-hmr\\\x26quot;\x26quot;,\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22dora --port 8888 --plugins \\\x22proxy,webpack,webpack-hmr\\\x22\x22\x3c\/span\x3e,\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完成这些基本工作就做好了\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e友情提示\x3c\/h3\x3e\n\x3cp\x3e在模拟数据环境，\x3ccode\x3eservices\x3c\/code\x3e下的模块这么写就好了，真实API则替换为真实API的地址。可将地址前缀写到统一配置中去。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import request from \x27..\/utils\/request\x27;\nimport qs from \x27qs\x27;\nexport async function query(params) {\n  return request(`\/api\/users?${qs.stringify(params)}`);\n}\n\nexport async function create(params) {\n  return request(\x27\/api\/users\x27, {\n    method: \x27post\x27,\n    body: qs.stringify(params),\n  });\n}\n\nexport async function remove(params) {\n  return request(\x27\/api\/users\x27, {\n    method: \x27delete\x27,\n    body: qs.stringify(params),\n  });\n}\n\nexport async function update(params) {\n  return request(\x27\/api\/users\x27, {\n    method: \x27put\x27,\n    body: qs.stringify(params),\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e request \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/request\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e qs \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27qs\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3equery\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparams\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(\x3cspan class=\x22hljs-string\x22\x3e`\/api\/users?\x3cspan class=\x22hljs-subst\x22\x3e${qs.stringify(params)}\x3c\/span\x3e`\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreate\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparams\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/users\x27\x3c\/span\x3e, {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: qs.stringify(params),\n  });\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eremove\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparams\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/users\x27\x3c\/span\x3e, {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27delete\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: qs.stringify(params),\n  });\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eupdate\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparams\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/users\x27\x3c\/span\x3e, {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27put\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: qs.stringify(params),\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e真实API参考实例: \x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/services\/users.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/services\/users.js\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e如何保持登录状态\x3c\/h2\x3e\n\x3cp\x3e在看dva的引导手册时，并没有介绍登录相关的内容。因为不同的项目，对于登录这块的实现会有所不同，并不是唯一的。通常我们会使用Cookie的方式保持登录状态，或者 Auth 2.0的技术。\x3c\/p\x3e\n\x3cp\x3e这里介绍Cookie的方式。\x3c\/p\x3e\n\x3cp\x3e登录成功之后服务器会设置一个当前域可以使用的Cookie，例如\x3ccode\x3etoken\x3c\/code\x3e啥的。然后在每次数据请求的时候在\x3ccode\x3eRequest Headers\x3c\/code\x3e中携带\x3ccode\x3etoken\x3c\/code\x3e，后端会基于这个\x3ccode\x3etoken\x3c\/code\x3e进行权限验证。思路清晰了，来看看具体实现吧。（注：在这次项目中使用了统一登录模块，通过Header中的\x3ccode\x3eAuthorization\x3c\/code\x3e进行验证，将只介绍拿到\x3ccode\x3etoken\x3c\/code\x3e之后的数据处理）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e准备工作\x3c\/h3\x3e\n\x3cp\x3e对于操作Cookie的一些操作，建议先封装到工具类模块下。同时我把操作\x3ccode\x3eLocalStrage\x3c\/code\x3e的一些操作也写进来了。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/helper.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/helper.js\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n.\n.\n\/\/ Operation Cookie\nexport function getCookie(name) {\n  const reg = new RegExp(\x27(^| )\x27 \x2b name \x2b \x27=([^;]*)(;|$)\x27);\n  const arr = document.cookie.match(reg);\n  if (arr) {\n    return decodeURIComponent(arr[2]);\n  } else {\n    return null;\n  }\n}\n\nexport function delCookie({ name, domain, path }) {\n  if (getCookie(name)) {\n    document.cookie = name \x2b \x27=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=\x27 \x2b \n                      path \x2b \x27; domain=\x27 \x2b \n                      domain;\n  }\n}\n.\n.\n.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e.\n.\n.\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Operation Cookie\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetCookie\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reg = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27(^| )\x27\x3c\/span\x3e \x2b name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27=([^;]*)(;|$)\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arr = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie.match(reg);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (arr) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(arr[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edelCookie\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ name, domain, path }\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (getCookie(name)) {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie = name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=\x27\x3c\/span\x3e \x2b \n                      path \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27; domain=\x27\x3c\/span\x3e \x2b \n                      domain;\n  }\n}\n.\n.\n.\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eHeader的预处理我放在了\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/auth.js#L5\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/auth.js#L5\x3c\/a\x3e，这里后端返回的数据都是JSON格式，所以在Header里面需要添加\x3ccode\x3eapplication\/json\x3c\/code\x3e进去，而\x3ccode\x3eAuthorization\x3c\/code\x3e是后端用来验证用户信息的。变量\x3ccode\x3esso_token\x3c\/code\x3e为了方便代码阅读就没有按照规范命名了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function getAuthHeader(sso_token) {\n  return ({\n    headers: {\n      \x27Accept\x27: \x27application\/json\x27,\n      \x27Authorization\x27: \x27Bearer \x27 \x2b sso_token,\n      \x27Content-Type\x27: \x27application\/json\x27,\n    },\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetAuthHeader\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esso_token\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ({\n    \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x27Accept\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27Authorization\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Bearer \x27\x3c\/span\x3e \x2b sso_token,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e,\n    },\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e修改Request\x3c\/h3\x3e\n\x3cp\x3e这里没有使用自带的catch机制来处理请求错误，在开发过程中，最开始打算使用统一错误处理，但是发现请求失败后，不能在\x3ccode\x3emodels\x3c\/code\x3e层处理\x3ccode\x3ecomponents\x3c\/code\x3e，所以就换了一种方式处理，后面会讲到。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/request.js#L29\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/request.js#L29\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function request(url, options) {\n  const sso_token = getCookie(\x27sso_token\x27);\n  const authHeader = getAuthHeader(sso_token);\n  return fetch(url, { ...options, ...authHeader })\n    .then(checkStatus)\n    .then(parseJSON)\n    .then((data) =\x3e ({ data }));\n    \/\/ .catch((err) =\x3e ({ err }));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, options\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e sso_token = getCookie(\x3cspan class=\x22hljs-string\x22\x3e\x27sso_token\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e authHeader = getAuthHeader(sso_token);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(url, { ...options, ...authHeader })\n    .then(checkStatus)\n    .then(parseJSON)\n    .then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e ({ data }));\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ .catch((err) =\x26gt; ({ err }));\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完成这些配置之后，每次向服务器发送的请求就都携带了用户\x3ccode\x3etoken\x3c\/code\x3e了。在\x3ccode\x3etoken\x3c\/code\x3e无效时，服务器会抛出\x3ccode\x3e401\x3c\/code\x3e错误，这时就需要在中间件中处理\x3ccode\x3e401\x3c\/code\x3e错误。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/request.js#L10\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/request.js#L10\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eredirectLogin\x3c\/code\x3e是工具类\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/auth\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/auth.js\x3c\/a\x3e中的重定向登录方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function checkStatus(response) {\n  if (response \x26amp;\x26amp; response.status === 401) {\n    redirectLogin();\n  }\n  if (response.status \x3e= 200 \x26amp;\x26amp; response.status \x3c 500) {\n    return response;\n  }\n  const error = new Error(response.statusText);\n  error.response = response;\n  throw error;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckStatus\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (response \x26amp;\x26amp; response.status === \x3cspan class=\x22hljs-number\x22\x3e401\x3c\/span\x3e) {\n    redirectLogin();\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (response.status \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e \x26amp;\x26amp; response.status \x26lt; \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e error = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(response.statusText);\n  error.response = response;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到此为止，登录状态的配置基本完成。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3eRouter\x3c\/h2\x3e\n\x3cp\x3e我们的应用中会有多个页面，而且有的需要登录才可见，那么如何控制呢？\x3c\/p\x3e\n\x3cp\x3eReact的路由控制是比较灵活的，来看看下面这个例子：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/router.jsx\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/router.jsx\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27;\nimport { Router, Route } from \x27dva\/router\x27;\nimport { authenticated } from \x27.\/utils\/auth\x27;\nimport Dashboard from \x27.\/routes\/Dashboard\x27;\nimport Users from \x27.\/routes\/Users\x27;\nimport User from \x27.\/routes\/User\x27;\nimport Password from \x27.\/routes\/Password\x27;\nimport Roles from \x27.\/routes\/Roles\x27;\nimport Permissions from \x27.\/routes\/Permissions\x27;\n\nexport default function ({ history }) {\n  return (\n    \x3cRouter history={history}\x3e\n      \x3cRoute path=\x26quot;\/\x26quot; component={Dashboard} onEnter={authenticated} \/\x3e\n      \x3cRoute path=\x26quot;\/user\x26quot; component={User} onEnter={authenticated} \/\x3e\n      \x3cRoute path=\x26quot;\/password\x26quot; component={Password} onEnter={authenticated} \/\x3e\n      \x3cRoute path=\x26quot;\/users\x26quot; component={Users} onEnter={authenticated} \/\x3e\n      \x3cRoute path=\x26quot;\/roles\x26quot; component={Roles} onEnter={authenticated} \/\x3e\n      \x3cRoute path=\x26quot;\/permissions\x26quot; component={Permissions} onEnter={authenticated} \/\x3e\n    \x3c\/Router\x3e\n  );\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Router, Route } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27dva\/router\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { authenticated } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/utils\/auth\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Dashboard \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/Dashboard\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Users \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/Users\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e User \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/User\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Password \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/Password\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Roles \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/Roles\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Permissions \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\/Permissions\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e{ history }\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x26lt;Router history={history}\x26gt;\n      \x26lt;Route path=\x22\/\x22 component={Dashboard} onEnter={authenticated} \/\x26gt;\n      \x26lt;Route path=\x22\/user\x22 component={User} onEnter={authenticated} \/\x26gt;\n      \x26lt;Route path=\x22\/password\x22 component={Password} onEnter={authenticated} \/\x26gt;\n      \x26lt;Route path=\x22\/users\x22 component={Users} onEnter={authenticated} \/\x26gt;\n      \x26lt;Route path=\x22\/roles\x22 component={Roles} onEnter={authenticated} \/\x26gt;\n      \x26lt;Route path=\x22\/permissions\x22 component={Permissions} onEnter={authenticated} \/\x26gt;\n    \x26lt;\/Router\x26gt;\n  );\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于路由的验证配置在\x3ccode\x3eonEnter\x3c\/code\x3e属性中，\x3ccode\x3eauthenticated\x3c\/code\x3e方法可统一进行路由验证，要注意每一个\x3ccode\x3eRoute\x3c\/code\x3e节点的验证都需要配置相应的\x3ccode\x3eonEnter\x3c\/code\x3e属性。如果权限较为复杂需对每一个\x3ccode\x3eRoute\x3c\/code\x3e单独验证。其实这种基于客户端渲染的应用，如果页面限制有遗漏也关系不太，后端提供的API会对数据进行验证，即使前端访问到没有权限的页面，也同样不用担心，做好客户端错误处理即可。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e数据缓存\x3c\/h2\x3e\n\x3cp\x3e对于一个React应用来说，缓存是很重要的一步。前后端分离后，频繁的Ajax请求会消耗大量的服务器资源，如果一些不长变动的持久化数据不做缓存的话，会浪费许多资源。所以，比较常见的方法就是将数据缓存在\x3ccode\x3eLocalStorage\x3c\/code\x3e中。针对一些敏感信息可适当进行加密混淆处理，我这里就不介绍了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e什么时候做数据缓存?\x3c\/h3\x3e\n\x3cp\x3e例：用户信息缓存\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/models\/auth.js#L64\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/models\/auth.js#L64\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3esubscriptions\x3c\/code\x3e中配置了\x3ccode\x3esetup\x3c\/code\x3e检测\x3ccode\x3eLocalStorage\x3c\/code\x3e中的\x3ccode\x3euser\x3c\/code\x3e是否存在。不存在时会去\x3ccode\x3equery\x3c\/code\x3e用户信息，然后保存到\x3ccode\x3euser\x3c\/code\x3e中，如果存在就将\x3ccode\x3euser\x3c\/code\x3e中的数据添加到\x3ccode\x3estate\x3c\/code\x3e的\x3ccode\x3euser: {}\x3c\/code\x3e中。当然在进行请求时，已经在\x3ccode\x3esrc\/utils\/auth.js\x3c\/code\x3e验证用户信息是否正确，同时做了相应的限制\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/utils\/auth.js#L20\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/utils\/auth.js#L20\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { parse } from \x27qs\x27;\nimport { message } from \x27antd\x27;\nimport { query, update, password } from \x27..\/services\/auth\x27;\nimport { getLocalStorage, setLocalStorage } from \x27..\/utils\/helper\x27;\n\nexport default {\n  namespace: \x27auth\x27,\n  state: {\n    user: {},\n    isLogined: false,\n    currentMenu: [],\n  },\n  reducers: {\n    querySuccess(state, action) {\n      return { ...state, ...action.payload, isLogined: true };\n    },\n  },\n  effects: {\n    *query({ payload }, { call, put }) {\n      const { data } = yield call(query, parse(payload));\n      if (data \x26amp;\x26amp; data.err_msg === \x27SUCCESS\x27) {\n        setLocalStorage(\x27user\x27, data.data);\n        yield put({\n          type: \x27querySuccess\x27,\n          payload: {\n            user: data.data,\n          },\n        });\n      }\n    },\n  }\n  subscriptions: {\n    setup({ dispatch }) {\n      const data = getLocalStorage(\x27user\x27);\n      if (!data) {\n        dispatch({\n          type: \x27query\x27,\n          payload: {},\n        });\n      } else {\n        dispatch({\n          type: \x27querySuccess\x27,\n          payload: {\n            user: data,\n          },\n        });\n      }\n    },\n  },\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { parse } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27qs\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { message } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27antd\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { query, update, password } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/services\/auth\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { getLocalStorage, setLocalStorage } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/helper\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attr\x22\x3enamespace\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27auth\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3estate\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-attr\x22\x3eisLogined\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecurrentMenu\x3c\/span\x3e: [],\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3ereducers\x3c\/span\x3e: {\n    querySuccess(state, action) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...state, ...action.payload, \x3cspan class=\x22hljs-attr\x22\x3eisLogined\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e };\n    },\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eeffects\x3c\/span\x3e: {\n    *query({ payload }, { call, put }) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(query, parse(payload));\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data \x26amp;\x26amp; data.err_msg === \x3cspan class=\x22hljs-string\x22\x3e\x27SUCCESS\x27\x3c\/span\x3e) {\n        setLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e, data.data);\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\n          \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27querySuccess\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: data.data,\n          },\n        });\n      }\n    },\n  }\n  subscriptions: {\n    setup({ dispatch }) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e data = getLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!data) {\n        dispatch({\n          \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27query\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {},\n        });\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        dispatch({\n          \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27querySuccess\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: data,\n          },\n        });\n      }\n    },\n  },\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单来说，就是没有缓存的时候缓存。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e什么时候更新数据缓存？\x3c\/h3\x3e\n\x3cp\x3e例如，\x3ccode\x3eroles\x3c\/code\x3e中\x3ccode\x3e添加\x3c\/code\x3e和\x3ccode\x3e修改\x3c\/code\x3e功能都需要用到\x3ccode\x3epermissions\x3c\/code\x3e的数据，哪我怎么拿到最新的\x3ccode\x3epermissions\x3c\/code\x3e数据呢。首先，我在加载\x3ccode\x3eroles\x3c\/code\x3e列表页面时就需要将\x3ccode\x3epermissions\x3c\/code\x3e的数据缓存，这样，在每次点\x3ccode\x3e添加\x3c\/code\x3e或\x3ccode\x3e修改\x3c\/code\x3e功能时就不需要再去拉取已缓存的数据了。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/models\/roles.js#L166\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/models\/roles.js#L166\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e在监听路由到\x3ccode\x3eroles\x3c\/code\x3e时查询\x3ccode\x3epermissions\x3c\/code\x3e是否缓存，将其更新到缓存中去。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n.\n.\n  subscriptions: {\n    setup({ dispatch, history }) {\n      history.listen((location) =\x3e {\n        const match = pathToRegexp(\x27\/roles\x27).exec(location.pathname);\n        if (match) {\n          const data = getLocalStorage(\x27permissions\x27);\n          if (!data) {\n            dispatch({\n              type: \x27permissions\/updateCache\x27,\n            });\n          }\n          dispatch({\n            type: \x27query\x27,\n            payload: location.query,\n          });\n        }\n      });\n    },\n  },\n.\n.\n.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e.\n.\n.\n  subscriptions: {\n    setup({ dispatch, history }) {\n      history.listen(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3elocation\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e match = pathToRegexp(\x3cspan class=\x22hljs-string\x22\x3e\x27\/roles\x27\x3c\/span\x3e).exec(location.pathname);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (match) {\n          \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e data = getLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27permissions\x27\x3c\/span\x3e);\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!data) {\n            dispatch({\n              \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27permissions\/updateCache\x27\x3c\/span\x3e,\n            });\n          }\n          dispatch({\n            \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27query\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: location.query,\n          });\n        }\n      });\n    },\n  },\n.\n.\n.\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e什么时候删除数据缓存？\x3c\/h3\x3e\n\x3cp\x3e删除缓存的配置是比较灵活的，这里的业务场景并不复杂所以，我用了比较简单的处理方式。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/models\/permissions.js#L112\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/models\/permissions.js#L112\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e在执行新增或更新操作成功后，将本地原有的缓存删除。加上数据联动的特性，当再次回到\x3ccode\x3eroles\x3c\/code\x3e操作时，缓存已经更新了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n.\n.\n    *update({ payload }, { select, call, put }) {\n      yield put({ type: \x27hideModal\x27 });\n      yield put({ type: \x27showLoading\x27 });\n      const id = yield select(({ permissions }) =\x3e permissions.currentItem.id);\n      const newRole = { ...payload, id };\n      const { data } = yield call(update, newRole);\n      if (data \x26amp;\x26amp; data.err_msg === \x27SUCCESS\x27) {\n        yield put({\n          type: \x27updateSuccess\x27,\n          payload: newRole,\n        });\n        localStorage.removeItem(\x27permissions\x27);\n        message.success(\x27更新成功!\x27);\n      }\n    },\n.\n.\n.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e.\n.\n.\n    *update({ payload }, { select, call, put }) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27hideModal\x27\x3c\/span\x3e });\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27showLoading\x27\x3c\/span\x3e });\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e id = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ permissions }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e permissions.currentItem.id);\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e newRole = { ...payload, id };\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(update, newRole);\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data \x26amp;\x26amp; data.err_msg === \x3cspan class=\x22hljs-string\x22\x3e\x27SUCCESS\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\n          \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27updateSuccess\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: newRole,\n        });\n        localStorage.removeItem(\x3cspan class=\x22hljs-string\x22\x3e\x27permissions\x27\x3c\/span\x3e);\n        message.success(\x3cspan class=\x22hljs-string\x22\x3e\x27更新成功!\x27\x3c\/span\x3e);\n      }\n    },\n.\n.\n.\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eState的临时缓存\x3c\/h3\x3e\n\x3cp\x3estate的中的数据是变化的，刷新页面之后会重置掉，也可以将部分\x3ccode\x3emodels\x3c\/code\x3e中的\x3ccode\x3estate\x3c\/code\x3e存到\x3ccode\x3eLocalstorage\x3c\/code\x3e中，让state的数据从\x3ccode\x3eLocalstorage\x3c\/code\x3e读取，但不是必要的。而\x3ccode\x3elist\x3c\/code\x3e数据的更新，是直接操作state中的数据的。\x3c\/p\x3e\n\x3cp\x3e如下(这样就不用更新整个list的数据了)。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n.\n.\n    grantSuccess(state, action) {\n      const grantUser = action.payload;\n      const newList = state.list.map((user) =\x3e {\n        if (user.id === grantUser.id) {\n          user.roles = grantUser.roles;\n          return { ...user };\n        }\n        return user;\n      });\n      return { ...state, ...newList, loading: false };\n    },\n.\n.\n.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e.\n.\n.\n    grantSuccess(state, action) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e grantUser = action.payload;\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e newList = state.list.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3euser\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.id === grantUser.id) {\n          user.roles = grantUser.roles;\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...user };\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e user;\n      });\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...state, ...newList, \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e };\n    },\n.\n.\n.\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e视图组件运用\x3c\/h2\x3e\n\x3cp\x3eAnt 提供的组件非常多，但用起来还是需要一些学习成本的，同时多个组件组合使用时也需要有很多地方注意的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3eModal注意事项\x3c\/h3\x3e\n\x3cp\x3e在使用Modal组件时，难免会出现一个页面多个Modal的情况，首先要注意的就是Modal的命名，在多Modal情况下，命名不注意很容易出现分不清用的是哪个Modal。建议命名时能望名知意。然后就是Modal需要用到别的Models的数据时，如果在弹窗时通过Ajax获取需要的数据再显示Modal，这样就会出现Modal延迟，而且Modal的动画也无法加载出来。所以，我的处理方式是，在进入这一级\x3ccode\x3eRoute\x3c\/code\x3e的时候就将需要的数据\x3ccode\x3e预缓存\x3c\/code\x3e，这样调用时就可随用随取，不会出现延迟了。\x3c\/p\x3e\n\x3cp\x3e参见\x3ca href=\x22https:\/\/github.com\/tkvern\/dva-passport\/blob\/develop\/resources\/assets\/ant_passport\/src\/components\/user\/UserModalGrant.jsx#L33\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esrc\/components\/user\/UserModalGrant.jsx#L33\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3eForm注意\x3c\/h3\x3e\n\x3cp\x3eAnt的form组件很完善，需要注意的就是表单的多条件查询。如果单单是一个条件查询的处理比较简单，将查询关键词设成\x3ccode\x3estring\x3c\/code\x3e类型存到相应的Models中的state即可，多条件的话，稍微麻烦一点，需存成Hash对象。灵活处理即可。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3e其他\x3c\/h3\x3e\n\x3cp\x3e官方文档的描述很清楚，我就不充大头了。注意写法规范即可，直接复制粘贴官方例子代码会很难看。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader21\x22\x3e跨域问题\x3c\/h2\x3e\n\x3cp\x3e终于说到点子上了，前后端分离遇到跨域问题很正常，而这种基于RESTful API的前后端分离就更好弄了。我这以Fetch \x2b PHP \x2b Laravel为例，这种并不是最有解决方案！仅供参考！\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3eheader\x3c\/code\x3e中进行如下配置\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eAccess-Control-Allow-Origin\x3c\/code\x3e配置允许的域\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eAccess-Control-Allow-Methods\x3c\/code\x3e配置允许的请求方式\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eAccess-Control-Allow-Headers\x3c\/code\x3e配置允许的请求头\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\n\nuse Illuminate\\Http\\Request;\n\n\/*\n|--------------------------------------------------------------------------\n| API Routes\n|--------------------------------------------------------------------------\n|\n| Here is where you can register API routes for your application. These\n| routes are loaded by the RouteServiceProvider within a group which\n| is assigned the \x26quot;api\x26quot; middleware group. Enjoy building your API!\n|\n*\/\n\nRoute::group([\x27middleware\x27=\x3e [\x27auth:api\x27]], function() {\n    header(\x26quot;Access-Control-Allow-Origin: *\x26quot;);\n    header(\x26quot;Access-Control-Allow-Methods: GET, HEAD, POST, PUT, PATCH, DELETE\x26quot;);\n    header(\x26quot;Access-Control-Allow-Headers: Access-Control-Allow-Headers, Origin, Accept, Authorization, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers\x26quot;);\n    require base_path(\x27routes\/common.php\x27);\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22php hljs\x22\x3e\x3ccode class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIlluminate\x3c\/span\x3e\\\x3cspan class=\x22hljs-title\x22\x3eHttp\x3c\/span\x3e\\\x3cspan class=\x22hljs-title\x22\x3eRequest\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*\n|--------------------------------------------------------------------------\n| API Routes\n|--------------------------------------------------------------------------\n|\n| Here is where you can register API routes for your application. These\n| routes are loaded by the RouteServiceProvider within a group which\n| is assigned the \x22api\x22 middleware group. Enjoy building your API!\n|\n*\/\x3c\/span\x3e\n\nRoute::group([\x3cspan class=\x22hljs-string\x22\x3e\x27middleware\x27\x3c\/span\x3e=\x26gt; [\x3cspan class=\x22hljs-string\x22\x3e\x27auth:api\x27\x3c\/span\x3e]], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    header(\x3cspan class=\x22hljs-string\x22\x3e\x22Access-Control-Allow-Origin: *\x22\x3c\/span\x3e);\n    header(\x3cspan class=\x22hljs-string\x22\x3e\x22Access-Control-Allow-Methods: GET, HEAD, POST, PUT, PATCH, DELETE\x22\x3c\/span\x3e);\n    header(\x3cspan class=\x22hljs-string\x22\x3e\x22Access-Control-Allow-Headers: Access-Control-Allow-Headers, Origin, Accept, Authorization, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers\x22\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e base_path(\x3cspan class=\x22hljs-string\x22\x3e\x27routes\/common.php\x27\x3c\/span\x3e);\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e基于其他编程语言的处理类似。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader22\x22\x3e结语\x3c\/h2\x3e\n\x3cp\x3e了解前端、熟悉前端、精通前端、熟悉前端、不懂前端\x3c\/p\x3e\n\x3cp\x3e了解 X X 、熟悉 X X 、精通 X X 、熟悉 X X 、不懂 X X\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Dva + Ant Design 前后端分离之 React 应用实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008250977">https://segmentfault.com/a/1190000008250977</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zopj8uo03n/" target="_blank">https://alili.tech/archive/zopj8uo03n/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/t42iv2yle7e/">2016-我的前端之路:工具化与工程化<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/xlhryjzdso/">2016年总结--成长<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/4wvjfeus9ur/">2016年末总结，我的前端之路<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/w7062tmcw3/">3D 视差效果<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5jt1iw1t77b/">AlloyTouch实战--60行代码搞定QQ看点资料卡<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/kquf0fxkw2j/">ES6，你不得不学！<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/r5b6g4133jh/">Emmet-前端开发神器<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5dbaikv4emi/">FreeCodeCamp中级算法题答案<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/iuyeljg6lm/">JSONP是什么<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/23ftsgrtzzc/">JS中的观察者模式(发布订阅)<aside class="dates">2019-01-29</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>