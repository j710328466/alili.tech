<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用现代化的方式开发一个图片上传工具"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用现代化的方式开发一个图片上传工具 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ighps7ts2as/",
				"appid": "1613049289050283", 
				"title": "用现代化的方式开发一个图片上传工具 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-16T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/oqbeqtn53cf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dq9drsomcv/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&text=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&text=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&title=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&is_video=false&description=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&title=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&title=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&title=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fighps7ts2as%2f&title=%e7%94%a8%e7%8e%b0%e4%bb%a3%e5%8c%96%e7%9a%84%e6%96%b9%e5%bc%8f%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e5%b7%a5%e5%85%b7"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用现代化的方式开发一个图片上传工具</h1><div class="meta"><div class="postdate"><time datetime="2019-01-16" itemprop="datePublished">2019-01-16</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e对于图片上传，大家一定不陌生。最近工作中遇到了关于图片上传的内容，借此机会认真研究了一番，遂一发不可收拾，最后琢磨了一个东西出来。在开发的过程中有不少的体会，于是打算写一篇文章分享一下心得体会。\x3cbr\x3e本文将会以这个名为\x3ccode\x3eDolu\x3c\/code\x3e的项目为例子，一步步介绍我是如何进行环境搭建、代码设计以及实际开发的。内容较多，还请耐心读完。\x3c\/p\x3e\n\x3cp\x3e项目地址：\x3ca href=\x22https:\/\/github.com\/jrainlau\/dolu\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/jrainlau\/dolu\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e一、环境搭建\x3c\/h1\x3e\n\x3cp\x3e本项目使用目前最新的\x3ccode\x3ewebpack 2\x3c\/code\x3e和\x3ccode\x3ees7\x3c\/code\x3e进行开发，所以环境的搭建必不可少。但是由于这个项目比较简单，所以环境的搭建也是非常简单的，只有一个\x3ccode\x3ewebpack.config.js\x3c\/code\x3e文件:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var path = require(\x27path\x27)\nvar webpack = require(\x27webpack\x27)\n\nmodule.exports = {\n  entry: \x27.\/src\/main.js\x27, \/\/ 开发模式用\n  \/\/ entry: \x27.\/src\/dolu.js\x27, \/\/ 生产模式用\n  output: {\n    path: path.resolve(__dirname, \x27.\/dist\x27),\n    publicPath: \x27\/dist\/\x27,\n    filename: \x27build.js\x27,  \/\/ 开发模式用\n    \/\/ filename: \x27index.js\x27,  \/\/ 生产模式用\n    libraryTarget: \x27umd\x27\n  },\n  module: {\n    rules: [\n      {\n        test: \/\\.js$\/,\n        exclude: \/node_modules|dist\/,\n        use: [\n          \x27babel-loader\x27,\n          \x27eslint-loader\x27\n        ]\n      }\n    ]\n  },\n  devServer: {\n    historyApiFallback: true,\n    noInfo: true,\n    host: \x270.0.0.0\x27\n  },\n  performance: {\n    hints: false\n  },\n  devtool: \x27#eval-source-map\x27\n}\n\nif (process.env.NODE_ENV === \x27production\x27) {\n  module.exports.devtool = \x27#source-map\x27\n  module.exports.plugins = (module.exports.plugins || []).concat([\n    new webpack.DefinePlugin({\n      \x27process.env\x27: {\n        NODE_ENV: \x27\x26quot;production\x26quot;\x27\n      }\n    }),\n    new webpack.optimize.UglifyJsPlugin({\n      sourceMap: true,\n      compress: {\n        warnings: false\n      }\n    }),\n    new webpack.LoaderOptionsPlugin({\n      minimize: true\n    })\n  ])\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e webpack = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  entry: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/main.js\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开发模式用\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ entry: \x27.\/src\/dolu.js\x27, \/\/ 生产模式用\x3c\/span\x3e\n  output: {\n    path: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e),\n    publicPath: \x3cspan class=\x22hljs-string\x22\x3e\x27\/dist\/\x27\x3c\/span\x3e,\n    filename: \x3cspan class=\x22hljs-string\x22\x3e\x27build.js\x27\x3c\/span\x3e,  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开发模式用\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ filename: \x27index.js\x27,  \/\/ 生产模式用\x3c\/span\x3e\n    libraryTarget: \x3cspan class=\x22hljs-string\x22\x3e\x27umd\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e: {\n    rules: [\n      {\n        test: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.js$\/\x3c\/span\x3e,\n        exclude: \x3cspan class=\x22hljs-regexp\x22\x3e\/node_modules|dist\/\x3c\/span\x3e,\n        use: [\n          \x3cspan class=\x22hljs-string\x22\x3e\x27babel-loader\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-string\x22\x3e\x27eslint-loader\x27\x3c\/span\x3e\n        ]\n      }\n    ]\n  },\n  devServer: {\n    historyApiFallback: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    noInfo: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    host: \x3cspan class=\x22hljs-string\x22\x3e\x270.0.0.0\x27\x3c\/span\x3e\n  },\n  performance: {\n    hints: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  },\n  devtool: \x3cspan class=\x22hljs-string\x22\x3e\x27#eval-source-map\x27\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV === \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.devtool = \x3cspan class=\x22hljs-string\x22\x3e\x27#source-map\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.plugins = (\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.plugins || []).concat([\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.DefinePlugin({\n      \x3cspan class=\x22hljs-string\x22\x3e\x27process.env\x27\x3c\/span\x3e: {\n        NODE_ENV: \x3cspan class=\x22hljs-string\x22\x3e\x27\x22production\x22\x27\x3c\/span\x3e\n      }\n    }),\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.optimize.UglifyJsPlugin({\n      sourceMap: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n      compress: {\n        warnings: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      }\n    }),\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.LoaderOptionsPlugin({\n      minimize: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    })\n  ])\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e考虑到“生产模式”使用的次数不多，所以并没有区分\x3ccode\x3edev\x3c\/code\x3e和\x3ccode\x3eprod\x3c\/code\x3e模式，而是手动注释对应的内容进行切换。\x3c\/p\x3e\n\x3cp\x3e定义好入口文件和输出路径后，我使用了\x3ccode\x3ebabel-loader\x3c\/code\x3e和\x3ccode\x3eeslint-loader\x3c\/code\x3e。这两个loader的作用就不多作介绍了，值得注意的是养成使用\x3ccode\x3eeslint\x3c\/code\x3e的习惯是极好的，能够有效减少代码的错误，并且能够改掉很多坏习惯。同时在编辑器里（我用VSCODE）中也能够实时进行代码检查，非常方便。\x3c\/p\x3e\n\x3cp\x3e为了使用最新的\x3ccode\x3ees7\x3c\/code\x3e，我们也需要在根目录下配置一份\x3ccode\x3e.babelrc\x3c\/code\x3e文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;presets\x26quot;: [\n    [\x26quot;latest\x26quot;, {\n      \x26quot;es2015\x26quot;: { \x26quot;modules\x26quot;: false }\n    }]\n  ],\n  \x26quot;plugins\x26quot;: [\n    [\x26quot;transform-runtime\x26quot;]\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22presets\x22\x3c\/span\x3e: [\n    [\x3cspan class=\x22hljs-string\x22\x3e\x22latest\x22\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22es2015\x22\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3e\x22modules\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n    }]\n  ],\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22plugins\x22\x3c\/span\x3e: [\n    [\x3cspan class=\x22hljs-string\x22\x3e\x22transform-runtime\x22\x3c\/span\x3e]\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e配置好了\x3ccode\x3ewebpack.config.js\x3c\/code\x3e和\x3ccode\x3e.babelrc\x3c\/code\x3e以后，我们打开\x3ccode\x3epackage.json\x3c\/code\x3e，来看看需要安装的依赖都有哪些：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x26quot;devDependencies\x26quot;: {\n    \x26quot;babel-core\x26quot;: \x26quot;^6.24.0\x26quot;,\n    \x26quot;babel-loader\x26quot;: \x26quot;^6.4.1\x26quot;,\n    \x26quot;babel-plugin-transform-runtime\x26quot;: \x26quot;^6.23.0\x26quot;,\n    \x26quot;babel-polyfill\x26quot;: \x26quot;^6.23.0\x26quot;,\n    \x26quot;babel-preset-latest\x26quot;: \x26quot;^6.24.0\x26quot;,\n    \x26quot;cors\x26quot;: \x26quot;^2.8.3\x26quot;,\n    \x26quot;cross-env\x26quot;: \x26quot;^3.2.4\x26quot;,\n    \x26quot;eslint\x26quot;: \x26quot;^3.19.0\x26quot;,\n    \x26quot;eslint-config-standard\x26quot;: \x26quot;^10.2.1\x26quot;,\n    \x26quot;eslint-loader\x26quot;: \x26quot;^1.7.1\x26quot;,\n    \x26quot;eslint-plugin-import\x26quot;: \x26quot;^2.2.0\x26quot;,\n    \x26quot;eslint-plugin-node\x26quot;: \x26quot;^4.2.2\x26quot;,\n    \x26quot;eslint-plugin-promise\x26quot;: \x26quot;^3.5.0\x26quot;,\n    \x26quot;eslint-plugin-standard\x26quot;: \x26quot;^3.0.1\x26quot;,\n    \x26quot;multer\x26quot;: \x26quot;^1.3.0\x26quot;,\n    \x26quot;webpack\x26quot;: \x26quot;^2.3.1\x26quot;,\n    \x26quot;webpack-dev-server\x26quot;: \x26quot;^2.4.2\x26quot;\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-string\x22\x3e\x22devDependencies\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22babel-core\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^6.24.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22babel-loader\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^6.4.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22babel-plugin-transform-runtime\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^6.23.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22babel-polyfill\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^6.23.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22babel-preset-latest\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^6.24.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22cors\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^2.8.3\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^3.2.4\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^3.19.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-config-standard\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^10.2.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-loader\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^1.7.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-plugin-import\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^2.2.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-plugin-node\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^4.2.2\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-plugin-promise\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^3.5.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22eslint-plugin-standard\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^3.0.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22multer\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^1.3.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22webpack\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^2.3.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22webpack-dev-server\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^2.4.2\x22\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当中的\x3ccode\x3ecors\x3c\/code\x3e模块和\x3ccode\x3emulter\x3c\/code\x3e模块为我们之后搭建node服务器需要用的，其他都是运行所需。\x3c\/p\x3e\n\x3cp\x3e然后在\x22scripts\x22里面写上我们要用到的几条命令：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x26quot;scripts\x26quot;: {\n    \x26quot;dev\x26quot;: \x26quot;cross-env NODE_ENV=development webpack-dev-server --hot\x26quot;,\n    \x26quot;build\x26quot;: \x26quot;cross-env NODE_ENV=production webpack --progress --hide-modules\x26quot;,\n    \x26quot;server\x26quot;: \x26quot;node .\/server\/index.js\x26quot;\n  },\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22dev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=development webpack-dev-server --hot\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22build\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=production webpack --progress --hide-modules\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22server\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22node .\/server\/index.js\x22\x3c\/span\x3e\n  },\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e分别对应\x3ccode\x3e开发模式\x3c\/code\x3e，\x3ccode\x3e生产模式\x3c\/code\x3e，\x3ccode\x3e启动本地后台服务器\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e然后我们在根目录下新建一个\x3ccode\x3esrc\x3c\/code\x3e目录，一个\x3ccode\x3eindex.html\x3c\/code\x3e，一个\x3ccode\x3e\/src\/main.js\x3c\/code\x3e。这时候整个项目的目录结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22├── index.html\n├── package.json\n├── src\n│\x26nbsp;\x26nbsp; └── main.js\n├── webpack.config.js\n└── .babelrc\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.html\x3c\/span\x3e\n├── package\x3cspan class=\x22hljs-selector-class\x22\x3e.json\x3c\/span\x3e\n├── src\n│\x26nbsp;\x26nbsp; └── main\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n├── webpack\x3cspan class=\x22hljs-selector-class\x22\x3e.config\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n└── .babelrc\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此，我们的开发环境已经搭建完毕。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e二、功能设计\x3c\/h1\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMk8P?w=318\x26amp;h=452\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMk8P?w=318\x26amp;h=452\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e基本的流程及功能如上图所示，其中的每一步我们都将以模块的方式进行开发。\x3c\/p\x3e\n\x3cp\x3e当然，我们不能满足于这么一点点的功能，我们需要考虑更多的情况更多的可能，扩展一下，也许我们可以这么做：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMlaN?w=819\x26amp;h=806\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMlaN?w=819\x26amp;h=806\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e比如我们在获取图片之后先不进行上传，也许我们还要对转出来的\x3ccode\x3ebase64\x3c\/code\x3e进行处理或使用，也许我们能够直接上传一堆由第三方提供的\x3ccode\x3ebase64\x3c\/code\x3e甚至\x3ccode\x3eformdata\x3c\/code\x3e。另外我们还需要对上传的方法进行自定义，又或者可以选择多张图片什么的……除此之外，可能还有许许多多的场景，为了开发一个通用的组件，我们需要思考的地方实在有很多很多。\x3c\/p\x3e\n\x3cp\x3e当然，这一次我们的任务比较简单，上面这么多功能已经够我们玩的了，下面我们进入实际的开发。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e三、开始coding！\x3c\/h1\x3e\n\x3cp\x3e在\x3ccode\x3e\/src\x3c\/code\x3e目录下新建一个\x3ccode\x3edolu.js\x3c\/code\x3e文件，这将会是我们整个项目的核心。\x3c\/p\x3e\n\x3cp\x3e首先定义一个类：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Dolulu {\n  constructor (config = {}) {}\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDolulu\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e (config = {}) {}\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后我们按照上一节脑图的思路，先完成“图片选取”相关的功能。\x3c\/p\x3e\n\x3cp\x3e在这个类里面我们定义一个名为\x3ccode\x3e_pickFile()\x3c\/code\x3e的私有方法，这个方法我们不希望被外部调用，只是作为\x3ccode\x3eDolu\x3c\/code\x3e内置的方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _pickFile () {\n    const picker = document.querySelector(this.config.picker)\n\n    picker.addEventListener(\x27change\x27, () =\x3e {\n      if (!picker.files.length) {\n        return\n      }\n      const files = [...picker.files]\n\n      if (files.length \x3e this.config.quantity) {\n        throw new Error(\x27Out of file quantity limit!\x27)\n      }\n\n      \/*\n       * 这时候我们已经拿到了文件数组files，可以马上进行转码\n       * _transformer()函数是另一个私有方法，用于格式转码\n       *\/\n      this._transformer(files)\n      \n      \/*\n       * 加入这一行以实现重复选中同一张图片\n       *\/\n      picker.value = null\n    })\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e  _pickFile () {\n    const picker = document.querySelector(this\x3cspan class=\x22hljs-selector-class\x22\x3e.config\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.picker\x3c\/span\x3e)\n\n    picker.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27change\x27\x3c\/span\x3e, () =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!picker\x3cspan class=\x22hljs-selector-class\x22\x3e.files\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.length\x3c\/span\x3e) {\n        return\n      }\n      const files = [..\x3cspan class=\x22hljs-selector-class\x22\x3e.picker\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.files\x3c\/span\x3e]\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (files\x3cspan class=\x22hljs-selector-class\x22\x3e.length\x3c\/span\x3e \x26gt; this\x3cspan class=\x22hljs-selector-class\x22\x3e.config\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.quantity\x3c\/span\x3e) {\n        throw new Error(\x3cspan class=\x22hljs-string\x22\x3e\x27Out of file quantity limit!\x27\x3c\/span\x3e)\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/*\n       * 这时候我们已经拿到了文件数组files，可以马上进行转码\n       * _transformer()函数是另一个私有方法，用于格式转码\n       *\/\x3c\/span\x3e\n      this._transformer(files)\n      \n      \x3cspan class=\x22hljs-comment\x22\x3e\/*\n       * 加入这一行以实现重复选中同一张图片\n       *\/\x3c\/span\x3e\n      picker\x3cspan class=\x22hljs-selector-class\x22\x3e.value\x3c\/span\x3e = null\n    })\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后写一个初始化的方法，让\x3ccode\x3eDolu\x3c\/code\x3e实例能够自动开启文件选取功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _init () {\n    if (this.config.picker) {\n      return this._pickFile()\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e  _init () {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.picker) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._pickFile()\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e只要在\x3ccode\x3econstructor\x3c\/code\x3e里面调用这个方法就可以了。\x3c\/p\x3e\n\x3cp\x3e选择完图片，我们就要对它进行转码了。为了更好地组织我们的代码，我们把这个“图片转成base64”的函数封装成一个模块。在\x3ccode\x3e\/src\x3c\/code\x3e目录下新建\x3ccode\x3efileToBase64.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const fileToBase64 = (file) =\x3e {\n  const reader = new FileReader()\n\n  reader.readAsDataURL(file)\n\n  return new Promise((resolve) =\x3e {\n    reader.addEventListener(\x27load\x27, () =\x3e {\n      const result = reader.result\n      resolve(result)\n    })\n  })\n}\n\nexport default fileToBase64\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fileToBase64 = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3efile\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FileReader()\n\n  reader.readAsDataURL(file)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    reader.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = reader.result\n      resolve(result)\n    })\n  })\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e fileToBase64\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码内容只有15行，其输入为一个图片文件，输出为一串base64编码。返回一个Promise方便接下来我们使用\x3ccode\x3easync\/await\x3c\/code\x3e语法。\x3c\/p\x3e\n\x3cp\x3e同样的道理，我们新建一个\x3ccode\x3ebase64ToBlob.js\x3c\/code\x3e文件，以实现输入为base64，输出为formdata的功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const base64ToBlob = (base64) =\x3e {\n  const byteString = atob(base64.split(\x27,\x27)[1])\n  const mimeString = base64.split(\x27,\x27)[0].split(\x27:\x27)[1].split(\x27;\x27)[0]\n  const ab = new ArrayBuffer(byteString.length)\n  const ia = new Uint8Array(ab)\n  for (let i = 0, len = byteString.length; i \x3c len; i \x2b= 1) {\n    ia[i] = byteString.charCodeAt(i)\n  }\n\n  let Builder = window.WebKitBlobBuilder || window.MozBlobBuilder\n  let blobUrl\n\n  if (Builder) {\n    const builder = new Builder()\n    builder.append(ab)\n    blobUrl = builder.getBlob(mimeString)\n  } else {\n    blobUrl = new window.Blob([ab], { type: mimeString })\n  }\n\n  const fd = new FormData()\n  fd.append(\x27file\x27, blobUrl)\n\n  return fd\n}\n\nexport default base64ToBlob\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e base64ToBlob = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ebase64\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e byteString = atob(base64.split(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e])\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mimeString = base64.split(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].split(\x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].split(\x3cspan class=\x22hljs-string\x22\x3e\x27;\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ab = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArrayBuffer\x3c\/span\x3e(byteString.length)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ia = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eUint8Array\x3c\/span\x3e(ab)\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, len = byteString.length; i \x26lt; len; i \x2b= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n    ia[i] = byteString.charCodeAt(i)\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e Builder = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.WebKitBlobBuilder || \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.MozBlobBuilder\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e blobUrl\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (Builder) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e builder = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Builder()\n    builder.append(ab)\n    blobUrl = builder.getBlob(mimeString)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    blobUrl = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.Blob([ab], { \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: mimeString })\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fd = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData()\n  fd.append(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e, blobUrl)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fd\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e base64ToBlob\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来我们利用这两个模块，构建我们的\x3ccode\x3e_transformer()\x3c\/code\x3e方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _transformer (files, manually = false) {\n    files.forEach(async (file, index) =\x3e {\n      if (isObject(file)) {\n        if (!\/\\\/(?:jpeg|png|gif)\/i.test(file.type)) {\n          return\n        }\n\n        const dataUrl = await fileToBase64(file)\n        const formData = await base64ToBlob(dataUrl)\n\n        if (this.config.autoSend || manually) {\n          this._uploader(formData, index)\n        }\n      }\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e  _transformer (files, manually = \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n    files.forEach(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (file, index) =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isObject(file)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\/\\\/(?:jpeg|png|gif)\/i.test(file.type)) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dataUrl = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fileToBase64(file)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e base64ToBlob(dataUrl)\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.autoSend || manually) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._uploader(formData, index)\n        }\n      }\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看到，这个方法会遍历整个files数组，通过筛选保证其文件类型为图片，然后连续转码生成formdata格式数据，作为参数传入\x3ccode\x3e_uploader()\x3c\/code\x3e方法中。另外为了方便扩展和使用，同时传入了图片的下标。图片的下标能够方便在上传函数中让用户知道“现在是第几张图片被处理”。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e_upload()\x3c\/code\x3e函数将会直接调用\x3ccode\x3eDolu\x3c\/code\x3e实例中所定义的上传方法，这个稍后再述。\x3c\/p\x3e\n\x3cp\x3e到这里，我们已经完成了上一节第一张图片的几个“基本功能”了，和外面一捞一大把的教程相差无几。别急，我们马上进入对扩展功能的开发。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e四、实现向外输出完整的base64字符串数组\x3c\/h1\x3e\n\x3cp\x3e我们重新把目光投向上一节的\x3ccode\x3e_transformer()\x3c\/code\x3e函数。这个函数接受一个\x3cstrong\x3e数组\x3c\/strong\x3e，在内部使用\x3ccode\x3e.forEach()\x3c\/code\x3e方法遍历每一个文件，对它进行转码处理。为了向外输出完整的转码后的数组，关键的步骤在于如何确定转码已经完成了。从最简单的想法开始，在\x3ccode\x3eforEach\x3c\/code\x3e循环体的外部直接把数组抛出去行不行？比如这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _transformer (files, manually = false) {\n    files.forEach(async (file, index) =\x3e {\n      if (isObject(file)) {\n        if (!\/\\\/(?:jpeg|png|gif)\/i.test(file.type)) {\n          return\n        }\n\n        const dataUrl = await fileToBase64(file)\n        const formData = await base64ToBlob(dataUrl)\n\n        this.dataUrlArr.push(dataUrl)\n\n        if (this.config.autoSend || manually) {\n          this._uploader(formData, index)\n        }\n      }\n    })\n\n    this.config.getDataUrls(this.dataUrlArr)\n\n    return this\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e  _transformer (files, manually = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n    files.forEach(async (file, index) =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isObject(file)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\/\\\/(?:jpeg|png|gif)\/i.test(file.type)) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n\n        const dataUrl = await fileToBase64(file)\n        const formData = await base64ToBlob(dataUrl)\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dataUrlArr.push(dataUrl)\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.autoSend || manually) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._uploader(formData, index)\n        }\n      }\n    })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.getDataUrls(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dataUrlArr)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看起来没有问题，但是在实际的测试中，传入\x3ccode\x3ethis.config.getDataUrls\x3c\/code\x3e中的\x3ccode\x3edataUrlArr\x3c\/code\x3e首先会是一个空数组，过一会儿才会有数据。为了验证这个结论，我们在\x3ccode\x3e\/src\x3c\/code\x3e名录下新建一个文件\x3ccode\x3emain.js\x3c\/code\x3e，写入如下内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import Dolu from \x27.\/dolu\x27\n\nconst dolu = new Dolu({\n  picker: \x27#picker\x27,\n  getDataUrls (arr) {\n    console.info(arr)\n    arr.forEach((dataUrl) =\x3e {\n      console.log(dataUrl)\n    })\n  }\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Dolu \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/dolu\x27\x3c\/span\x3e\n\nconst dolu = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Dolu({\n  picker: \x3cspan class=\x22hljs-string\x22\x3e\x27#picker\x27\x3c\/span\x3e,\n  getDataUrls (arr) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.info(arr)\n    arr.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(dataUrl)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(dataUrl)\n    })\n  }\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行一下，发现输出结果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMl7O?w=570\x26amp;h=106\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMl7O?w=570\x26amp;h=106\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只有一个空数组，而且\x3ccode\x3eforEach()\x3c\/code\x3e循环并没有打印出任何东西。这个例子不直观，我们现在把开发者工具关掉，然后重新打开，看看会发生什么：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMl8p?w=442\x26amp;h=126\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMl8p?w=442\x26amp;h=126\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e仅仅是重新打开开发者工具，就发现刚才的空数组变成了一个有内容的数组，特别奇怪。\x3c\/p\x3e\n\x3cp\x3e其实原因也很简单，因为\x3ccode\x3e_transformer()\x3c\/code\x3e内部的\x3ccode\x3eforEach()\x3c\/code\x3e循环，并不能保证图片已经转码完毕，这涉及到浏览器任务队列的知识（此处理解可能有误，欢迎指出），在这里就不展开讨论了。\x3c\/p\x3e\n\x3cp\x3e那么我们只能\x3cstrong\x3e等待\x3c\/strong\x3e图片转码完毕，才调用\x3ccode\x3ethis.config.getDataUrls()\x3c\/code\x3e方法。要实现这个目的，我们有许多种方法，最简单粗暴的就是利用\x3ccode\x3esetInterval()\x3c\/code\x3e进行轮询，当\x3ccode\x3edataUrlArr.length === files.length\x3c\/code\x3e，则立即调用，但是这种做法一点儿也不优雅。我们能不能让函数发送一个\x3cstrong\x3e通知\x3c\/strong\x3e，当\x3ccode\x3e.push()\x3c\/code\x3e方法执行并成功的时候就判断\x3ccode\x3edataUrlArr.length =?= files.length\x3c\/code\x3e，若条件符合则进行相应的处理。\x3c\/p\x3e\n\x3cp\x3e这时候我们可以考虑使用es6新增语法\x3ccode\x3eProxy\x3c\/code\x3e来解决。关于\x3ccode\x3eProxy\x3c\/code\x3e的使用可以查阅我的另外一篇文章\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000007443611\x22\x3e《使用ES6的新特性Proxy来实现一个数据绑定实例》\x3c\/a\x3e，然后我们一起来步入正题吧！\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e五、使用\x3ccode\x3eProxy\x3c\/code\x3e实现数据绑定\x3c\/h1\x3e\n\x3cp\x3e在\x3ccode\x3e\/src\x3c\/code\x3e目录下的\x3ccode\x3eutils.js\x3c\/code\x3e里，我们加入一个新的工具方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function proxier (props, callback) {\n  const waitProxy = new Proxy(props, {\n    set (target, property, value) {\n      target[property] = value\n      callback(target, property, value)\n      return true\n    }\n  })\n  return waitProxy\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproxier\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eprops, callback\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e waitProxy = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(props, {\n    set (target, \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x3c\/span\x3e, value) {\n      target[\x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e] \x3c\/span\x3e= value\n      callback(target, \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x3c\/span\x3e, value)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    }\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e waitProxy\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e回到\x3ccode\x3edolu.js\x3c\/code\x3e文件，改写一下\x3ccode\x3e_transformer()\x3c\/code\x3e方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _transformer (files, manually = false) {\n    const dataUrlArrProxy = proxier(this.dataUrlArr, (target, property, value) =\x3e {\n      if (property === \x27length\x27) {\n        if (target.length === files.length) {\n          this.config.getDataUrls(this.dataUrlArr)\n        }\n      }\n    })\n\n    files.forEach(async (file, index) =\x3e {\n      if (isObject(file)) {\n        if (!\/\\\/(?:jpeg|png|gif)\/i.test(file.type)) {\n          return\n        }\n\n        const dataUrl = await fileToBase64(file)\n        const formData = await base64ToBlob(dataUrl)\n\n        dataUrlArrProxy.push(dataUrl)\n\n        if (this.config.autoSend || manually) {\n          this._uploader(formData, index)\n        }\n      }\n    })\n\n    return this\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e  _transformer (files, manually = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dataUrlArrProxy = proxier(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dataUrlArr, (target, \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x3c\/span\x3e, value) =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e \x3c\/span\x3e=== \x3cspan class=\x22hljs-string\x22\x3e\x27length\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (target.length === files.length) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.getDataUrls(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dataUrlArr)\n        }\n      }\n    })\n\n    files.forEach(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (file, index) =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isObject(file)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\/(?:jpeg|png|gif)\/i\x3c\/span\x3e.test(file.type)) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dataUrl = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fileToBase64(file)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e base64ToBlob(dataUrl)\n\n        dataUrlArrProxy.push(dataUrl)\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.autoSend || manually) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._uploader(formData, index)\n        }\n      }\n    })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，我们每一次转码过后，都会调用\x3cstrong\x3e代理数组\x3c\/strong\x3e\x3ccode\x3edataUrlArrProxy\x3c\/code\x3e中的\x3ccode\x3e.push()\x3c\/code\x3e方法，这时候代理数组就会自动判断\x3ccode\x3etarget.length =?= files.length\x3c\/code\x3e然后调用相应的方法。\x3c\/p\x3e\n\x3cp\x3e尝试运行一下，发现结果符合预期。同样的方式，我们可以为\x3ccode\x3eformDataArr\x3c\/code\x3e也设置一个代理数组，以实现向外抛出\x3ccode\x3eformdata\x3c\/code\x3e数组的目的。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3e六、服务器搭建\x3c\/h1\x3e\n\x3cp\x3e把前端这边的图片选取、图片转码都已经做完了，那么我们是时候搭建一个后台服务器，去测试以\x3ccode\x3eformdata\x3c\/code\x3e格式上传图片是否有效了。\x3c\/p\x3e\n\x3cp\x3e进入根目录下的\x3ccode\x3e\/server\x3c\/code\x3e文件夹，我们新建一个\x3ccode\x3e\/imgs\x3c\/code\x3e目录以及一个\x3ccode\x3eindex.js\x3c\/code\x3e文件，内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const express = require(\x27express\x27)\nconst multer = require(\x27multer\x27)\nconst cors = require(\x27cors\x27)\n\nconst app = express()\napp.use(express.static(\x27.\/public\x27))\napp.use(cors())\n\napp.listen(process.env.PORT || 8888)\nconsole.log(\x27Node.js Ajax Upload File running at: http:\/\/0.0.0.0:8888\x27)\n\napp.post(\x27\/upload\x27, (req, res) =\x3e {\n  const store = multer.diskStorage({\n    destination: \x27.\/server\/imgs\x27\n  })\n  const upload = multer({\n    storage: store\n  }).any()\n\n  upload(req, res, function (err) {\n    if (err) {\n      console.log(err)\n      return res.end(\x27Error\x27)\n    } else {\n      console.log(req.body)\n      req.files.forEach(function (item) {\n        console.log(item)\n      })\n      res.end(\x27File uploaded\x27)\n    }\n  })\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e express = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e multer = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27multer\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e cors = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27cors\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = express()\napp.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(express.\x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/public\x27\x3c\/span\x3e))\napp.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(cors())\n\napp.listen(process.env.PORT || \x3cspan class=\x22hljs-number\x22\x3e8888\x3c\/span\x3e)\nconsole.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Node.js Ajax Upload File running at: http:\/\/0.0.0.0:8888\x27\x3c\/span\x3e)\n\napp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/upload\x27\x3c\/span\x3e, (req, res) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = multer.diskStorage({\n    destination: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/server\/imgs\x27\x3c\/span\x3e\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e upload = multer({\n    storage: store\n  }).any()\n\n  upload(req, res, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(err)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n      console.log(err)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.end(\x3cspan class=\x22hljs-string\x22\x3e\x27Error\x27\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      console.log(req.body)\n      req.files.\x3cspan class=\x22hljs-keyword\x22\x3eforEach\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(item)\x3c\/span\x3e \x3c\/span\x3e{\n        console.log(item)\n      })\n      res.end(\x3cspan class=\x22hljs-string\x22\x3e\x27File uploaded\x27\x3c\/span\x3e)\n    }\n  })\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该服务器将会运行于本地\x3ccode\x3e8888\x3c\/code\x3e端口，通过\x3ccode\x3epost\x3c\/code\x3e方法发送到\x3ccode\x3elocalhost:8888\/upload\x3c\/code\x3e，然后图片会保存到\x3ccode\x3eserver\/imgs\x3c\/code\x3e目录下。\x3c\/p\x3e\n\x3cp\x3e回到\x3ccode\x3edolu.js\x3c\/code\x3e，我们写一个\x3ccode\x3e_uploader()\x3c\/code\x3e方法，该方法会调用\x3ccode\x3econfig\x3c\/code\x3e里面的自定义设置，调用设置中具体的上传方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  _uploader (formData, index) {\n    this.config.uploader(formData, index)\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3e  _uploader (formData, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config.uploader(formData, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e)\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在\x3ccode\x3emain.js\x3c\/code\x3e中，我们使用\x3ccode\x3eaxios\x3c\/code\x3e作为上传的工具：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const dolu = new Dolu({\n  picker: \x27#picker\x27,\n  autoSend: true,\n  uploader (data, index) {\n    axios({\n      method: \x27post\x27,\n      url: \x27http:\/\/0.0.0.0:8888\/upload\x27,\n      data: data,\n      onUploadProgress: (e) =\x3e {\n        const percent = Math.round((e.loaded * 100) \/ e.total)\n        console.log(percent, index)\n      }\n    }).then((res) =\x3e {\n      console.log(res)\n    }).catch((err) =\x3e {\n      console.log(err)\n    })\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3econst dolu = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Dolu({\n  picker: \x3cspan class=\x22hljs-string\x22\x3e\x27#picker\x27\x3c\/span\x3e,\n  autoSend: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  uploader (data, index) {\n    axios({\n      method: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n      url: \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/0.0.0.0:8888\/upload\x27\x3c\/span\x3e,\n      data: data,\n      onUploadProgress: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        const percent = Math.round((e.loaded * \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) \/ e.total)\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(percent, index)\n      }\n    }).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(res)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res)\n    }).\x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(err)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err)\n    })\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e激动人心的时刻来了，我们来测试一下吧！\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3e七、实际运行测试\x3c\/h1\x3e\n\x3cp\x3e打开开发者工具当中的\x3ccode\x3eNetwork\x3c\/code\x3e，随便选几张图片进行上传，看看效果如何：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMmml?w=411\x26amp;h=246\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMmml?w=411\x26amp;h=246\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMmmA?w=597\x26amp;h=71\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMmmA?w=597\x26amp;h=71\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e点击去看看发送的是什么东西：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMmmO?w=476\x26amp;h=126\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMmmO?w=476\x26amp;h=126\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如上图所示，是一个formdata数据。打开\x3ccode\x3e.\/server\/imgs\x3c\/code\x3e目录，我们应该就能看到三个文件了：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMmnC?w=1684\x26amp;h=726\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMmnC?w=1684\x26amp;h=726\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVMmn8?w=1146\x26amp;h=164\x22 src=\x22https:\/\/static.alili.tech\/img\/bVMmn8?w=1146\x26amp;h=164\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上传成功！而且符合我们以“formdata上传的二进制格式”的需求。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e八、后续工作\x3c\/h1\x3e\n\x3cp\x3e至此已经基本完成了我们整个图片上传组件，还有几个细节需要注意，比如所发送图片的命名、对图片通过canvas进行压缩等等，这些坑以后有空再填。比较完善的代码可以直接查看\x3ca href=\x22https:\/\/github.com\/jrainlau\/dolu\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e我的仓库\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e感谢您的阅读，欢迎对文章内容提出批评指导建议！\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e参考资料：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/axes\/p\/4603984.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e移动前端—图片压缩上传实践\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.tych.io\/tech\/2013\/08\/21\/html5-upload-file.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTML5实现图片上传\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/4109276\/how-to-detect-input-type-file-change-for-the-same-file\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHow to detect input type=file “change” for the same file?\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用现代化的方式开发一个图片上传工具</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009103723">https://segmentfault.com/a/1190000009103723</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ighps7ts2as/" target="_blank">https://alili.tech/archive/ighps7ts2as/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5328xogjarn/">IndexedDB--HTML5本地存储<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/xpccu0hsqbr/">JS学习系列 01 - 编译原理和作用域<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/shv09bbtbfd/">Vue2 SSR 的优化之旅<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5vj1ojfo6h6/">[2016年末巨献] — HTML5可交互地铁线路图（第二季：帝都进阶版）<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/m02hlm4bzh/">vue2.0开发聊天程序（三）组件的通信<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/mz5o7n90plg/">《很高兴我没有猝死》- 前端新人的 2016 年总结和感悟<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/3vhoe2mo09k/">一道颇有难度的JavaScript题<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/uj12mb7thp/">使用CANVAS实现交互性圆形马赛克效果<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/ja636h8hcxa/">写于 2016 年末<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5uomnoq1kmi/">前端学习资源整理<aside class="dates">2019-01-28</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>