<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="细说Unicode(二) Unicode与JavaScript的纠葛"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>细说Unicode(二) Unicode与JavaScript的纠葛 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/yyqhgqfit9r/",
				"appid": "1613049289050283", 
				"title": "细说Unicode(二) Unicode与JavaScript的纠葛 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-28T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/58ztskl01lt/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/35nlfyf30f2/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&text=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&text=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&title=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&is_video=false&description=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&title=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&title=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&title=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyyqhgqfit9r%2f&title=%e7%bb%86%e8%af%b4Unicode%28%e4%ba%8c%29%20Unicode%e4%b8%8eJavaScript%e7%9a%84%e7%ba%a0%e8%91%9b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">细说Unicode(二) Unicode与JavaScript的纠葛</h1><div class="meta"><div class="postdate"><time datetime="2019-01-28" itemprop="datePublished">2019-01-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e大家对上一篇文章中提到的UCS编码可能比较陌生。殊不知这就是JavaScript采用的编码方法。\x3c\/p\x3e\n\x3cp\x3e既然Unicode已经统一了天下，为什么JavaScript不采用UTF的编码方法呢？原因很简单，因为JavaScript诞生的时候UTF-8还尚未成熟，UTF-16更是到后面才出现，而此时UCS已经先行一步地完成了UCS-2。所以JavaScript采用了比UTF更早的UCS。也就是UCS-2。（记住只是编码方法，实际上字符集还是Unicode字符集）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3eUCS-2 与 UTF-16\x3c\/h3\x3e\n\x3cp\x3e从命名上看，我们很容易猜出UCS-2占用2个字节。而UTF-16占用16位，也是2个字节，那他们的编码方式有什么不同呢？\x3cbr\x3e对于2个字节的码点，UCS-2和UTF-16是没有什么区别的。在基本平面上（2^16），UTF-16沿用了UCS-2的编码，另外在辅助平面上，UTF-16还定义了4个字节的表示方法。简单来说，UTF-16可看成是UCS-2的父集。在没有辅助平面字符前，UTF-16与UCS-2所指的是同一的意思。但当引入辅助平面字符后，就称为UTF-16了。\x3c\/p\x3e\n\x3cp\x3e由于JavaScript只能处理UCS-2编码，造成所有字符都是2个字节，如果是4个字节的字符，会被当做两个双字节的字符处理。受到这个的影响，JavaScript中的字符操作函数某些情况无法返回正确的结果。\x3c\/p\x3e\n\x3cp\x3e对于两个字节的字符，js能够根据码点直接输出对应字符。例如小写字母\x27a\x27的Unicode编码就是U\x2b0061。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992413?w=199\x26amp;h=70\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992413?w=199\x26amp;h=70\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eU\x2b0000 - U\x2b00FF的码点，还有另外一种表示方法，称为16进制转义序列。用\x27x\x27开头，后面跟两位的16进制符。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992414?w=200\x26amp;h=72\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992414?w=200\x26amp;h=72\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大于两个字符的码点，JavaScript就有点力不从心了。例如字符 \x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这个符号的字符码点为 \x22U\x2b1F4A9\x22, 控制台的输出结果是这样的\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992416?w=94\x26amp;h=37\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992416?w=94\x26amp;h=37\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这显然不是正确的结果，那么\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992417?w=54\x26amp;h=18\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992417?w=54\x26amp;h=18\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e这个符号是怎么产生的呢？\x3c\/p\x3e\n\x3cp\x3e由于UCS-2每次只能读取两个字节，所以 \x22U\x2b1F4A9\x22被解读为U\x2b1F4A 和 9, 查阅\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUnicode映射表\x3c\/a\x3eU\x2b1F4A 对应的是希腊语的扩展，就是是符号0加一点。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992418?w=608\x26amp;h=34\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992418?w=608\x26amp;h=34\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992419?w=104\x26amp;h=40\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992419?w=104\x26amp;h=40\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e剩下的9则被识别为普通的字符串符号\x279\x27输出了。\x3c\/p\x3e\n\x3cp\x3e既然JavaScript无法处理大于两个字节的符号，那对于互联网上成千上万的复杂字符和表情，岂不是束手无策？\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e非也！\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们在控制台输出这个码点：”uD83DuDCA9″\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992420?w=151\x26amp;h=45\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992420?w=151\x26amp;h=45\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e神奇的事情发生了，”uD83DuDCA9″竟然也能输出\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e符号。\x3c\/p\x3e\n\x3cp\x3e如果我们单独输出这两个码点，看会输出什么字符：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992421?w=102\x26amp;h=74\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992421?w=102\x26amp;h=74\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e两个字符单独输出都是乱码，Unicode无法识别对应的字符。再次查阅映射表。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992422?w=606\x26amp;h=64\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992422?w=606\x26amp;h=64\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e发现这两个码点分别落在了UTF-16的高半位和低半位。\x3c\/p\x3e\n\x3cp\x3e原来UTF-16碰到第一个双字节码点在D800-DBFF之间时，代码不会直接读取符号，而是将其存储为高半区，再往下读取两个字节的低半区，合在一起再输出符号。而这也是UCS-2的处理方式。\x3c\/p\x3e\n\x3cp\x3e那么 \x22U\x2b1F4A9\x22怎么转化为高低位”uD83DuDCA9\x22呢，下面是转换公式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22H = Math.floor((0x1F4A9-0x10000)\/0x400)\x2b0xD800 = 0xD83D\n\nL = (0x1F4A9-0x10000) % 0x400\x2b0xDC00 = 0xDCA9\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eH = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor((\x3cspan class=\x22hljs-number\x22\x3e0x1F4A9\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-0x10000\x3c\/span\x3e)\/\x3cspan class=\x22hljs-number\x22\x3e0x400\x3c\/span\x3e)\x2b\x3cspan class=\x22hljs-number\x22\x3e0xD800\x3c\/span\x3e = \x3cspan class=\x22hljs-number\x22\x3e0xD83D\x3c\/span\x3e\n\nL = (\x3cspan class=\x22hljs-number\x22\x3e0x1F4A9\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-0x10000\x3c\/span\x3e) % \x3cspan class=\x22hljs-number\x22\x3e0x400\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-number\x22\x3e0xDC00\x3c\/span\x3e = \x3cspan class=\x22hljs-number\x22\x3e0xDCA9\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e既然我们已经能够在JavaScript中输出辅助平面的字符了，那不是万事大吉了吗？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e常见问题\x3c\/h3\x3e\n\x3cp\x3e考虑一个常用的前端场景——输入框，通常会规定最大输入字数。尝试输出上面的符号长度, 发现长度是2。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992423?w=182\x26amp;h=78\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992423?w=182\x26amp;h=78\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这与我们的认知有点不同，我们通常认为一个表情符号也是一个字符，长度为1。而如果通过\x22xxx\x22.length 来判断字符串长度显然是不够准确的。这个问题在ES6中能迎刃而解：\x3c\/p\x3e\n\x3cp\x3eES6中通过Array.from能准确读取字符长度\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992424?w=273\x26amp;h=83\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992424?w=273\x26amp;h=83\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然而Array.from不是完美的，在某些场景下也无法满足需求，况且还存在ES6的浏览器兼容性问题。\x3c\/p\x3e\n\x3cp\x3e在ES5中，我们通过正则的判断，也能得到Array.from的效果，而且扩展性更高：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var regexAstralSymbols = \/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]\/g;\n\nfunction countSymbols(string) {\n    return string\n        \/\/ 替换掉辅助平面的连字符\n        .replace(regexAstralSymbols, \x27_\x27)\n        .length;\n}\n\ncountSymbols(\x27\\uD835\\uDC00\x27); \/\/1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e regexAstralSymbols = \x3cspan class=\x22hljs-regexp\x22\x3e\/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]\/g\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecountSymbols\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e string\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 替换掉辅助平面的连字符\x3c\/span\x3e\n        .replace(regexAstralSymbols, \x3cspan class=\x22hljs-string\x22\x3e\x27_\x27\x3c\/span\x3e)\n        .length;\n}\n\ncountSymbols(\x3cspan class=\x22hljs-string\x22\x3e\x27\\uD835\\uDC00\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e另外\x3c\/strong\x3e，JavaScript也提供了从码点到字符的转换函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/这里直接输入进制数0x0061或97，而不是字符串\nString.fromCharCode(0x0061); \/\/a\n\/\/输出为10进制数\n\x27a\x27.charCodeAt(0);\/\/97 (16进制0x0061)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/这里直接输入进制数0x0061或97，而不是字符串\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e.fromCharCode(\x3cspan class=\x22hljs-number\x22\x3e0x0061\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/a\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/输出为10进制数\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e.charCodeAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/97 (16进制0x0061)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而对于附加平面的符号，JavaScript又要跪了, 直接输出低位 U\x2bF4A9的字符，而该字符位于Unicode的私用区，未定义，所以输出\x27\x27。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22String.fromCharCode(0x1F4A9);\/\/\x27\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e.fromCharCode(\x3cspan class=\x22hljs-number\x22\x3e0x1F4A9\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/\x27\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992425?w=170\x26amp;h=39\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992425?w=170\x26amp;h=39\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e同样的，我们将符号U\x2b1F4A9变为高地位输入，就能成功输出\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992415?w=39\x26amp;h=17\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e符号\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992426?w=285\x26amp;h=38\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992426?w=285\x26amp;h=38\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e对于fromCharCode和charCodeAr这两个方法，ES6 也提供了新的接口，对应fromCodePoint和codePointAt，问题得到解决：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992427?w=245\x26amp;h=42\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992427?w=245\x26amp;h=42\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007992428?w=180\x26amp;h=44\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007992428?w=180\x26amp;h=44\x22 alt=\x22roadmap.path\x22 title=\x22roadmap.path\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在处理字符串逆转，正则的匹配上，附加字符都会有问题，要处理这些问题，只有一条准则，就是要对附加码点做特殊处理。在ES6还没全面支持的情况下，只能通过定义各种hack方法来解决。\x3c\/p\x3e\n\x3cp\x3e关于Unicode跟JavaScript的纠葛就讲到这，乱码问题让人费解，但是只要了解了基本原理，问题往往就能迎刃而解。\x3c\/p\x3e\n\x3cp\x3e参考文章：\x3cbr\x3e\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/zh.wikipedia.org\/wiki\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/mathiasbynens.be\/notes\/javascript-unicode\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/mathiasbynens.be\/note...\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2014\/12\/unicode.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blo...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>细说Unicode(二) Unicode与JavaScript的纠葛</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007992410">https://segmentfault.com/a/1190000007992410</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/yyqhgqfit9r/" target="_blank">https://alili.tech/archive/yyqhgqfit9r/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/z09muaar7j/">2年前端应该会哪些技能<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/ke982v6qrfg/">CSS 性能优化笔记<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/if1i2hs28ah/">H5打造3d场景不完全攻略（二）: Amazing CSS3D<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/s4apghsr7o/">JS原生一步步实现前端路由和单页面应用<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/hjgkntbgqek/">JavaScript 中对大量数据的多重过滤<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/h1hfvr2a2nj/">JavaScript 中的错误处理机制<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/a0ukpm125gm/">JavaScript 数组分组的实现<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/fwosouhbhmj/">JavaScript 类型转换深度学习<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/z193p9xv2p/">JavaScript设计模式之发布-订阅模式（观察者模式）-Part1<aside class="dates">2019-02-01</aside></a></li><li><a href="/archive/6i7sr0vgkxm/">Javascript中的时间<aside class="dates">2019-02-01</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>