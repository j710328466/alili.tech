<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="40 行代码内实现一个 React.js"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>40 行代码内实现一个 React.js | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4ns5cwxsi05/",
				"appid": "1613049289050283", 
				"title": "40 行代码内实现一个 React.js | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-26T02:30:18"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/imbao5um82/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/zsxxn0n7jj/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&text=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&text=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&title=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&is_video=false&description=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&title=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&title=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&title=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ns5cwxsi05%2f&title=40%20%e8%a1%8c%e4%bb%a3%e7%a0%81%e5%86%85%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%20React.js"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">40 行代码内实现一个 React.js</h1><div class="meta"><div class="postdate"><time datetime="2019-01-26" itemprop="datePublished">2019-01-26</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e作者：\x3ca href=\x22https:\/\/www.zhihu.com\/people\/hu-zi-da-ha\/activities\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e胡子大哈\x3c\/a\x3e\x3cbr\x3e原文链接：\x3ca href=\x22http:\/\/huziketang.com\/blog\/posts\/detail?postId=58aea515204d50674934c3ac\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/huziketang.com\/blog\/posts\/detail?postId=58aea515204d50674934c3ac\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e转载请注明出处，保留原文链接和作者信息。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e目录\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e1 前言\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e2 一切从点赞说起\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e3 实现可复用性\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e3.1 结构复用\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e3.2 生成 DOM 元素并且添加事件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e4 为什么不暴力一点？\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e4.1 状态改变 -\x26gt; 构建新的 DOM 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e4.2 重新插入新的 DOM 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e5 抽象出 Component 类\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e6 总结\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e1 前言\x3c\/h2\x3e\n\x3cp\x3e本文会教你如何在 50 行代码内，不依赖任何第三方的库，用纯 JavaScript 实现一个 React.js 。\x3c\/p\x3e\n\x3cp\x3e本文的目的是：揭开对初学者看起来很很难理解的 React.js 的组件化形式的外衣，让你有更多的精力和注意力去学习 React.js 精髓的地方。如果你刚开始学习 React.js 并且感觉很迷茫，那么看完这篇文章以后就能够解除一些疑惑。\x3c\/p\x3e\n\x3cp\x3e另外注意，本文所实现的代码只用于说明教学展示，并不适用于生产环境。代码托管这个 \x3ca href=\x22https:\/\/github.com\/huzidaha\/reactjs-in-40\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e仓库\x3c\/a\x3e  。心急如焚的同学可以先去看代码，但本文会从最基础的内容开始解释。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e2 一切从点赞说起\x3c\/h2\x3e\n\x3cp\x3e接下来所有的代码都会从一个基本的点赞功能开始演化，你会逐渐看到，文章代码慢慢地越来越像 React.js 的组件代码。而在这个过程里面，大家需要只需要跟着文章的思路，就可以在代码的演化当中体会到组件化形式。\x3c\/p\x3e\n\x3cp\x3e假设现在我们需要实现一个点赞、取消点赞的功能。\x3c\/p\x3e\n\x3cp\x3e[image:B4B41FF2-519A-4A7C-8035-0D5CD4EE8FFA-86900-00013723B2CAE361\/8D274601-162D-4B36-B1E0-9C65FB0C494F.png]\x3c\/p\x3e\n\x3cp\x3e如果你对前端稍微有一点了解，你就顺手拈来：\x3c\/p\x3e\n\x3cp\x3eHTML:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x3cbody\x3e\n    \x3cdiv class=\x27wrapper\x27\x3e\n      \x3cbutton class=\x27like-btn\x27\x3e\n        \x3cspan class=\x27like-text\x27\x3e点赞\x3c\/span\x3e\n        \x3cspan\x3e?\x3c\/span\x3e\n      \x3c\/button\x3e\n    \x3c\/div\x3e\n  \x3c\/body\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27wrapper\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27like-btn\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27like-text\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e点赞\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e?\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了现实当中的实际情况，所以这里特易把这个 \x3ccode\x3ebutton\x3c\/code\x3e 的 HTML 结构搞得稍微复杂一些。有了这个 HTML 结构，现在就给它加入一些 JavaScript 的行为：\x3c\/p\x3e\n\x3cp\x3eJavaScript：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const button = document.querySelector(\x27.like-btn\x27)\n  const buttonText = button.querySelector(\x27.like-text\x27)\n  let isLiked = false\n  button.addEventListener(\x27click\x27, function () {\n    isLiked = !isLiked\n    if (isLiked) {\n      buttonText.innerHTML = \x27取消\x27\n    } else {\n      buttonText.innerHTML = \x27点赞\x27\n    }\n  }, false)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e  const \x3cspan class=\x22hljs-selector-tag\x22\x3ebutton\x3c\/span\x3e = document.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.like-btn\x27\x3c\/span\x3e)\n  const buttonText = \x3cspan class=\x22hljs-selector-tag\x22\x3ebutton\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.like-text\x27\x3c\/span\x3e)\n  let isLiked = false\n  \x3cspan class=\x22hljs-selector-tag\x22\x3ebutton\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, function () {\n    isLiked = !isLiked\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isLiked) {\n      buttonText\x3cspan class=\x22hljs-selector-class\x22\x3e.innerHTML\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27取消\x27\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      buttonText\x3cspan class=\x22hljs-selector-class\x22\x3e.innerHTML\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27点赞\x27\x3c\/span\x3e\n    }\n  }, false)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e功能和实现都很简单，按钮已经可以提供点赞和取消点赞的功能。这时候你的同事跑过来了，说他很喜欢你的按钮，他也想用你写的这个点赞功能。你就会发现这种实现方式很致命：你的同事要把整个  \x3ccode\x3ebutton\x3c\/code\x3e  和里面的结构复制过去，还有整段 JavaScript 代码也要复制过去。这样的实现方式没有任何可复用性。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e3 实现可复用性\x3c\/h2\x3e\n\x3cp\x3e所以现在我们来想办法解决这个问题，让这个点赞功能具有较好的可复用的效果，那么你的同事们就可以轻松自在地使用这个点赞功能。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e3.1 结构复用\x3c\/h3\x3e\n\x3cp\x3e现在我们来重新编写这个点赞功能。这次我们先写一个类，这个类有 render 方法，这个方法里面直接返回一个表示 HTML 结构的字符串：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class LikeButton {\n    render () {\n      return `\n        \x3cbutton id=\x27like-btn\x27\x3e\n          \x3cspan class=\x27like-text\x27\x3e赞\x3c\/span\x3e\n          \x3cspan\x3e?\x3c\/span\x3e\n        \x3c\/button\x3e\n      `\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLikeButton\x3c\/span\x3e {\x3c\/span\x3e\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e `\x3cspan class=\x22javascript\x22\x3e\n        \x26lt;button id=\x3cspan class=\x22hljs-string\x22\x3e\x27like-btn\x27\x3c\/span\x3e\x26gt;\n          \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27like-text\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e赞\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n          \x26lt;span\x26gt;?\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n        \x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/button\x26gt;\n      \x3c\/span\x3e\x3c\/span\x3e`\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后可以用这个类来构建不同的点赞功能的实例，然后把它们插到页面中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const wrapper = document.querySelector(\x27.wrapper\x27)\n  const likeButton1 = new LikeButton()\n  wrapper.innerHTML = likeButton1.render()\n  \n  const likeButton2 = new LikeButton()\n  wrapper.innerHTML \x2b= likeButton2.render()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.wrapper\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e likeButton1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e LikeButton()\n  wrapper.innerHTML = likeButton1.render()\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e likeButton2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e LikeButton()\n  wrapper.innerHTML \x2b= likeButton2.render()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e[image:4AEFC6B6-F913-440E-9306-CCC454A7A30C-87312-00013B98FB6F8354\/4555573C-8435-4079-9D64-C76913AB6E40.png]\x3c\/p\x3e\n\x3cp\x3e这里非常暴力地使用了 innerHTML ，把两个按钮粗鲁地插入了 wrapper 当中。虽然你可能会对这种实现方式非常不满意，但我们还是勉强了实现了结构的复用。我们后面再来优化它。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3.2 生成 DOM 元素并且添加事件\x3c\/h3\x3e\n\x3cp\x3e你一定会发现，现在的按钮是死的，你点击它它根本不会有什么反应。因为根本没有往上面添加事件。但是问题来了，\x3ccode\x3eLikeButton\x3c\/code\x3e  类里面是虽然说有一个  \x3ccode\x3ebutton\x3c\/code\x3e，但是这玩意根本就是在字符串里面的。你怎么能往一个字符串里面添加事件呢？DOM 事件的 API 只有 DOM 结构才能用。\x3c\/p\x3e\n\x3cp\x3e我们需要 DOM 结构，准确地来说：\x3cem\x3e我们需要这个点赞功能的 HTML 字符串代表的 DOM 结构\x3c\/em\x3e。假设我们现在有一个函数  \x3ccode\x3ecreateDOMFromString\x3c\/code\x3e ，你往这个函数传入 HTML 字符串，但是它会把相应的 DOM 元素返回给你。这个问题就可以额解决了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ ::String =\x3e ::Document\nconst createDOMFromString = (domString) =\x3e {\n  \/\/ TODO \n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ::String =\x26gt; ::Document\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e createDOMFromString = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edomString\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ TODO \x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e先不用管这个函数应该怎么实现，先知道它是干嘛的。拿来用就好，这时候用它来改写一下 \x3ccode\x3eLikeButton\x3c\/code\x3e 类：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class LikeButton {\n    render () {\n      this.el = createDOMFromString(`\n        \x3cbutton class=\x27like-button\x27\x3e\n          \x3cspan class=\x27like-text\x27\x3e点赞\x3c\/span\x3e\n          \x3cspan\x3e?\x3c\/span\x3e\n        \x3c\/button\x3e\n      `)\n      this.el.addEventListener(\x27click\x27, () =\x3e console.log(\x27click\x27), false)\n      return this.el\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLikeButton\x3c\/span\x3e {\x3c\/span\x3e\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = createDOMFromString(`\x3cspan class=\x22javascript\x22\x3e\n        \x26lt;button \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27like-button\x27\x3c\/span\x3e\x26gt;\n          \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27like-text\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e点赞\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n          \x26lt;span\x26gt;?\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n        \x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/button\x26gt;\n      \x3c\/span\x3e\x3c\/span\x3e`)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在  \x3ccode\x3erender()\x3c\/code\x3e 返回的不是一个 html 字符串了，而是一个由这个 html 字符串所生成的 DOM。在返回 DOM 元素之前会先给这个 DOM 元素上添加事件在返回。\x3c\/p\x3e\n\x3cp\x3e因为现在 \x3ccode\x3erender\x3c\/code\x3e 返回的是 DOM 元素，所以不能用 \x3ccode\x3einnerHTML\x3c\/code\x3e 暴力地插入 wrapper。而是要用 DOM API 插进去。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const wrapper = document.querySelector(\x27.wrapper\x27)\n\n  const likeButton1 = new LikeButton()\n  wrapper.appendChild(likeButton1.render())\n\n  const likeButton2 = new LikeButton()\n  wrapper.appendChild(likeButton2.render())\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.wrapper\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e likeButton1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e LikeButton()\n  wrapper.appendChild(likeButton1.render())\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e likeButton2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e LikeButton()\n  wrapper.appendChild(likeButton2.render())\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在你点击这两个按钮，每个按钮都会在控制台打印 \x3ccode\x3eclick\x3c\/code\x3e，说明事件绑定成功了。但是按钮上的文本还是没有发生改变，只要稍微改动一下 \x3ccode\x3eLikeButton\x3c\/code\x3e 的代码就可以完成完整的功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class LikeButton {\n    constructor () {\n      this.state = { isLiked: false }\n    }\n\n    changeLikeText () {\n      const likeText = this.el.querySelector(\x27.like-text\x27)\n      this.state.isLiked = !this.state.isLiked\n      if (this.state.isLiked) {\n        likeText.innerHTML = \x27取消\x27\n      } else {\n        likeText.innerHTML = \x27点赞\x27\n      }\n    }\n\n    render () {\n      this.el = createDOMFromString(`\n        \x3cbutton class=\x27like-button\x27\x3e\n          \x3cspan class=\x27like-text\x27\x3e点赞\x3c\/span\x3e\n          \x3cspan\x3e?\x3c\/span\x3e\n        \x3c\/button\x3e\n      `)\n      this.el.addEventListener(\x27click\x27, this.changeLikeText.bind(this), false)\n      return this.el\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLikeButton\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { isLiked: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n    }\n\n    changeLikeText () {\n      const likeText = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.like-text\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked = !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked) {\n        likeText.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27取消\x27\x3c\/span\x3e\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        likeText.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27点赞\x27\x3c\/span\x3e\n      }\n    }\n\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = createDOMFromString(`\n        \x26lt;button \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x27\x3cspan class=\x22hljs-title\x22\x3elike\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ebutton\x3c\/span\x3e\x27\x26gt;\x3c\/span\x3e\n          \x26lt;span \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x27\x3cspan class=\x22hljs-title\x22\x3elike\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3etext\x3c\/span\x3e\x27\x26gt;点赞\x26lt;\x3cspan class=\x22hljs-type\x22\x3e\/span\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x26lt;span\x26gt;?\x26lt;\/span\x26gt;\n        \x26lt;\/button\x26gt;\n      `)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.changeLikeText.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e), \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的代码稍微长了一些，但是还是很好理解。只不过是在给 \x3ccode\x3eLikeButton\x3c\/code\x3e 类添加了构造函数，这个构造函数会给每一个 \x3ccode\x3eLikeButton\x3c\/code\x3e 的实例添加一个对象 \x3ccode\x3estate\x3c\/code\x3e，\x3ccode\x3estate\x3c\/code\x3e 里面保存了每个按钮自己是否点赞的状态。还改写了原来的事件绑定函数：原来只打印  \x3ccode\x3eclick\x3c\/code\x3e，现在点击的按钮的时候会调用  \x3ccode\x3echangeLikeText\x3c\/code\x3e 方法，这个方法会根据 \x3ccode\x3ethis.state\x3c\/code\x3e 的状态改变点赞按钮的文本。\x3c\/p\x3e\n\x3cp\x3e如果你现在还能跟得上文章的思路，那么你留意下，现在的代码已经和 React.js 的组件代码有点类似了。但其实我们根本没有讲 React.js 的任何内容，我们一心一意只想怎么做好“组件化”。\x3c\/p\x3e\n\x3cp\x3e现在这个组件的可复用性已经很不错了，你的同事们只要实例化一下然后插入到 DOM 里面去就好了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e4 为什么不暴力一点？\x3c\/h2\x3e\n\x3cp\x3e仔细留意一下  \x3ccode\x3echangeLikeText\x3c\/code\x3e 函数，这个函数包含了 DOM 操作，现在看起来比较简单，那是因为现在只有 \x3ccode\x3eisLiked\x3c\/code\x3e 一个状态。但想一下，因为你的数据状态改变了你就需要去更新页面的内容，所以如果你的组件包含了很多状态，那么你的组件基本全部都是 DOM 操作。一个组件包含很多状态的情况非常常见，所以这里还有优化的空间：如何尽量减少这种手动 DOM 操作？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e4.1 状态改变 -\x26gt; 构建新的 DOM 元素\x3c\/h3\x3e\n\x3cp\x3e这里要提出的一种解决方案：\x3cem\x3e一旦状态发生改变，就重新调用  \x3ccode\x3erender\x3c\/code\x3e  方法，构建一个新的 DOM 元素\x3c\/em\x3e。这样做的好处是什么呢？好处就是你可以在 \x3ccode\x3erender\x3c\/code\x3e 方法里面使用最新的 \x3ccode\x3ethis.state\x3c\/code\x3e 来构造不同 HTML 结构的字符串，并且通过这个字符串构造不同的 DOM 元素。页面就更新了！听起来有点绕，看看代码怎么写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class LikeButton {\n    constructor () {\n      this.state = { isLiked: false }\n    }\n\n    setState (state) {\n      this.state = state\n      this.el = this.render()\n    }\n\n    changeLikeText () {\n      this.setState({\n        isLiked: !this.state.isLiked\n      })\n    }\n\n    render () {\n      this.el = createDOMFromString(`\n        \x3cbutton class=\x27like-btn\x27\x3e\n          \x3cspan class=\x27like-text\x27\x3e${this.state.isLiked ? \x27取消\x27 : \x27点赞\x27}\x3c\/span\x3e\n          \x3cspan\x3e?\x3c\/span\x3e\n        \x3c\/button\x3e\n      `)\n      this.el.addEventListener(\x27click\x27, this.changeLikeText.bind(this), false)\n      return this.el\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLikeButton\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { isLiked: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n    }\n\n    setState (state) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = state\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.render()\n    }\n\n    changeLikeText () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n        isLiked: !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked\n      })\n    }\n\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = createDOMFromString(`\n        \x26lt;button \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x27\x3cspan class=\x22hljs-title\x22\x3elike\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ebtn\x3c\/span\x3e\x27\x26gt;\x3c\/span\x3e\n          \x26lt;span \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x27\x3cspan class=\x22hljs-title\x22\x3elike\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3etext\x3c\/span\x3e\x27\x26gt;$\x3c\/span\x3e{\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked ? \x3cspan class=\x22hljs-string\x22\x3e\x27取消\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27点赞\x27\x3c\/span\x3e}\x26lt;\/span\x26gt;\n          \x26lt;span\x26gt;?\x26lt;\/span\x26gt;\n        \x26lt;\/button\x26gt;\n      `)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.changeLikeText.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e), \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其实只是改了几个小地方：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erender\x3c\/code\x3e 函数里面的 HTML 字符串会根据 \x3ccode\x3ethis.state\x3c\/code\x3e 不同而不同（这里是用了 ES6 的字符串特性，做这种事情很方便）。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e新增一个 \x3ccode\x3esetState\x3c\/code\x3e 函数，这个函数接受一个对象作为参数；它会设置实例的 \x3ccode\x3estate\x3c\/code\x3e，然后重新调用一下 \x3ccode\x3erender\x3c\/code\x3e 方法。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当用户点击按钮的时候， \x3ccode\x3echangeLikeText\x3c\/code\x3e  会构建新的 \x3ccode\x3estate\x3c\/code\x3e 对象，这个新的 \x3ccode\x3estate\x3c\/code\x3e ，传入 \x3ccode\x3esetState\x3c\/code\x3e 函数当中。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这样的结果就是，用户每次点击，\x3ccode\x3echangeLikeText\x3c\/code\x3e 都会调用改变组件状态然后调用 \x3ccode\x3esetState\x3c\/code\x3e ；\x3ccode\x3esetState\x3c\/code\x3e 会调用 \x3ccode\x3erender\x3c\/code\x3e 方法重新构建新的 DOM 元素；\x3ccode\x3erender\x3c\/code\x3e 方法会根据  \x3ccode\x3estate\x3c\/code\x3e 的不同构建不同的 DOM 元素。\x3c\/p\x3e\n\x3cp\x3e也就是说，你只要调用 \x3ccode\x3esetState\x3c\/code\x3e，组件就会重新渲染。我们顺利地消除了没必要的 DOM 操作。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e4.2 重新插入新的 DOM 元素\x3c\/h3\x3e\n\x3cp\x3e上面的改进不会有什么效果，因为你仔细看一下就会发现，其实重新渲染的 DOM 元素并没有插入到页面当中。所以这个组件之外，你需要知道这个组件发生了改变，并且把新的 DOM 元素更新到页面当中。\x3c\/p\x3e\n\x3cp\x3e重新修改一下 \x3ccode\x3esetState\x3c\/code\x3e 方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\n    setState (state) {\n        const oldEl = this.el\n      this.state = state\n      this.el = this.render()\n        if (this.onStateChange) this.onStateChange(oldEl, this.el)\n    }\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e...\n    \x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eState (\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e) {\n        const oldEl = this.el\n      this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e\n      this.el = this.render()\n        if (this.\x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eStateChange) this.\x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eStateChange(oldEl, this.el)\n    }\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用这个组件的时候：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const likeButton = new LikeButton()\nwrapper.appendChild(likeButton.render()) \/\/ 第一次插入 DOM 元素\ncomponent.onStateChange = (oldEl, newEl) =\x3e {\n  wrapper.insertBefore(newEl, oldEl) \/\/ 插入新的元素\n  wrapper.removeChild(oldEl) \/\/ 删除旧的元素\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3econst likeButton = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eLikeButton\x3c\/span\x3e()\nwrapper.appendChild(likeButton.render()) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第一次插入 DOM 元素\x3c\/span\x3e\ncomponent.onStateChange = (oldEl, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eEl\x3c\/span\x3e) =\x26gt; {\n  wrapper.insertBefore(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eEl\x3c\/span\x3e, oldEl) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 插入新的元素\x3c\/span\x3e\n  wrapper.removeChild(oldEl) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除旧的元素\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里每次 \x3ccode\x3esetState\x3c\/code\x3e 都会调用 \x3ccode\x3eonStateChange\x3c\/code\x3e 方法，而这个方法是实例化以后时候被设置的，所以你可以自定义 \x3ccode\x3eonStateChange\x3c\/code\x3e 的行为。\x3cem\x3e这里做的事是，每当 \x3ccode\x3esetState\x3c\/code\x3e 的时候，就会把插入新的 DOM 元素，然后删除旧的元素，页面就更新了\x3c\/em\x3e。这里已经做到了进一步的优化了：现在不需要再手动更新页面了。\x3c\/p\x3e\n\x3cp\x3e非一般的暴力。不过没有关系，这种暴力行为可以被 Virtual-DOM 的 diff 策略规避掉，但这不是本文章所讨论的范围。\x3c\/p\x3e\n\x3cp\x3e这个版本的点赞功能很不错，我可以继续往上面加功能，而且还不需要手动操作DOM。但是有一个不好的地方，如果我要重新另外做一个新组件，譬如说评论组件，那么里面的这些 \x3ccode\x3esetState\x3c\/code\x3e 方法要重新写一遍，其实这些东西都可以抽出来。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e5 抽象出 Component 类\x3c\/h2\x3e\n\x3cp\x3e为了让代码更灵活，可以写更多的组件，我把这种模式抽象出来，放到一个 Component 类当中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class Component {\n    constructor (props = {}) {\n      this.props = props\n    }\n\n    setState (state) {\n      const oldEl = this.el\n      this.state = state\n      this.el = this.renderDOM()\n      if (this.onStateChange) this.onStateChange(oldEl, this.el)\n    }\n\n    renderDOM () {\n      this.el = createDOMFromString(this.render())\n      if (this.onClick) {\n        this.el.addEventListener(\x27click\x27, this.onClick.bind(this), false)\n      }\n      return this.el\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e (props = {}) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props = props\n    }\n\n    setState (state) {\n      const oldEl = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = state\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.renderDOM()\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange) \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange(oldEl, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el)\n    }\n\n    renderDOM () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el = createDOMFromString(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.render())\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onClick) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onClick.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e), \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e还有一个额外的  \x3ccode\x3emount\x3c\/code\x3e  的方法，其实就是把组件的 DOM 元素插入页面，并且在 \x3ccode\x3esetState\x3c\/code\x3e 的时候更新页面：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const mount = (wrapper, component) =\x3e {\n    wrapper.appendChild(component.renderDOM())\n    component.onStateChange = (oldEl, newEl) =\x3e {\n      wrapper.insertBefore(newEl, oldEl)\n      wrapper.removeChild(oldEl)\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e  const mount = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(wrapper, component)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    wrapper.appendChild(component.renderDOM())\n    component.onStateChange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(oldEl, newEl)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      wrapper.insertBefore(newEl, oldEl)\n      wrapper.removeChild(oldEl)\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样的话我们重新写点赞组件就会变成：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class LikeButton extends Component {\n    constructor (props) {\n      super(props)\n      this.state = { isLiked: false }\n    }\n\n    onClick () {\n      this.setState({\n        isLiked: !this.state.isLiked\n      })\n    }\n\n    render () {\n      return `\n        \x3cbutton class=\x27like-btn\x27\x3e\n          \x3cspan class=\x27like-text\x27\x3e${this.props.word || \x27\x27} ${this.state.isLiked ? \x27取消\x27 : \x27点赞\x27}\x3c\/span\x3e\n          \x3cspan\x3e?\x3c\/span\x3e\n        \x3c\/button\x3e\n      `\n    }\n  }\n\n  mount(wrapper, new LikeButton({ word: \x27hello\x27 }))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLikeButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    constructor (props) {\n      \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { isLiked: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n    }\n\n    onClick () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n        isLiked: !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked\n      })\n    }\n\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e `\n        \x26lt;button \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-symbol\x22\x3e\x27like\x3c\/span\x3e-btn\x27\x26gt;\n          \x26lt;span \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-symbol\x22\x3e\x27like\x3c\/span\x3e-text\x27\x26gt;${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.word || \x27\x27} ${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.isLiked ? \x27取消\x27 : \x27点赞\x27}\x26lt;\/span\x26gt;\n          \x26lt;span\x26gt;?\x26lt;\/span\x26gt;\n        \x26lt;\/button\x26gt;\n      `\n    }\n  }\n\n  mount(wrapper, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eLikeButton\x3c\/span\x3e({ word: \x3cspan class=\x22hljs-symbol\x22\x3e\x27hell\x3c\/span\x3eo\x27 }))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有没有发现你写的代码已经和 React.js 的组件写法很相似了？而且还是可以正常运作的代码，而且我们从头到尾都是用纯的 JavaScript，没有依赖任何第三方库。（注意这里加入了上面没有提到过点  \x3ccode\x3eprops\x3c\/code\x3e，可以给组件传入配置属性，跟 React.js 一样）。\x3c\/p\x3e\n\x3cp\x3e只要有了上面那个 \x3ccode\x3eComponent\x3c\/code\x3e 类和 \x3ccode\x3emount\x3c\/code\x3e 方法加起来不足40行代码就可以做到组件化。如果我们需要写另外一个组件，只需要像上面那样，简单地继承一下  \x3ccode\x3eComponent\x3c\/code\x3e 类就好了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  class RedBlueButton extends Component {\n    constructor (props) {\n      super(props)\n      this.state = {\n        color: \x27red\x27\n      }\n    }\n\n    onClick () {\n      this.setState({\n        color: \x27blue\x27\n      })\n    }\n\n    render () {\n      return `\n        \x3cdiv style=\x27color: ${this.state.color};\x27\x3e${this.state.color}\x3c\/div\x3e\n      `\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eRedBlueButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    constructor (props) {\n      \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n        color: \x3cspan class=\x22hljs-symbol\x22\x3e\x27re\x3c\/span\x3ed\x27\n      }\n    }\n\n    onClick () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n        color: \x3cspan class=\x22hljs-symbol\x22\x3e\x27blu\x3c\/span\x3ee\x27\n      })\n    }\n\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e `\n        \x26lt;div style=\x3cspan class=\x22hljs-symbol\x22\x3e\x27color\x3c\/span\x3e: ${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.color};\x27\x26gt;${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.color}\x26lt;\/div\x26gt;\n      `\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单好用，完整的代码可以在这里找到： \x3ca href=\x22https:\/\/github.com\/huzidaha\/reactjs-in-40\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e仓库\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e噢，忘了，还有一个神秘的 \x3ccode\x3ecreateDOMFromString\x3c\/code\x3e，其实它更简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const createDOMFromString = (domString) =\x3e {\n    const div = document.createElement(\x27div\x27)\n    div.innerHTML = domString\n    return div\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e  const createDOMFromString = (domString) =\x26gt; {\n    const \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e = document.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.innerHTML\x3c\/span\x3e = domString\n    return \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e6 总结\x3c\/h2\x3e\n\x3cp\x3e你到底从文章能从文章中获取到什么？\x3c\/p\x3e\n\x3cp\x3e好吧，我承认我标题党了，这个 40 行不到的代码其实是一个残废而且智障版的 React.js，没有 JSX ，没有组件嵌套等等。它只是 React.js 组件化表现形式的一种实现而已。它根本没有触碰到 React.js 的精髓。\x3c\/p\x3e\n\x3cp\x3e其实 React.js 的最最精髓的地方可能就在于它的 Virtual DOM 算法，而它的  \x3ccode\x3esetState\x3c\/code\x3e 、\x3ccode\x3eprops\x3c\/code\x3e 等等都只不过是一种形式，而很多初学者会被它这种形式作迷惑。\x3cem\x3e本篇文章其实就是揭露了这种组件化形式的实现原理。如果你正在学习或者学习 React.js 过程很迷茫，那么看完这篇文章以后就能够解除一些疑惑。\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e本文并没有涉及到 Virtual DOM 的任何内容，有需要的同学可以参考一下这篇\x3ca href=\x22https:\/\/github.com\/livoras\/blog\/issues\/13\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e博客\x3c\/a\x3e ，介绍的很详尽。有兴趣的同学可以把两者结合起来，把 Virtual DOM 替代本文暴力处理的 \x3ccode\x3emount\x3c\/code\x3e 中的实现，真正实现一个 React.js。\x3c\/p\x3e\n\x3cp\x3e如果你对本文的内容有疑惑，可以关注我的\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/qianduandaha\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e知乎专栏\x3c\/a\x3e并且评论或者给我知乎发私信。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e我最近正在写一本\x3ca href=\x22http:\/\/huziketang.com\/books\/react\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《React.js 小书》\x3c\/a\x3e，对 React.js 感兴趣的童鞋，\x3ca href=\x22http:\/\/huziketang.com\/books\/react\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e欢迎指点\x3c\/a\x3e。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>40 行代码内实现一个 React.js</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008472941">https://segmentfault.com/a/1190000008472941</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4ns5cwxsi05/" target="_blank">https://alili.tech/archive/4ns5cwxsi05/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/lfmj4xr00e/">2016年终总结--前端生涯从0到1的过程<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/ukfvl3yzohq/">ES6新语法疑点简析<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/adal5cm5rlr/">Icon 进化史<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/xwquh4g09bl/">JS 中 TDZ 的理解<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/13j072ppoyf/">Javascript 中 Y 组合子的推导<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/kn3l7fwd55/">Redux story-1:who creates it?<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/9gngp6sg77/">Redux概念之二: Redux的三大原则<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/ktc291v9lq/">V8 Object 内存结构与属性访问详解<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/62hk7sdq93k/">Vue&#43;MySQL&#43;Express小试牛刀<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/q9tzlra5qaj/">Vue2.0简易案例<aside class="dates">2019-01-27</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>