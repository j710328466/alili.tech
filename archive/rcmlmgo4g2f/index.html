<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="构建一个自定义 angular2 输入组件"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>构建一个自定义 angular2 输入组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/rcmlmgo4g2f/",
				"appid": "1613049289050283", 
				"title": "构建一个自定义 angular2 输入组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-31T02:31:16"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xxz347l8ci/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bwe6h0cryeg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&text=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&text=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&title=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&is_video=false&description=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&title=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&title=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&title=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frcmlmgo4g2f%2f&title=%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ae%9a%e4%b9%89%20angular2%20%e8%be%93%e5%85%a5%e7%bb%84%e4%bb%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">构建一个自定义 angular2 输入组件</h1><div class="meta"><div class="postdate"><time datetime="2019-01-31" itemprop="datePublished">2019-01-31</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e构建一个自定义 angular2 输入组件\x3c\/h2\x3e\n\x3cp\x3e今天我们来学习如何正确的构建和一个具有和 \x3ccode\x3e\x26lt;input type=\x22text\x22\x26gt;\x3c\/code\x3e 同样作用，但同时也具有自己的逻辑的输入组件。\x3c\/p\x3e\n\x3cp\x3e在读这篇文章之前，希望你已经把官方的文档和案例都看过至少一遍了，具体的一些概念和细节不会在文章中讲解。\x3c\/p\x3e\n\x3cp\x3e我们先来看一下我们这篇文章里面所介绍的组件的表现形式是怎么样的：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVF4gi?w=480\x26amp;h=789\x22 src=\x22https:\/\/static.alili.tech\/img\/bVF4gi?w=480\x26amp;h=789\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eOK，上图就是我们所要达到的效果了。那么，我们来分析下我们这个组件该具备哪些功能。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e聚焦的时候，底部边框为绿色\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e具有自己的部分逻辑，比如在有输入值的情况下，会出现一个删除图标\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当输入值为空的时候，提示错误文案\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e可以插入其它的 DOM，比如最下面的发送验证码按钮\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e支持 \x3ccode\x3einput\x3c\/code\x3e 的必要属性，比如 \x3ccode\x3emaxlength、placeholder\x3c\/code\x3e等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e支持表单 \x3ccode\x3eangular2 form-control\x3c\/code\x3e 表单绑定，如上图中的值都是从 \x3ccode\x3eFormBuilder\x3c\/code\x3e 中构建的\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们将在后面一步步的来讲解如何实现这样一个自定义组件的功能；\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e创建一个 angular2 组件\x3c\/h2\x3e\n\x3cp\x3e我们先来构建一个基础的 \x3ccode\x3eangular2\x3c\/code\x3e 组件,这里我们先新建一个叫做 \x3ccode\x3einput-control\x3c\/code\x3e 的组件。\x3c\/p\x3e\n\x3cp\x3e首先是 \x3ccode\x3einput-control.component.ts\x3c\/code\x3e 文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component({\n  selector: \x27input-control\x27,\n  templateUrl: \x27input-control.component.html\x27,\n  styleUrls: [\x27input-control.component.scss\x27],\n  encapsulation: ViewEncapsulation.None,\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e({\n  selector: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control\x27\x3c\/span\x3e,\n  templateUrl: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.html\x27\x3c\/span\x3e,\n  styleUrls: [\x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.scss\x27\x3c\/span\x3e],\n  encapsulation: ViewEncapsulation.None,\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后是 \x3ccode\x3einput-control.component.html\x3c\/code\x3e 文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput #input\n  [type]=\x26quot;type\x26quot;\n  [name]=\x26quot;name\x26quot;\n  (focus)=\x26quot;_handleFocus($event)\x26quot;\n  (blur)=\x26quot;_handleBlur($event)\x26quot;\n  [placeholder]=\x26quot;placeholder\x26quot;\n  [(ngModel)]=\x26quot;value\x26quot;\n  [minlength]=\x26quot;minlength\x26quot;\n  [maxlength]=\x26quot;maxlength\x26quot;\n  [readonly]=\x26quot;readonly\x26quot;\n  [disabled]=\x26quot;disabled\x26quot;\x3e\n\x3ci #iconDelete *ngIf=\x26quot;focused \x26amp;\x26amp; !readonly\x26quot; class=\x26quot;icon icon-delete\x26quot; (click)=\x26quot;_handleClear($event)\x26quot;\x3e\x3c\/i\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e #\x3cspan class=\x22hljs-attr\x22\x3einput\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22type\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\n  (\x3cspan class=\x22hljs-attr\x22\x3efocus\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleFocus($event)\x22\x3c\/span\x3e\n  (\x3cspan class=\x22hljs-attr\x22\x3eblur\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleBlur($event)\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22placeholder\x22\x3c\/span\x3e\n  [(\x3cspan class=\x22hljs-attr\x22\x3engModel\x3c\/span\x3e)]=\x3cspan class=\x22hljs-string\x22\x3e\x22value\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eminlength\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22minlength\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3emaxlength\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22maxlength\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3ereadonly\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3edisabled\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22disabled\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e #\x3cspan class=\x22hljs-attr\x22\x3eiconDelete\x3c\/span\x3e *\x3cspan class=\x22hljs-attr\x22\x3engIf\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22focused \x26amp;\x26amp; !readonly\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22icon icon-delete\x22\x3c\/span\x3e (\x3cspan class=\x22hljs-attr\x22\x3eclick\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleClear($event)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e剩下就是 \x3ccode\x3einput-control.component.scss\x3c\/code\x3e 文件了，这里我就不贴出代码了，各位可以根据自己的项目来设置对应的样式\x3c\/p\x3e\n\x3cp\x3e最后，就是我们调用的时候的方式:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-control class=\x26quot;input-control\x26quot;\n  [class.error]=\x26quot;!mobile.valid \x26amp;\x26amp; mobile.touched\x26quot;\n  type=\x26quot;tel\x26quot;\n  name=\x26quot;mobile\x26quot;\n  placeholder=\x26quot;手机号\x26quot;\n  maxlength=\x26quot;11\x26quot;\n  [formControl]=\x26quot;mobile\x26quot;\x3e\n  \x3cp *ngIf=\x26quot;mobile.touched \x26amp;\x26amp; mobile.hasError(\x27mobile\x27)\x26quot; class=\x26quot;error-tips\x26quot;\x3e请输入正确的手机号码\x3c\/p\x3e\n\x3c\/input-control\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22input-control\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eclass.error\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22!mobile.valid \x26amp;\x26amp; mobile.touched\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mobile\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22手机号\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3emaxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2211\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eformControl\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22mobile\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e *\x3cspan class=\x22hljs-attr\x22\x3engIf\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mobile.touched \x26amp;\x26amp; mobile.hasError(\x27mobile\x27)\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22error-tips\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e请输入正确的手机号码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是否对于上面的一些属性和变量感到困惑，别急，让我一步步道来！\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e功能细分\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e输入属性 \x3ccode\x3e@Input()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e有一点要谨记：\x3cstrong\x3e我们是在用 DIV 来模拟一个 input 的表现，同时具备自己的逻辑\x3c\/strong\x3e; 所以，当我们需要 \x3ccode\x3einput\x3c\/code\x3e 的对应属性值的时候，我们都需要从父容器传递到组件内部的 \x3ccode\x3einput\x3c\/code\x3e 上面，所以在这里我们需要用到 \x3ccode\x3e@Input\x3c\/code\x3e 特性了\x3c\/p\x3e\n\x3cp\x3e我们在 \x3ccode\x3einput-control.component.ts\x3c\/code\x3e 定义我们所需的一些属性：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component({\n  selector: \x27input-control\x27,\n  templateUrl: \x27input-control.component.html\x27,\n  styleUrls: [\x27input-control.component.scss\x27],\n  host: {\n    \/\/ 宿主元素 click 事件，触发 focus() 事件\n    \x27(click)\x27: \x27focus()\x27,\n    \/\/ 切换宿主元素 focus 样式\n    \x27[class.focus]\x27: \x27focused\x27\n  }\n})\nexport class InputControlComponent {\n  private _focused: boolean = false;\n  private _value: any = \x27\x27;\n  private _disabled: boolean = false;\n  private _readonly: boolean = false;\n  private _required: boolean = false;\n\n  \/\/ 外部传入属性\n  @Input() type: string = \x27text\x27;\n  @Input() name: string = null;\n  @Input() placeholder: string = null;\n  @Input() minlength: number;\n  @Input() maxlength: number;\n\n  \/\/ value 属性，以 get 方式拦截\n  get value(): any {\n    return this._value;\n  };\n\n  @Input() set value(v: any) {\n    v = this._convertValueForInputType(v);\n    if (v !== this._value) {\n      this._value = v;\n      \/\/ 触发值改变事件，冒泡给父级\n      this._onChangeCallback(v);\n    }\n  }\n\n  \/\/ 只读属性\n  get focused() {\n    return this._focused;\n  }\n\n  @Input()\n  get disabled(): boolean {\n    return this._disabled;\n  }\n  set disabled(value) {\n    this._disabled = this._coerceBooleanProperty(value);\n  }\n\n  @Input()\n  get readonly(): boolean {\n    return this._readonly;\n  }\n  set readonly(value) {\n    this._readonly = this._coerceBooleanProperty(value);\n  }\n\n  @Input()\n  get required(): boolean {\n    return this._required;\n  }\n  set required(value) {\n    this._required = this._coerceBooleanProperty(value);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e({\n  selector: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control\x27\x3c\/span\x3e,\n  templateUrl: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.html\x27\x3c\/span\x3e,\n  styleUrls: [\x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.scss\x27\x3c\/span\x3e],\n  host: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 宿主元素 click 事件，触发 focus() 事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27(click)\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focus()\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 切换宿主元素 focus 样式\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27[class.focus]\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focused\x27\x3c\/span\x3e\n  }\n})\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e InputControlComponent {\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _focused: \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _value: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _disabled: \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _readonly: \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _required: \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 外部传入属性\x3c\/span\x3e\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() name: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() placeholder: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() minlength: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() maxlength: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ value 属性，以 get 方式拦截\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e value(): \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._value;\n  };\n\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e() \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e value(v: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e) {\n    v = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._convertValueForInputType(v);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (v !== \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._value) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._value = v;\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发值改变事件，冒泡给父级\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onChangeCallback(v);\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 只读属性\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e focused() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._focused;\n  }\n\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e()\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e disabled(): \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._disabled;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e disabled(value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._disabled = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._coerceBooleanProperty(value);\n  }\n\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e()\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e readonly(): \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._readonly;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e readonly(value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._readonly = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._coerceBooleanProperty(value);\n  }\n\n  \x3cspan class=\x22hljs-meta\x22\x3e@Input\x3c\/span\x3e()\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e required(): \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._required;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e required(value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._required = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._coerceBooleanProperty(value);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e回顾的我们前面的 \x3ccode\x3einput-control.component.html\x3c\/code\x3e 文件，我们定义了 \x3ccode\x3etype\x3c\/code\x3e、\x3ccode\x3ename\x3c\/code\x3e、\x3ccode\x3eplaceholder\x3c\/code\x3e、\x3ccode\x3eminlength\x3c\/code\x3e、\x3ccode\x3emaxlength\x3c\/code\x3e 可读写的属性，同时还有 \x3ccode\x3evalue\x3c\/code\x3e、\x3ccode\x3ereadonly\x3c\/code\x3e、\x3ccode\x3edisabled\x3c\/code\x3e、\x3ccode\x3erequired\x3c\/code\x3e 等只读属性。通过 \x3ccode\x3e[属性]=\x22源\x22\x3c\/code\x3e 方式，接收父级传入的数据。\x3c\/p\x3e\n\x3cp\x3eOK，属性我们都知道如何从父级去接收了，那么接下来我们来实现 \x3cstrong\x3e点击\x3c\/strong\x3e 操作： \x3c\/p\x3e\n\x3cp\x3e我们先修改 \x3ccode\x3einput-control.component.ts\x3c\/code\x3e 文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component({\n  ……\n  host: {\n    \/\/ 宿主元素 click 事件，触发 focus() 事件\n    \x27(click)\x27: \x27focus()\x27,\n    \/\/ 切换宿主元素 focus 样式\n    \x27[class.focus]\x27: \x27focused\x27\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e({\n  ……\n  host: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 宿主元素 click 事件，触发 focus() 事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27(click)\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focus()\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 切换宿主元素 focus 样式\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27[class.focus]\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focused\x27\x3c\/span\x3e\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们利用了 \x3ccode\x3ehost\x3c\/code\x3e 这个属性，用来给宿主元素对应操作，传送门 \x3ca href=\x22https:\/\/angular.cn\/docs\/ts\/latest\/api\/core\/index\/Component-decorator.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@Component 相关属性\x3c\/a\x3e;\x3cbr\x3e我们给宿主元素也就是 \x3ccode\x3e\x26lt;input-control\x26gt;\x26lt;\/input-control\x26gt;\x3c\/code\x3e 绑定了一个 \x3ccode\x3eclick\x3c\/code\x3e 事件，同时根据自身属性 \x3ccode\x3efocused\x3c\/code\x3e 来切换一个 \x3ccode\x3e.focus\x3c\/code\x3e 类。在我们组件的 \x3ccode\x3efocus()\x3c\/code\x3e 事件中，我们需要让组件内部的 \x3ccode\x3einput\x3c\/code\x3e 聚焦，同时切换自身的 \x3ccode\x3efocused\x3c\/code\x3e 值。为了拿到我们组件内部的 \x3ccode\x3einput\x3c\/code\x3e 元素，这里我们需要使用 \x3ccode\x3e@ViewChild()\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e修改 \x3ccode\x3einput-control.component.ts\x3c\/code\x3e 文件如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component({\n  ……\n  host: {\n    \/\/ 宿主元素 click 事件，触发 focus() 事件\n    \x27(click)\x27: \x27focus()\x27,\n    \/\/ 切换宿主元素 focus 样式\n    \x27[class.focus]\x27: \x27focused\x27\n  }\n})\nexport class InputControlComponent {\n  ……\n  ……\n\n  private _focusEmitter: EventEmitter\x3cFocusEvent\x3e = new EventEmitter\x3cFocusEvent\x3e();\n  @ViewChild(\x27input\x27) _inputElement: ElementRef; \/\/ 组件内部 input 元素\n  @ViewChild(\x27iconDelete\x27) iconDelete: ElementRef; \/\/ 删除图标元素\n\n  constructor(private hostRef: ElementRef) {\n  }\n\n  \/\/ 监听全局的点击事件，如果不是当前 input-control 组，则视为失去焦点操作\n  @HostListener(\x27window:click\x27, [\x27$event\x27])\n  inputControlBlurHandler(event) {\n    var parent = event.target;\n    \/\/ 如何当前节点不是宿主节点，并且不等于 document 节点\n    while (parent \x26amp;\x26amp; parent != this.hostRef.nativeElement \x26amp;\x26amp; parent != document) {\n      \/\/ 取当前节点的父节点继续寻找\n      parent = parent.parentNode;\n    }\n\n    \/\/ 找到最顶层，则表示已经不在宿主元素内部了，触发失去焦点 fn\n    if (parent == document) {\n      this._focused = false;\n    }\n  }\n\n  \/\/ 宿主聚焦\n  focus() {\n    \/\/ 触发下面的 _handleFocus() 事件\n    this._inputElement.nativeElement.focus();\n  }\n\n  \/\/ 输入框聚焦\n  _handleFocus(event: FocusEvent) {\n    this._focused = true;\n    this._focusEmitter.emit(event);\n  }\n\n  \/\/ 清空输入值\n  _handleClear() {\n    this.value = \x27\x27;\n    return false;\n  }\n\n  \/\/ 这里触发 blur 操作，但是不改变 this._focused 的值，\n  \/\/ 不然删除图标无法实现它的功能，\n  \/\/设置 this._focused 的值将由上面的 @HostListener(\x27window:click\x27, [\x27$event\x27]) 来处理\n  \/\/ 触发父级的 blur 事件\n  _handleBlur(event: any) {\n    this._onTouchedCallback();\n    this._blurEmitter.emit(event);\n  }\n\n  \/\/ 对外暴露 focus 事件\n  @Output(\x27focus\x27) onFocus = this._focusEmitter.asObservable();\n  ……\n  ……\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e({\n  ……\n  host: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 宿主元素 click 事件，触发 focus() 事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27(click)\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focus()\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 切换宿主元素 focus 样式\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27[class.focus]\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focused\x27\x3c\/span\x3e\n  }\n})\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e InputControlComponent {\n  ……\n  ……\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _focusEmitter: EventEmitter\x26lt;FocusEvent\x26gt; = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e EventEmitter\x26lt;FocusEvent\x26gt;();\n  \x3cspan class=\x22hljs-meta\x22\x3e@ViewChild\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e) _inputElement: ElementRef; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 组件内部 input 元素\x3c\/span\x3e\n  \x3cspan class=\x22hljs-meta\x22\x3e@ViewChild\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27iconDelete\x27\x3c\/span\x3e) iconDelete: ElementRef; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除图标元素\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e hostRef: ElementRef\x3c\/span\x3e) {\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听全局的点击事件，如果不是当前 input-control 组，则视为失去焦点操作\x3c\/span\x3e\n  \x3cspan class=\x22hljs-meta\x22\x3e@HostListener\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27window:click\x27\x3c\/span\x3e, [\x3cspan class=\x22hljs-string\x22\x3e\x27$event\x27\x3c\/span\x3e])\n  inputControlBlurHandler(event) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parent = event.target;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如何当前节点不是宿主节点，并且不等于 document 节点\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (parent \x26amp;\x26amp; parent != \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hostRef.nativeElement \x26amp;\x26amp; parent != \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 取当前节点的父节点继续寻找\x3c\/span\x3e\n      parent = parent.parentNode;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 找到最顶层，则表示已经不在宿主元素内部了，触发失去焦点 fn\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (parent == \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._focused = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 宿主聚焦\x3c\/span\x3e\n  focus() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发下面的 _handleFocus() 事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._inputElement.nativeElement.focus();\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 输入框聚焦\x3c\/span\x3e\n  _handleFocus(event: FocusEvent) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._focused = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._focusEmitter.emit(event);\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 清空输入值\x3c\/span\x3e\n  _handleClear() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里触发 blur 操作，但是不改变 this._focused 的值，\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不然删除图标无法实现它的功能，\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 this._focused 的值将由上面的 @HostListener(\x27window:click\x27, [\x27$event\x27]) 来处理\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发父级的 blur 事件\x3c\/span\x3e\n  _handleBlur(event: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onTouchedCallback();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._blurEmitter.emit(event);\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对外暴露 focus 事件\x3c\/span\x3e\n  \x3cspan class=\x22hljs-meta\x22\x3e@Output\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27focus\x27\x3c\/span\x3e) onFocus = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._focusEmitter.asObservable();\n  ……\n  ……\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的代码中，我们通过宿主的 \x3ccode\x3efocus()\x3c\/code\x3e 事件，让 \x3ccode\x3einput\x3c\/code\x3e 元素 \x3ccode\x3efocus\x3c\/code\x3e, 同时 \x3ccode\x3einput\x3c\/code\x3e 元素聚焦之后，会触发下面的 \x3ccode\x3e_handleFocus()\x3c\/code\x3e 方法，在这个方法里面，我们修改组件自身的 \x3ccode\x3efocused\x3c\/code\x3e 属性，并对外发射一个 \x3ccode\x3efocus\x3c\/code\x3e 事件，用来向父级传递使用。同时，我们的删除图标也是根据组件的 \x3ccode\x3efocused\x3c\/code\x3e 属性切换显示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput #input\n  [type]=\x26quot;type\x26quot;\n  [name]=\x26quot;name\x26quot;\n  (focus)=\x26quot;_handleFocus($event)\x26quot;\n  (blur)=\x26quot;_handleBlur($event)\x26quot;\n  [placeholder]=\x26quot;placeholder\x26quot;\n  [(ngModel)]=\x26quot;value\x26quot;\x3e\n\x3ci #iconDelete \n    *ngIf=\x26quot;focused \x26amp;\x26amp; !readonly\x26quot; \n    class=\x26quot;icon icon-delete\x26quot; \n    (click)=\x26quot;_handleClear($event)\x26quot;\x3e\x3c\/i\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e #\x3cspan class=\x22hljs-attr\x22\x3einput\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22type\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\n  (\x3cspan class=\x22hljs-attr\x22\x3efocus\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleFocus($event)\x22\x3c\/span\x3e\n  (\x3cspan class=\x22hljs-attr\x22\x3eblur\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleBlur($event)\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22placeholder\x22\x3c\/span\x3e\n  [(\x3cspan class=\x22hljs-attr\x22\x3engModel\x3c\/span\x3e)]=\x3cspan class=\x22hljs-string\x22\x3e\x22value\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e #\x3cspan class=\x22hljs-attr\x22\x3eiconDelete\x3c\/span\x3e \n    *\x3cspan class=\x22hljs-attr\x22\x3engIf\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22focused \x26amp;\x26amp; !readonly\x22\x3c\/span\x3e \n    \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22icon icon-delete\x22\x3c\/span\x3e \n    (\x3cspan class=\x22hljs-attr\x22\x3eclick\x3c\/span\x3e)=\x3cspan class=\x22hljs-string\x22\x3e\x22_handleClear($event)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们的 \x3ccode\x3einput\x3c\/code\x3e 和组件内部的 \x3ccode\x3evalue\x3c\/code\x3e 属性进行了双向绑定，所以在 \x3ccode\x3e_handleClear\x3c\/code\x3e 之后，我们的输入框的值自然也就被清空了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e值访问器 \x3ca href=\x22https:\/\/angular.cn\/docs\/ts\/latest\/api\/forms\/index\/ControlValueAccessor-interface.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eControlValueAccessor\x3c\/a\x3e\n\x3c\/h3\x3e\n\x3cp\x3e在完成上面的一些步骤之后，我们的组件基本功能完成了，但是接下来还有最重要的一部分内容，那就是让我们的自定义组件获得 \x3ccode\x3e值访问\x3c\/code\x3e 权限。\x3cbr\x3e在官方的文档中有提到一点 \x3ca href=\x22https:\/\/github.com\/angular\/material2\/blob\/master\/src\/lib\/input\/input.ts\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/angular\/material2\/blob\/master\/src\/lib\/input\/input.ts\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVF4gG?w=1029\x26amp;h=446\x22 src=\x22https:\/\/static.alili.tech\/img\/bVF4gG?w=1029\x26amp;h=446\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e在查看官方的文档之后，我们发现要实现自定义组件的值访问权限，我们需要继承 \x3ccode\x3eControlValueAccessor\x3c\/code\x3e 接口，同时实现它内部的对应的接口\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 要实现双向数据绑定，这个不可少\nexport const INPUT_CONTROL_VALUE_ACCESSOR: any = {\n  provide: NG_VALUE_ACCESSOR,\n  useExisting: forwardRef(() =\x3e InputControlComponent),\n  multi: true\n};\n\nconst noop = () =\x3e {\n};\n\n@Component({\n  selector: \x27input-control\x27,\n  templateUrl: \x27input-control.component.html\x27,\n  styleUrls: [\x27input-control.component.scss\x27],\n  host: {\n    \/\/ 宿主元素 click 事件，触发 focus() 事件\n    \x27(click)\x27: \x27focus()\x27,\n    \/\/ 切换宿主元素 focus 样式\n    \x27[class.focus]\x27: \x27focused\x27\n  },\n  \/\/ \n  encapsulation: ViewEncapsulation.None,\n  providers: [INPUT_CONTROL_VALUE_ACCESSOR]\n})\nexport class InputControlComponent implements ControlValueAccessor {\n  ……\n  ……\n  \/** Callback registered via registerOnTouched (ControlValueAccessor)\n   * 此属性在做表单校验的时候，不可少，\n   * 如果缺少了这个属性，FormControl.touched 属性将监测不到，切记！！\n   *\/\n  private _onTouchedCallback: () =\x3e void = noop;\n  \/** Callback registered via registerOnChange (ControlValueAccessor) *\/\n  private _onChangeCallback: (_: any) =\x3e void = noop;\n\n  \/**\n   * Write a new value to the element.\n   *\/\n  writeValue(value: any) {\n    this._value = value;\n  }\n\n  \/**\n   * Set the function to be called when the control receives a change event.\n   *\/\n  registerOnChange(fn: any) {\n    this._onChangeCallback = fn;\n  };\n\n  \/**\n   * Set the function to be called when the control receives a touch event.\n   *\/\n  registerOnTouched(fn: any) {\n    this._onTouchedCallback = fn;\n  }\n  ……\n  ……\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 要实现双向数据绑定，这个不可少\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e INPUT_CONTROL_VALUE_ACCESSOR: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e = {\n  provide: NG_VALUE_ACCESSOR,\n  useExisting: forwardRef(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e InputControlComponent),\n  multi: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e noop = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n};\n\n\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e({\n  selector: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control\x27\x3c\/span\x3e,\n  templateUrl: \x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.html\x27\x3c\/span\x3e,\n  styleUrls: [\x3cspan class=\x22hljs-string\x22\x3e\x27input-control.component.scss\x27\x3c\/span\x3e],\n  host: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 宿主元素 click 事件，触发 focus() 事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27(click)\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focus()\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 切换宿主元素 focus 样式\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27[class.focus]\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27focused\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3c\/span\x3e\n  encapsulation: ViewEncapsulation.None,\n  providers: [INPUT_CONTROL_VALUE_ACCESSOR]\n})\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e InputControlComponent \x3cspan class=\x22hljs-keyword\x22\x3eimplements\x3c\/span\x3e ControlValueAccessor {\n  ……\n  ……\n  \x3cspan class=\x22hljs-comment\x22\x3e\/** Callback registered via registerOnTouched (ControlValueAccessor)\n   * 此属性在做表单校验的时候，不可少，\n   * 如果缺少了这个属性，FormControl.touched 属性将监测不到，切记！！\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _onTouchedCallback: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3evoid\x3c\/span\x3e = noop;\n  \x3cspan class=\x22hljs-comment\x22\x3e\/** Callback registered via registerOnChange (ControlValueAccessor) *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e _onChangeCallback: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e_: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3evoid\x3c\/span\x3e = noop;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * Write a new value to the element.\n   *\/\x3c\/span\x3e\n  writeValue(value: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._value = value;\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * Set the function to be called when the control receives a change event.\n   *\/\x3c\/span\x3e\n  registerOnChange(fn: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onChangeCallback = fn;\n  };\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * Set the function to be called when the control receives a touch event.\n   *\/\x3c\/span\x3e\n  registerOnTouched(fn: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onTouchedCallback = fn;\n  }\n  ……\n  ……\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e正如上面代码中所示的一样，实现了这些对应的接口之后，我们就能像使用普通的 \x3ccode\x3einput\x3c\/code\x3e 元素一样使用我们的自定义组件了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e允许组件加载内部其它的 DOM 元素\x3c\/h3\x3e\n\x3cp\x3e回顾我们前面文章开头的 GIF 图片，我们还有一个获取验证码的按钮，同时，我们的错误提示也是放在组件内部的。要支持这种形式的，我们需要在组件内部加上 \x3ccode\x3e\x26lt;ng-content\x26gt;\x26lt;\/ng-content\x26gt;\x3c\/code\x3e 标签\x3cbr\x3e有了这个之后，所有包裹在 \x3ccode\x3e\x26lt;input-control\x26gt;\x26lt;\/input-control\x26gt;\x3c\/code\x3e 组件内部的元素都将被渲染到组件内部\x3c\/p\x3e\n\x3cp\x3e父组件调用 \x3ccode\x3einput-control\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-control class=\x26quot;input-control sms-control\x26quot;\n  [class.error]=\x26quot;!captcha.valid \x26amp;\x26amp; captcha.touched\x26quot;\n  type=\x26quot;tel\x26quot;\n  name=\x26quot;captcha\x26quot;\n  placeholder=\x26quot;请输入验证码\x26quot;\n  [formControl]=\x26quot;captcha\x26quot;\n  maxlength=\x26quot;5\x26quot;\x3e\n  \x3ccount-down class=\x26quot;btn-send-sms\x26quot; counter=\x26quot;50\x26quot; title=\x26quot;获取验证码\x26quot; countText=\x26quot;秒后重新获取\x26quot;\x3e\x3c\/count-down\x3e\n  \x3cp *ngIf=\x26quot;!captcha.valid \x26amp;\x26amp; captcha.touched\x26quot; class=\x26quot;error-tips\x26quot;\x3e请输入验证码\x3c\/p\x3e\n\x3c\/input-control\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22input-control sms-control\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eclass.error\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22!captcha.valid \x26amp;\x26amp; captcha.touched\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22captcha\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22请输入验证码\x22\x3c\/span\x3e\n  [\x3cspan class=\x22hljs-attr\x22\x3eformControl\x3c\/span\x3e]=\x3cspan class=\x22hljs-string\x22\x3e\x22captcha\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attr\x22\x3emaxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecount-down\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn-send-sms\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22获取验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecountText\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22秒后重新获取\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ecount-down\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e *\x3cspan class=\x22hljs-attr\x22\x3engIf\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22!captcha.valid \x26amp;\x26amp; captcha.touched\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22error-tips\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e请输入验证码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e浏览器渲染之后的的 DOM 结构：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-control class=\x26quot;input-control sms-control ng-untouched ng-pristine ng-invalid\x26quot; maxlength=\x26quot;5\x26quot; name=\x26quot;captcha\x26quot; placeholder=\x26quot;请输入验证码\x26quot; type=\x26quot;tel\x26quot; ng-reflect-maxlength=\x26quot;5\x26quot; ng-reflect-type=\x26quot;tel\x26quot; ng-reflect-name=\x26quot;captcha\x26quot; ng-reflect-placeholder=\x26quot;请输入验证码\x26quot; ng-reflect-form=\x26quot;[object Object]\x26quot;\x3e\n  \x3cinput ng-reflect-maxlength=\x26quot;5\x26quot; ng-reflect-name=\x26quot;captcha\x26quot; ng-reflect-type=\x26quot;tel\x26quot; type=\x26quot;tel\x26quot; ng-reflect-placeholder=\x26quot;请输入验证码\x26quot; placeholder=\x26quot;请输入验证码\x26quot; maxlength=\x26quot;5\x26quot; class=\x26quot;ng-untouched ng-pristine ng-valid\x26quot;\x3e\n\x3c!--template bindings={\n  \x26quot;ng-reflect-ng-if\x26quot;: null\n}--\x3e\n  \x3ccount-down class=\x26quot;btn-send-sms\x26quot; counttext=\x26quot;秒后重新获取\x26quot; counter=\x26quot;50\x26quot; title=\x26quot;获取验证码\x26quot; ng-reflect-counter=\x26quot;50\x26quot; ng-reflect-title=\x26quot;获取验证码\x26quot; ng-reflect-count-text=\x26quot;秒后重新获取\x26quot;\x3e\x3cbutton\x3e获取验证码\x3c\/button\x3e\x3c\/count-down\x3e\n      \x3c!--template bindings={\n  \x26quot;ng-reflect-ng-if\x26quot;: null\n}--\x3e\n\x3c\/input-control\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22input-control sms-control ng-untouched ng-pristine ng-invalid\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emaxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22captcha\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22请输入验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-maxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-type\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-name\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22captcha\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-placeholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22请输入验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-form\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22[object Object]\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-maxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-name\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22captcha\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-type\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22tel\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-placeholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22请输入验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22请输入验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emaxlength\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22ng-untouched ng-pristine ng-valid\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--template bindings={\n  \x22ng-reflect-ng-if\x22: null\n}--\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecount-down\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn-send-sms\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecounttext\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22秒后重新获取\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22获取验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-counter\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-title\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22获取验证码\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eng-reflect-count-text\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22秒后重新获取\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e获取验证码\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ecount-down\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--template bindings={\n  \x22ng-reflect-ng-if\x22: null\n}--\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-control\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e与 FormControl 结合使用注意事项\x3c\/h3\x3e\n\x3cp\x3e在后期的时候，我整合了自定输入组件与 \x3ccode\x3eFormControl\x3c\/code\x3e 一起使用，在使用过程中，发现在需要使用 \x3ccode\x3e.touched\x3c\/code\x3e 特性的时候，发现无法生效，通过查资料发现，如果需要让这个特性生性，我们的输入组件必须监听 \x3ccode\x3eblur\x3c\/code\x3e 事件并且在处理事件中调用触发对外的 blur 事件，具体代码见前面的 \x3ccode\x3e_handleBlur()\x3c\/code\x3e 内容。   \x3cbr\x3e\x3cbr\x3e\x3cbr\x3e完整 Demo 地址：\x3ca href=\x22https:\/\/github.com\/lichenbuliren\/mcare-app\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emcare-app\x3c\/a\x3e \x3cbr\x3e这个 Demo 里面整合了路由、子模块、服务、动态表单等特性的使用方法，有兴趣的可以参考下，还在持续完善中。这个 Demo 是参照自己做过的项目部分UI，当然不会涉及核心的业务代码：）。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e参考资料\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/angular\/material2\/blob\/master\/src\/lib\/input\/input.ts\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAngular2 material2 官方UI库\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/blog.thoughtram.io\/angular\/2016\/07\/27\/custom-form-controls-in-angular-2.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCUSTOM FORM CONTROLS IN ANGULAR 2\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/38447681\/touched-untouched-not-updating-in-custom-input-component-angular-2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/stackoverflow.com\/questions\/38447681\/touched-untouched-not-updating-in-custom-input-component-angular-2\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>构建一个自定义 angular2 输入组件</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007603861">https://segmentfault.com/a/1190000007603861</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/rcmlmgo4g2f/" target="_blank">https://alili.tech/archive/rcmlmgo4g2f/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>