<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="拒绝Redux文档“毒害” 一个项目告诉你Redux最新真正哲学"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>拒绝Redux文档“毒害” 一个项目告诉你Redux最新真正哲学 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/nam0wflavuf/",
				"appid": "1613049289050283", 
				"title": "拒绝Redux文档“毒害” 一个项目告诉你Redux最新真正哲学 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-15T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/w8ouaospvy/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/axmdao5mbzc/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&text=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&text=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&title=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&is_video=false&description=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&title=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&title=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&title=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnam0wflavuf%2f&title=%e6%8b%92%e7%bb%9dRedux%e6%96%87%e6%a1%a3%e2%80%9c%e6%af%92%e5%ae%b3%e2%80%9d%20%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%91%8a%e8%af%89%e4%bd%a0Redux%e6%9c%80%e6%96%b0%e7%9c%9f%e6%ad%a3%e5%93%b2%e5%ad%a6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">拒绝Redux文档“毒害” 一个项目告诉你Redux最新真正哲学</h1><div class="meta"><div class="postdate"><time datetime="2019-01-15" itemprop="datePublished">2019-01-15</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e之前分享过几篇关于React技术栈的原创文章：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.jianshu.com\/p\/7a56ac1de2a8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e解析Twitter前端架构 学习复杂场景数据设计\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.jianshu.com\/p\/83c86dd0802d\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact Conf 2017 干货总结1: React \x2b ES next = ♥\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.jianshu.com\/p\/cde3cf7e2760\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact\x2bRedux打造“NEWS EARLY”单页应用 一个项目理解最前沿技术栈真谛\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.jianshu.com\/p\/8e28be0e7ab1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e一个react\x2bredux工程实例\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e......\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e今天进一步剖析一个实际案例：\x3cstrong\x3eUber APP 移动网页版。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e如果你对React技术栈没有多大兴趣，或者不是很了解，也没有关系。因为读下来，你会发现，这篇文章的真谛其实在于\x3cstrong\x3e性能优化\x3c\/strong\x3e上。\x3c\/p\x3e\n\x3cp\x3e本文灵感和主体内容翻译自Narendra N Shetty的\x3ca href=\x22https:\/\/hackernoon.com\/how-i-built-a-super-fast-uber-clone-for-mobile-web-863680d2100f\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文章：How I built a super fast Uber clone for mobile web\x3c\/a\x3e，同时进行了大量扩充以及深挖。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e出发点和产品雏形\x3c\/h2\x3e\n\x3cp\x3e很早以来，相信大家都会认同一个观点：\x3cstrong\x3e移动端流量超越PC端是不争的事实。\x3c\/strong\x3e对于前端开发者来说，移动端web的开发同样非常有趣，也充满挑战。\x3c\/p\x3e\n\x3cp\x3e这不，Uber最近发布了最新版本APP，全新样式，体验超棒。于是，笔者决定使用React来从零开始构建一个新的属于自己的Uber。\x3c\/p\x3e\n\x3cp\x3e开发期间，笔者花费了很多时间在基础组件和样式搭建上。这环节中，主要应用了\x3ca href=\x22https:\/\/github.com\/uber\/react-map-gl\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUber官方开放的React地图库\x3c\/a\x3e，并在地图上“目的地”和“起始点”之间采用svg-overlay和html-overlay去绘制路线。\x3c\/p\x3e\n\x3cp\x3e最终的基本交互可以参考下面Gif图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307316?w=300\x26amp;h=528\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307316?w=300\x26amp;h=528\x22 alt=\x22uber.gif\x22 title=\x22uber.gif\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e走上优化之路\x3c\/h2\x3e\n\x3cp\x3e现在，我们有基本的产品形态了。目前面临的问题在于提高产品的各方面性能体验。我使用了Chrome Lighthouse去检验产品的性能表现。最终得到的结果为：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307317?w=1240\x26amp;h=487\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307317?w=1240\x26amp;h=487\x22 alt=\x22结果1.png\x22 title=\x22结果1.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ewow...\x3cbr\x3e第一次绘制时间就已经\x3cstrong\x3e接近2秒\x3c\/strong\x3e，后面的时间惨不忍睹就不要看了吧。\x3cbr\x3e想象一下，一个用户拿出手机，企图叫车。主屏时间的绘制就超过了19189.9ms，这是极其不能忍受的。\x3c\/p\x3e\n\x3cp\x3e接下来，什么也不说了，撸起袖子，想办法去优化吧。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e优化方法1－代码分离（Code Splitting）\x3c\/h2\x3e\n\x3cp\x3e我最开始想到并使用的方法就是：Code Splitting（代码分离），正好我们可以借助webpack来实现这项技术。\x3cbr\x3e什么是webpack code splitting呢? 您可以参考\x3ca href=\x22https:\/\/webpack.github.io\/docs\/code-splitting.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e，如果英语阅读吃力，可以参考下面引文：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3ecode splitting就是指将文件分割为块(chunk)，webpack使我们可以定义一些分割点(split point)，根据这些分割点对文件进行分块，并实现按需加载。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e因为笔者使用了React技术栈，并采用了react-router，所以代码的划分（split）就可以按照路由和加载时机进行。具体操作可以使用react-router的getComponent api来实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cRoute path=\x26quot;home\x26quot; name=\x26quot;home\x26quot; getComponent={(nextState, cb) =\x3e {\n    require.ensure([], (require) =\x3e {\n        cb(null, require(\x27..\/components\/Home\x27).default);\n    }, \x27HomeView\x27);\n\x22}}\x22\x3e \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22home\x22\x3c\/span\x3e name=\x3cspan class=\x22hljs-string\x22\x3e\x22home\x22\x3c\/span\x3e getComponent={(nextState, cb) =\x26gt; {\n    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.ensure([], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/components\/Home\x27\x3c\/span\x3e).\x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-string\x22\x3e\x27HomeView\x27\x3c\/span\x3e);\n\x22}}\x22\x26gt; \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e只有当对应路由被请求时，相应的组件才会被加载呈现。\x3c\/p\x3e\n\x3cp\x3e同时，笔者使用了webpack的CommonChunkPlugin插件提取第三方代码。这是出于什么考虑呢？\x3c\/p\x3e\n\x3cp\x3e细心的读者可能会发现上面的code splitting也许会存在一个问题：\x3cbr\x3e\x3cstrong\x3e按需（按路由）引入资源后，这些资源可能存在大量重复代码。尤其是我们使用的第三方资源。\x3c\/strong\x3e\x3cbr\x3e想明白这个问题，这时候，你应该就会明白CommonChunkPlugin这个插件的意义了。关于这个插件配置方法有多种，这里我们采用了：有选择性的提取（对象方式传参）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x27entry\x27: {\n        \x27app\x27: \x27.\/src\/index.js\x27,\n        \x27vendor\x27: [\n            \x27react\x27,\n            \x27react-redux\x27,\n            \x27redux\x27,\n            \x27react-router\x27,\n            \x27redux-thunk\x27\n        ]\n    },\n    \x27output\x27: {\n        \x27path\x27: path.resolve(__dirname, \x27.\/dist\x27),\n        \x27publicPath\x27: \x27\/\x27,\n        \x27filename\x27: \x27static\/js\/[name].[hash].js\x27,\n        \x27chunkFilename\x27: \x27static\/js\/[name].[hash].js\x27\n    },\n    \x27plugins\x27: [\n        new webpack.optimize.CommonsChunkPlugin({\n            name: [\x27vendor\x27], \/\/ 公共块的块名称\n            minChunks: Infinity, \/\/ 最小被引用次数，最小是2。传递Infinity只是创建公共块，但不移动模块。 \n            filename: \x27static\/js\/[name].[hash].js\x27, \/\/ 公共块的文件名\n        }),\n    ]\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-string\x22\x3e\x27entry\x27\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-string\x22\x3e\x27app\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/index.js\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27vendor\x27\x3c\/span\x3e: [\n            \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27react-redux\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27react-router\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27redux-thunk\x27\x3c\/span\x3e\n        ]\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x27output\x27\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-string\x22\x3e\x27publicPath\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27filename\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27static\/js\/[name].[hash].js\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27chunkFilename\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27static\/js\/[name].[hash].js\x27\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x27plugins\x27\x3c\/span\x3e: [\n        new webpack\x3cspan class=\x22hljs-selector-class\x22\x3e.optimize\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.CommonsChunkPlugin\x3c\/span\x3e({\n            name: [\x3cspan class=\x22hljs-string\x22\x3e\x27vendor\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 公共块的块名称\x3c\/span\x3e\n            minChunks: Infinity, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最小被引用次数，最小是2。传递Infinity只是创建公共块，但不移动模块。 \x3c\/span\x3e\n            filename: \x3cspan class=\x22hljs-string\x22\x3e\x27static\/js\/[name].[hash].js\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 公共块的文件名\x3c\/span\x3e\n        }),\n    ]\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样子，我们把公共代码（react、react-redux、redux、react-router、redux-thunk）专门抽取到vendor模块中。\x3c\/p\x3e\n\x3cp\x3e通过上述方法，笔者欣喜地发现：\x3cbr\x3eFirst meaningful paint时间由19189.9ms缩短到4584.3ms：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307318\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307318\x22 alt=\x22结果2\x22 title=\x22结果2\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这无疑是激动人心的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e优化方法2－Server side rendering（服务端直出）\x3c\/h2\x3e\n\x3cp\x3e也许你一直在听说过“服务端渲染”或者“服务端直出”这样的名词。但是从未实践过，也从来没有了解过他的意义。好吧，这里我先描述一下，到底什么是服务端直出。\x3c\/p\x3e\n\x3cp\x3e服务端直出，其实简单总结为服务器在接到来自浏览器第一次请求时，便返回一个“初步最终”HTML文档。这个HTML文档已经进行了数据拼接。这样用户能以最快的时间看到首屏的效果，当然这个效果是“阉割版”的，非最终版本。\x3c\/p\x3e\n\x3cp\x3e这种方式主要是针对“前后分离”的传统模式。传统模式中，服务器返回HTML文档，之后浏览器解析文档标签，拉取CSS，之后拉取JS文件。JS文件加载完成之后，执行JS内容，并发送请求获取数据。最终，将数据渲染在页面上。\x3c\/p\x3e\n\x3cp\x3e由此，Server side rendering方式将JS请求数据的过程放在了服务器上，甚至对于数据与HTML结合处理也可以在服务器上做。\x3c\/p\x3e\n\x3cp\x3e这样一来，\x3cstrong\x3e主要就是加快了首屏渲染时间。\x3c\/strong\x3e当然，使用服务端渲染，还能够优化前端渲染难以克服的SEO问题。\x3c\/p\x3e\n\x3cp\x3e理论理解起来很简单，难处就在于服务器端环境的前端脚本如何处理，如何与客户端保持一致。\x3c\/p\x3e\n\x3cp\x3e在这个项目中，我使用了Express作为nodeJS框架，结合react－router完成：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22server.use((req, res)=\x3e {\n    match({\n    \x27routes\x27: routes,\n    \x27location\x27: req.url\n    }, (error, redirectLocation, renderProps) =\x3e {\n        if (error) {\n            res.status(500).send(error.message);\n        } \n        else if (redirectLocation) {\n            res.redirect(302, redirectLocation.pathname \x2b redirectLocation.search);\n        } \n        else if (renderProps) {\n            \/\/ Create a new Redux store instance\n            const store = configureStore();\n\n            \/\/ Render the component to a string\n            const html = renderToString(\x3cProvider store={store}\x3e\x3cRouterContext {...renderProps} \/\x3e\x3c\/Provider\x3e);\n\n            const preloadedState = store.getState();\n\n            fs.readFile(\x27.\/dist\/index.html\x27, \x27utf8\x27, function (err, file) {\n                if (err) {\n                    return console.log(err);\n                }\n                let document = file.replace(\/\x3cdiv id=\x26quot;app\x26quot;\x3e\x3c\\\/div\x3e\/, `\x3cdiv id=\x26quot;app\x26quot;\x3e${html}\x3c\/div\x3e`);\n                document = document.replace(\/\x27preloadedState\x27\/, `\x27${JSON.stringify(preloadedState)}\x27`);\n                res.setHeader(\x27Cache-Control\x27, \x27public, max-age=31536000\x27);\n                res.setHeader(\x26quot;Expires\x26quot;, new Date(Date.now() \x2b 2592000000).toUTCString());\n                res.send(document);\n            });\n        } \n        else {\n            res.status(404).send(\x27Not found\x27)\n        }\n    });\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3eserver.use((req, res)=\x26gt; {\n    match({\n    \x3cspan class=\x22hljs-string\x22\x3e\x27routes\x27\x3c\/span\x3e: routes,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27location\x27\x3c\/span\x3e: req.url\n    }, (error, redirectLocation, renderProps) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) {\n            res.status(\x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e).send(error.message);\n        } \n        \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (redirectLocation) {\n            res.redirect(\x3cspan class=\x22hljs-number\x22\x3e302\x3c\/span\x3e, redirectLocation.pathname \x2b redirectLocation.search);\n        } \n        \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (renderProps) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Create a new Redux store instance\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = configureStore();\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Render the component to a string\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e html = renderToString(\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{store}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRouterContext\x3c\/span\x3e {\x3cspan class=\x22hljs-attr\x22\x3e...renderProps\x3c\/span\x3e} \/\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e)\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e preloadedState = store.getState();\n\n            fs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\/index.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, file\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err);\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e = file.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\x26lt;div id=\x22app\x22\x26gt;\x26lt;\\\/div\x26gt;\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e`\x26lt;div id=\x22app\x22\x26gt;\x3cspan class=\x22hljs-subst\x22\x3e${html}\x3c\/span\x3e\x26lt;\/div\x26gt;`\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\x27preloadedState\x27\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e`\x27\x3cspan class=\x22hljs-subst\x22\x3e${JSON.stringify(preloadedState)}\x3c\/span\x3e\x27`\x3c\/span\x3e);\n                res.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Cache-Control\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27public, max-age=31536000\x27\x3c\/span\x3e);\n                res.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x22Expires\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now() \x2b \x3cspan class=\x22hljs-number\x22\x3e2592000000\x3c\/span\x3e).toUTCString());\n                res.send(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e);\n            });\n        } \n        \x3cspan class=\x22hljs-title\x22\x3eelse\x3c\/span\x3e {\n            res.status(\x3cspan class=\x22hljs-number\x22\x3e404\x3c\/span\x3e).send(\x3cspan class=\x22hljs-string\x22\x3e\x27Not found\x27\x3c\/span\x3e)\n        }\n    });\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过上述方法，我们欣喜地发现：\x3cbr\x3eFirst meaningful paint时间已经缩短到921.5ms：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307319?w=1240\x26amp;h=405\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307319?w=1240\x26amp;h=405\x22 alt=\x22结果3\x22 title=\x22结果3\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这无疑是令人振奋的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e优化方法3－Compressed static assets（压缩静态文件）\x3c\/h2\x3e\n\x3cp\x3e压缩文件，当然是一个容易想到而且行之有效的措施。为此，我使用了webpack的CompressionPlugin插件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x27plugins\x27: [\n        new CompressionPlugin({\n            test: \/\\.js$|\\.css$|\\.html$\/\n        })\n    ]\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e{\n    \x27plugins\x27: [\n        new CompressionPlugin({\n            test: \/\\.js$|\\.css$|\\.html$\/\n        })\n    ]\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同时，使用express-static-gzip来对服务端进行配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22server.use(\x27\/static\x27, expressStaticGzip(\x27.\/dist\/static\x27, {\n    \x27maxAge\x27: 31536000,\n    setHeaders: function(res, path, stat) {\n    res.setHeader(\x26quot;Expires\x26quot;, new Date(Date.now() \x2b 2592000000).toUTCString());\n        return res;\n    }\n}));\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eserver.use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/static\x27\x3c\/span\x3e, expressStaticGzip(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\/static\x27\x3c\/span\x3e, {\n    \x3cspan class=\x22hljs-string\x22\x3e\x27maxAge\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e31536000\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3esetHeaders\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres, path, stat\x3c\/span\x3e) \x3c\/span\x3e{\n    res.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x22Expires\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now() \x2b \x3cspan class=\x22hljs-number\x22\x3e2592000000\x3c\/span\x3e).toUTCString());\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res;\n    }\n}));\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eexpress-static-gzip是一个处于express.static之上的中间件。如果对于指定路径的文件没有找到压缩版本，就使用为压缩版本进行返回。\x3c\/p\x3e\n\x3cp\x3e经过此处理，我们缩短了400ms时间，OK，现在First meaningful paint时间为546.6ms.\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307320?w=1240\x26amp;h=406\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307320?w=1240\x26amp;h=406\x22 alt=\x22结果4\x22 title=\x22结果4\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e优化方法4－Caching（缓存）\x3c\/h2\x3e\n\x3cp\x3e截止到此，我们已经从最初的19189.9ms已经优化到546ms，我们当然继续可以在客户端进行\x3cstrong\x3e静态文件缓存\x3c\/strong\x3e来使得加载时间变得更短。\x3c\/p\x3e\n\x3cp\x3e笔者使用了\x3ca href=\x22https:\/\/github.com\/GoogleChrome\/sw-toolbox\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esw-toolbox\x3c\/a\x3e搭配service workers进行。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3esw-toolbox：A collection of service worker tools for offlining runtime requests.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eService Worker Toolbox provides some simple helpers for use in creating your own service workers. Specifically, it provides common caching strategies for dynamic content, such as API calls, third-party resources, and large or infrequently used local resources that you don\x27t want precached.\x3c\/p\x3e\n\x3cp\x3e简单翻译下：\x3cbr\x3eService Worker实现常见运行时缓存模式，例如动态内容、API调用以及第三方资源，实现方法就像编写README一样简单。\x3c\/p\x3e\n\x3cp\x3e也许到这里你一头雾水，没关系，我们从最初开始，了解一下什么是service worker:\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e在2014年，W3C公布了service worker的草案，service worker提供了很多新的能力，使得web app拥有与native app相同的离线体验、消息推送体验。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eservice worker是一段脚本，与web worker一样，也是在后台运行。\x3cbr\x3e作为一个独立的线程，运行环境与普通脚本不同，所以不能直接参与web交互行为。native app可以做到离线使用、消息推送、后台自动更新，service worker的出现是正是为了使得web app也可以具有类似的能力。\x3c\/p\x3e\n\x3cp\x3e而sw-toolbox，顾名思义，就是service worker一个toolbox，具体我们看代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22toolbox.router.get(\x27(.*).js\x27, toolbox.fastest, {\n    \x27origin\x27:\/.herokuapp.com|localhost|maps.googleapis.com\/,\n    \x27mode\x27:\x27cors\x27,\n    \x27cache\x27: {\n        \x27name\x27: `js-assets-${VERSION}`,\n        \x27maxEntries\x27: 50,\n        \x27maxAgeSeconds\x27: 2592e3\n    }\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ruby\x22\x3e\x3ccode\x3etoolbox.router.get(\x3cspan class=\x22hljs-string\x22\x3e\x27(.*).js\x27\x3c\/span\x3e, toolbox.fastest, {\n    \x3cspan class=\x22hljs-string\x22\x3e\x27origin\x27\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\/\x3c\/span\x3e.herokuapp.com\x3cspan class=\x22hljs-params\x22\x3e|localhost|\x3c\/span\x3emaps.googleapis.com\/,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27mode\x27\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27cors\x27\x3c\/span\x3e\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27cache\x27\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`js-assets-${VERSION}`\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27maxEntries\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27maxAgeSeconds\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2592\x3c\/span\x3ee3\n    }\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面代码的意思是，我们对于get类型的请求，当请求内容为js脚本时，应用toolbox.fastest handler处理。\x3cbr\x3etoolbox.fastest指示：对于这个请求，我们既从缓存中获取，也同时通过正常的请求network获取。\x3cstrong\x3e这两种方式哪个返回快，就应用哪一个。\x3c\/strong\x3e\x3cbr\x3e另外，toolbox.router.get的第三个参数表示配置项。\x3c\/p\x3e\n\x3cp\x3e考虑周到的读者可能会想，上面是对于支持Service worker的浏览器，那么对于不支持的浏览器呢？我们干脆设置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22res.setHeader(\x26quot;Expires\x26quot;, new Date(Date.now() \x2b 2592000000).toUTCString());\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vbscript\x22\x3e\x3ccode\x3eres.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x22Expires\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3enow\x3c\/span\x3e() \x2b \x3cspan class=\x22hljs-number\x22\x3e2592000000\x3c\/span\x3e).toUTCString());\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过这样处理，我们来直观感受一下页面加载瀑布流：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307321?w=841\x26amp;h=170\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307321?w=841\x26amp;h=170\x22 alt=\x22使用Service worker\x22 title=\x22使用Service worker\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307322?w=847\x26amp;h=170\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307322?w=847\x26amp;h=170\x22 alt=\x22不使用Service worker\x22 title=\x22不使用Service worker\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e优化方法5－Preload and then load（预加载／延后加载）\x3c\/h2\x3e\n\x3cp\x3e如果你还没听说过“Preload”，不要紧。我们这就来了解一下：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3ePreload作为一个新的web标准，旨在提高性能和为web开发人员提供更细粒度的加载控制。Preload使开发者能够自定义资源的加载逻辑，且无需忍受基于脚本的资源加载器带来的性能损失。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e换成你能听明白的话来说：\x3cbr\x3e\x3cstrong\x3epreload建议允许始终预加载某些资源，浏览器必须请求preload标记的资源。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e这样子，究竟有什么意义呢？\x3cbr\x3e举个例子：比如一些隐藏在CSS和Javascript中的资源。\x3cbr\x3e当浏览器发现自己需要这些资源时已经为时已晚，所以大多数情况，这些资源的加载都会对页面渲染造成延迟。\x3c\/p\x3e\n\x3cp\x3epreload的出现就是为了优化这个过程。\x3cbr\x3e对于preload的兼容性，可以参考\x3ca href=\x22http:\/\/caniuse.com\/#search=preload\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里。\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e对于不支持preload的浏览器，笔者使用了prefetch来处理。\x3cbr\x3e但于preload不同，prefetch的作用是告诉浏览器加载下一页面可能会用到的资源，注意，是下一页面，而不是当前页面。因此该方法的加载优先级非常低。\x3c\/p\x3e\n\x3cp\x3e这些新标准其实很有意思，里面的内容远不止这些。有兴趣的同学可以自行了解，也欢迎与我讨论。\x3c\/p\x3e\n\x3cp\x3e回到正题，我在head标签中使用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3clink rel=\x26quot;preload\x26quot; ... as=\x26quot;script\x26quot;\x3e\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x26lt;link rel=\x3cspan class=\x22hljs-string\x22\x3e\x22preload\x22\x3c\/span\x3e ... \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22script\x22\x3c\/span\x3e\x26gt;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最终优化的结果如图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009307323?w=749\x26amp;h=382\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009307323?w=749\x26amp;h=382\x22 alt=\x22最终结果\x22 title=\x22最终结果\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e其实，使用React＋Webpack做出一个Uber已经不是重点了。真正激动人心的是整套流程的优化之路。我们使用了大量成熟的、未成熟（新技术），希望对读者有所启发！\x3c\/p\x3e\n\x3cp\x3eHappy Coding!\x3c\/p\x3e\n\x3cp\x3ePS: 作者\x3ca href=\x22https:\/\/github.com\/HOUCe\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGithub仓库\x3c\/a\x3e，欢迎通过代码各种形式交流。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>拒绝Redux文档“毒害” 一个项目告诉你Redux最新真正哲学</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009307313">https://segmentfault.com/a/1190000009307313</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/nam0wflavuf/" target="_blank">https://alili.tech/archive/nam0wflavuf/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>