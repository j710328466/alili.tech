<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Node.js&#43;MongoDB对于RestfulApi中用户token认证实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Node.js&#43;MongoDB对于RestfulApi中用户token认证实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/r8yve5n3vxn/",
				"appid": "1613049289050283", 
				"title": "Node.js&#43;MongoDB对于RestfulApi中用户token认证实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/mw9p5lb9qfb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/1sal2pa56z8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&text=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&text=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&title=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&is_video=false&description=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&title=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&title=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&title=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr8yve5n3vxn%2f&title=Node.js%2bMongoDB%e5%af%b9%e4%ba%8eRestfulApi%e4%b8%ad%e7%94%a8%e6%88%b7token%e8%ae%a4%e8%af%81%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Node.js&#43;MongoDB对于RestfulApi中用户token认证实践</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629635?w=800\x26amp;h=534\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629635?w=800\x26amp;h=534\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e最近在新的项目中开发中需要使用到RESTful API的对接IOS与Android应用开发，所以一不小心就踩进了REST的坑里面……在开发过程中还是有许多收货的。\x3cstrong\x3e这次就来看看API设计中的token的思路与实践\x3c\/strong\x3e。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e技术栈\x3c\/h2\x3e\n\x3cp\x3e使用Node.js上的\x3ca href=\x22http:\/\/www.expressjs.com.cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eExpress\x3c\/a\x3e框架进行我们的路由设计，\x3ca href=\x22https:\/\/cnodejs.org\/topic\/504b4924e2b84515770103dd\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMongoose\x3c\/a\x3e来与Mongodb数据库连接交互，使用Postman对我们设计的Api进行调试，快动起手来吧！\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e关于RESTful API\x3c\/h2\x3e\n\x3cp\x3e网上已经有了很多关于RESTful的介绍，我这里也不过多重复了。想说的就是它的主要作用，就是对于现如今的网络应用程序，分为前端和后端两个部分，然而当前的发展趋势就是应用平台需求的扩大(IOS、Android、Webapp等等)\x3c\/p\x3e\n\x3cp\x3e因此，就需要一种统一的机制，方便不同的应用平台的前端设备与后端进行通信，也就是前后端的分离。这导致了API架构的流行，甚至出现\x22API First\x22的设计思想。RESTful API则是目前比较成熟的一套互联网应用程序的API设计理论。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eAPI设计中的token的思路\x3c\/h2\x3e\n\x3cp\x3e在API设计中,TOKEN用来判断用户是否有权限访问API.TOKEN首先不需要编解码处理. 一般TOKEN都是一些用户名\x2b时间等内容的MD5的不可逆加密.然后通过一个USER_TOKEN表来判断用户请求中包含的TOKEN与USER_TOKEN表中的TOKEN是否一致即可. \x3c\/p\x3e\n\x3cp\x3e具体实践过程主要为:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e设定一个密钥比如key = ‘2323dsfadfewrasa3434\x27。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e这个key 只有发送方和接收方知道。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e调用时，发送方，组合各个参数用密钥 key按照一定的规则(各种排序，MD5，ip等)生成一个access_key。一起post提交到API接口。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e接收方拿到post过来的参数以及这个access_key。也和发送一样，用密钥key 对各个参数进行一样的规则(各种排序，MD5，ip等)也生成一个access_key2。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e对比 access_key 和 access_key2 。一样。则允许操作，不一样，报错返回或者加入黑名单。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3etoken设计具体实践\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e废话不多说，先进入看我们的干货，这次选用Node.js\x2bexperss配合Mongoose来进入REST的token实践\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e项目地址: \x3ca href=\x22https:\/\/github.com\/Nicksapp\/nAuth-restful-api\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGitHub地址\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e或 \x3ccode\x3egit clone https:\/\/github.com\/Nicksapp\/nAuth-restful-api.git\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e整体构架\x3c\/h3\x3e\n\x3cp\x3e开发前先进行我们设计的构想\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e路由设计\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3ePOST \/api\/signup: 用户注册\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ePOST \/api\/user\/accesstoken: 账号验证,获取token\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eGET \/api\/users\/info: 获得用户信息,需验证\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3euser 模型设计\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3ename : 用户名\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3epassword: 密码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etoken: 验证相关token\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e新建项目\x3c\/h3\x3e\n\x3cp\x3e先看看我们的项目文件夹\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22- routes\/\n---- index.js\n---- users.js\n- models\/\n---- user.js\n- config.js\n- package.json\n- passport.js\n- index.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e- routes\/\n---- index.js\n---- users.js\n- models\/\n---- user.js\n- config.js\n- package.json\n- passport.js\n- index.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3enpm init\x3c\/code\x3e创建我们的\x3ccode\x3epackage.json\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e接着在项目根文件夹下安装我们所需的依赖\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install express body-parser morgan mongoose jsonwebtoken bcrypt passport passport-http-bearer --save \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall \x3c\/span\x3eexpress \x3cspan class=\x22hljs-keyword\x22\x3ebody-parser \x3c\/span\x3emorgan mongoose \x3cspan class=\x22hljs-keyword\x22\x3ejsonwebtoken \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ebcrypt \x3c\/span\x3epassport passport-http-\x3cspan class=\x22hljs-keyword\x22\x3ebearer \x3c\/span\x3e--save \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eexpress: 我们的主要开发框架\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emongoose: 用来与MongoDB数据库进行交互的框架，请提前安装好MongoDB在PC上\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emorgan: 会将程序请求过程的信息显示在Terminal中，以便于我们调试代码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ejsonwebtoken: 用来生成我们的token\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3epassport: 非常流行的权限验证库\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ebcrypt: 对用户密码进行hash加密\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e-- save会将我们安装的库文件写入\x3ccode\x3epackage.json\x3c\/code\x3e的依赖中,以便其他人打开项目是能够正确安装所需依赖.\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e用户模型\x3c\/h3\x3e\n\x3cp\x3e定义我们所需用户模型，用于moogoose，新建\x3ccode\x3emodels\/user.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const mongoose = require(\x27mongoose\x27);\nconst Schema = mongoose.Schema;\nconst bcrypt = require(\x27bcrypt\x27);\n\nconst UserSchema = new Schema({\n  name: {\n    type: String,\n    unique: true, \/\/ 不可重复约束\n    require: true \/\/ 不可为空约束\n  },\n  password: {\n    type: String,\n    require: true\n  },\n  token: {\n    type: String\n  }\n});\n\n\/\/ 添加用户保存时中间件对password进行bcrypt加密,这样保证用户密码只有用户本人知道\nUserSchema.pre(\x27save\x27, function (next) {\n    var user = this;\n    if (this.isModified(\x27password\x27) || this.isNew) {\n        bcrypt.genSalt(10, function (err, salt) {\n            if (err) {\n                return next(err);\n            }\n            bcrypt.hash(user.password, salt, function (err, hash) {\n                if (err) {\n                    return next(err);\n                }\n                user.password = hash;\n                next();\n            });\n        });\n    } else {\n        return next();\n    }\n});\n\/\/ 校验用户输入密码是否正确\nUserSchema.methods.comparePassword = function(passw, cb) {\n    bcrypt.compare(passw, this.password, (err, isMatch) =\x3e {\n        if (err) {\n            return cb(err);\n        }\n        cb(null, isMatch);\n    });\n};\n\nmodule.exports = mongoose.model(\x27User\x27, UserSchema);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mongoose = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27mongoose\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Schema = mongoose.Schema;\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bcrypt = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27bcrypt\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e UserSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eunique\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不可重复约束\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不可为空约束\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3erequire\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e\n  }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加用户保存时中间件对password进行bcrypt加密,这样保证用户密码只有用户本人知道\x3c\/span\x3e\nUserSchema.pre(\x3cspan class=\x22hljs-string\x22\x3e\x27save\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isModified(\x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e) || \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isNew) {\n        bcrypt.genSalt(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, salt\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(err);\n            }\n            bcrypt.hash(user.password, salt, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, hash\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(err);\n                }\n                user.password = hash;\n                next();\n            });\n        });\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next();\n    }\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 校验用户输入密码是否正确\x3c\/span\x3e\nUserSchema.methods.comparePassword = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epassw, cb\x3c\/span\x3e) \x3c\/span\x3e{\n    bcrypt.compare(passw, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.password, (err, isMatch) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(err);\n        }\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, isMatch);\n    });\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27User\x27\x3c\/span\x3e, UserSchema);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e配置文件\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3e.\/config.js\x3c\/code\x3e 用来配置我们的MongoDB数据库连接和token的密钥。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = {\n  \x27secret\x27: \x27learnRestApiwithNickjs\x27, \/\/ used when we create and verify JSON Web Tokens\n  \x27database\x27: \x27mongodb:\/\/localhost:27017\/test\x27 \/\/ 填写本地自己 mongodb 连接地址,xxx为数据表名\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-string\x22\x3e\x27secret\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27learnRestApiwithNickjs\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ used when we create and verify JSON Web Tokens\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x27database\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb:\/\/localhost:27017\/test\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 填写本地自己 mongodb 连接地址,xxx为数据表名\x3c\/span\x3e\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e本地服务器配置\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3e.\/index.js\x3c\/code\x3e 服务器配置文件，也是程序的入口。\x3c\/p\x3e\n\x3cp\x3e这里我们主要用来包含我们程序需要加载的库文件，调用初始化程序所需要的依赖。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const express = require(\x27express\x27);\nconst app = express();\nconst bodyParser = require(\x27body-parser\x27);\/\/ 解析body字段模块\nconst morgan = require(\x27morgan\x27); \/\/ 命令行log显示\nconst mongoose = require(\x27mongoose\x27);\nconst passport = require(\x27passport\x27);\/\/ 用户认证模块passport\nconst Strategy = require(\x27passport-http-bearer\x27).Strategy;\/\/ token验证模块\nconst routes = require(\x27.\/routes\x27);\nconst config = require(\x27.\/config\x27);\n\nlet port = process.env.PORT || 8080;\n\napp.use(passport.initialize());\/\/ 初始化passport模块\napp.use(morgan(\x27dev\x27));\/\/ 命令行中显示程序运行日志,便于bug调试\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json()); \/\/ 调用bodyParser模块以便程序正确解析body传入值\n\nroutes(app); \/\/ 路由引入\n\nmongoose.Promise = global.Promise;\nmongoose.connect(config.database); \/\/ 连接数据库\n\napp.listen(port, () =\x3e {\n  console.log(\x27listening on port : \x27 \x2b port);\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = express();\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bodyParser = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27body-parser\x27\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解析body字段模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e morgan = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27morgan\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 命令行log显示\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mongoose = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27mongoose\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e passport = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27passport\x27\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用户认证模块passport\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Strategy = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27passport-http-bearer\x27\x3c\/span\x3e).Strategy;\x3cspan class=\x22hljs-comment\x22\x3e\/\/ token验证模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routes = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/routes\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e port = process.env.PORT || \x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e;\n\napp.use(passport.initialize());\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 初始化passport模块\x3c\/span\x3e\napp.use(morgan(\x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 命令行中显示程序运行日志,便于bug调试\x3c\/span\x3e\napp.use(bodyParser.urlencoded({ \x3cspan class=\x22hljs-attr\x22\x3eextended\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }));\napp.use(bodyParser.json()); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用bodyParser模块以便程序正确解析body传入值\x3c\/span\x3e\n\nroutes(app); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 路由引入\x3c\/span\x3e\n\nmongoose.Promise = global.Promise;\nmongoose.connect(config.database); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 连接数据库\x3c\/span\x3e\n\napp.listen(port, () =\x26gt; {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27listening on port : \x27\x3c\/span\x3e \x2b port);\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e路由配置\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3e.\/routes\x3c\/code\x3e 主要存放路由相关文件\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e.\/routes\/index.js\x3c\/code\x3e 路由总入口，引入所使用路由\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = (app) =\x3e {\n  app.get(\x27\/\x27, (req, res) =\x3e {\n    res.json({ message: \x27hello index!\x27});\n  });\n\n  app.use(\x27\/api\x27, require(\x27.\/users\x27)); \/\/ 在所有users路由前加\/api\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eapp\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  app.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e, (req, res) =\x26gt; {\n    res.json({ \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27hello index!\x27\x3c\/span\x3e});\n  });\n\n  app.use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/users\x27\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在所有users路由前加\/api\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e.\/routes\/users.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nconst express = require(\x27express\x27);\nconst User = require(\x27..\/models\/user\x27);\nconst jwt = require(\x27jsonwebtoken\x27);\nconst config = require(\x27..\/config\x27);\nconst passport = require(\x27passport\x27);\nconst router = express.Router();\n\nrequire(\x27..\/passport\x27)(passport);\n\n\/\/ 注册账户\nrouter.post(\x27\/signup\x27, (req, res) =\x3e {\n  if (!req.body.name || !req.body.password) {\n    res.json({success: false, message: \x27请输入您的账号密码.\x27});\n  } else {\n    var newUser = new User({\n      name: req.body.name,\n      password: req.body.password\n    });\n    \/\/ 保存用户账号\n    newUser.save((err) =\x3e {\n      if (err) {\n        return res.json({success: false, message: \x27注册失败!\x27});\n      }\n      res.json({success: true, message: \x27成功创建新用户!\x27});\n    });\n  }\n});\n\n\/\/ 检查用户名与密码并生成一个accesstoken如果验证通过\nrouter.post(\x27\/user\/accesstoken\x27, (req, res) =\x3e {\n  User.findOne({\n    name: req.body.name\n  }, (err, user) =\x3e {\n    if (err) {\n      throw err;\n    }\n    if (!user) {\n      res.json({success: false, message:\x27认证失败,用户不存在!\x27});\n    } else if(user) {\n      \/\/ 检查密码是否正确\n      user.comparePassword(req.body.password, (err, isMatch) =\x3e {\n        if (isMatch \x26amp;\x26amp; !err) {\n          var token = jwt.sign({name: user.name}, config.secret,{\n            expiresIn: 10080\n          });\n          user.token = token;\n          user.save(function(err){\n            if (err) {\n              res.send(err);\n            }\n          });\n          res.json({\n            success: true,\n            message: \x27验证成功!\x27,\n            token: \x27Bearer \x27 \x2b token,\n            name: user.name\n          });\n        } else {\n          res.send({success: false, message: \x27认证失败,密码错误!\x27});\n        }\n      });\n    }\n  });\n});\n\n\/\/ passport-http-bearer token 中间件验证\n\/\/ 通过 header 发送 Authorization -\x3e Bearer  \x2b token\n\/\/ 或者通过 ?access_token = token\nrouter.get(\x27\/users\/info\x27,\n  passport.authenticate(\x27bearer\x27, { session: false }),\n  function(req, res) {\n    res.json({username: req.user.name});\n});\n\nmodule.exports = router;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e User = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/models\/user\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e jwt = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27jsonwebtoken\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e passport = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27passport\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = express.Router();\n\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/passport\x27\x3c\/span\x3e)(passport);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注册账户\x3c\/span\x3e\nrouter.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/signup\x27\x3c\/span\x3e, (req, res) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!req.body.name || !req.body.password) {\n    res.json({\x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27请输入您的账号密码.\x27\x3c\/span\x3e});\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e newUser = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e User({\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: req.body.name,\n      \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: req.body.password\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户账号\x3c\/span\x3e\n    newUser.save(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27注册失败!\x27\x3c\/span\x3e});\n      }\n      res.json({\x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27成功创建新用户!\x27\x3c\/span\x3e});\n    });\n  }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查用户名与密码并生成一个accesstoken如果验证通过\x3c\/span\x3e\nrouter.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/user\/accesstoken\x27\x3c\/span\x3e, (req, res) =\x26gt; {\n  User.findOne({\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: req.body.name\n  }, (err, user) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!user) {\n      res.json({\x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27认证失败,用户不存在!\x27\x3c\/span\x3e});\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(user) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查密码是否正确\x3c\/span\x3e\n      user.comparePassword(req.body.password, (err, isMatch) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isMatch \x26amp;\x26amp; !err) {\n          \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e token = jwt.sign({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: user.name}, config.secret,{\n            \x3cspan class=\x22hljs-attr\x22\x3eexpiresIn\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10080\x3c\/span\x3e\n          });\n          user.token = token;\n          user.save(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n              res.send(err);\n            }\n          });\n          res.json({\n            \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27验证成功!\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Bearer \x27\x3c\/span\x3e \x2b token,\n            \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: user.name\n          });\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          res.send({\x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27认证失败,密码错误!\x27\x3c\/span\x3e});\n        }\n      });\n    }\n  });\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ passport-http-bearer token 中间件验证\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 header 发送 Authorization -\x26gt; Bearer  \x2b token\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 或者通过 ?access_token = token\x3c\/span\x3e\nrouter.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/users\/info\x27\x3c\/span\x3e,\n  passport.authenticate(\x3cspan class=\x22hljs-string\x22\x3e\x27bearer\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3esession\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }),\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n    res.json({\x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: req.user.name});\n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = router;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3epassport配置\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3e.\/passport.js\x3c\/code\x3e 配置权限模块所需功能\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const passport = require(\x27passport\x27);\nconst Strategy = require(\x27passport-http-bearer\x27).Strategy;\n\nconst User = require(\x27.\/models\/user\x27);\nconst config = require(\x27.\/config\x27);\n\nmodule.exports = function(passport) {\n    passport.use(new Strategy(\n        function(token, done) {\n            User.findOne({\n                token: token\n            }, function(err, user) {\n                if (err) {\n                    return done(err);\n                }\n                if (!user) {\n                    return done(null, false);\n                }\n                return done(null, user);\n            });\n        }\n    ));\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e passport = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27passport\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Strategy = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27passport-http-bearer\x27\x3c\/span\x3e).Strategy;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e User = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/models\/user\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epassport\x3c\/span\x3e) \x3c\/span\x3e{\n    passport.use(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Strategy(\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etoken, done\x3c\/span\x3e) \x3c\/span\x3e{\n            User.findOne({\n                \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: token\n            }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, user\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e done(err);\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!user) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, user);\n            });\n        }\n    ));\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e主要验证发送的token值与用户服务器端token值是否匹配，进行信息验证。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e具体调试\x3c\/h2\x3e\n\x3cp\x3e现在就可以运行我们的代码看具体运作过程了！为了便于调试与参数的收发，我们使用\x3ca href=\x22https:\/\/www.getpostman.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epostman\x3c\/a\x3e(可在Chrome上或Mac上安装)来操作.\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3enode index\x3c\/code\x3e运行我们的本地服务器，访问 \x3ccode\x3elocalhost:8080\/\x3c\/code\x3e\x3cbr\x3e应该就可以看到我们所返回的初始json值了，然我们继续深入测试。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629636?w=1678\x26amp;h=1558\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629636?w=1678\x26amp;h=1558\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ePOST访问\x3ccode\x3elocalhost:8080\/api\/signup\x3c\/code\x3e,我们来注册一个新用户，注意要设置\x3ccode\x3ebody\x3c\/code\x3e的\x3ccode\x3eContent-Type\x3c\/code\x3e为\x3ccode\x3ex-www-form-urlencoded\x3c\/code\x3e 以便我们的\x3ccode\x3ebody-parser\x3c\/code\x3e能够正确解析,好的我们成功模拟创建了我们的新用户。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629637?w=1622\x26amp;h=1502\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629637?w=1622\x26amp;h=1502\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e连接一下数据库看下我们的用户信息是否也被正确存储(注:我使用的是MongoChef,十分强大MongoDB数据库管理软件),我们可以看到,我的password也被正确加密保存了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629638?w=1768\x26amp;h=1248\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629638?w=1768\x26amp;h=1248\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e接着POST访问\x3ccode\x3elocalhost:8080\/api\/user\/accesstoken\x3c\/code\x3e,来为我的用户获得专属token，POST过程与注册相关,可以看到也正确生成我们的token值。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629639?w=1678\x26amp;h=1558\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629639?w=1678\x26amp;h=1558\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e再看下我们的数据库中的用户信息，token值也被存入了进来，便于我们之后进行权限验证。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629640?w=1768\x26amp;h=1248\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629640?w=1768\x26amp;h=1248\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eGET访问\x3ccode\x3elocalhost:8080\/api\/users\/info\x3c\/code\x3e,同时将我们的token值在\x3ccode\x3eHeader\x3c\/code\x3e中以 \x3ccode\x3eAuthorization: token\x3c\/code\x3e 传入,正确获得用户名则表示我们访问请求通过了验证。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629641?w=1678\x26amp;h=1558\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629641?w=1678\x26amp;h=1558\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果token值不正确，则返回 Unauthorized 并拒绝访问请求。到这里我们的权限验证功能也就基本实现了(喜大普奔~~~)。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008629642?w=1678\x26amp;h=1558\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008629642?w=1678\x26amp;h=1558\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e希望在看完这篇教程后能够对你在RESTful Api开发上有所启发，小生才疏学浅，过程中有什么不足的地方也欢迎指正。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Node.js+MongoDB对于RestfulApi中用户token认证实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008629632">https://segmentfault.com/a/1190000008629632</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/r8yve5n3vxn/" target="_blank">https://alili.tech/archive/r8yve5n3vxn/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5328xogjarn/">IndexedDB--HTML5本地存储<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/xpccu0hsqbr/">JS学习系列 01 - 编译原理和作用域<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/shv09bbtbfd/">Vue2 SSR 的优化之旅<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5vj1ojfo6h6/">[2016年末巨献] — HTML5可交互地铁线路图（第二季：帝都进阶版）<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/m02hlm4bzh/">vue2.0开发聊天程序（三）组件的通信<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/mz5o7n90plg/">《很高兴我没有猝死》- 前端新人的 2016 年总结和感悟<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/3vhoe2mo09k/">一道颇有难度的JavaScript题<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/uj12mb7thp/">使用CANVAS实现交互性圆形马赛克效果<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/ja636h8hcxa/">写于 2016 年末<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5uomnoq1kmi/">前端学习资源整理<aside class="dates">2019-01-28</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>