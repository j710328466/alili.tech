<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="一篇文章说清浏览器解析和CSS（GPU）动画优化"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>一篇文章说清浏览器解析和CSS（GPU）动画优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/dklfgwyc9f/",
				"appid": "1613049289050283", 
				"title": "一篇文章说清浏览器解析和CSS（GPU）动画优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-28T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9pvtwgjarlq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/oy7jchnpqu/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&text=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&text=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&is_video=false&description=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdklfgwyc9f%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e8%af%b4%e6%b8%85%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90%e5%92%8cCSS%ef%bc%88GPU%ef%bc%89%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">一篇文章说清浏览器解析和CSS（GPU）动画优化</h1><div class="meta"><div class="postdate"><time datetime="2019-01-28" itemprop="datePublished">2019-01-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e相信不少人在做移动端动画的时候遇到了卡顿的问题，这篇文章尝试从浏览器渲染的角度；一点一点告诉你动画优化的原理及其技巧，作为你工作中优化动画的参考。文末有优化技巧的总结。\x3c\/p\x3e\n\x3cp\x3e因为GPU合成没有官方规范，每个浏览器的问题和解决方式也不同；所以文章内容仅供参考。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e浏览器渲染\x3c\/h2\x3e\n\x3cp\x3e提高动画的优化不得不提及浏览器是如何渲染一个页面。在从服务器中拿到数据后，浏览器会先做解析三类东西：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e解析html,xhtml,svg这三类文档，形成dom树。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e解析css，产生css rule tree。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e解析js，js会通过api来操作dom tree和css rule tree。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e解析完成之后，浏览器引擎会通过dom tree和css rule tree来构建rendering tree：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3erendering tree和dom tree并不完全相同，例如：\x26lt;head\x26gt;\x26lt;\/head\x26gt;或display:none的东西就不会放在渲染树中。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecss rule tree主要是完成匹配，并把css rule附加给rendering tree的每个element。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在渲染树构建完成后，\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e浏览器会对这些元素进行定位和布局，这一步也叫做reflow或者layout。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e浏览器绘制这些元素的样式，颜色，背景，大小及边框等，这一步也叫做repaint。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e然后浏览器会将各层的信息发送给GPU，GPU会将各层合成；显示在屏幕上。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e渲染优化原理\x3c\/h2\x3e\n\x3cp\x3e如上所说，渲染树构建完成后；浏览器要做的步骤：\x3c\/p\x3e\n\x3cp\x3ereflow——》repaint——》composite\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ereflow和repaint\x3c\/h3\x3e\n\x3cp\x3ereflow和repaint都是耗费浏览器性能的操作，这两者尤以reflow为甚；因为每次reflow，浏览器都要重新计算每个元素的形状和位置。\x3c\/p\x3e\n\x3cp\x3e由于reflow和repaint都是非常消耗性能的，我们的浏览器为此做了一些优化。浏览器会将reflow和repaint的操作积攒一批，然后做一次reflow。但是有些时候，你的代码会强制浏览器做多次reflow。例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var content = document.getElementById(\x27content\x27);\ncontent.style.width = 700px;\nvar contentWidth = content.offsetWidth;\ncontent.style.backgound = \x27red\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econtent\x3c\/span\x3e = document.getElementById(\x27\x3cspan class=\x22hljs-built_in\x22\x3econtent\x3c\/span\x3e\x27);\n\x3cspan class=\x22hljs-built_in\x22\x3econtent\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3estyle\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3ewidth\x3c\/span\x3e = 700px;\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e contentWidth = \x3cspan class=\x22hljs-built_in\x22\x3econtent\x3c\/span\x3e.offsetWidth;\n\x3cspan class=\x22hljs-built_in\x22\x3econtent\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3estyle\x3c\/span\x3e.backgound = \x27red\x27;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上第三行代码，需要浏览器reflow后；再获取值，所以会导致浏览器多做一次reflow。\x3c\/p\x3e\n\x3cp\x3e下面是一些针对reflow和repaint的最佳实践：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e不要一条一条地修改dom的样式，尽量使用className一次修改。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e将dom离线后修改\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e使用documentFragment对象在内存里操作dom。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e先把dom节点display:none;（会触发一次reflow）。然后做大量的修改后，再把它显示出来。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eclone一个dom节点在内存里，修改之后；与在线的节点相替换。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不要使用table布局，一个小改动会造成整个table的重新布局。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etransform和opacity只会引起合成，不会引起布局和重绘。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e从上述的最佳实践中你可能发现，动画优化一般都是\x3cstrong\x3e尽可能地减少reflow、repaint的发生\x3c\/strong\x3e。关于哪些属性会引起reflow、repaint及composite，你可以在这个网站找到\x3ca href=\x22https:\/\/csstriggers.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/csstriggers.com\/\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3ecomposite\x3c\/h3\x3e\n\x3cp\x3e在reflow和repaint之后，浏览器会将多个复合层传入GPU；进行合成工作，那么合成是如何工作的呢？\x3c\/p\x3e\n\x3cp\x3e假设我们的页面中有A和B两个元素，它们有absolute和z-index属性；浏览器会重绘它们，然后将图像发送给GPU；然后GPU将会把多个图像合成展示在屏幕上。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n#a, #b {\n position: absolute;\n}\n\n#a {\n left: 30px;\n top: 30px;\n z-index: 2;\n}\n\n#b {\n z-index: 1;\n}\n\x3c\/style\x3e\n\x3cdiv id=\x26quot;#a\x26quot;\x3eA\x3c\/div\x3e\n\x3cdiv id=\x26quot;#b\x26quot;\x3eB\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e30px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e30px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#a\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eA\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#b\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eB\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHJXs?w=802\x26amp;h=320\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHJXs?w=802\x26amp;h=320\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们将A元素使用left属性，做一个移动动画：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n#a, #b {\n position: absolute;\n}\n\n#a {\n left: 10px;\n top: 10px;\n z-index: 2;\n animation: move 1s linear;\n}\n\n#b {\n left: 50px;\n top: 50px;\n z-index: 1;\n}\n\n@keyframes move {\n from { left: 30px; }\n to { left: 100px; }\n}\n\x3c\/style\x3e\n\x3cdiv id=\x26quot;#a\x26quot;\x3eA\x3c\/div\x3e\n\x3cdiv id=\x26quot;#b\x26quot;\x3eB\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3eanimation\x3c\/span\x3e: move \x3cspan class=\x22hljs-number\x22\x3e1s\x3c\/span\x3e linear;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n}\n\n@\x3cspan class=\x22hljs-keyword\x22\x3ekeyframes\x3c\/span\x3e move {\n \x3cspan class=\x22hljs-selector-tag\x22\x3efrom\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e30px\x3c\/span\x3e; }\n \x3cspan class=\x22hljs-selector-tag\x22\x3eto\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e; }\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#a\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eA\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#b\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eB\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这个例子中，对于动画的每一帧；浏览器会计算元素的几何形状，渲染新状态的图像；并把它们发送给GPU。（你没看错，position也会引起浏览器重排的）尽管浏览器做了优化，在repaint时，只会repaint部分区域；但是我们的动画仍然不够流畅。\x3c\/p\x3e\n\x3cp\x3e因为重排和重绘发生在动画的每一帧，一个有效避免reflow和repaint的方式是我们仅仅画两个图像；一个是a元素，一个是b元素及整个页面；我们将这两张图片发送给GPU，然后动画发生的时候；只做两张图片相对对方的平移。也就是说，仅仅合成缓存的图片将会很快；这也是GPU的优势——它能非常快地以亚像素精度地合成图片，并给动画带来平滑的曲线。\x3c\/p\x3e\n\x3cp\x3e为了仅发生composite，我们做动画的css property必须满足以下三个条件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e不影响文档流。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不依赖文档流。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不会造成重绘。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e满足以上以上条件的css property只有transform和opacity。你可能以为position也满足以上条件，但事实不是这样，举个例子left属性可以使用百分比的值，依赖于它的offset parent。还有em、vh等其他单位也依赖于他们的环境。\x3c\/p\x3e\n\x3cp\x3e我们使用translate来代替left\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n#a, #b {\n position: absolute;\n}\n\n#a {\n left: 10px;\n top: 10px;\n z-index: 2;\n animation: move 1s linear;\n}\n\n#b {\n left: 50px;\n top: 50px;\n z-index: 1;\n}\n\n@keyframes move {\n from { transform: translateX(0); }\n to { transform: translateX(70px); }\n}\n\x3c\/style\x3e\n\x3cdiv id=\x26quot;#a\x26quot;\x3eA\x3c\/div\x3e\n\x3cdiv id=\x26quot;#b\x26quot;\x3eB\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3eanimation\x3c\/span\x3e: move \x3cspan class=\x22hljs-number\x22\x3e1s\x3c\/span\x3e linear;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3ez-index\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n}\n\n@\x3cspan class=\x22hljs-keyword\x22\x3ekeyframes\x3c\/span\x3e move {\n \x3cspan class=\x22hljs-selector-tag\x22\x3efrom\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etranslateX\x3c\/span\x3e(0); }\n \x3cspan class=\x22hljs-selector-tag\x22\x3eto\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etranslateX\x3c\/span\x3e(70px); }\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#a\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eA\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#b\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eB\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e浏览器在动画执行之前就知道动画如何开始和结束，因为浏览器没有看到需要reflow和repaint的操作；浏览器就会画两张图像作为复合层，并将它们传入GPU。\x3c\/p\x3e\n\x3cp\x3e这样做有两个优势：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e动画将会非常流畅\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e动画不在绑定到CPU，即使js执行大量的工作；动画依然流畅。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e看起来性能问题好像已经解决了？在下文你会看到GPU动画的一些问题。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eGPU是如何合成图像的\x3c\/h3\x3e\n\x3cp\x3eGPU实际上可以看作一个独立的计算机，它有自己的处理器和存储器及数据处理模型。当浏览器向GPU发送消息的时候，就像向一个外部设备发送消息。\x3c\/p\x3e\n\x3cp\x3e你可以把浏览器向GPU发送数据的过程，与使用ajax向服务器发送消息非常类似。想一下，你用ajax向服务器发送数据，服务器是不会直接接受浏览器的存储的信息的。你需要收集页面上的数据，把它们放进一个载体里面（例如JSON），然后发送数据到远程服务器。\x3c\/p\x3e\n\x3cp\x3e同样的，浏览器向GPU发送数据也需要先创建一个载体；只不过GPU距离CPU很近，不会像远程服务器那样可能几千里那么远。但是对于远程服务器，2秒的延迟是可以接受的；但是对于GPU，几毫秒的延迟都会造成动画的卡顿。\x3c\/p\x3e\n\x3cp\x3e浏览器向GPU发送的数据载体是什么样？这里给出一个简单的制作载体，并把它们发送到GPU的过程。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e画每个复合层的图像\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e准备图层的数据\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e准备动画的着色器（如果需要）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e向GPU发送数据\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e所以你可以看到，每次当你添加\x3ccode\x3etransform:translateZ(0)\x3c\/code\x3e或\x3ccode\x3ewill-change：transform\x3c\/code\x3e给一个元素，你都会做同样的工作。重绘是非常消耗性能的，在这里它尤其缓慢。在大多数情况，浏览器不能增量重绘。它不得不重绘先前被复合层覆盖的区域。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e隐式合成\x3c\/h3\x3e\n\x3cp\x3e还记得刚才a元素和b元素动画的例子吗？现在我们将b元素做动画，a元素静止不动。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHLx1?w=801\x26amp;h=337\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHLx1?w=801\x26amp;h=337\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e和刚才的例子不同，现在b元素将拥有一个独立复合层；然后它们将被GPU合成。但是因为a元素要在b元素的上面（因为a元素的z-index比b元素高），那么浏览器会做什么？浏览器会将a元素也单独做一个复合层！\x3c\/p\x3e\n\x3cp\x3e所以我们现在有三个复合层a元素所在的复合层、b元素所在的复合层、其他内容及背景层。\x3c\/p\x3e\n\x3cp\x3e一个或多个没有自己复合层的元素要出现在有复合层元素的上方，它就会拥有自己的复合层；这种情况被称为隐式合成。\x3c\/p\x3e\n\x3cp\x3e浏览器将a元素提升为一个复合层有很多种原因，下面列举了一些：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e3d或透视变换css属性，例如translate3d,translateZ等等（js一般通过这种方式，使元素获得复合层）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x26lt;video\x26gt;\x26lt;iframe\x26gt;\x26lt;canvas\x26gt;\x26lt;webgl\x26gt;等元素。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e混合插件（如flash）。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e元素自身的 opacity和transform 做 CSS 动画。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e拥有css过滤器的元素。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用will-change属性。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eposition:fixed。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e元素有一个 z-index 较低且包含一个复合层的兄弟元素(换句话说就是该元素在复合层上面渲染)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这看起来css动画的性能瓶颈是在重绘上，但是真实的问题是在内存上：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e内存占用\x3c\/h3\x3e\n\x3cp\x3e使用GPU动画需要发送多张渲染层的图像给GPU，GPU也需要缓存它们以便于后续动画的使用。\x3c\/p\x3e\n\x3cp\x3e一个渲染层，需要多少内存占用？为了便于理解，举一个简单的例子；一个宽、高都是300px的纯色图像需要多少内存？\x3c\/p\x3e\n\x3cp\x3e300 \x3cem\x3e 300 \x3c\/em\x3e 4 = 360000字节，即360kb。这里乘以4是因为，每个像素需要四个字节计算机内存来描述。\x3c\/p\x3e\n\x3cp\x3e假设我们做一个轮播图组件，轮播图有10张图片；为了实现图片间平滑过渡的交互；为每个图像添加了will-change:transform。这将提升图像为复合层，它将多需要19mb的空间。800 \x3cem\x3e 600 \x3c\/em\x3e 4 * 10 = 1920000。\x3c\/p\x3e\n\x3cp\x3e仅仅是一个轮播图组件就需要19m的额外空间！\x3c\/p\x3e\n\x3cp\x3e在chrome的开发者工具中打开setting——》Experiments——》layers可以看到每个层的内存占用。如图所示：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHLP9?w=819\x26amp;h=369\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHLP9?w=819\x26amp;h=369\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHLQi?w=1170\x26amp;h=285\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHLQi?w=1170\x26amp;h=285\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eGPU动画的优点和缺点\x3c\/h3\x3e\n\x3cp\x3e现在我们可以总结一下GPU动画的优点和缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e每秒60帧，动画平滑、流畅。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一个合适的动画工作在一个单独的线程，它不会被大量的js计算阻塞。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e3D“变换”是便宜的。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e提升一个元素到复合层需要额外的重绘，有时这是慢的。（即我们得到的是一个全层重绘，而不是一个增量）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e绘图层必须传输到GPU。取决于层的数量和传输可能会非常缓慢。这可能让一个元素在中低档设备上闪烁。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e每个复合层都需要消耗额外的内存，过多的内存可能导致浏览器的崩溃。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果你不考虑隐式合成，而使用重绘；会导致额外的内存占用，并且浏览器崩溃的概率是非常高的。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e我们会有视觉假象，例如在Safari中的文本渲染，在某些情况下页面内容将消失或变形。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e优化技巧\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e避免隐式合成\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e保持动画的对象的z-index尽可能的高。理想的，这些元素应该是body元素的直接子元素。当然，这不是总可能的。所以你可以克隆一个元素，把它放在body元素下仅仅是为了做动画。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e将元素上设置will-change CSS属性，元素上有了这个属性，浏览器会提升这个元素成为一个复合层（不是总是）。这样动画就可以平滑的开始和结束。但是不要滥用这个属性，否则会大大增加内存消耗。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e动画中只使用transform和opacity\x3c\/h3\x3e\n\x3cp\x3e如上所说，transform和opacity保证了元素属性的变化不影响文档流、也不受文档流影响；并且不会造成repaint。\x3cbr\x3e有些时候你可能想要改变其他的css属性，作为动画。例如：你可能想使用background属性改变背景：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;bg-change\x26quot;\x3e\x3c\/div\x3e\n.bg-change {\n  width: 100px;\n  height: 100px;\n  background: red;\n  transition: opacity 2s;\n}\n.bg-change:hover {\n  background: blue;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e class=\x3cspan class=\x22hljs-string\x22\x3e\x22bg-change\x22\x3c\/span\x3e\x26gt;\x26lt;\/div\x26gt;\n\x3cspan class=\x22hljs-selector-class\x22\x3e.bg-change\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: red;\n  \x3cspan class=\x22hljs-attribute\x22\x3etransition\x3c\/span\x3e: opacity \x3cspan class=\x22hljs-number\x22\x3e2s\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.bg-change\x3c\/span\x3e:hover {\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: blue;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这个例子中，在动画的每一步；浏览器都会进行一次重绘。我们可以使用一个复层在这个元素上面，并且仅仅变换opacity属性：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;bg-change\x26quot;\x3e\x3c\/div\x3e\n\x3cstyle\x3e\n.bg-change {\n  width: 100px;\n  height: 100px;\n  background: red;\n}\n.bg-change::before {\n  content: \x27\x27;\n  display: block;\n  width: 100%;\n  height: 100%;\n  background: blue;\n  opacity: 0;\n  transition: opacity 20s;\n}\n.bg-change:hover::before {\n  opacity: 1;\n}\n\x3c\/style\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22bg-change\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.bg-change\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: red;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.bg-change\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e::before\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: block;\n  \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: blue;\n  \x3cspan class=\x22hljs-attribute\x22\x3eopacity\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3etransition\x3c\/span\x3e: opacity \x3cspan class=\x22hljs-number\x22\x3e20s\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.bg-change\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:hover\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e::before\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3eopacity\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e减小复合层的尺寸\x3c\/h3\x3e\n\x3cp\x3e看一下两张图片，有什么不同吗？\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVHLYA?w=821\x26amp;h=161\x22 src=\x22https:\/\/static.alili.tech\/img\/bVHLYA?w=821\x26amp;h=161\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这两张图片视觉上是一样的，但是它们的尺寸一个是39kb；另外一个是400b。不同之处在于，第二个纯色层是通过scale放大10倍做到的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;a\x26quot;\x3e\x3c\/div\x3e\n\x3cdiv id=\x26quot;b\x26quot;\x3e\x3c\/div\x3e\n\n\x3cstyle\x3e\n#a, #b {\n will-change: transform;\n}\n\n#a {\n width: 100px;\n height: 100px;\n}\n\n#b {\n width: 10px;\n height: 10px;\n transform: scale(10);\n}\n\x3c\/style\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22a\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22b\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3ewill-change\x3c\/span\x3e: transform;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#a\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-id\x22\x3e#b\x3c\/span\x3e {\n \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3escale\x3c\/span\x3e(10);\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于图片，你要怎么做呢？你可以将图片的尺寸减少5%——10%，然后使用scale将它们放大；用户不会看到什么区别，但是你可以减少大量的存储空间。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e用css动画而不是js动画\x3c\/h3\x3e\n\x3cp\x3ecss动画有一个重要的特性，它是完全工作在GPU上。因为你声明了一个动画如何开始和如何结束，浏览器会在动画开始前准备好所有需要的指令；并把它们发送给GPU。而如果使用js动画，浏览器必须计算每一帧的状态；为了保证平滑的动画，我们必须在浏览器主线程计算新状态；把它们发送给GPU至少60次每秒。除了计算和发送数据比css动画要慢，主线程的负载也会影响动画； 当主线程的计算任务过多时，会造成动画的延迟、卡顿。\x3c\/p\x3e\n\x3cp\x3e所以尽可能地使用基于css的动画，不仅仅更快；也不会被大量的js计算所阻塞。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e优化技巧总结\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e减少浏览器的重排和重绘的发生。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不要使用table布局。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecss动画中尽量只使用transform和opacity，这不会发生重排和重绘。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e尽可能地只使用css做动画。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e避免浏览器的隐式合成。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e改变复合层的尺寸。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e参考\x3c\/h2\x3e\n\x3cp\x3eGPU合成主要参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.smashingmagazine.com\/2016\/12\/gpu-animation-doing-it-right\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.smashingmagazine....\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e哪些属性会引起reflow、repaint及composite，你可以在这个网站找到：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/csstriggers.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/csstriggers.com\/\x3c\/a\x3e。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>一篇文章说清浏览器解析和CSS（GPU）动画优化</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008015671">https://segmentfault.com/a/1190000008015671</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/dklfgwyc9f/" target="_blank">https://alili.tech/archive/dklfgwyc9f/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5fmk2pl6rab/">2016年前端开发者深度调研，看看别人使用什么技术体系<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/stp6408xnu/">Bootstrap使用模态框modal实现表单提交弹出框<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/fu7a86e9uyh/">CSS水平垂直居中总结<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/r0w29esklr/">JS 里怎么给数组填充默认值<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/i00hiszlr1/">JavaScript - EventEmitter 背后的秘密<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/u2la0cn9do/">JavaScript 精度丢失问题<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/3txhfn3ejcb/">Nodejs进阶：如何玩转子进程（child_process）<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/yr7v8e9fao/">Promise介绍--规范篇<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/9lyxyz4wc6g/">QQ音乐API整理<aside class="dates">2019-01-30</aside></a></li><li><a href="/archive/84zzlljmes4/">SegmentFault 技术周刊 Vol.14 - 进阶 Vue 2.0<aside class="dates">2019-01-30</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>