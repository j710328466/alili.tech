<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 TS &#43; Vue 重写 APlayer HTML5 音乐播放器"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 TS &#43; Vue 重写 APlayer HTML5 音乐播放器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fiiariwzu3/",
				"appid": "1613049289050283", 
				"title": "用 TS &#43; Vue 重写 APlayer HTML5 音乐播放器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-07T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/dyscun60v8a/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/cvayxl3wvpi/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&text=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&text=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&title=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&is_video=false&description=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&title=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&title=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&title=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffiiariwzu3%2f&title=%e7%94%a8%20TS%20%2b%20Vue%20%e9%87%8d%e5%86%99%20APlayer%20HTML5%20%e9%9f%b3%e4%b9%90%e6%92%ad%e6%94%be%e5%99%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 TS &#43; Vue 重写 APlayer HTML5 音乐播放器</h1><div class="meta"><div class="postdate"><time datetime="2019-01-07" itemprop="datePublished">2019-01-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e简介\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.anotherhome.net\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@DIYgod\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/APlayer\x3c\/a\x3e 是一款简洁漂亮的 \x3ccode\x3eHTML5\x3c\/code\x3e 音乐播放器 (〃ﾉωﾉ)  \x3cbr\x3e在我第一次看到这款播放器颜值的时候让我眼前一亮，我非常崇拜那些能设计出好看界面的设计师 (* \x26gt;ω\x26lt;)\x3c\/p\x3e\n\x3cp\x3e但是在用过之后发现还是有不足的地方 这是我曾经提过的 \x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\/issues\/110\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIssues\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e用了一段时间，很喜欢 APlayer 简洁的 UI，提一些其他可改进的建议：\x3c\/p\x3e\n\x3cp\x3e1.我认为有必要提供动态管理播放列表的 API\x3cbr\x3e（如果没有，在需要动态添加歌曲到列表时只能重新初始化）\x3cbr\x3e2.应该提供一个销毁播放器的 API\x3cbr\x3e3.歌词允许异步添加，通常获取歌词接口是单独的\x3cbr\x3e（现在必须等待歌词接口返回再初始化播放器，若歌词获取失败或时间过长会同时影响到播放音乐功能）\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e关于第三条，\x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPlayer\x3c\/a\x3e 其实是支持异步歌词的但仅支持传入 \x3ccode\x3e.lrc\x3c\/code\x3e 文件的地址  \x3cbr\x3e如果是像网易云／QQ音乐那样返回的是 \x3ccode\x3eJSON\x3c\/code\x3e 格式的那就不满足需求了\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e为什么不提 PR 要重写呢？\x3c\/strong\x3e\x3cbr\x3e这个我想了一会，最终还是觉得组件化的方式开发更好一些（原 APlayer 用的是原生 JS 没有依赖别的库）  \x3cbr\x3e而且因为我以前还在做后端的时候就自己写过音乐播放器（仿微博播放器，当时不会用 \x3ccode\x3eGit\x3c\/code\x3e 源码已丢）  \x3cbr\x3e所以挺有经验的，重写一个难度也不大，而且比较随心所欲，还可以随意加一些自己想要的东西 qwq\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e截图\x3c\/h2\x3e\n\x3cp\x3e说明：该播放器是基于 \x3ca href=\x22https:\/\/www.anotherhome.net\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@DIYgod\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/APlayer\x3c\/a\x3e 的布局和 \x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\/blob\/master\/src\/APlayer.scss\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e样式\x3c\/a\x3e 采用 \x3ca href=\x22http:\/\/www.typescriptlang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTS\x3c\/a\x3e \x2b \x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 组件化重构的\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRspD?w=1026\x26amp;h=602\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRspD?w=1026\x26amp;h=602\x22 alt=\x22Demo\x22 title=\x22Demo\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e演示：\x3ca href=\x22http:\/\/aplayer.quq.cat\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/aplayer.quq.cat\x3c\/a\x3e  \x3cbr\x3e文档：\x3ca href=\x22http:\/\/aplayer.quq.cat\/docs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/aplayer.quq.cat\/docs\x3c\/a\x3e  \x3cbr\x3e源码：\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/MoeFE\/vue-...\x3c\/a\x3e  \x3cbr\x3eNPM：\x3ca href=\x22https:\/\/www.npmjs.com\/package\/vue-aplayer-plugin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.npmjs.com\/package...\x3c\/a\x3e  \x3cbr\x3e播放列表来自网易云歌单：\x3ca href=\x22http:\/\/music.163.com\/#\/playlist?id=805272969\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/music.163.com\/#\/playli...\x3c\/a\x3e  \x3c\/p\x3e\n\x3cp\x3e如果喜欢的话别忘了点一个 star 哟 (*ゝω・)  \x3cbr\x3e欢迎提 \x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/issues\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIssues\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/pulls\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePR\x3c\/a\x3e (´・_・｀)\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e框架选型\x3c\/h2\x3e\n\x3cp\x3e为了大家使用方便，我选择 \x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e ，可以响应式控制播放器各个属性 并以插件的形式发布（详情请看 \x3ca href=\x22http:\/\/aplayer.quq.cat\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edemo\x3c\/a\x3e ）\x3cbr\x3e我这里为了方便大家能更好的调试，在生产环境下开启了 \x3ccode\x3eSourceMap\x3c\/code\x3e 和 \x3ca href=\x22https:\/\/cn.vuejs.org\/v2\/api\/#devtools\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edevtools\x3c\/a\x3e  \x3cbr\x3e如果您安装了 \x3ca href=\x22https:\/\/github.com\/vuejs\/vue-devtools\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue-devtools\x3c\/a\x3e 可以打开调试器查看组件划分和各个组件的信息\x3c\/p\x3e\n\x3cp\x3e至于为什么选择用 \x3ccode\x3eTypeScript\x3c\/code\x3e 本文就不做过多的解释了  \x3cbr\x3e大家可以自行在网上找一下 \x3ccode\x3eTypeScript\x3c\/code\x3e 和 \x3ccode\x3eJavaScript\x3c\/code\x3e 的区别\x3c\/p\x3e\n\x3cp\x3e我只能告诉你：对于一个曾经使用 \x3ccode\x3eC#\x3c\/code\x3e 的开发者来说这简直不能太爽啦 微软爸爸赛高 (* \x26gt;ω\x26lt;)  \x3c\/p\x3e\n\x3cp\x3e最后推荐一款 \x3ca href=\x22http:\/\/www.typescriptlang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTS\x3c\/a\x3e \x2b \x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 的脚手架模版：\x3ca href=\x22https:\/\/github.com\/Toilal\/vue-webpack-template\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/Toilal\/vue...\x3c\/a\x3e\x3cbr\x3e以后或将加入到官方模版中：\x3ca href=\x22https:\/\/github.com\/vuejs-templates\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/vuejs-temp...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.typescriptlang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTS\x3c\/a\x3e \x2b \x3ca href=\x22https:\/\/facebook.github.io\/react\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact\x3c\/a\x3e 的脚手架可以用这个：\x3ca href=\x22https:\/\/github.com\/wmonk\/create-react-app-typescript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/wmonk\/crea...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e拆分组件\x3c\/h2\x3e\n\x3cp\x3e拿到布局样式后要做的第一件事情就是拆分组件  \x3cbr\x3e将 \x3ca href=\x22https:\/\/www.anotherhome.net\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@DIYgod\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\/APlayer\x3c\/a\x3e 的布局和 \x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\/blob\/master\/src\/APlayer.scss\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e样式\x3c\/a\x3e 复制过来  \x3cbr\x3e确保样式没有问题后再将各个组件的布局和样式单独复制出来  \x3cbr\x3e不懂设计的只好复制了 请允许我做一个悲伤的表情 (ಗ ‸ ಗ )\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRsZQ?w=1026\x26amp;h=602\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRsZQ?w=1026\x26amp;h=602\x22 alt=\x22拆分组件\x22 title=\x22拆分组件\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我将播放器拆分成了以下组件：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e组件名称\x3c\/th\x3e\n\x3cth\x3e组件说明\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/APlayer\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPlayer.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e播放器容器组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Button\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eButton.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e按钮组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Picture\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePicture.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e歌曲图片组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Container\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eContainer.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e右侧容器组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Info\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eInfo.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e歌曲信息组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Lyric\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eLyric.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e歌词面板组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Progress\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eProgress.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e进度条组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Time\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTime.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e播放时间组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Volume\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVolume.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e音量控制组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/List\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eList.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e播放列表组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/tree\/master\/src\/components\/Item\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eItem.ts\x3c\/a\x3e\x3c\/td\x3e\n\x3ctd\x3e播放列表项组件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e再来一张更清晰的图片吧：  \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVRs5y?w=3838\x26amp;h=1386\x22 src=\x22https:\/\/static.alili.tech\/img\/bVRs5y?w=3838\x26amp;h=1386\x22 alt=\x22vue-devtools\x22 title=\x22vue-devtools\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/i4.piimg.com\/549484\/fd58c3c12bc329e1.png\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e点击查看高清原图\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e功能开发\x3c\/h2\x3e\n\x3cp\x3e功能开发其实没有多少难度，\x3ccode\x3eHTML5\x3c\/code\x3e 已经封装好了 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/HTML\/Element\/audio\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTMLAudioElement\x3c\/a\x3e 元素  \x3cbr\x3e我们就是用一下它的 \x3ccode\x3eAPI\x3c\/code\x3e 和视图进行数据绑定和交互而已 看一下文档就好了\x3c\/p\x3e\n\x3cp\x3e不过这里会遇到一个小问题，那就是 \x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 不能监听到 \x3ccode\x3eAudio\x3c\/code\x3e 对象的属性变化  \x3cbr\x3e因为 \x3ccode\x3eAudio\x3c\/code\x3e 对象其实就是 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/HTML\/Element\/audio\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTMLAudioElement\x3c\/a\x3e 元素，\x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 是不能监听到元素属性变化的，所以我想了一个小办法  \x3c\/p\x3e\n\x3cp\x3e定义了一个 \x3ccode\x3eMedia\x3c\/code\x3e 接口，里面定义了和 \x3ccode\x3eAudio\x3c\/code\x3e 对象相同的属性，在 \x3ccode\x3eAudio\x3c\/code\x3e 的事件中对 \x3ccode\x3eMedia\x3c\/code\x3e 的属性进行同步  \x3cbr\x3e这样的话，就可以使用 \x3ccode\x3eMedia\x3c\/code\x3e 对象响应式获取 \x3ccode\x3eAudio\x3c\/code\x3e 的属性值  \x3cbr\x3e可以查看这一段代码：\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/blob\/master\/src\/components\/APlayer\/src\/APlayer.ts#L326-L334\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPlayer.ts#L326-L334\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e我这里简单介绍一些比较常用的属性和方法吧\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e名称\x3c\/th\x3e\n\x3cth\x3e说明\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eautoplay\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e是否自动播放 （在 \x3ccode\x3eSafari\x3c\/code\x3e 中无效，可以自行在初始化音频后手动调用 play 方法）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ebufferd\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取已缓冲的进度（必须在 \x3ccode\x3ereadeyState \x26gt;= 3\x3c\/code\x3e 之后获取，否则会抛异常）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eloop\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e是否循环播放音频（推荐根据当前播放模式自行实现该功能）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3epreload\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e预加载选项，推荐使用 \x3ccode\x3emetadata\x3c\/code\x3e，在未播放时仅获取音频的长度，而不要加载整个音频\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3esrc\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取或设置音频的播放地址\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3evolume\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取或设置音频的音量（0～1）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3epaused\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取当前音频是否已暂停\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ecurrentTime\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取或设置当前音频的播放进度（单位：秒）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eduration\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取当前音频的长度（单位：秒）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eplaybackRate\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e获取或设置当前音频的播放速度\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eplay ()\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e播放音频\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3epause ()\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e暂停音频\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/Guide\/Events\/Media_events\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e点击查看所有 Media 事件\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e事实上 \x3ccode\x3eAudio\x3c\/code\x3e 和 \x3ccode\x3eVideo\x3c\/code\x3e 对象差不多 都属于 \x3ccode\x3eMedia\x3c\/code\x3e  \x3cbr\x3e所以如果你会开发音乐播放器那么也会开发视频播放器了  \x3c\/p\x3e\n\x3cp\x3e这里重点说一下 \x3ccode\x3etimeupdate\x3c\/code\x3e 事件，这个事件在音频播放时不断触发，这个可以说是最有用的事件了  \x3cbr\x3e因为在播放过程中需要不断的重绘播放器的播放进度和已播放时间  \x3cbr\x3e如果有歌词的话，还需要根据当前的播放时间去同步歌词  \x3c\/p\x3e\n\x3cp\x3e如果没有或者不知道这个事件的话，你可能会使用 \x3ccode\x3esetInterval\x3c\/code\x3e 代替  \x3cbr\x3e使用 \x3ccode\x3esetInterval\x3c\/code\x3e 的话，会有两个问题：  \x3cbr\x3e1.重绘时间到底设置多少合适？太快了影响性能，太慢了页面不同步  \x3cbr\x3e2.如果用户暂停播放了，需要清除定时器，开始播放又要初始化定时器，太麻烦\x3cbr\x3e（或者偷懒的话可以判断 \x3ccode\x3epaused\x3c\/code\x3e 时 \x3ccode\x3ereturn\x3c\/code\x3e ，那么需要不断的跑一个空定时器）\x3c\/p\x3e\n\x3ch4\x3eLRC 歌词解析和同步\x3c\/h4\x3e\n\x3cp\x3e可能做这个功能的时候是最好玩的吧 qwq  \x3cbr\x3e因为在很久以前 千千静听那个年代 我无聊的时候就做一下 LRC 歌词  \x3cbr\x3e所以对这个功能很敏感 尽量做到最好吧 (´・_・｀)\x3c\/p\x3e\n\x3cp\x3e这里主要功能是歌词解析，歌词同步的话只要计算出与当前播放时间最匹配的项元素  \x3cbr\x3e然后设置歌词面板的滚动条位置到当前元素的位置即可\x3c\/p\x3e\n\x3cp\x3e常见的时间标签有以下几种\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[mm:ss] 只有分和秒的时间标签\n[mm:ss:ms] 有分、秒、毫秒的时间标签\n[mm:ss.ms] 有分、秒、毫秒的时间标签的另一种格式\n[mm:ss:ms][mm:ss.ms] 多个时间标签共享这一句相同的歌词\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs markdown\x22\x3e\x3ccode\x3e[mm:ss] 只有分和秒的时间标签\n[mm:ss:ms] 有分、秒、毫秒的时间标签\n[mm:ss.ms] 有分、秒、毫秒的时间标签的另一种格式\n[\x3cspan class=\x22hljs-string\x22\x3emm:ss:ms\x3c\/span\x3e][\x3cspan class=\x22hljs-symbol\x22\x3emm:ss.ms\x3c\/span\x3e] 多个时间标签共享这一句相同的歌词\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我的思路是：\x3cbr\x3e首先按照行将歌词文本分割成数组，再按行进行解析  \x3cbr\x3e使用正则表达式匹配出该行的 分、秒、毫秒 和显示的歌词文本  \x3cbr\x3e将 分、秒、毫秒 都转换成毫秒单位然后加起来与歌词文本关联后保存到数组中，最后需要按照时间正序排列  \x3cbr\x3e那么 \x3ccode\x3e当前要显示的歌词 = 过滤数组中 时间 \x26lt; 当前播放时间 后的最后一项\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22private async parseLRC (): Promise\x3cvoid\x3e {\n  if (!this.lrc || this.lrc === \x27loading\x27) return\n  if (this.isURL(this.lrc)) { \/\/ 如果歌词是一个URL地址则请求该地址获得歌词文本\n    const { data } = await Axios.get(this.lrc.toString())\n    this.currentLRC = data\n  } else this.currentLRC = this.lrc\n\n  const reg = \/\\[(\\d\x2b):(\\d\x2b)[.|:](\\d\x2b)\\](.\x2b)\/\n  const regTime = \/\\[(\\d\x2b):(\\d\x2b)[.|:](\\d\x2b)\\]\/g\n  const regCompatible = \/\\[(\\d\x2b):(\\d\x2b)]()(.\x2b)\/\n  const regTimeCompatible = \/\\[(\\d\x2b):(\\d\x2b)]\/g\n  const regOffset = \/\\[offset:\\s*(-{0,1}\\d\x2b)\\]\/\n  const offsetMatch = this.lrc.match(regOffset)\n  const offset = offsetMatch ? Number.parseInt(offsetMatch[1]) : 0\n  this.LRC = []\n\n  const matchAll = (line: string) =\x3e {\n    let match = line.match(reg) || line.match(regCompatible)\n    if (!match) return\n    if (match.length !== 5) return\n    const minutes = Number.parseInt(match[1]) || 0\n    const seconds = Number.parseInt(match[2]) || 0\n    const milliseconds = Number.parseInt(match[3]) || 0\n    const time = (minutes * 60 * 1000 \x2b seconds * 1000 \x2b milliseconds) \x2b offset\n    const text = (match[4] as string).replace(regTime, \x27\x27).replace(regTimeCompatible, \x27\x27)\n    if (!text) return \/\/ 优化：不要显示空行\n    this.LRC.push({ time, text })\n    matchAll(match[4]) \/\/ 递归匹配多个时间标签\n  }\n\n  this.currentLRC.replace(\/\\\\n\/g, \x27\\n\x27).split(\x27\\n\x27).forEach(line =\x3e matchAll(line))\n\n  \/\/ 歌词格式不支持\n  if (this.LRC.length \x3c= 0) this.LRC = [{ time: -1, text: \x27(・∀・*) 抱歉，该歌词格式不支持\x27 }]\n  else this.LRC.sort((a, b) =\x3e a.time - b.time)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22typescript hljs\x22\x3e\x3ccode class=\x22typescript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e parseLRC (): \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e\x26lt;\x3cspan class=\x22hljs-built_in\x22\x3evoid\x3c\/span\x3e\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc || \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc === \x3cspan class=\x22hljs-string\x22\x3e\x27loading\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isURL(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc)) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果歌词是一个URL地址则请求该地址获得歌词文本\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e Axios.get(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc.toString())\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentLRC = data\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentLRC = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reg = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\[(\\d\x2b):(\\d\x2b)[.|:](\\d\x2b)\\](.\x2b)\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e regTime = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\[(\\d\x2b):(\\d\x2b)[.|:](\\d\x2b)\\]\/g\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e regCompatible = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\[(\\d\x2b):(\\d\x2b)]()(.\x2b)\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e regTimeCompatible = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\[(\\d\x2b):(\\d\x2b)]\/g\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e regOffset = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\[offset:\\s*(-{0,1}\\d\x2b)\\]\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e offsetMatch = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lrc.match(regOffset)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e offset = offsetMatch ? \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.parseInt(offsetMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]) : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.LRC = []\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e matchAll = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eline: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e match = line.match(reg) || line.match(regCompatible)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!match) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (match.length !== \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e minutes = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.parseInt(match[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]) || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e seconds = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.parseInt(match[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]) || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e milliseconds = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e.parseInt(match[\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]) || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e time = (minutes * \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e \x2b seconds * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e \x2b milliseconds) \x2b offset\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e text = (match[\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e] \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e).replace(regTime, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).replace(regTimeCompatible, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!text) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 优化：不要显示空行\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.LRC.push({ time, text })\n    matchAll(match[\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 递归匹配多个时间标签\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentLRC.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\\n\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e).split(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e =\x26gt;\x3c\/span\x3e matchAll(line))\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 歌词格式不支持\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.LRC.length \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.LRC = [{ time: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, text: \x3cspan class=\x22hljs-string\x22\x3e\x27(・∀・*) 抱歉，该歌词格式不支持\x27\x3c\/span\x3e }]\n  \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.LRC.sort(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ea, b\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e a.time - b.time)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/MoeFE\/vue-aplayer\/blob\/master\/src\/components\/Lyric\/src\/Lyric.ts#L70-L105\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e点击查看完整代码\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e完善了原 \x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPlayer\x3c\/a\x3e 不足的地方：\x3cbr\x3e1.可以响应式的随意控制播放器属性  \x3cbr\x3e2.歌词同步支持多种时间标签格式（fix \x3ca href=\x22https:\/\/github.com\/DIYgod\/APlayer\/issues\/39\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e#39\x3c\/a\x3e）  \x3cbr\x3e3.歌词同步兼容 \x3ccode\x3e[offset:0]\x3c\/code\x3e 标签  \x3cbr\x3e4.异步歌词的支持  \x3cbr\x3e5.允许控制播放速度（相同的歌曲用不同的速度听感觉会不一样哦 quq）  \x3cbr\x3e6.音量允许拖动控制  \x3cbr\x3e7.支持注册所有 \x3ccode\x3eMedia\x3c\/code\x3e 事件  \x3cbr\x3e8.保存播放器配置到 \x3ccode\x3elocalStorage\x3c\/code\x3e 中，刷新后可以恢复播放进度等信息\x3c\/p\x3e\n\x3cp\x3e并且体验了一把用 \x3ca href=\x22http:\/\/www.typescriptlang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTS\x3c\/a\x3e 写 \x3ca href=\x22https:\/\/cn.vuejs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 的快感w \x3c\/p\x3e\n\x3cp\x3e最后 弱弱的：\x3ca href=\x22https:\/\/github.com\/MoeFE\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@MoeFE\x3c\/a\x3e 欢迎各位大佬加入 (๑•̀ㅂ•́)و✧  \x3cbr\x3e额..没啥要求 头像要萌要可爱的！！\x3c\/p\x3e\n\x3cp\x3e好想有个大佬能带我装逼带我飞 (ง •_•)ง\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 TS + Vue 重写 APlayer HTML5 音乐播放器</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010324395">https://segmentfault.com/a/1190000010324395</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fiiariwzu3/" target="_blank">https://alili.tech/archive/fiiariwzu3/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/dgic8s5qnlg/">CSS五种方式实现Footer置底<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/z94br1a9g2o/">React的10种有效的设计模式<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/xe4kfnhxlfo/">Seneca ：NodeJS 微服务框架入门指南<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/ffpl5ftnw2u/">Unable to preventDefault inside passive event listener<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/twqwd2wscy/">Vue源码详细解析:transclude,compile,link,依赖,批处理...一网打尽，全解析!<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/i1zivpsjdl/">chart.js 中文文档 翻译<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/ik09416kg2/">flex-box 速记表<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/ic5ys9tnr1n/">riotjs 2.2.4<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/wd1i4kdw4jq/">vuejs2.0运用原生js实现简单的拖拽元素功能<aside class="dates">2019-01-25</aside></a></li><li><a href="/archive/l7r8ye5804/">一道JS面试题所引发的&#34;血案&#34;，透过现象寻本质，再从本质看现象<aside class="dates">2019-01-25</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>