<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JS原生一步步实现前端路由和单页面应用"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JS原生一步步实现前端路由和单页面应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/s4apghsr7o/",
				"appid": "1613049289050283", 
				"title": "JS原生一步步实现前端路由和单页面应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hjgkntbgqek/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/if1i2hs28ah/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&text=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&text=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&title=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&is_video=false&description=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&title=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&title=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&title=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fs4apghsr7o%2f&title=JS%e5%8e%9f%e7%94%9f%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0%e5%89%8d%e7%ab%af%e8%b7%af%e7%94%b1%e5%92%8c%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%ba%94%e7%94%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JS原生一步步实现前端路由和单页面应用</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前端路由实现之 #hash\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e先上github项目地址：\x3c\/strong\x3e \x3ca href=\x22https:\/\/github.com\/kliuj\/spa-routers\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3espa-routers\x3c\/a\x3e\x3cbr\x3e\x3cstrong\x3e运行效果图\x3c\/strong\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVFi7l?w=581\x26amp;h=312\x22 src=\x22https:\/\/static.alili.tech\/img\/bVFi7l?w=581\x26amp;h=312\x22 alt=\x22运行效果图\x22 title=\x22运行效果图\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e背景介绍\x3c\/h2\x3e\n\x3cp\x3e用了许多前端框架来做\x3ccode\x3espa\x3c\/code\x3e应用，比如说\x3ccode\x3ebackbone，angular，vue\x3c\/code\x3e他们都有各自的路由系统，管理着前端的每一个页面切换，想要理解其中路由的实现，最好的方法就是手动实现一个。\x3cbr\x3e前端路由有2种实现方式，一种是html5推出的\x3ccode\x3ehistoryapi\x3c\/code\x3e，我们这里说的是另一种\x3ccode\x3ehash\x3c\/code\x3e路由，就是常见的 \x3ccode\x3e#\x3c\/code\x3e 号，这种方式兼容性更好。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e需求分析\x3c\/h2\x3e\n\x3cp\x3e我们这里只是简单的实现一个路由轮子，基本的功能包含以下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e切换页面\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步加载js\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步传参\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e实现步骤\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e切换页面：路由的最大作用就是切换页面，以往后台的路由是直接改变了页面的url方式促使页面刷新。但是前端路由通过 # 号不能刷新页面，只能通过  window 的监听事件  hashchange 来监听hash的变化，然后捕获到具体的hash值进行操作\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/路由切换\nwindow.addEventListener(\x27hashchange\x27,function(){\n    \/\/do something \n    this.hashChange()\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/路由切换\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27hashchange\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something \x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hashChange()\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e注册路由：我们需要把路由规则注册到页面，这样页面在切换的时候才会有不同的效果。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/注册函数\n map:function(path,callback){\n   path = path.replace(\/\\s*\/g,\x26quot;\x26quot;);\/\/过滤空格\n   \/\/在有回调，且回调是一个正确的函数的情况下进行存储 以 \/name 为key的对象 {callback:xx}\n   if(callback \x26amp;\x26amp; Object.prototype.toString.call(callback) === \x27[object Function]\x27 ){\n       this.routers[path] ={\n            callback:callback,\/\/回调\n            fn:null \/\/存储异步文件状态，用来记录异步的js文件是否下载，下文有提及\n        } \n    }else{\n    \/\/打印出错的堆栈信息\n        console.trace(\x27注册\x27\x2bpath\x2b\x27地址需要提供正确的的注册回调\x27)\n    }\n }\n \n \/\/调用方式\n map(\x27\/detail\x27,function(transition){\n  ...\n  })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/注册函数\x3c\/span\x3e\n map:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epath,callback\x3c\/span\x3e)\x3c\/span\x3e{\n   path = path.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\s*\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/过滤空格\x3c\/span\x3e\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/在有回调，且回调是一个正确的函数的情况下进行存储 以 \/name 为key的对象 {callback:xx}\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(callback \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e ){\n       \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.routers[path] ={\n            \x3cspan class=\x22hljs-attr\x22\x3ecallback\x3c\/span\x3e:callback,\x3cspan class=\x22hljs-comment\x22\x3e\/\/回调\x3c\/span\x3e\n            fn:\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/存储异步文件状态，用来记录异步的js文件是否下载，下文有提及\x3c\/span\x3e\n        } \n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/打印出错的堆栈信息\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27注册\x27\x3c\/span\x3e\x2bpath\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27地址需要提供正确的的注册回调\x27\x3c\/span\x3e)\n    }\n }\n \n \x3cspan class=\x22hljs-comment\x22\x3e\/\/调用方式\x3c\/span\x3e\n map(\x3cspan class=\x22hljs-string\x22\x3e\x27\/detail\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etransition\x3c\/span\x3e)\x3c\/span\x3e{\n  ...\n  })\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e异步加载js：一般单页面应用为了性能优化，都会把各个页面的文件拆分开，按需加载，所以路由里面要加入异步加载js文件的功能。异步加载我们就采用最简单的原生方法，创建script标签，动态引入js。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var _body= document.getElementsByTagName(\x27body\x27)[0],\n    scriptEle= document.createElement(\x27script\x27); \nscriptEle.type= \x27text\/javascript\x27; \nscriptEle.src= xxx.js; \nscriptEle.async = true;\nscriptEle.onload= function(callback){ \n    \/\/为了避免重复引入js，我们需要在这里记录一下已经加载过的文件，对应的 fn需要赋值处理\n    callback()\n} \n_body.appendChild(scriptEle);     \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _body= \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n    scriptEle= \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e); \nscriptEle.type= \x3cspan class=\x22hljs-string\x22\x3e\x27text\/javascript\x27\x3c\/span\x3e; \nscriptEle.src= xxx.js; \nscriptEle.async = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\nscriptEle.onload= \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e)\x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/为了避免重复引入js，我们需要在这里记录一下已经加载过的文件，对应的 fn需要赋值处理\x3c\/span\x3e\n    callback()\n} \n_body.appendChild(scriptEle);     \x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e参数传递：在我们动态引入单独模块的js之后，我们可能需要给这个模块传递一些单独的参数。这里借鉴了一下jsonp的处理方式，我们把单独模块的js包装成一个函数，提供一个全局的回调方法，加载完成时候再调用回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22SPA_RESOLVE_INIT = function(transition) { \n    document.getElementById(\x26quot;content\x26quot;).innerHTML = \x27\x3cp style=\x26quot;color:#F8C545;\x26quot;\x3e当前异步渲染列表页\x27\x2b JSON.stringify(transition) \x2b\x27\x3c\/p\x3e\x27\n    console.log(\x26quot;首页回调\x26quot; \x2b JSON.stringify(transition))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eSPA_RESOLVE_INIT = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etransition\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;p style=\x22color:#F8C545;\x22\x26gt;当前异步渲染列表页\x27\x3c\/span\x3e\x2b \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(transition) \x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;\/p\x26gt;\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22首页回调\x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(transition))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cstrong\x3e扩展：\x3c\/strong\x3e以上我们已经完成了基本功能，我们再对齐进行扩展，在页面切换之前\x3ccode\x3ebeforeEach\x3c\/code\x3e和切换完成\x3ccode\x3eafterEach\x3c\/code\x3e的时候增加2个方法进行处理。思路是，注册了这2个方法之后，在切换之前就调用\x3ccode\x3ebeforeEach\x3c\/code\x3e，切换之后，需要等待下载js完成，在\x3ccode\x3eonload\x3c\/code\x3e里面进行调用 \x3ccode\x3eafterEach\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/切换之前一些处理\n        beforeEach:function(callback){\n            if(Object.prototype.toString.call(callback) === \x27[object Function]\x27){\n                this.beforeFun = callback;\n            }else{\n                console.trace(\x27路由切换前钩子函数不正确\x27)\n            }\n        },\n        \/\/切换成功之后\n        afterEach:function(callback){\n            if(Object.prototype.toString.call(callback) === \x27[object Function]\x27){\n                this.afterFun = callback;\n            }else{\n                console.trace(\x27路由切换后回调函数不正确\x27)\n            }\n        },\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/切换之前一些处理\x3c\/span\x3e\n        beforeEach:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.beforeFun = callback;\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27路由切换前钩子函数不正确\x27\x3c\/span\x3e)\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/切换成功之后\x3c\/span\x3e\n        afterEach:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.afterFun = callback;\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27路由切换后回调函数不正确\x27\x3c\/span\x3e)\n            }\n        },\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过以上的思路分析，再加以整合，我们就完成了一个简单的前端路由，并且可以加到页面进行实际的SPA开发，不过还是非常简陋。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e完整代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/*\n*author:https:\/\/github.com\/kliuj\n**使用方法\n*        1：注册路由 : spaRouters.map(\x27\/name\x27,function(transition){\n                        \/\/异步加载js \n                        spaRouters.asyncFun(\x27name.js\x27,transition)\n                        \/\/或者同步执行回调\n                        spaRouters.syncFun(function(transition){},transition)\n                    })\n        2：初始化      spaRouters.init()\n        3：跳转  href = \x27#\/name\x27            \n*\/\n(function() {\n    var util = {\n        \/\/获取路由的路径和详细参数\n        getParamsUrl:function(){\n            var hashDeatail = location.hash.split(\x26quot;?\x26quot;),\n                hashName = hashDeatail[0].split(\x26quot;#\x26quot;)[1],\/\/路由地址\n                params = hashDeatail[1] ? hashDeatail[1].split(\x26quot;\x26amp;\x26quot;) : [],\/\/参数内容\n                query = {};\n            for(var i = 0;i\x3cparams.length ; i\x2b\x2b){\n                var item = params[i].split(\x26quot;=\x26quot;);\n                query[item[0]] = item[1]\n            }        \n            return     {\n                path:hashName,\n                query:query\n            }\n        }\n    }\n    function spaRouters(){\n        this.routers = {};\/\/保存注册的所有路由\n        this.beforeFun = null;\/\/切换前\n        this.afterFun = null;\n    }\n    spaRouters.prototype={\n        init:function(){\n            var self = this;\n            \/\/页面加载匹配路由\n            window.addEventListener(\x27load\x27,function(){\n                self.urlChange()\n            })\n            \/\/路由切换\n            window.addEventListener(\x27hashchange\x27,function(){\n                self.urlChange()\n            })\n            \/\/异步引入js通过回调传递参数\n            window.SPA_RESOLVE_INIT = null;\n        },\n        refresh:function(currentHash){\n            var self = this;\n            if(self.beforeFun){    \n                self.beforeFun({\n                    to:{\n                        path:currentHash.path,\n                        query:currentHash.query\n                    },\n                    next:function(){\n                        self.routers[currentHash.path].callback.call(self,currentHash)\n                    }\n                })\n            }else{\n                self.routers[currentHash.path].callback.call(self,currentHash)\n            }\n        },\n        \/\/路由处理\n        urlChange:function(){\n            var currentHash = util.getParamsUrl();\n            if(this.routers[currentHash.path]){\n                this.refresh(currentHash)\n            }else{\n                \/\/不存在的地址重定向到首页\n                location.hash = \x27\/index\x27\n            }\n        },\n        \/\/单层路由注册\n        map:function(path,callback){\n            path = path.replace(\/\\s*\/g,\x26quot;\x26quot;);\/\/过滤空格\n            if(callback \x26amp;\x26amp; Object.prototype.toString.call(callback) === \x27[object Function]\x27 ){\n                this.routers[path] ={\n                    callback:callback,\/\/回调\n                    fn:null \/\/存储异步文件状态\n                } \n            }else{\n                console.trace(\x27注册\x27\x2bpath\x2b\x27地址需要提供正确的的注册回调\x27)\n            }\n        },\n        \/\/切换之前一些处理\n        beforeEach:function(callback){\n            if(Object.prototype.toString.call(callback) === \x27[object Function]\x27){\n                this.beforeFun = callback;\n            }else{\n                console.trace(\x27路由切换前钩子函数不正确\x27)\n            }\n        },\n        \/\/切换成功之后\n        afterEach:function(callback){\n            if(Object.prototype.toString.call(callback) === \x27[object Function]\x27){\n                this.afterFun = callback;\n            }else{\n                console.trace(\x27路由切换后回调函数不正确\x27)\n            }\n        },\n        \/\/路由异步懒加载js文件\n        asyncFun:function(file,transition){\n           var self = this;\n           if(self.routers[transition.path].fn){\n                   self.afterFun \x26amp;\x26amp; self.afterFun(transition)     \n                   self.routers[transition.path].fn(transition)\n           }else{\n                  console.log(\x26quot;开始异步下载js文件\x26quot;\x2bfile)\n               var _body= document.getElementsByTagName(\x27body\x27)[0]; \n               var scriptEle= document.createElement(\x27script\x27); \n               scriptEle.type= \x27text\/javascript\x27; \n               scriptEle.src= file; \n               scriptEle.async = true;\n               SPA_RESOLVE_INIT = null;\n               scriptEle.onload= function(){ \n                   console.log(\x27下载\x27\x2bfile\x2b\x27完成\x27)\n                   self.afterFun \x26amp;\x26amp; self.afterFun(transition)     \n                   self.routers[transition.path].fn = SPA_RESOLVE_INIT;\n                   self.routers[transition.path].fn(transition)\n               } \n               _body.appendChild(scriptEle);         \n           }        \n        },\n        \/\/同步操作\n        syncFun:function(callback,transition){\n            this.afterFun \x26amp;\x26amp; this.afterFun(transition)\n            callback \x26amp;\x26amp;　callback(transition)\n        }\n\n    }\n    \/\/注册到window全局\n    window.spaRouters = new spaRouters();\n})()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/*\n*author:https:\/\/github.com\/kliuj\n**使用方法\n*        1：注册路由 : spaRouters.map(\x27\/name\x27,function(transition){\n                        \/\/异步加载js \n                        spaRouters.asyncFun(\x27name.js\x27,transition)\n                        \/\/或者同步执行回调\n                        spaRouters.syncFun(function(transition){},transition)\n                    })\n        2：初始化      spaRouters.init()\n        3：跳转  href = \x27#\/name\x27            \n*\/\x3c\/span\x3e\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e util = {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取路由的路径和详细参数\x3c\/span\x3e\n        getParamsUrl:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hashDeatail = location.hash.split(\x3cspan class=\x22hljs-string\x22\x3e\x22?\x22\x3c\/span\x3e),\n                hashName = hashDeatail[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].split(\x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\x3cspan class=\x22hljs-comment\x22\x3e\/\/路由地址\x3c\/span\x3e\n                params = hashDeatail[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] ? hashDeatail[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].split(\x3cspan class=\x22hljs-string\x22\x3e\x22\x26amp;\x22\x3c\/span\x3e) : [],\x3cspan class=\x22hljs-comment\x22\x3e\/\/参数内容\x3c\/span\x3e\n                query = {};\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;i\x26lt;params.length ; i\x2b\x2b){\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e item = params[i].split(\x3cspan class=\x22hljs-string\x22\x3e\x22=\x22\x3c\/span\x3e);\n                query[item[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]] = item[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n            }        \n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e     {\n                \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e:hashName,\n                \x3cspan class=\x22hljs-attr\x22\x3equery\x3c\/span\x3e:query\n            }\n        }\n    }\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3espaRouters\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.routers = {};\x3cspan class=\x22hljs-comment\x22\x3e\/\/保存注册的所有路由\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.beforeFun = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/切换前\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.afterFun = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    }\n    spaRouters.prototype={\n        \x3cspan class=\x22hljs-attr\x22\x3einit\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/页面加载匹配路由\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                self.urlChange()\n            })\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/路由切换\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27hashchange\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                self.urlChange()\n            })\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/异步引入js通过回调传递参数\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.SPA_RESOLVE_INIT = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3erefresh\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecurrentHash\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(self.beforeFun){    \n                self.beforeFun({\n                    \x3cspan class=\x22hljs-attr\x22\x3eto\x3c\/span\x3e:{\n                        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e:currentHash.path,\n                        \x3cspan class=\x22hljs-attr\x22\x3equery\x3c\/span\x3e:currentHash.query\n                    },\n                    \x3cspan class=\x22hljs-attr\x22\x3enext\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                        self.routers[currentHash.path].callback.call(self,currentHash)\n                    }\n                })\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                self.routers[currentHash.path].callback.call(self,currentHash)\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/路由处理\x3c\/span\x3e\n        urlChange:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentHash = util.getParamsUrl();\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.routers[currentHash.path]){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refresh(currentHash)\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/不存在的地址重定向到首页\x3c\/span\x3e\n                location.hash = \x3cspan class=\x22hljs-string\x22\x3e\x27\/index\x27\x3c\/span\x3e\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/单层路由注册\x3c\/span\x3e\n        map:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epath,callback\x3c\/span\x3e)\x3c\/span\x3e{\n            path = path.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\s*\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/过滤空格\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(callback \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e ){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.routers[path] ={\n                    \x3cspan class=\x22hljs-attr\x22\x3ecallback\x3c\/span\x3e:callback,\x3cspan class=\x22hljs-comment\x22\x3e\/\/回调\x3c\/span\x3e\n                    fn:\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/存储异步文件状态\x3c\/span\x3e\n                } \n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27注册\x27\x3c\/span\x3e\x2bpath\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27地址需要提供正确的的注册回调\x27\x3c\/span\x3e)\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/切换之前一些处理\x3c\/span\x3e\n        beforeEach:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.beforeFun = callback;\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27路由切换前钩子函数不正确\x27\x3c\/span\x3e)\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/切换成功之后\x3c\/span\x3e\n        afterEach:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.toString.call(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27[object Function]\x27\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.afterFun = callback;\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.trace(\x3cspan class=\x22hljs-string\x22\x3e\x27路由切换后回调函数不正确\x27\x3c\/span\x3e)\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/路由异步懒加载js文件\x3c\/span\x3e\n        asyncFun:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efile,transition\x3c\/span\x3e)\x3c\/span\x3e{\n           \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n           \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(self.routers[transition.path].fn){\n                   self.afterFun \x26amp;\x26amp; self.afterFun(transition)     \n                   self.routers[transition.path].fn(transition)\n           }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22开始异步下载js文件\x22\x3c\/span\x3e\x2bfile)\n               \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _body= \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]; \n               \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e scriptEle= \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e); \n               scriptEle.type= \x3cspan class=\x22hljs-string\x22\x3e\x27text\/javascript\x27\x3c\/span\x3e; \n               scriptEle.src= file; \n               scriptEle.async = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n               SPA_RESOLVE_INIT = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n               scriptEle.onload= \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ \n                   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27下载\x27\x3c\/span\x3e\x2bfile\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27完成\x27\x3c\/span\x3e)\n                   self.afterFun \x26amp;\x26amp; self.afterFun(transition)     \n                   self.routers[transition.path].fn = SPA_RESOLVE_INIT;\n                   self.routers[transition.path].fn(transition)\n               } \n               _body.appendChild(scriptEle);         \n           }        \n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/同步操作\x3c\/span\x3e\n        syncFun:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback,transition\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.afterFun \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.afterFun(transition)\n            callback \x26amp;\x26amp;　callback(transition)\n        }\n\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/注册到window全局\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.spaRouters = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e spaRouters();\n})()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单的单页面在github上有完整的demo\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/kliuj\/spa-routers\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3espa-routers\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e以上仅是我个人的一些看法，如有疑问，感谢指导\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JS原生一步步实现前端路由和单页面应用</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007422616">https://segmentfault.com/a/1190000007422616</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/s4apghsr7o/" target="_blank">https://alili.tech/archive/s4apghsr7o/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>