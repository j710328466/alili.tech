<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 husky 和 lint-staged 构建超溜的代码检查工作流"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 husky 和 lint-staged 构建超溜的代码检查工作流 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ggmo08gcwxc/",
				"appid": "1613049289050283", 
				"title": "用 husky 和 lint-staged 构建超溜的代码检查工作流 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-13T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xghqzsw0bgq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/z5hk43ua46d/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&text=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&text=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&title=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&is_video=false&description=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&title=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&title=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&title=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fggmo08gcwxc%2f&title=%e7%94%a8%20husky%20%e5%92%8c%20lint-staged%20%e6%9e%84%e5%bb%ba%e8%b6%85%e6%ba%9c%e7%9a%84%e4%bb%a3%e7%a0%81%e6%a3%80%e6%9f%a5%e5%b7%a5%e4%bd%9c%e6%b5%81"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 husky 和 lint-staged 构建超溜的代码检查工作流</h1><div class="meta"><div class="postdate"><time datetime="2019-01-13" itemprop="datePublished">2019-01-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546916?w=1195\x26amp;h=705\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546916?w=1195\x26amp;h=705\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e具备基本工程素养的同学都会注重编码规范，而代码风格检查（Code Linting，简称 Lint）是保障代码规范一致性的重要手段，你的工作流中有 Lint 环节么？有的话你用的爽么？你在团队中推广过 Lint，但是大家都不买账？究竟是为啥？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eLint 是什么？\x3c\/h2\x3e\n\x3cp\x3e探讨怎么做之前，我们很有必要给 Lint 来个清晰、准确的定义，\x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Lint_%28software%29\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewikipedia 的定义\x3c\/a\x3e如下：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eIn computer programming, lint is a Unix utility that flags some suspicious and non-portable constructs (likely to be bugs) in C language source code; generically, lint or a linter is any tool that flags suspicious usage in software written in any computer language. The term lint-like behavior is sometimes applied to the process of flagging suspicious language usage. Lint-like tools generally perform static analysis of source code.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e简单来说，Lint 就是对代码做静态分析，并试图找出潜在问题的工具，实战中我们也用 Lint 来指使用工具的过程。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e为什么要 Lint？\x3c\/h2\x3e\n\x3cp\x3e使用 Lint 会有什么好处呢？在我看来至少具有如下 3 点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e更少的 Bug，剑桥大学的\x3ca href=\x22http:\/\/www.prweb.com\/releases\/2013\/1\/prweb10298185.htm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e研究\x3c\/a\x3e发现，全世界每年因为软 Bug 造成的经济损失约 3120 亿美金；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e更高的开发效率，工程师平均会花掉 50% 的工作时间定位和解决各种 Bug，其中不乏那些显而易见的低级错误，而 Lint 很容易发现低级的、显而易见的错误；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e更高的可读性，代码可读性的首要因子是“表面文章”，表面上看起来乱糟糟的代码通常更难读懂；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e可以毫不客气的说，如果你不做 Lint，就是在浪费自己的时间，浪费公司的资源。既然做 Lint 的预期效果很好？该怎么做呢？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e提交后 Lint：反馈链条太长？\x3c\/h2\x3e\n\x3cp\x3e说到怎么做，多数人会自然而然的想到各种 Lint 工具，目前社区中针对各种语言都开发了 Lint 工具，前端能用到的就有大把：\x3ca href=\x22http:\/\/eslint.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eESLint\x3c\/a\x3e、\x3ca href=\x22https:\/\/standardjs.com\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eStandard\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/brigade\/scss-lint\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSCSSLint\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/zaach\/jsonlint\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJSONLint\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/yaniswang\/HTMLHint\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTMLHint\x3c\/a\x3e 等。GitHub 官方出品的 \x3ca href=\x22https:\/\/github.com\/showcases\/clean-code-linters\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eLint 工具列表\x3c\/a\x3e 也是个非常不错的参考。\x3c\/p\x3e\n\x3cp\x3e很多同学选择在持续集成阶段（后文用 CI 代称）做 Lint，比如使用远程的 Git Hooks 来触发。但是从实际的经历来看，这种做法的反馈链条通常如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22代码提交 --\x3e 发现问题(远程) --\x3e 修复问题 --\x3e 重新提交 --\x3e 通过检查(远程)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e代码提交\x3cspan class=\x22hljs-function\x22\x3e --\x26gt;\x3c\/span\x3e 发现问题\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(远程)\x3c\/span\x3e --\x26gt;\x3c\/span\x3e 修复问题\x3cspan class=\x22hljs-function\x22\x3e --\x26gt;\x3c\/span\x3e 重新提交\x3cspan class=\x22hljs-function\x22\x3e --\x26gt;\x3c\/span\x3e 通过检查(远程)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e整个过程可能会浪费掉你不少时间，毕竟 CI 过程通常不仅是在做 Lint，如果你是那种不知道自己时间每天都去哪儿了的工程师，可以反思下自己或者团队的工作流是否是这样。并且，请相信我，你不是少数人。\x3c\/p\x3e\n\x3cp\x3e你有没有这样的经历：吭哧吭哧写了几天代码，各种验收都通过了，最后被 CI 拒绝，竟是因为你的代码中少加了一个逗号，这时候心情简直崩溃到无法形容：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546917?w=500\x26amp;h=357\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546917?w=500\x26amp;h=357\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e从 GitHub 上各种修复 Lint 的提交数量不难发现工程师在修复 Lint 问题上浪费的时间，比如搜索 \x22fix lint\x22，多达 45W 次提交：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546918?w=934\x26amp;h=424\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546918?w=934\x26amp;h=424\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e再比如搜索 “fix indent”，多达 226W 次提交，是不是很触目惊心？\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546919?w=942\x26amp;h=428\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546919?w=942\x26amp;h=428\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只在 CI 流程做 Lint 的缺点也是显而易见的：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eLint 在整个开发工作流中的反馈链条太长，浪费时间、注意力和资源，最致命的；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eCI 流程搭建成本比较高，即使有各种 CI 服务，步骤也还是比较繁琐；\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们该怎么改进？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e提交前 Lint：错误信息不相关？\x3c\/h2\x3e\n\x3cp\x3e为了缩短 Lint 的反馈链条，把 Lint 挪到本地是最有效的办法。常见做法是使用 \x3ca href=\x22https:\/\/github.com\/typicode\/husky\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehusky\x3c\/a\x3e 或者 \x3ca href=\x22https:\/\/github.com\/observing\/pre-commit\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epre-commit\x3c\/a\x3e 在本地提交之前做 Lint。\x3c\/p\x3e\n\x3cp\x3e使用 husky 的具体做法如下：\x3c\/p\x3e\n\x3cp\x3e首先，安装依赖：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install -D husky\nyarn add --dev husky\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enpm install -D husky\nyarn add --dev husky\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后修改 package.json，增加配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;scripts\x26quot;: {\n    \x26quot;precommit\x26quot;: \x26quot;eslint src\/**\/*.js\x26quot;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22precommit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22eslint src\/**\/*.js\x22\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后尝试 Git 提交，你就会很快收到反馈：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22git commit -m \x26quot;Keep calm and commit\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nginx\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3egit\x3c\/span\x3e commit -m \x3cspan class=\x22hljs-string\x22\x3e\x22Keep calm and commit\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是在遗留代码仓库上工作的同学很快会遇到新的问题，开启 Lint 初期，你可能会面临成千上万的 Lint Error 需要修复。部分同学对下面这个图可能并不陌生：只改了文件 A，但是文件 B、C、D 中也有大量错误。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546920?w=1240\x26amp;h=447\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546920?w=1240\x26amp;h=447\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e把整个仓库都格式化不失为一种选择，但是实际上需要很大的勇气。多数人在项目中运用新工具都希望是渐进式的，而不是推到重来式的，因为相比而言，业务系统稳定是更重要的事情。简单的把 Lint 挪到本地，反馈链条是缩短了，但是面对每次改动，\x3cstrong\x3e工具还是给出了太多不相关的信息\x3c\/strong\x3e，这无疑与小步快跑的互联网节奏是相违背的。\x3c\/p\x3e\n\x3cp\x3e该怎么破？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e只  Lint 改动的：66666\x3c\/h2\x3e\n\x3cp\x3e如果把 Lint 挪到本地，并且每次提交只检查本次提交所修改的文件，上面的痛点就都解决了。Feedly 的工程师 \x3ca href=\x22https:\/\/www.npmjs.com\/~okonet\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAndrey Okonetchnikov\x3c\/a\x3e 开发的 \x3ca href=\x22https:\/\/github.com\/okonet\/lint-staged\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elint-staged\x3c\/a\x3e 就是基于这个想法，其中 staged 是 Git 里面的概念，指待提交区，使用 \x3ccode\x3egit commit -a\x3c\/code\x3e，或者先 \x3ccode\x3egit add\x3c\/code\x3e 然后 \x3ccode\x3egit commit\x3c\/code\x3e 的时候，你的修改代码都会经过待提交区。\x3c\/p\x3e\n\x3cp\x3elint-staged 用法如下：\x3c\/p\x3e\n\x3cp\x3e首先，安装依赖：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install -D lint-staged\nyarn add --dev lint-staged\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3enpm install -D lint-staged\nyarn add --dev lint-staged\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，修改 package.json 配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;scripts\x26quot;: {\n    \x26quot;precommit\x26quot;: \x26quot;lint-staged\x26quot;\n  },\n  \x26quot;lint-staged\x26quot;: {\n    \x26quot;src\/**\/*.js\x26quot;: \x26quot;eslint\x26quot;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22precommit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22src\/**\/*.js\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22eslint\x22\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后，尝试提交的效果：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009546921?w=828\x26amp;h=568\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009546921?w=828\x26amp;h=568\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e实际上，lint-staged 给了你提交前代码操作的更大自由度，比如使用下面的配置，自动修复错误：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;scripts\x26quot;: {\n    \x26quot;precommit\x26quot;: \x26quot;lint-staged\x26quot;\n  },\n  \x26quot;lint-staged\x26quot;: {\n    \x26quot;src\/**\/*.js\x26quot;: [\x26quot;eslint --fix\x26quot;, \x26quot;git add\x26quot;]\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22precommit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22src\/**\/*.js\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22eslint --fix\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22git add\x22\x3c\/span\x3e]\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e或者使用下面的配置，自动格式化代码（谨慎使用）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;scripts\x26quot;: {\n    \x26quot;precommit\x26quot;: \x26quot;lint-staged\x26quot;\n  },\n  \x26quot;lint-staged\x26quot;: {\n    \x26quot;src\/**\/*.js\x26quot;: [\x26quot;prettier --write\x26quot;, \x26quot;git add\x26quot;]\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22precommit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22lint-staged\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22src\/**\/*.js\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22prettier --write\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22git add\x22\x3c\/span\x3e]\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此外，lint-staged 和 prettier \x3ca href=\x22https:\/\/github.com\/facebookincubator\/create-react-app\/pull\/1759\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e已经集成到 create-react-app 中了\x3c\/a\x3e。你是不是也应该好好打磨下自己的 Lint 工作流了？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e有人说前端攻城狮是世界上最奇怪的动物，提交代码时用 prettier 把代码排版的很美观，但部署上线时又使用 uglify 把代码压缩的连亲妈都不认了，事实是，如果我们写出来的代码本来就很丑陋，就根本不需要用 uglify。希望读到这里的你能把 Lint 工作流打磨到极致，把更多时间专注在解决真正的问题上，成为真正高效的工程师。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eOne More Thing\x3c\/h2\x3e\n\x3cp\x3e本文作者王仕军，商业转载请联系作者获得授权，非商业转载请注明出处。如果你觉得本文对你有帮助，请点赞！如果对文中的内容有任何疑问，欢迎留言讨论。想知道我接下来会写些什么？欢迎订阅我的\x3ca href=\x22https:\/\/juejin.im\/user\/57a7f634d342d300576b738d\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e掘金专栏\x3c\/a\x3e或\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/feweekly\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e知乎专栏\x3c\/a\x3e：《前端周刊：让你在前端领域跟上时代的脚步》。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 husky 和 lint-staged 构建超溜的代码检查工作流</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009546913">https://segmentfault.com/a/1190000009546913</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ggmo08gcwxc/" target="_blank">https://alili.tech/archive/ggmo08gcwxc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>