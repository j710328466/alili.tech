<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="H5打造3d场景不完全攻略（二）: Amazing CSS3D"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>H5打造3d场景不完全攻略（二）: Amazing CSS3D | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/if1i2hs28ah/",
				"appid": "1613049289050283", 
				"title": "H5打造3d场景不完全攻略（二）: Amazing CSS3D | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/s4apghsr7o/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ke982v6qrfg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&text=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&text=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&title=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&is_video=false&description=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&title=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&title=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&title=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fif1i2hs28ah%2f&title=H5%e6%89%93%e9%80%a03d%e5%9c%ba%e6%99%af%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%94%bb%e7%95%a5%ef%bc%88%e4%ba%8c%ef%bc%89%3a%20Amazing%20CSS3D"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">H5打造3d场景不完全攻略（二）: Amazing CSS3D</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e对的，本文就是着重介绍如何使用CSS3中的3D变换打造出H5中的3D效果。灵感来源于造物节团队的3d引擎，因为使用方法比较复杂，也没有开源的API文档，于是想自己另外造个轮子，便开始了相关内容的学习和实践。\x3cbr\x3e众所周知，目前市面上的H5 3D类库（如Three）、引擎（Egret）、构建工具（kpano、720云）都或存在体积太大、不开源、非免费、学习成本高等问题。对于我们较为熟悉的CSS3，为什么就不对它好好利用一把呢？诚然，CSS3存在我们比较清楚的短板，CSS对平面的渲染能力高，但是对3D建模方面便力不从心了。\x3c\/p\x3e\n\x3cp\x3e我们知道3D的表现形式即让我们通过平面可从不同角度看到真实物体的展示效果。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e在计算机世界里，3D世界是由点组成，两个点能够组成一条直线，三个不在一条直线上的点就能够组成一个三角形面，无数三角形面就能够组成各种形状的物体，如下图。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAdbj?w=400\x26amp;h=321\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAdbj?w=400\x26amp;h=321\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们通常把这种网格模型叫做Mesh模型。给物体贴上皮肤，或者专业点就叫做纹理，那么这个物体就活灵活现了。最后无数的物体就组成了我们的3D世界。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3eThree中模型解析器的原理是将顶点数组将模型的顶点用数组储存起来，再利用three中的face函数取得定点数组中的三个或四个顶点的索引构成空间平面。如此反复，模型就被完整构造出来了。\x3c\/p\x3e\n\x3cp\x3e于是，越复杂的物体就需要越多的网面拼接。而css中是不存在根据坐标建立空间平面的能力的。\x3c\/p\x3e\n\x3cp\x3e（插个题外话，其实css有一个属性与坐标有关，那就是clip-path。这个属性的特性赋予了css3一定的建模能力。实现方法可参考这篇文章 \x3ca href=\x22http:\/\/www.tuicool.com\/articles\/ZfQzy2v\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e纯clip-path打造的3D模型渲染器\x3c\/a\x3e）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eCSS3实现3D全景\x3c\/h2\x3e\n\x3cp\x3e。上篇文章介绍了Web3D的一些表现形式，这里着重谈谈怎么以CSS3实现3D全景。下面会探索Three实现全景的方案，因为WebGL门槛和学习成本还是比较高的，不适于用于快速开发。造物节的CSS3d全景已有文章对其进行了技术探秘，但都未深入谈及具体实现方式。\x3c\/p\x3e\n\x3cp\x3e要清晰理解实现方式，必须对CSS3的transform、perspective有一定的认识。\x3cbr\x3e原理方面的东西我就不深入讲了，大家可以先看看这篇文章，对CSS3D有一个大致的概念。\x3cbr\x3e\x3ca href=\x22http:\/\/www.oxxostudio.tw\/articles\/201506\/css-3d.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e玩轉 CSS 3D - 原理篇\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eCSS全景可通过建立柱形或者立方体再通过贴图方式实现。也许会有人问，球体行不行？实际上是不行的，球体模型由无数个极小的平面拼接构成连贯曲面，而CSS缺乏使平面扭曲的属性。球体模型我们可以使用上文提过的Clip-3d建造出，但是，贴图问题就解决不了了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e天空盒子\x3c\/h3\x3e\n\x3cp\x3e相信很多打造过或有了解过3d全景的同行们都知道这个概念。实际上Skybox就是一个立方体，通过给六个面贴上不同的，边缘可以无缝贴合的图片，再将视角伸入盒子内部。可以想象成我们自己站入了一个巨型立方体盒子内部，移动视角便能看到不同的场景。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAetN?w=590\x26amp;h=417\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAetN?w=590\x26amp;h=417\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e1、贴图\x3cbr\x3e来看一张天空盒子的贴图，剪头指向的边缘代表需要无缝贴合的边。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAd8L?w=564\x26amp;h=422\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAd8L?w=564\x26amp;h=422\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e从上图可以看出只要相互贴合的两个面上的图像能够无缝拼接，那么再通过对各个面进行一定的旋转变换，天空盒子就能被打造出来了。\x3c\/p\x3e\n\x3cp\x3e那么问题来了，怎么去拍摄制作这样的图片呢？这就需要通过一些专业软件了，比如pano2vr，max等。其实，需要用到这些专业工具打造的全景对画质和拼合度的要求都非常高了，而单纯依靠CSS3中的变化给不了它们很好的体验。\x3c\/p\x3e\n\x3cp\x3e但我们今天讨论的是某些运营活动H5打造的全景，此全景不一定真实存在，或者是和真实场景有一定的比例差距。例如星空、海底。对于这类贴合度可人为改变的全景图的打造，我们可以采用现有的高清图片，再经由PS转换成六面全景图。\x3cbr\x3e贴一篇文章 \x3ca href=\x22http:\/\/www.interlopers.net\/tutorials\/28841\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCreate a Skybox From Photos\x3c\/a\x3e\x3cbr\x3e其实主要思想是\x3cbr\x3e在一张大图上勾画出六个面的选取 \x26gt;\x3cbr\x3e选择大图中某个面的相邻面将其旋转到需要拼合的盒子的某个面上，使他们完美贴合 \x26gt;\x3cbr\x3e得到最合理的六面贴图后，观察有无创造出新的边缘，通过蒙版等工具使他们自然融合。\x3c\/p\x3e\n\x3cp\x3e2、构造\x3cbr\x3e贴图完成就可以创建立方体了。首先将创建好的六个面切割出来，以front、back、left、right…命名标记位置。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 .sence {\n      -webkit-perspective: 1000px;\n    }\n    .cube {\n      width: 500px;\n      height: 500px;\n      margin: 100px auto;\n      transform-style: preserve-3d;\n    }\n    .cube img {\n      width: 130px;\n      height: 130px;\n      position: absolute;\n    }\n    .cube img:nth-child(1) {\n\n    }\n    .cube img:nth-child(2) {\n      transform:  rotateY(180deg);\n    }\n    .cube img:nth-child(3) {\n      transform:  rotateY(90deg);\n    }\n    .cube img:nth-child(4) {\n      transform:  rotateY(-90deg);\n    }\n    .cube img:nth-child(5) {\n      transform:  rotateX(90deg);\n    }\n    .cube img:nth-child(6) {\n      transform:  rotateX(-90deg);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-selector-class\x22\x3e.sence\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3e-webkit-perspective\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1000px\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e auto;\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform-style\x3c\/span\x3e: preserve-\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3ed;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e130px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e130px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(1)\x3c\/span\x3e {\n\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(2)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3erotateY\x3c\/span\x3e(180deg);\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(3)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3erotateY\x3c\/span\x3e(90deg);\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(4)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3erotateY\x3c\/span\x3e(-90deg);\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(5)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3erotateX\x3c\/span\x3e(90deg);\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(6)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3erotateX\x3c\/span\x3e(-90deg);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;sence\x26quot;\x3e\n    \x3cdiv class=\x26quot;cube\x26quot;\x3e\n      \x3cimg src=\x26quot;img\/skybox\/front.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n      \x3cimg src=\x26quot;img\/skybox\/back.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n      \x3cimg src=\x26quot;img\/skybox\/left.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n      \x3cimg src=\x26quot;img\/skybox\/right.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n      \x3cimg src=\x26quot;img\/skybox\/top.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n      \x3cimg src=\x26quot;img\/skybox\/bottom.jpg\x26quot; alt=\x26quot;\x26quot; \/\x3e\n    \x3c\/div\x3e\n  \x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e class=\x3cspan class=\x22hljs-string\x22\x3e\x22sence\x22\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e class=\x3cspan class=\x22hljs-string\x22\x3e\x22cube\x22\x3c\/span\x3e\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/front.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/back.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/left.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/right.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/top.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e src=\x3cspan class=\x22hljs-string\x22\x3e\x22img\/skybox\/bottom.jpg\x22\x3c\/span\x3e alt=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\n    \x26lt;\/div\x26gt;\n  \x26lt;\/div\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e准备好6个面，载入贴图。通过旋转，使得每个面旋转到相印的位置。如左边的面由原本面朝我们的图片绕Y轴逆时针旋转90°得到。（注意Y轴逆时针旋转是正数）\x3c\/p\x3e\n\x3cp\x3e此时会得到下图这样的效果：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAfbj?w=168\x26amp;h=158\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAfbj?w=168\x26amp;h=158\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e但是由于每个面的旋转中心都在其正中位置，因此还不能形成正方体。于是我们需要让每个面产生一定的位移。\x3c\/p\x3e\n\x3cp\x3e贴一张坐标系图以助于大家理解。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAfeM?w=368\x26amp;h=402\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAfeM?w=368\x26amp;h=402\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e现在首先让front位移到应该到的位置，由于全景图的镜头在立方体内部，因此，可以想象一下，我们需要将图片往后移动。移动距离很明显为立方体边长的一半。在这里是65px。得到下图结果。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.cube img:nth-child(1) {\n      transform: translateZ(-65px);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:nth-child(1)\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etranslateZ\x3c\/span\x3e(-65px);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAfd0?w=195\x26amp;h=175\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAfd0?w=195\x26amp;h=175\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e照这样看，是不是back位移为\x3ccode\x3etranslateZ(65px)\x3c\/code\x3e，left为\x3ccode\x3etranslateX(-65px)\x3c\/code\x3e，top \x3ccode\x3etranslateY(-65px)\x3c\/code\x3e呢？但结果并不是我们想要的。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAffd?w=137\x26amp;h=237\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAffd?w=137\x26amp;h=237\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e重新看回上文空间坐标系的那张贴图，我们会发现，平面旋转后，其对应的三个轴的位置也改变了。如图片绕Y旋转后，Z轴指向为屏幕的水平方向。绕X旋转后，Z轴指向垂直方向。因此我们很容易发现，其实要将贴面移动到正确的位置，都只需要让他们\x3ccode\x3etranslateZ(-width\/2px)\x3c\/code\x3e就可以了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAfgF?w=188\x26amp;h=176\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAfgF?w=188\x26amp;h=176\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e为了让大家容易理解，我这里设置了一个较大的perspective。要想得到全景的效果，我们将镜头拉近让它进入到box里面就可以了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAfjj?w=1687\x26amp;h=430\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAfjj?w=1687\x26amp;h=430\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e接下来绑定手势，就可以让它动起来啦。\x3c\/p\x3e\n\x3cp\x3e部分代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22viewer.on(\x27touchstart\x27, function(e) {\n    x1 = e.targetTouches[0].pageX; - $(this).offset().left;\n    y1 = e.targetTouches[0].pageY; - $(this).offset().top;\n});\n\nviewer.on(\x27touchmove\x27,function(){\n    var dist_x = x2 - x1,\n        dist_y = y2 - y1,\n        deg_x = Math.atan2(dist_y, perspective) \/ Math.PI * 180,\n        deg_y = -Math.atan2(dist_x, perspective) \/ Math.PI * 180,\n        i,\n        c_x_deg \x2b= deg_x;\n        c_y_deg \x2b= deg_y;\n        \n    cube.css(\x27transform\x27, \x27rotateX(\x27 \x2b deg_x \x2b \x27deg) rotateY(\x27 \x2b deg_y \x2b \x27deg)\x27);\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eviewer.on(\x3cspan class=\x22hljs-string\x22\x3e\x27touchstart\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    x1 = e.targetTouches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageX; - $(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e).offset().left;\n    y1 = e.targetTouches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageY; - $(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e).offset().top;\n});\n\nviewer.on(\x3cspan class=\x22hljs-string\x22\x3e\x27touchmove\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dist_x = x2 - x1,\n        dist_y = y2 - y1,\n        deg_x = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.atan2(dist_y, perspective) \/ \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI * \x3cspan class=\x22hljs-number\x22\x3e180\x3c\/span\x3e,\n        deg_y = -\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.atan2(dist_x, perspective) \/ \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI * \x3cspan class=\x22hljs-number\x22\x3e180\x3c\/span\x3e,\n        i,\n        c_x_deg \x2b= deg_x;\n        c_y_deg \x2b= deg_y;\n        \n    cube.css(\x3cspan class=\x22hljs-string\x22\x3e\x27transform\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27rotateX(\x27\x3c\/span\x3e \x2b deg_x \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27deg) rotateY(\x27\x3c\/span\x3e \x2b deg_y \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27deg)\x27\x3c\/span\x3e);\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eMath.atan2(y,x) 方法：得到从 x 轴到点 (x,y) 之间的角度。对于空间左边系比较难理解，大家可以想象成一张以空间Z轴为Y轴的平面绕X轴正方向旋转的角度即为cube绕空间Y轴旋转的角度。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e柱形\x3c\/h3\x3e\n\x3cp\x3e柱形全景也不算复杂。关于圆柱形的打造方法，大家可以参考下这篇文章\x3ca href=\x22http:\/\/www.htmleaf.com\/ziliaoku\/qianduanjiaocheng\/201502061338.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCSS3 3D transforms系列教程-3D旋转木马\x3c\/a\x3e\x3cbr\x3e有了这个基础，我们可以写一段函数快速构造柱形全景。\x3c\/p\x3e\n\x3cp\x3e先来看下页面结构\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n  body {\n    height: 100%;\n    overflow: hidden;\n  }\n    .scene {\n      width: 100%;\n      height: 1170px;\n      transform: translateX(-50%) translateY(-50%);\n      top: 50%;\n      left: 50%;\n      position: absolute;\n    }\n    .cube {\n      transform-style: preserve-3d;\n      height: 100%;\n      width: 100%;\n      margin: 0px auto;\n    }\n    .cube_bg {\n      transform-style: preserve-3d;\n      height: 100%;\n      width: 128px;\n      margin: 0px auto;\n    }\n    .cube_bg div {\n      height: 100%;\n      \n      \/* 这里为圆柱形的每个面都设定了同样的背景图 那么在建造柱形时不再需要手动切图 *\/\n      background-image: url(\x26quot;img\/zao\/zao.png\x26quot;);\n      \n      background-repeat: no-repeat;\n      position: absolute;\n      top: 0;\n    }\n\x3c\/style\x3e\n\n\x3cbody\x3e\n  \x3cdiv class=\x26quot;scene\x26quot;\x3e\n    \x3cdiv class=\x26quot;cube\x26quot;\x3e\n      \x3cdiv class=\x26quot;cube_bg\x26quot;\x3e\n        \x3c!--\n        这里是柱形全景背景贴图\n        --\x3e\n      \x3c\/div\x3e\n      \x3cdiv class=\x26quot;cube_item\x26quot;\x3e\n        \x3c!--\n        这里是柱形全景中的小元件\n        --\x3e\n      \x3c\/div\x3e\n    \x3c\/div\x3e\n  \x3c\/div\x3e\n\x3c\/body\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n  \x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eoverflow\x3c\/span\x3e: hidden;\n  }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.scene\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1170px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etranslateX\x3c\/span\x3e(-50%) \x3cspan class=\x22hljs-built_in\x22\x3etranslateY\x3c\/span\x3e(-50%);\n      \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform-style\x3c\/span\x3e: preserve-\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3ed;\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0px\x3c\/span\x3e auto;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube_bg\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3etransform-style\x3c\/span\x3e: preserve-\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3ed;\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e128px\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0px\x3c\/span\x3e auto;\n    }\n    \x3cspan class=\x22hljs-selector-class\x22\x3e.cube_bg\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n      \n      \x3cspan class=\x22hljs-comment\x22\x3e\/* 这里为圆柱形的每个面都设定了同样的背景图 那么在建造柱形时不再需要手动切图 *\/\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attribute\x22\x3ebackground-image\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22img\/zao\/zao.png\x22\x3c\/span\x3e);\n      \n      \x3cspan class=\x22hljs-attribute\x22\x3ebackground-repeat\x3c\/span\x3e: no-repeat;\n      \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n      \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22scene\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22cube\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22cube_bg\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--\n        这里是柱形全景背景贴图\n        --\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22cube_item\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--\n        这里是柱形全景中的小元件\n        --\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function creCylinder(lenZ,pieceWid,angle,slice){\n\n    \/* \n    pieceWid 表示单个柱形块状宽度\n    angle表示柱形内角\n    slice表示有多少个面拼接 \n    slice越多，拼合的面越接近曲面\n    *\/\n    \n  var l = pieceWid*slice; \/\/ 画布全长\n  var ag = angle\/slice \/\/ 旋转角度\n\n  var html = \x27\x27;\n\n  \/*\n    设置每个面的旋转角度和位移 因为要分割成多个面，所以应该为每个面的背景图设置不同的`background-position`\n    *\/\n\n  for(var i=0,len=slice;i\x3clen;i\x2b\x2b){\n    html\x2b=\x27\x3cdiv style=\x26quot;transform: rotateY(-\x27\x2bag*i\x2b\x27deg) \x27\x2b\n          \x27translateZ(\x27\x2blenZ\x2b\x27px);\x27\x2b\n          \x27width:\x27\x2b(pieceWid)\x2b\x27px;\x27\x2b\n          \x27background-position: -\x27\x2b(i*pieceWid)\x2b\x27px 0;\x27\x2b\n          \x27background-size: \x27\x2b(l)\x2b\x27px 100%;\x26quot;\x3e\x3c\/div\x3e\x27;\n  }\n\n    return html;\n}\n\nfunction renderPano(pieceWid,angle,slice){\n\n    var vw = $(window).width();\n\n    var RADIAN = 0.017453293; \/\/ 弧度制 将角度转成弧度\n\n    var innerAngle = angle\/(2*slice); \/\/内角，用来计算translateZ\n\n    \/\/ 这里的原理和上文旋转木马链接一致\n    var lenZ = -(pieceWid\/2)*Math.tan((90-innerAngle)*RADIAN);\n\n    \/*  \n        因为默认是由画布的最左端开始旋转 所以处于我们面前的是画布的最左端和最右端及其连接处\n        要想画布中央显示再我们面前，这里需要给cube_bg加上一定的绕Y旋转角度\n    *\/\n    var rotate = ((angle\/slice)*(slice-1))\/2,\n        perspective = -lenZ-5;\n\n    var cube_bg = $(\x27.cube_bg\x27),\n        scene = $(\x27.scene\x27);\n\n    var cylinder = creCylinder(lenZ,pieceWid,angle,slice);\n\n    cube_bg.html(cylinder).css(\x27transform\x27,\x27rotateY(\x27\x2brotate\x2b\x27deg)\x27);\n    scence.css(\x27-webkit-perspective\x27,perspective\x2b\x27px\x27);\n    \n    \/\/最后调用一下\n    renderPano(128,360,20);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreCylinder\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3elenZ,pieceWid,angle,slice\x3c\/span\x3e)\x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* \n    pieceWid 表示单个柱形块状宽度\n    angle表示柱形内角\n    slice表示有多少个面拼接 \n    slice越多，拼合的面越接近曲面\n    *\/\x3c\/span\x3e\n    \n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e l = pieceWid*slice; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画布全长\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ag = angle\/slice \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 旋转角度\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e html = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/*\n    设置每个面的旋转角度和位移 因为要分割成多个面，所以应该为每个面的背景图设置不同的`background-position`\n    *\/\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,len=slice;i\x26lt;len;i\x2b\x2b){\n    html\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div style=\x22transform: rotateY(-\x27\x3c\/span\x3e\x2bag*i\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27deg) \x27\x3c\/span\x3e\x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27translateZ(\x27\x3c\/span\x3e\x2blenZ\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27px);\x27\x3c\/span\x3e\x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27width:\x27\x3c\/span\x3e\x2b(pieceWid)\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27px;\x27\x3c\/span\x3e\x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27background-position: -\x27\x3c\/span\x3e\x2b(i*pieceWid)\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27px 0;\x27\x3c\/span\x3e\x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27background-size: \x27\x3c\/span\x3e\x2b(l)\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27px 100%;\x22\x26gt;\x26lt;\/div\x26gt;\x27\x3c\/span\x3e;\n  }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e html;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erenderPano\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epieceWid,angle,slice\x3c\/span\x3e)\x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vw = $(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e).width();\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e RADIAN = \x3cspan class=\x22hljs-number\x22\x3e0.017453293\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 弧度制 将角度转成弧度\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e innerAngle = angle\/(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e*slice); \x3cspan class=\x22hljs-comment\x22\x3e\/\/内角，用来计算translateZ\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里的原理和上文旋转木马链接一致\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e lenZ = -(pieceWid\/\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)*\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.tan((\x3cspan class=\x22hljs-number\x22\x3e90\x3c\/span\x3e-innerAngle)*RADIAN);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*  \n        因为默认是由画布的最左端开始旋转 所以处于我们面前的是画布的最左端和最右端及其连接处\n        要想画布中央显示再我们面前，这里需要给cube_bg加上一定的绕Y旋转角度\n    *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rotate = ((angle\/slice)*(slice\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e))\/\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n        perspective = -lenZ\x3cspan class=\x22hljs-number\x22\x3e-5\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cube_bg = $(\x3cspan class=\x22hljs-string\x22\x3e\x27.cube_bg\x27\x3c\/span\x3e),\n        scene = $(\x3cspan class=\x22hljs-string\x22\x3e\x27.scene\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cylinder = creCylinder(lenZ,pieceWid,angle,slice);\n\n    cube_bg.html(cylinder).css(\x3cspan class=\x22hljs-string\x22\x3e\x27transform\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27rotateY(\x27\x3c\/span\x3e\x2brotate\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27deg)\x27\x3c\/span\x3e);\n    scence.css(\x3cspan class=\x22hljs-string\x22\x3e\x27-webkit-perspective\x27\x3c\/span\x3e,perspective\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e);\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/最后调用一下\x3c\/span\x3e\n    renderPano(\x3cspan class=\x22hljs-number\x22\x3e128\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里解释一下perspective为什么要设成 \x3ccode\x3e-lenZ-5\x3c\/code\x3e\x3cbr\x3e看一张图，上面的\x3ccode\x3elenZ\x3c\/code\x3e即\x3ccode\x3etranslateZ\x3c\/code\x3e值，为负值。\x3cbr\x3eperspective为镜头到屏幕的距离，因为此时镜头在柱体内部，因此不能看到柱体后面的图像。\x3cbr\x3e当perspective值为-lenZ值时，正好柱体back面能与镜头在同一平面上，为了避免它有一定的机率遮挡镜头，我们可以将镜头拉近一些。便设成了\x3ccode\x3e-lenZ-5\x3c\/code\x3e。这个时候就能保证镜头处于柱体内部，同时也能更广角度地观察到柱体全景。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVAgcM?w=346\x26amp;h=342\x22 src=\x22https:\/\/static.alili.tech\/img\/bVAgcM?w=346\x26amp;h=342\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大家可以复制代码体验一下。这里的背景图我选用的是自己拼合成的造物节背景图。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e优劣势对比\x3c\/h3\x3e\n\x3cp\x3e相信大家也有体会，天空盒制造起来会相对的简单，并且天空和地面都能被考虑进去。但是由于面面间的贴合角度太大，若物体正好处于相互贴合的两个面，会给人一种被拦腰折断的感觉。而柱形图对这种情况有了比较好的解决，但是天空和地面的贴图就比较困难了，一般情况下只能通过给scene添加背景图片模拟。\x3c\/p\x3e\n\x3cp\x3e未完待续…\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>H5打造3d场景不完全攻略（二）: Amazing CSS3D</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007262754">https://segmentfault.com/a/1190000007262754</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/if1i2hs28ah/" target="_blank">https://alili.tech/archive/if1i2hs28ah/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>