<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Vue.js源码（2）：初探List Rendering"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Vue.js源码（2）：初探List Rendering | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4ntdhjv8fe2/",
				"appid": "1613049289050283", 
				"title": "Vue.js源码（2）：初探List Rendering | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-03T02:30:40"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/kcnu5ul5ec9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/aweotn3vwpj/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&text=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&text=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&title=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&is_video=false&description=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&title=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&title=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&title=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4ntdhjv8fe2%2f&title=Vue.js%e6%ba%90%e7%a0%81%ef%bc%882%ef%bc%89%ef%bc%9a%e5%88%9d%e6%8e%a2List%20Rendering"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Vue.js源码（2）：初探List Rendering</h1><div class="meta"><div class="postdate"><time datetime="2019-02-03" itemprop="datePublished">2019-02-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e下面例子来自官网，虽然看上去就比Hello World多了一个v-for，但是内部多了好多的处理过程。但是这就是框架，只给你留下最美妙的东西，让生活变得简单。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;mountNode\x26quot;\x3e\n    \x3cul\x3e\n        \x3cli v-for=\x26quot;todo in todos\x26quot;\x3e\n          \x22{{\x22 todo.text \x22}}\x22\n        \x3c\/li\x3e\n    \x3c\/ul\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs django\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mountNode\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22todo in todos\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 todo.text \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var vm = new Vue({\n    el: \x27#mountNode\x27,\n        data: {\n           todos: [\n               { text: \x27Learn JavaScript\x27 },\n               { text: \x27Learn Vue.js\x27 },\n               { text: \x27Build Something Awesome\x27 }\n           ]\n        }\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vim\x22\x3e\x3ccode\x3evar \x3cspan class=\x22hljs-keyword\x22\x3evm\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n    \x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3el:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27#mountNode\x27\x3c\/span\x3e,\n        dat\x3cspan class=\x22hljs-variable\x22\x3ea:\x3c\/span\x3e {\n           todo\x3cspan class=\x22hljs-variable\x22\x3es:\x3c\/span\x3e [\n               { tex\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Learn JavaScript\x27\x3c\/span\x3e },\n               { tex\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Learn Vue.js\x27\x3c\/span\x3e },\n               { tex\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Build Something Awesome\x27\x3c\/span\x3e }\n           ]\n        }\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这篇文章将要一起分析：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eobserve array\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eterminal directive\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ev-for指令过程\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3erecap\x3c\/h2\x3e\n\x3cp\x3e这里先用几张图片回顾和整理下上一篇\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006866881\x22\x3eVue.js源码（1）：Hello World的背后\x3c\/a\x3e的内容，这将对本篇的compile，link和bind过程的理解有帮助：\x3c\/p\x3e\n\x3cp\x3ecopmile阶段：主要是得到指令的descriptor\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg0k?w=823\x26amp;h=404\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg0k?w=823\x26amp;h=404\x22 alt=\x22Hello World compile phase\x22 title=\x22Hello World compile phase\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3elink阶段：实例化指令，替换DOM\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg0t?w=647\x26amp;h=240\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg0t?w=647\x26amp;h=240\x22 alt=\x22Hello World link phase\x22 title=\x22Hello World link phase\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ebind阶段：调用指令的bind函数，创建watcher\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg0F?w=978\x26amp;h=302\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg0F?w=978\x26amp;h=302\x22 alt=\x22Hello World bind phase\x22 title=\x22Hello World bind phase\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e用一张图表示即为：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC9jR?w=1268\x26amp;h=456\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC9jR?w=1268\x26amp;h=456\x22 alt=\x22Hello World complete process\x22 title=\x22Hello World complete process\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eobserve array\x3c\/h2\x3e\n\x3cp\x3e初始化中的merge options，proxy过程和Hello World的过程基本一样，所以这里直接从observe开始分析。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: src\/observer\/index.js\nvar ob = new Observer(value) \/\/ value = data = {todos: [{message: \x27Learn JavaScript\x27}, ...]}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ob = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Observer(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ value = data = {todos: [{message: \x27Learn JavaScript\x27}, ...]}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: src\/observer\/index.js\nexport function Observer (value) {\n  this.value = value\n  this.dep = new Dep()\n  def(value, \x27__ob__\x27, this)\n  if (isArray(value)) {     \/\/ 数组分支\n    var augment = hasProto\n      ? protoAugment\n      : copyAugment         \/\/ 选择增强方法\n    augment(value, arrayMethods, arrayKeys)     \/\/ 增强数组\n    this.observeArray(value)\n  } else {                  \/\/ plain object分支\n    this.walk(value)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3eexport function \x3cspan class=\x22hljs-title\x22\x3eObserver\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dep = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Dep()\n  def(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27__ob__\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isArray(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e)) {     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数组分支\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e augment = hasProto\n      ? protoAugment\n      : copyAugment         \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 选择增强方法\x3c\/span\x3e\n    augment(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e, arrayMethods, arrayKeys)     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 增强数组\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.observeArray(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {                  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ plain object分支\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.walk(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e增强数组\x3c\/h3\x3e\n\x3cp\x3e增强（augment）数组，即对数组进行扩展，使其能detect change。这里面有两个内容，一个是拦截数组的\x3ca href=\x22http:\/\/vuejs.org\/guide\/list.html#Mutation-Methods\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emutation methods\x3c\/a\x3e（导致数组本身发生变化的方法），一个是提供两个\x3ca href=\x22http:\/\/vuejs.org\/guide\/list.html#Caveats\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e便利的方法\x3c\/a\x3e\x3ccode\x3e$set\x3c\/code\x3e和\x3ccode\x3e$remove\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e拦截有两个方法，如果浏览器实现\x3ccode\x3e__proto__\x3c\/code\x3e那么就使用protoAugment，否则就使用copyAugment。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: src\/util\/evn.js\nexport const hasProto = \x27__proto__\x27 in {}\n\n\/\/ file path: src\/observer\/index.js\n\/\/ 截取原型链\nfunction protoAugment (target, src) {\n  target.__proto__ = src\n}\n\n\/\/ file path: src\/observer\/index.js\n\/\/ 定义属性\nfunction copyAugment (target, src, keys) {\n  for (var i = 0, l = keys.length; i \x3c l; i\x2b\x2b) {\n    var key = keys[i]\n    def(target, key, src[key])\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/util\/evn.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hasProto = \x3cspan class=\x22hljs-string\x22\x3e\x27__proto__\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e {}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 截取原型链\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprotoAugment\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etarget, src\x3c\/span\x3e) \x3c\/span\x3e{\n  target.__proto__ = src\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义属性\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecopyAugment\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etarget, src, keys\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = keys.length; i \x26lt; l; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = keys[i]\n    def(target, key, src[key])\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了更直观，请看下面的示意图：\x3c\/p\x3e\n\x3cp\x3e增强之前：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg8Z?w=829\x26amp;h=217\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg8Z?w=829\x26amp;h=217\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通过原型链拦截：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg86?w=819\x26amp;h=339\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg86?w=819\x26amp;h=339\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通过定义属性拦截：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDg88?w=826\x26amp;h=341\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDg88?w=826\x26amp;h=341\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在拦截器\x3ccode\x3earrayMethods\x3c\/code\x3e里面，就是对这些mutation methods进行包装：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e调用原生的Array.prototype中的方法\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e检查是否有新的值被插入（主要是push, unshift和splice方法）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果有新值插入，observe它们\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e最后就是notify change：调用observer的dep.notify()\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: src\/observer\/array.js\n;[\n  \x27push\x27,\n  \x27pop\x27,\n  \x27shift\x27,\n  \x27unshift\x27,\n  \x27splice\x27,\n  \x27sort\x27,\n  \x27reverse\x27\n]\n.forEach(function (method) {\n  \/\/ cache original method\n  var original = arrayProto[method]\n  def(arrayMethods, method, function mutator () {\n    \/\/ avoid leaking arguments:\n    \/\/ http:\/\/jsperf.com\/closure-with-arguments\n    var i = arguments.length\n    var args = new Array(i)\n    while (i--) {\n      args[i] = arguments[i]\n    }\n    var result = original.apply(this, args)\n    var ob = this.__ob__\n    var inserted\n    switch (method) {\n      case \x27push\x27:\n        inserted = args\n        break\n      case \x27unshift\x27:\n        inserted = args\n        break\n      case \x27splice\x27:\n        inserted = args.slice(2)\n        break\n    }\n    if (inserted) ob.observeArray(inserted)\n    \/\/ notify change\n    ob.dep.notify()\n    return result\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/array.js\x3c\/span\x3e\n;[\n  \x3cspan class=\x22hljs-string\x22\x3e\x27push\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27pop\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27shift\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27unshift\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27splice\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27sort\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27reverse\x27\x3c\/span\x3e\n]\n.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emethod\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ cache original method\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e original = arrayProto[method]\n  def(arrayMethods, method, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emutator\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ avoid leaking arguments:\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ http:\/\/jsperf.com\/closure-with-arguments\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e(i)\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i--) {\n      args[i] = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e[i]\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = original.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, args)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ob = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__ob__\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e inserted\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (method) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27push\x27\x3c\/span\x3e:\n        inserted = args\n        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27unshift\x27\x3c\/span\x3e:\n        inserted = args\n        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27splice\x27\x3c\/span\x3e:\n        inserted = args.slice(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (inserted) ob.observeArray(inserted)\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ notify change\x3c\/span\x3e\n    ob.dep.notify()\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eobserveArray()\x3c\/h3\x3e\n\x3cp\x3e知道上一篇的observe()，这里的\x3ccode\x3eobserveArray()\x3c\/code\x3e就很简单了，即对数组对象都observe一遍，为各自对象生成Observer实例。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: src\/observer\/index.js\nObserver.prototype.observeArray = function (items) {\n  for (var i = 0, l = items.length; i \x3c l; i\x2b\x2b) {\n    observe(items[i])\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: src\/observer\/index.js\x3c\/span\x3e\nObserver.prototype.observeArray = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(items)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = items.length; i \x26lt; l; i\x2b\x2b) {\n    observe(items[i])\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3ecompile\x3c\/h2\x3e\n\x3cp\x3e在介绍v-for的compile之前，有必要回顾一下compile过程：compile是一个递归遍历DOM tree的过程，这个过程对每个node进行指令类型，指令参数，表达式，过滤器等的解析。\x3c\/p\x3e\n\x3cp\x3e递归过程大致如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3ecompile当前node\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果当前node没有terminal directive，则遍历child node，分别对其compile node\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果当前node有terminal directive，则跳过其child node\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这里有个terminal directive的概念，这个概念在\x3ca href=\x22http:\/\/vuejs.org\/guide\/custom-directive.html#Element-Directives\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eElement Directive\x3c\/a\x3e中提到过：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eA big difference from normal directives is that element directives are terminal, which means once Vue encounters an element directive, it will completely skip that element\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e实际上自带的directive中也有两个terminal的directive，v-for和v-if（v-else）。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3eterminal directive\x3c\/h3\x3e\n\x3cp\x3e在源码中找到：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eterminal directive will have a terminal link function, which build a node link function for a terminal directive. A terminal link function terminates the current compilation recursion and handles compilation of the subtree in the directive.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e也就是上面递归过程中描述的，有terminal directive的node在compile时，会跳过其child node的compile过程。而这些child node将由这个directive单独compile（partial compile）。\x3c\/p\x3e\n\x3cp\x3e以图为例，红色节点有terminal directive，compile时（绿线）将其子节点跳过：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC74Y?w=1317\x26amp;h=551\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC74Y?w=1317\x26amp;h=551\x22 alt=\x22compile terminal\x22 title=\x22compile terminal\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e为什么是v-for和v-if？因为它们会带来节点的增加或者删除。\x3c\/p\x3e\n\x3cp\x3eCompile的中间产物是directive的descriptor，也可能会创建directive来管理的document fragment。这些产物是在link阶段时需要用来实例化directive的。从racap中的图可以清楚的看到，compile过程产出了和link过程怎么使用的它们。那么现在看看v-for的情况：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC8kp?w=1038\x26amp;h=524\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC8kp?w=1038\x26amp;h=524\x22 alt=\x22List Rendering compile phase\x22 title=\x22List Rendering compile phase\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ecompile之后，只得到了v-for的descriptor，link时将用它实例化v-for指令。\x3c\/p\x3e\n\x3cp\x3ev-for descriptor:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22descriptor = {\n    name: \x27for\x27,\n    attrName: \x27v-for\x27,\n    expression: \x27todo in todos\x27,\n    raw: \x27todo in todos\x27,\n    def: vForDefinition\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sml\x22\x3e\x3ccode\x3edescriptor = {\n    name: \x3cspan class=\x22hljs-symbol\x22\x3e\x27for\x27\x3c\/span\x3e,\n    attrName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27v\x3c\/span\x3e-for\x27,\n    expression: \x3cspan class=\x22hljs-symbol\x22\x3e\x27todo\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e todos\x27,\n    raw: \x3cspan class=\x22hljs-symbol\x22\x3e\x27todo\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e todos\x27,\n    def: vForDefinition\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3elink\x3c\/h2\x3e\n\x3cp\x3eHello World中，link会实例化指令，并将其与compile阶段创建好的fragment（TextNode）进行绑定。但是本文例子中，可以看到compile过程没有创建fragment。这里的link过程只实例化指令，其他过程将发生在v-for指令内部。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDgY2?w=778\x26amp;h=453\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDgY2?w=778\x26amp;h=453\x22 alt=\x22List Rendering link phase\x22 title=\x22List Rendering link phase\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3ebind\x3c\/h2\x3e\n\x3cp\x3e主要的list rendering的魔法都在v-for里面，这里有FragmentFactory，partial compile还有diff算法（diff算法会在单独的文章介绍）。\x3c\/p\x3e\n\x3cp\x3e在v-for的bind()里面，做了三件事：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e重新赋值expression，找出alias：\x22todo in todos\x22里面，\x3ccode\x3etodo\x3c\/code\x3e是alias，\x3ccode\x3etodos\x3c\/code\x3e才是真正的需要监听的表达式\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e移除\x26lt;li v-for=\x22todo in todos\x22\x26gt;\x22{{\x22todo.text\x22}}\x22\x26lt;\/li\x26gt;元素，替换上start和end锚点（anchor）。锚点用来帮助插入最终的li节点\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e创建FragmentFactory：factory会compile被移除的li节点，得到并缓存linker，后面会用linker创建Fragment\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: \/src\/directives\/public\/for.js\nbind () {\n    \/\/ 找出alias，赋值expression = \x26quot;todos\x26quot;\n    var inMatch = this.expression.match(\/(.*) (?:in|of) (.*)\/)\n    if (inMatch) {\n      var itMatch = inMatch[1].match(\/\\((.*),(.*)\\)\/)\n      if (itMatch) {\n        this.iterator = itMatch[1].trim()\n        this.alias = itMatch[2].trim()\n      } else {\n        this.alias = inMatch[1].trim()\n      }\n      this.expression = inMatch[2]\n    }\n    \n    ...\n    \n    \/\/ 创建锚点，移除LI元素\n    this.start = createAnchor(\x27v-for-start\x27)\n    this.end = createAnchor(\x27v-for-end\x27)\n    replace(this.el, this.end)\n    before(this.start, this.end)\n\n    ...\n\n    \/\/ 创建FragmentFactory\n    this.factory = new FragmentFactory(this.vm, this.el)\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ file path: \/src\/directives\/public\/for.js\x3c\/span\x3e\nbind () {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 找出alias，赋值expression = \x22todos\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e inMatch = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.expression.match(\/(.*) (?:\x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e|of) (.*)\/)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (inMatch) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e itMatch = inMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].match(\/\\((.*),(.*)\\)\/)\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (itMatch) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.iterator = itMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].trim()\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.alias = itMatch[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e].trim()\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.alias = inMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].trim()\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.expression = inMatch[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n    }\n    \n    ...\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建锚点，移除LI元素\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.start = createAnchor(\x3cspan class=\x22hljs-string\x22\x3e\x27v-for-start\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.end = createAnchor(\x3cspan class=\x22hljs-string\x22\x3e\x27v-for-end\x27\x3c\/span\x3e)\n    replace(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.end)\n    before(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.start, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.end)\n\n    ...\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建FragmentFactory\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.factory = new FragmentFactory(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.el)\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDgUp?w=1448\x26amp;h=499\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDgUp?w=1448\x26amp;h=499\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/demo.jackyang.me\/vue-src-pic\/list_rendering_partial_compile.png\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e大图链接\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3eFragment \x26amp; FragmentFactory\x3c\/h3\x3e\n\x3cp\x3e这里的Fragment，指的不是DocumentFragment，而是Vue内部实现的一个类，源码注释解释为：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eAbstraction for a partially-compiled fragment. Can optionally compile content with a child scope.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eFragmentFactory会compile\x3ccode\x3e\x26lt;li\x26gt;\x22{{\x22todo.text\x22}}\x22\x26lt;\/li\x26gt;\x3c\/code\x3e，并保存返回的linker。在v-for中，数组发生变化时，将创建scope，克隆template，即\x3ccode\x3e\x26lt;li\x26gt;\x22{{\x22todo.text\x22}}\x22\x26lt;\/li\x26gt;\x3c\/code\x3e，使用linker，实例化Fragment，然后挂在end锚点上。\x3c\/p\x3e\n\x3cp\x3e在Fragment中调用linker时，就是link和bind\x3ccode\x3e\x26lt;li\x26gt;\x22{{\x22todo.text\x22}}\x22\x26lt;\/li\x26gt;\x3c\/code\x3e，和Hello World中一样，创建v-text实例，创建watcher。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDgUt?w=1552\x26amp;h=808\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDgUt?w=1552\x26amp;h=808\x22 alt=\x22List Rendering bind phase\x22 title=\x22List Rendering bind phase\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/demo.jackyang.me\/vue-src-pic\/list_rendering_complete.png\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e大图链接\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3escope\x3c\/h3\x3e\n\x3cp\x3e为什么在v-for指令里面可以通过别名（alias）\x3ccode\x3etodo\x3c\/code\x3e访问循环变量？为什么有\x3ccode\x3e$index\x3c\/code\x3e和\x3ccode\x3e$key\x3c\/code\x3e这样的特殊变量？因为使用了child scope。\x3c\/p\x3e\n\x3cp\x3e还记得Hello World中watcher是怎么识别simplePath的吗？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var getter = new Function(\x27scope\x27, \x27return scope.message;\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs oxygene\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getter = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27scope\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27return scope.message;\x27\x3c\/span\x3e)\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这里，说白了就是访问\x3ccode\x3escope\x3c\/code\x3e对象的todo，$index或者$key属性。在v-for指令里，会扩展其父作用域，本例中父作用域对象就是vm本身。在调用factory创建每一个fragment时，都会以下面方式创建合适的child scope给其使用：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDfsX?w=452\x26amp;h=205\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDfsX?w=452\x26amp;h=205\x22 alt=\x22child scope\x22 title=\x22child scope\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ file path: \/src\/directives\/public\/for.js\ncreate (value, alias, index, key) {\n    \/\/ index是遍历数组时的下标\n    \/\/ value是对应下标的数组元素\n    \/\/ alias = \x27todo\x27\n    \/\/ key是遍历对象时的属性名称\n    ...\n    var parentScope = this._scope || this.vm\n    var scope = Object.create(parentScope) \/\/ 以parent scope为原型链创建child scope\n    ...\n    withoutConversion(() =\x3e {\n      defineReactive(scope, alias, value) \/\/ 添加alias到child scope\n    })\n    defineReactive(scope, \x27$index\x27, index) \/\/ 添加$index到child scope\n    ...\n    var frag = this.factory.create(host, scope, this._frag)\n    ...\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode\x3e\/\/ file path: \/src\/directives\/public\/for.js\n\x3cspan class=\x22hljs-keyword\x22\x3ecreate\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealias\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ekey\x3c\/span\x3e) {\n    \/\/ \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e是遍历数组时的下标\n    \/\/ \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e是对应下标的数组元素\n    \/\/ \x3cspan class=\x22hljs-keyword\x22\x3ealias\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27todo\x27\x3c\/span\x3e\n    \/\/ \x3cspan class=\x22hljs-keyword\x22\x3ekey\x3c\/span\x3e是遍历对象时的属性名称\n    ...\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parentScope = this._scope || this.vm\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e = Object.create(parentScope) \/\/ 以\x3cspan class=\x22hljs-keyword\x22\x3eparent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e为原型链创建\x3cspan class=\x22hljs-keyword\x22\x3echild\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e\n    ...\n    withoutConversion(() =\x26gt; {\n      defineReactive(\x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealias\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e) \/\/ 添加\x3cspan class=\x22hljs-keyword\x22\x3ealias\x3c\/span\x3e到\x3cspan class=\x22hljs-keyword\x22\x3echild\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e\n    })\n    defineReactive(\x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27$index\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e) \/\/ 添加$\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e到\x3cspan class=\x22hljs-keyword\x22\x3echild\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e\n    ...\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e frag = this.factory.create(host, \x3cspan class=\x22hljs-keyword\x22\x3escope\x3c\/span\x3e, this._frag)\n    ...\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader10\x22\x3edetect change\x3c\/h1\x3e\n\x3cp\x3e到这里，基本上“初探”了一下List Rendering的过程，里面有很多概念没有深入，打算放在后面结合其他使用这些概念的地方一起在分析，应该能体会到其巧妙的设计。\x3c\/p\x3e\n\x3cp\x3e最后举两个例子，回顾上面的内容\x3c\/p\x3e\n\x3cp\x3e例一：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22vm.todos[0].text = \x27Learn JAVASCRIPT\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3evm.todos[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].\x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27Learn JAVASCRIPT\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e改变的是数组元素中text属性，由于factory创建的fragment的v-text指令observe todo.text，因此这里直接由v-text指令更新对应li元素的TextNode内容。\x3c\/p\x3e\n\x3cp\x3e例二：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22vm.todos.push({text: \x27Learn Vue Source Code\x27});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3evm\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.todos\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.push\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Learn Vue Source Code\x27\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e增加了数组元素，v-for指令的watcher通知其做update，diff算法判断新增了一个元素，于是创建scope，factory克隆template，创建新的fragment，append在#end-anchor的前面，fragment中的v-text指令observe新增元素的text属性，将值更新到TextNode上。\x3c\/p\x3e\n\x3cp\x3e更多数组操作放在diff算法中再看。\x3c\/p\x3e\n\x3cp\x3e到这里，应该对官网上的这句话有更深的理解了：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eInstead of a Virtual DOM, Vue.js uses the actual DOM as the template and keeps references to actual nodes for data bindings.\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Vue.js源码（2）：初探List Rendering</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006938217">https://segmentfault.com/a/1190000006938217</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4ntdhjv8fe2/" target="_blank">https://alili.tech/archive/4ntdhjv8fe2/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/sj57jxyoook/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（上）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/qsw902j95k/">ES6 &#43; Webpack &#43; React &#43; Babel 如何在低版本浏览器上愉快的玩耍（下）<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/nnpmjlot58j/">IndexedDB使用与出坑指南<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/alvlbas9oai/">JS事件模型<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/u0pzym8k36o/">JS练习实例--编写经典小游戏俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/khwpyk5yz8q/">JavaScript 事件代理和委托<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/kuocl6lc3n/">JavaScript 版俄罗斯方块<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/n8bk54lyrf/">Promise学习:基础入门<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/7bk7u30qncb/">Redux 入坑进阶 - 源码解析<aside class="dates">2019-02-03</aside></a></li><li><a href="/archive/853kqfmqmf7/">Snap.svg 基本知识入门<aside class="dates">2019-02-03</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>