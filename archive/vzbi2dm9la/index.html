<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Node &#43; FFmpeg 实现Canvas动画导出视频"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Node &#43; FFmpeg 实现Canvas动画导出视频 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/vzbi2dm9la/",
				"appid": "1613049289050283", 
				"title": "Node &#43; FFmpeg 实现Canvas动画导出视频 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-17T02:30:25"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/n9sky2zvbk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/lmsm660oor/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&text=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&text=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&title=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&is_video=false&description=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&title=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&title=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&title=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvzbi2dm9la%2f&title=Node%20%2b%20FFmpeg%20%e5%ae%9e%e7%8e%b0Canvas%e5%8a%a8%e7%94%bb%e5%af%bc%e5%87%ba%e8%a7%86%e9%a2%91"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Node &#43; FFmpeg 实现Canvas动画导出视频</h1><div class="meta"><div class="postdate"><time datetime="2019-01-17" itemprop="datePublished">2019-01-17</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e导言\x3c\/h2\x3e\n\x3cp\x3eCanvas为前端提供了动画展示的平台，随着现在视频娱乐的流行，你是否想过把Canvas动画导出视频？目前纯前端的视频编码转换（例如WebM Encoder \x3ca href=\x22https:\/\/github.com\/antimatter15\/whammy\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWhammy\x3c\/a\x3e）还存在许多限制，较为成熟的方案是将每帧图片传给后端实现，由后端调用FFmpeg进行视频转码。整体流程并不复杂，这篇文章将带大家实现这个过程。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e整体方案\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e由前端记录Canvas动画的每帧图像，以base64字符串形式传给后端\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e利用node fluent-ffmpeg模块，调用FFmpeg将图片合并成视频，并将视频存储在server端，并返回相应下载url\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e前端通过请求得到视频文件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e前端部分\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e每帧图片生成\x3c\/h3\x3e\n\x3cp\x3e图片生成可以通过canvas原生接口toDataURL实现，最终返回base64形式的图像数据。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22generatePng () {\n  ...\n  var imgData = canvas.toDataURL(\x26quot;image\/png\x26quot;);\n  return imgData;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3egeneratePng () {\n  ...\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgData = canvas.toDataURL(\x3cspan class=\x22hljs-string\x22\x3e\x22image\/png\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e imgData;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e动画录制与图片流传输\x3c\/h3\x3e\n\x3cp\x3e动画的记录与传送是个异步过程，这里返回一个Promise，等待后端处理完毕，收到回应后，即完成此异步过程。\x3c\/p\x3e\n\x3cp\x3e以下代码将canvas每帧动画信息存入一个图片数组imgs中，将数组转成字符串的形式传给后端。注意这里contentType设置为“text\/plain”。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22generateVideo () {\n  var that = this;\n  return new Promise (\n    function (resolve, reject) {\n      var imgs = [];\n      ...\n      window.requestAnimationFrame(that.recordTick.bind(that, imgs, resolve, reject));\n    }\n  )\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livescript\x22\x3e\x3ccode\x3egenerateVideo () {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3ethat\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Promise (\n    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (resolve, reject) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgs = [];\n      ...\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(\x3cspan class=\x22hljs-literal\x22\x3ethat\x3c\/span\x3e.recordTick.bind(\x3cspan class=\x22hljs-literal\x22\x3ethat\x3c\/span\x3e, imgs, resolve, reject));\n    }\n  )\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22recordTick (imgs, resolve, reject) {\n  ...\/\/每帧动画的记录信息，如时间戳等\n\n  if (...) {\/\/动画终止条件\n    this.stopPlay();\n    imgs.push(this.generatePng());\n    $.ajax({\n      url: \x27\/video\/record\x27,\n      data: imgs.join(\x27 \x27),\n      method: \x27POST\x27,\n      contentType: \x27text\/plain\x27,\n      success: function (data, textStatus, jqXHR) {\n        resolve(data);\n      },\n      error: function (jqXHR, textStatus, errorThrown) {\n        reject(errorThrown);\n      }\n    });\n  } else {\n    ...\/\/每帧动画展示的代码\n\n    imgs.push(this.generatePng());\n    window.requestAnimationFrame(this.recordTick.bind(this, imgs, resolve, reject));\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3erecordTick (imgs, resolve, reject) {\n  ...\x3cspan class=\x22hljs-comment\x22\x3e\/\/每帧动画的记录信息，如时间戳等\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (...) {\x3cspan class=\x22hljs-comment\x22\x3e\/\/动画终止条件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.stopPlay();\n    imgs.push(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.generatePng());\n    $.ajax({\n      \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/video\/record\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: imgs.join(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e),\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3econtentType\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27text\/plain\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata, textStatus, jqXHR\x3c\/span\x3e) \x3c\/span\x3e{\n        resolve(data);\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ejqXHR, textStatus, errorThrown\x3c\/span\x3e) \x3c\/span\x3e{\n        reject(errorThrown);\n      }\n    });\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    ...\x3cspan class=\x22hljs-comment\x22\x3e\/\/每帧动画展示的代码\x3c\/span\x3e\n\n    imgs.push(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.generatePng());\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.recordTick.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, imgs, resolve, reject));\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e视频下载\x3c\/h3\x3e\n\x3cp\x3e上一节代码中，动画停止时，会通过post请求给后端传送所有图片数据，后端处理完毕后，返回数据中包含一个url，此url即为视频文件的下载地址。\x3c\/p\x3e\n\x3cp\x3e为了支持浏览器端用户点击下载，我们需要用到a标签的download属性，此属性可以支持点击a标签后下载指定文件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22editor.generateVideo().then(function (data) {\n  videoRecordingModal.setDownloadLink(data.url, data.filename);\n  videoRecordingModal.changeStatus(\x27recorded\x27);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3eeditor.generateVideo().\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e) {\n  videoRecordingModal.setDownloadLink(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.url, \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.filename);\n  videoRecordingModal.changeStatus(\x3cspan class=\x22hljs-string\x22\x3e\x27recorded\x27\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22setDownloadLink: function (url, filename) {\n  this.config.$dom.find(\x27.video-download\x27).attr(\x27href\x27, url);\n  this.config.$dom.find(\x27.video-download\x27).attr(\x27download\x27, filename);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3esetDownloadLink: function (url, filename) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e.$dom.\x3cspan class=\x22hljs-built_in\x22\x3efind\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.video-download\x27\x3c\/span\x3e).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27href\x27\x3c\/span\x3e, url);\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e.$dom.\x3cspan class=\x22hljs-built_in\x22\x3efind\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.video-download\x27\x3c\/span\x3e).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27download\x27\x3c\/span\x3e, filename);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e后端部分\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e图片序列生成\x3c\/h3\x3e\n\x3cp\x3e接收到前端传送的图片数据后，我们首先需要将图片解析、存储在服务器中，我们建立以当前时间戳命名的文件夹，将图片序列以一定格式存储于其中。由于每张图片写入都是异步过程，为确保所有图片都已处理完毕后，才执行视频转码过程，我们需要用到Promise.all。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Promise.all(imgs.map(function (value, index) {\n  var img = decodeBase64Image(value)\n  var data = img.data\n  var type = img.type\n  return new Promise(function (resolve, reject) {\n    fs.writeFile(path.resolve(__dirname, (folder \x2b \x27\/img\x27 \x2b index \x2b \x27.\x27 \x2b type)), data, \x27base64\x27, function(err) {\n      if (err) {\n        reject(err)\n      } else {\n        resolve()\n      }\n    })\n  })\n})).then(function () {\n  …\/\/视频转码\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(imgs.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue, index\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = decodeBase64Image(value)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = img.data\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e type = img.type\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    fs.writeFile(path.resolve(__dirname, (folder \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/img\x27\x3c\/span\x3e \x2b index \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e \x2b type)), data, \x3cspan class=\x22hljs-string\x22\x3e\x27base64\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n        reject(err)\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        resolve()\n      }\n    })\n  })\n})).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  …\x3cspan class=\x22hljs-comment\x22\x3e\/\/视频转码\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中decodeBase64Image函数参考\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/20267939\/nodejs-write-base64-image-file\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e视频生成\x3c\/h3\x3e\n\x3cp\x3e视频生成利用FFmpeg转码工具。\x3cbr\x3e首先确保server端安装了FFmpeg\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22brew install ffmpeg\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ebrew \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3einstall \x3c\/span\x3effmpeg\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在项目中安装fluent-ffmpeg，这是node调用ffmpeg的接口模块\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install fluent-ffmpeg --save\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e fluent-ffmpeg \x3cspan class=\x22hljs-comment\x22\x3e--save\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结合上一节图片序列存储的代码，整个接口代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.post(\x27\/video\/record\x27, function(req, res) {\n  var imgs = req.text.split(\x27 \x27)\n  var timeStamp = Date.now()\n  var folder = \x27images\/\x27 \x2b timeStamp\n  if (!fs.existsSync(resolve(folder))){\n    fs.mkdirSync(resolve(folder));\n  }\n\n  Promise.all(imgs.map(function (value, index) {\n    var img = decodeBase64Image(value)\n    var data = img.data\n    var type = img.type\n    return new Promise(function (resolve, reject) {\n      fs.writeFile(path.resolve(__dirname, (folder \x2b \x27\/img\x27 \x2b index \x2b \x27.\x27 \x2b type)), data, \x27base64\x27, function(err) {\n        if (err) {\n          reject(err)\n        } else {\n          resolve()\n        }\n      })\n    })\n  })).then(function () {\n    var proc = new ffmpeg({ source: resolve(folder \x2b \x27\/img%d.png\x27), nolog: true })\n      .withFps(25)\n      .on(\x27end\x27, function() {\n        res.status(200)\n        res.send({\n          url: \x27\/video\/mpeg\/\x27 \x2b timeStamp,\n          filename: \x27jianshi\x27 \x2b timeStamp \x2b \x27.mpeg\x27\n        })\n      })\n      .on(\x27error\x27, function(err) {\n        console.log(\x27ERR: \x27 \x2b err.message)\n      })\n      .saveToFile(resolve(\x27video\/jianshi\x27 \x2b timeStamp \x2b \x27.mpeg\x27))\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eapp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/video\/record\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgs = req.text.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timeStamp = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now()\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e folder = \x3cspan class=\x22hljs-string\x22\x3e\x27images\/\x27\x3c\/span\x3e \x2b timeStamp\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!fs.existsSync(resolve(folder))){\n    fs.mkdirSync(resolve(folder));\n  }\n\n  \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(imgs.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue, index\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = decodeBase64Image(value)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = img.data\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e type = img.type\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n      fs.writeFile(path.resolve(__dirname, (folder \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/img\x27\x3c\/span\x3e \x2b index \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e \x2b type)), data, \x3cspan class=\x22hljs-string\x22\x3e\x27base64\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n          reject(err)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          resolve()\n        }\n      })\n    })\n  })).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e proc = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ffmpeg({ \x3cspan class=\x22hljs-attr\x22\x3esource\x3c\/span\x3e: resolve(folder \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/img%d.png\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-attr\x22\x3enolog\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n      .withFps(\x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e)\n      .on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        res.status(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e)\n        res.send({\n          \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/video\/mpeg\/\x27\x3c\/span\x3e \x2b timeStamp,\n          \x3cspan class=\x22hljs-attr\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27jianshi\x27\x3c\/span\x3e \x2b timeStamp \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.mpeg\x27\x3c\/span\x3e\n        })\n      })\n      .on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ERR: \x27\x3c\/span\x3e \x2b err.message)\n      })\n      .saveToFile(resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27video\/jianshi\x27\x3c\/span\x3e \x2b timeStamp \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.mpeg\x27\x3c\/span\x3e))\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e视频下载\x3c\/h3\x3e\n\x3cp\x3e最终将视频文件传输给前端的接口代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.get(\x27\/video\/mpeg\/:timeStamp\x27, function(req, res) {\n  res.contentType(\x27mpeg\x27);\n  var rstream = fs.createReadStream(resolve(\x27video\/jianshi\x27 \x2b req.params.timeStamp \x2b \x27.mpeg\x27));\n  rstream.pipe(res, {end: true});\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eapp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/video\/mpeg\/:timeStamp\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e \x3c\/span\x3e{\n  res.contentType(\x3cspan class=\x22hljs-string\x22\x3e\x27mpeg\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rstream = fs.createReadStream(resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27video\/jianshi\x27\x3c\/span\x3e \x2b req.params.timeStamp \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.mpeg\x27\x3c\/span\x3e));\n  rstream.pipe(res, {end: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e效果预览\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLEIb?w=1275\x26amp;h=749\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLEIb?w=1275\x26amp;h=749\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e注：此功能是个人项目”简诗”的一部分，完整代码可以查看\x3ca href=\x22https:\/\/github.com\/moyuer1992\/jianshi\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/moyuer1992...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Node + FFmpeg 实现Canvas动画导出视频</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008935586">https://segmentfault.com/a/1190000008935586</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/vzbi2dm9la/" target="_blank">https://alili.tech/archive/vzbi2dm9la/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>