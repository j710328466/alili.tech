<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="UXCore 组件单测的一些事儿"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>UXCore 组件单测的一些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/5jbqt5cbauk/",
				"appid": "1613049289050283", 
				"title": "UXCore 组件单测的一些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-26T02:30:18"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qrupu4zdxl/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/e6c9gymqoz7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&text=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&text=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&title=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&is_video=false&description=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&title=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&title=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&title=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jbqt5cbauk%2f&title=UXCore%20%e7%bb%84%e4%bb%b6%e5%8d%95%e6%b5%8b%e7%9a%84%e4%b8%80%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">UXCore 组件单测的一些事儿</h1><div class="meta"><div class="postdate"><time datetime="2019-01-26" itemprop="datePublished">2019-01-26</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22http:\/\/uxco.re\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUXCore\x3c\/a\x3e 是 XUX 团队开源的 PC 端 React UI 套件，作为一个支持企业级应用的 React UI 开源套件，为了保持项目的持续集成，良好的单元测试必不可少。本文来分享一下在编写单元测试的过程中遇到的一些问题和总结。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在编写单测的时候首先可能会遇到一个开发顺序的问题，是先写测试代码还是先写程序代码，那么先来介绍两种开发技术：\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E8%A1%8C%E4%B8%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBDD\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTDD\x3c\/a\x3e。BDD 是行为驱动开发，更趋向于需求，从写单测的顺序上可以理解为先了解行为，然后去写单测来检测是否符合需求期望；TDD 是测试驱动开发，先编写符合需求期望的测试，然后根据测试来实现最简功能代码，不断进行迭代打磨代码，在写单测的顺序上那就是先写单测，根据单测来编写功能代码。这两种开发技术分别适用于不同的场景，可根据自己的情况来选择使用。\x3c\/p\x3e\n\x3cp\x3eUXCore 目前已有的组件采用的是 BDD ，由于组价代码都已 ready 我们就编写测试来验证需求是否已经满足，首先要做的就是通读组件代码（因为有的组件的作者不是自己），将其内部逻辑和实现要搞清楚，接下来才会知道怎么具体写测试代码！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3eUXCore 组件单测环境\x3c\/h3\x3e\n\x3cp\x3e在编写单测时我们要将测试代码运行起来，实时看到测试结果，并且要查看测试覆盖率以更好的提高代码质量，那么这就需要测试运行器、测试框架等等工具或框架来支持，以下是 UXCore 组件采用的单测环境，其他 React 项目也可参考使用。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e测试运行器（Test runner）主要负责测试的自动化，它可以自动调起多种浏览器或者 js 环境让你来调试测试代码。目前有 \x3ca href=\x22https:\/\/code.google.com\/archive\/p\/js-test-driver\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJSTD\x3c\/a\x3e 、\x3ca href=\x22https:\/\/karma-runner.github.io\/1.0\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eKarma\x3c\/a\x3e 、\x3ca href=\x22http:\/\/swarm.jquery.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTestSwarm\x3c\/a\x3e、 \x3ca href=\x22http:\/\/docs.busterjs.org\/en\/latest\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBuster\x3c\/a\x3e 等测试运行器，UXCore 使用的是 \x3ca href=\x22https:\/\/karma-runner.github.io\/1.0\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eKarma\x3c\/a\x3e ，原因是它集成了 Istanbul 的 coverage 功能，可检测测试覆盖率，并且支持多种测试框架。在 uxcore-tools 中已经集成 karma ，你只需执行几个命令就可以。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e测试框架（Testing Framework），即运行测试的工具，测试框架规定了测试风格和测试的生命周期，通过测试框架为程序添加测试，保证代码质量。目前有 \x3ca href=\x22https:\/\/jasmine.github.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJasmine\x3c\/a\x3e 、\x3ca href=\x22http:\/\/qunitjs.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eQunit\x3c\/a\x3e 、\x3ca href=\x22http:\/\/sinonjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSinon\x3c\/a\x3e 、\x3ca href=\x22https:\/\/mochajs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMocha\x3c\/a\x3e 等测试框架。UXCore 选择的是 \x3ca href=\x22https:\/\/mochajs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMocha\x3c\/a\x3e ，它来自 TJ 大神，不但可以在bash中进行测试，而且还拥有一整套命令对测试进行操作，Mocha 的异步测试做的比较好，在 it 的回调函数中会获取一个参数 done ，类型是 function ，用于异步回调，当执行这个函数时就会继续测试。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当然，除了测试运行器 、测试框架之外我们还需要断言库（Assertion library）来帮助我们判断代码执行的正误，比较流行的断言库有：\x3ca href=\x22https:\/\/www.npmjs.com\/package\/expect.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eexpect.js\x3c\/a\x3e、\x3ca href=\x22https:\/\/www.npmjs.com\/package\/should\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eshould\x3c\/a\x3e、\x3ca href=\x22https:\/\/www.npmjs.com\/package\/chai\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3echai\x3c\/a\x3e，我们使用的是 expect.js ，支持 IE6\x2b ，语法通俗易懂。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在测试 react 组件时还要用到 React UI 测试库，\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/test-utils.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact 官方提供了工具库\x3c\/a\x3e，它对虚拟 DOM 和 真实 DOM 都有对应的测试方法，但是它使用起来不太方便。还有一个 Airbnb 公司的封装的 \x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eEnzyme\x3c\/a\x3e ，非常容易上手。我们选择的是后者。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e测试覆盖率\x3c\/h3\x3e\n\x3cp\x3e测试覆盖率是测试中的一种度量，描述源代码被测试的比例和程度。通过测试覆盖率可以检测哪些代码没有被测试，但是测试覆盖率并不能作为衡量代码质量的标准和目标，而是一种发现未被测试代码的手段。\x3c\/p\x3e\n\x3cp\x3e覆盖率的统计的核心思想就是，在源代码对应的位置注入统计代码，当代码运行后，根据统计代码统计的数据确定程序运行的路径，最终生成覆盖率统计报告。整个过程可以分为三部分：转换(instrument)、执行(run)、生成报告(report)。\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e\n\x3cp\x3e转换(instrument)\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e首先对源代码进行语法分析生成语法树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在语法树相应的位置注入统计代码，在程序执行到这个位置的时候对相应的全局变量赋值，确保执行之后能够根据全局变量知道代码的执行流程\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e根据注入之后的语法树生成对应的 JavaScript 代码，即转换之后的代码(instrumented code)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e注：这里进行语法分析的好处是，针对书写不规范的代码（比如一行多个语句），依然能够很好统计出分支覆盖和组合覆盖等信息。反过来想，如果想要提高覆盖率，那么代码要书写规范。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3col\x3e\x3cli\x3e\x3cp\x3e执行(run)\x3c\/p\x3e\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e这一步需要先载入转换后的代码：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e浏览器环境：需要将转换后的代码传给浏览器。如果是 karma 之类的带 server 的测试框架，需要通过 socket 传输至浏览器，执行完之后再将包含覆盖率信息的执行结果传回 server ，生成测试报告。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e然后执行单元测试，产生的统计信息会挂在全局变量 this 下面。对于浏览器环境，this 就是 window。\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e\x3cp\x3e生成报告(report)\x3c\/p\x3e\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e这一步会根据全局标量中的覆盖率信息生成特定格式的报告，如 html、lcov、cobertura、teamcity等。\x3c\/p\x3e\n\x3cp\x3e想要了解更详细的内容可移步：\x3ca href=\x22https:\/\/yq.aliyun.com\/articles\/2656\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/yq.aliyun.com\/article...\x3c\/a\x3e，如果想了解 \x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2015\/06\/istanbul.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIstanbul入门使用\x3c\/a\x3e的童鞋可以看一下阮大神的这篇。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e如何编写 React 组件单测\x3c\/h3\x3e\n\x3cp\x3e编写单元测试就是用一段代码来测试一个模块或功能是否能达到预期结果的一个过程。\x3c\/p\x3e\n\x3cp\x3e下边列出两个常见的例子给大家作为参考：\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e\n\x3cp\x3e最简单的 props 测试。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e首先创建组件的真实 DOM 结构\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const wrapper = mount(\x3cSelect2 prefixCls=\x26quot;kuma-select2\x26quot; \x3e\x3c\/Select2\x3e);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = mount(\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eSelect2\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eprefixCls\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22kuma-select2\x22\x3c\/span\x3e \x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eSelect2\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e然后获取到当前组件的 prefixCls props，用 enzyme 的 \x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\/blob\/master\/docs\/api\/ReactWrapper\/props.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e.props()\x3c\/a\x3e API 就可以很容易的取到  props 的值（这里有一点要说明，.props() 只能取到 root component 的 props），然后用断言句进行判断当前的 prefixCls 是否是 \x27kuma-select2\x27\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22expect(wrapper.props().prefixCls).to.equal(\x27kuma-select2\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eexpect(wrapper.props().prefixCls).to.equal(\x3cspan class=\x22hljs-string\x22\x3e\x27kuma-select2\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e完成上边两步就可以了吗？上边只是 get props 符合了我们的期望，那我们再给组件更新一下 props 看会不会生效。enzyme 也提供了对应的 \x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\/blob\/master\/docs\/api\/ReactWrapper\/setProps.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e.setProps()\x3c\/a\x3e 的 API ，真是太方便啦。然后再次验证新的 prefixCls 有没有更新。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22wrapper.setProps({ prefixCls: \x27kuma-select2-test\x27 });\nexpect(wrapper.props().prefixCls).to.equal(\x27kuma-select2-test\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ewrapper.setProps({ \x3cspan class=\x22hljs-attr\x22\x3eprefixCls\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27kuma-select2-test\x27\x3c\/span\x3e });\nexpect(wrapper.props().prefixCls).to.equal(\x3cspan class=\x22hljs-string\x22\x3e\x27kuma-select2-test\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ol\x3e\n\x3col\x3e\x3cli\x3e\n\x3cp\x3e模拟下拉框选中动作，测试 value 值是否已更新。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e首先还是创建组件的真实 DOM 结构\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const wrapper = mount(\x3cCascadeSelect options={options} \/\x3e);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = mount(\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eCascadeSelect\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eoptions\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{options}\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e);\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e然后要创建 Trigger 组件（ dropdown的子组件 ）的真实 DOM 结构，这里要提一下 enzyme 的 \x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\/blob\/master\/docs\/api\/ReactWrapper\/find.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e.find()\x3c\/a\x3e API ，它的参数除了可以是选择器外还可以是子组件的名称。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const dropdownWrapper = mount(wrapper.find(\x27Trigger\x27).node.getComponent());\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dropdownWrapper = mount(wrapper.find(\x3cspan class=\x22hljs-string\x22\x3e\x27Trigger\x27\x3c\/span\x3e).node.getComponent());\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e接下来找到下拉选项中的第一项触发 click 事件，\x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\/blob\/master\/docs\/api\/ReactWrapper\/simulate.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e.simulate()\x3c\/a\x3e API 用来做事件绑定。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropdownWrapper.find(\x27li\x27).at(0).simulate(\x27click\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3edropdownWrapper.find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).at(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).simulate(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e模拟完后就来验证你要验证的逻辑，获取到子组件 CascadeSubmenu 的一项 option ，调用 CascadeSubmenu 的 props onItemClick 函数，将获取到的 option 传入进去，最后断言句判断最后组件的 value 是否不为空。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const option = dropdownWrapper.find(\x27CascadeSubmenu\x27).props().options[0];\ndropdownWrapper.find(\x27CascadeSubmenu\x27).props().onItemClick(option,2,false);\nexpect(wrapper.state(\x27value\x27).length \x3e 0).to.be.ok()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e option = dropdownWrapper.find(\x3cspan class=\x22hljs-string\x22\x3e\x27CascadeSubmenu\x27\x3c\/span\x3e).props().options[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\ndropdownWrapper.find(\x3cspan class=\x22hljs-string\x22\x3e\x27CascadeSubmenu\x27\x3c\/span\x3e).props().onItemClick(option,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\nexpect(wrapper.state(\x3cspan class=\x22hljs-string\x22\x3e\x27value\x27\x3c\/span\x3e).length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).to.be.ok()\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e上边的代码使用了 Enzyme 的 \x3ca href=\x22https:\/\/github.com\/airbnb\/enzyme\/blob\/master\/docs\/api\/mount.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFull DOM Rendering API\x3c\/a\x3e ，首先创建 CascadeSelect 组件的真实 DOM 结构，然后再次创建 dropdown 的 Trigger 子组件的真实 DOM 结构，最后找到第一个选项触发 click 事件。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eTip：如果组件引用了其他的组件，那么单测应该测到什么程度呢？要不要测引用的其他组件的代码？答案就是：你不需要测试它引用的组件的代码逻辑，引用组件的代码测试会在它自己内部完成，当然你测了也不会提高覆盖率，我们只需测试我们组件的代码即可。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e最后，怎么能更加清晰的知道自己哪些代码还没有覆盖到呢？如果可以看到就好了，能够对症下药，绝对提高覆盖率啊！当然，Karma 都帮你做好了，执行过 coverage 后会生成一个 coverage 目录，它的 src  目录下的组件文件命名的 html 文件打开后就会看到非常清晰的记录，红色的表示还没有覆盖到的。当然也可以本地起一个服务，可用 anywhere 直接浏览器里查看覆盖率列表和对应的详细文件。下图是一份coverage 报告。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008328280?w=1018\x26amp;h=407\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008328280?w=1018\x26amp;h=407\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000008328281?w=472\x26amp;h=281\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000008328281?w=472\x26amp;h=281\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>UXCore 组件单测的一些事儿</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008328277">https://segmentfault.com/a/1190000008328277</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/5jbqt5cbauk/" target="_blank">https://alili.tech/archive/5jbqt5cbauk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/t42iv2yle7e/">2016-我的前端之路:工具化与工程化<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/xlhryjzdso/">2016年总结--成长<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/4wvjfeus9ur/">2016年末总结，我的前端之路<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/w7062tmcw3/">3D 视差效果<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5jt1iw1t77b/">AlloyTouch实战--60行代码搞定QQ看点资料卡<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/kquf0fxkw2j/">ES6，你不得不学！<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/r5b6g4133jh/">Emmet-前端开发神器<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/5dbaikv4emi/">FreeCodeCamp中级算法题答案<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/iuyeljg6lm/">JSONP是什么<aside class="dates">2019-01-29</aside></a></li><li><a href="/archive/23ftsgrtzzc/">JS中的观察者模式(发布订阅)<aside class="dates">2019-01-29</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>