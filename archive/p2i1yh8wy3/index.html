<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Ansible 起步指南"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Ansible 起步指南 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/p2i1yh8wy3/",
				"appid": "1613049289050283", 
				"title": "Ansible 起步指南 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-24T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/y7nqj2mm6bo/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/hp9o5by02nm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&text=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&text=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&title=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&is_video=false&description=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&title=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&title=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&title=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fp2i1yh8wy3%2f&title=Ansible%20%e8%b5%b7%e6%ad%a5%e6%8c%87%e5%8d%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Ansible 起步指南</h1><div class="meta"><div class="postdate"><time datetime="2019-01-24" itemprop="datePublished">2019-01-24</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#ansible-起步指南\x22\x3e\x3c\/a\x3eAnsible 起步指南\x3c\/h1\x3e\n\x3cp\x3e这是一篇关于 Ansible 的速成课程，你可以用作小项目的模板，或者帮你深入了解这个神奇的工具。阅读了本指南之后，你将对自动化服务器配置、部署等有足够的了解。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#ansible-是什么为什么你该了解\x22\x3e\x3c\/a\x3eAnsible 是什么，为什么你该了解？\x3c\/h3\x3e\n\x3cp\x3eAnsible 简单的说是一个配置管理系统（configuration management system）。你只需要可以使用 ssh 访问你的服务器或设备就行。它也不同于其他工具，因为它使用推送的方式，而不是像 puppet 或 chef 那样使用拉取的方式。你可以将代码部署到任意数量的服务器上，配置网络设备或在基础架构中自动执行任何操作。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#前置要求\x22\x3e\x3c\/a\x3e前置要求\x3c\/h3\x3e\n\x3cp\x3e假设你使用 Mac 或 Linux 作为你的工作站，Ubuntu Trusty 作为你的服务器，并有一些安装软件包的经验。此外，你的计算机上将需要以下软件。所以，如果你还没有它们，请先安装：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.virtualbox.org\/\x22\x3eVirtualbox\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.vagrantup.com\/downloads.html\x22\x3eVagrant\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3eMac 用户：\x3ca href=\x22http:\/\/brew.sh\/\x22\x3eHomebrew\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3\x3e\x3ca href=\x22#情景\x22\x3e\x3c\/a\x3e情景\x3c\/h3\x3e\n\x3cp\x3e我们将模拟 2 个连接到 MySQL 数据库的 Web 应用程序服务器。Web 应用程序使用 Rails 5 和 Puma。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#准备\x22\x3e\x3c\/a\x3e准备\x3c\/h3\x3e\n\x3ch4\x3e\x3ca href=\x22#vagrantfile\x22\x3e\x3c\/a\x3eVagrantfile\x3c\/h4\x3e\n\x3cp\x3e为这个项目创建一个文件夹，并将下面的内容保存到名为 \x3ccode\x3eVagrantfile\x3c\/code\x3e 的文件。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs coq\x22\x3eVMs = [\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22web1\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.11\x22\x3c\/span\x3e],\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22web2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.12\x22\x3c\/span\x3e],\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22dbserver\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.21\x22\x3c\/span\x3e],\n  ]\n\nVagrant.configure(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3econfig\x3c\/span\x3e|\n  \x3cspan class=\x22hljs-type\x22\x3eVMs\x3c\/span\x3e.each { |\x3cspan class=\x22hljs-type\x22\x3evm\x3c\/span\x3e|\n    \x3cspan class=\x22hljs-type\x22\x3econfig\x3c\/span\x3e.vm.define vm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3ebox\x3c\/span\x3e|\n      \x3cspan class=\x22hljs-type\x22\x3ebox\x3c\/span\x3e.vm.box = \x3cspan class=\x22hljs-string\x22\x3e\x22ubuntu\/trusty64\x22\x3c\/span\x3e\n      box.vm.network \x3cspan class=\x22hljs-string\x22\x3e\x22private_network\x22\x3c\/span\x3e, ip: vm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n      box.vm.hostname = vm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n      box.vm.provider \x3cspan class=\x22hljs-string\x22\x3e\x22virtualbox\x22\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3evb\x3c\/span\x3e|\n         \x3cspan class=\x22hljs-type\x22\x3evb\x3c\/span\x3e.memory = \x3cspan class=\x22hljs-string\x22\x3e\x22512\x22\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n  }\n\x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#配置你的虚拟网络\x22\x3e\x3c\/a\x3e配置你的虚拟网络\x3c\/h4\x3e\n\x3cp\x3e我们希望我们的虚拟机能互相交互，但不要让流量流出到真实的网络，所以我们将在 Virtualbox 中创建一个仅主机（HOST-Only）的网络适配器。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e打开 Virtualbox\x3c\/li\x3e\n\x3cli\x3e转到 Preferences\x3c\/li\x3e\n\x3cli\x3e转到 Network\x3c\/li\x3e\n\x3cli\x3e单击 Host-Only\x3c\/li\x3e\n\x3cli\x3e单击添加网络\x3c\/li\x3e\n\x3cli\x3e单击 Adapter\x3c\/li\x3e\n\x3cli\x3e将 IPv4 设置为 \x3ccode\x3e10.1.1.1\x3c\/code\x3e，IPv4 网络掩码：\x3ccode\x3e255.255.255.0\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e单击 “OK”\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e\x3ca href=\x22#测试虚拟机及虚拟网络\x22\x3e\x3c\/a\x3e测试虚拟机及虚拟网络\x3c\/h4\x3e\n\x3cp\x3e在终端中，在存放 \x3ccode\x3eVagrantfile\x3c\/code\x3e 的项目目录中，输入下面的命令：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs ebnf\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3evagrant up\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e它会创建你的虚拟机，因此会花费一会时间。输入下面的命令并验证输出内容以检查是否已经工作：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs applescript\x22\x3e$ vagrant status\nCurrent machine states:\n\nweb1                      \x3cspan class=\x22hljs-built_in\x22\x3erunning\x3c\/span\x3e (virtualbox)\nweb2                      \x3cspan class=\x22hljs-built_in\x22\x3erunning\x3c\/span\x3e (virtualbox)\nmaster                    \x3cspan class=\x22hljs-built_in\x22\x3erunning\x3c\/span\x3e (virtualbox)\n\nThis environment represents multiple VMs. The VMs are all listed\n\x3cspan class=\x22hljs-keyword\x22\x3eabove\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ewith\x3c\/span\x3e their current state. For more information \x3cspan class=\x22hljs-keyword\x22\x3eabout\x3c\/span\x3e a specific\nVM, \x3cspan class=\x22hljs-built_in\x22\x3erun\x3c\/span\x3e `vagrant status NAME`.\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在使用 \x3ccode\x3evagrant\x3c\/code\x3e 的用户名和密码 ，按 \x3ccode\x3eVagrantfile\x3c\/code\x3e 中的 IP 登录其中一台虚拟机，这将验证虚拟机并将它们的密钥添加到你的已知主机（\x3ccode\x3eknown_hosts\x3c\/code\x3e）文件中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3essh vagrant@\x3cspan class=\x22hljs-number\x22\x3e10.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.11\x3c\/span\x3e # password is `vagrant`\nssh vagrant@\x3cspan class=\x22hljs-number\x22\x3e10.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.12\x3c\/span\x3e\nssh vagrant@\x3cspan class=\x22hljs-number\x22\x3e10.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.21\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e恭喜你！现在你已经有可以实验的服务器了。下面的剩下的部分！\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#安装-ansible\x22\x3e\x3c\/a\x3e安装 Ansible\x3c\/h3\x3e\n\x3cp\x3e对于 Mac 用户:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs mipsasm\x22\x3e$ \x3cspan class=\x22hljs-keyword\x22\x3ebrew \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3einstall \x3c\/span\x3eansible\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e对于 Ubuntu 用户:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e sudo apt install ansible\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e确保你使用了ansible 最近的版本 2.1 或者更高的版本：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e$ ansible --version\nansible \x3cspan class=\x22hljs-number\x22\x3e2.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#清单\x22\x3e\x3c\/a\x3e清单\x3c\/h3\x3e\n\x3cp\x3eAnsible 使用清单文件来了解要使用的服务器，以及如何将它们分组以并行执行任务。让我们为这个项目创建我们的清单文件 \x3ccode\x3einventory\x3c\/code\x3e，并将它放在与 \x3ccode\x3eVagrantfile\x3c\/code\x3e 相同的文件夹中：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e[all:children]\nwebs\ndb\n\n[all:vars]\n\x3cspan class=\x22hljs-attribute\x22\x3eansible_user\x3c\/span\x3e=vagrant\n\x3cspan class=\x22hljs-attribute\x22\x3eansible_ssh_pass\x3c\/span\x3e=vagrant\n\n[webs]\nweb1 \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.11\nweb2 \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.12\n\n[db]\ndbserver \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.21\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e[all：children]\x3c\/code\x3e 定义一个组的组（\x3ccode\x3eall\x3c\/code\x3e）\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e[all：vars]\x3c\/code\x3e 定义属于组 \x3ccode\x3eall\x3c\/code\x3e 的变量\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e[webs]\x3c\/code\x3e 定义一个组，就像 \x3ccode\x3e[db]\x3c\/code\x3e 一样\x3c\/li\x3e\n\x3cli\x3e文件的其余部分只是主机的声明，带有它们的名称和 IP\x3c\/li\x3e\n\x3cli\x3e空行表示声明结束\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e现在我们有了一个清单，我们可以从命令行开始使用 ansible，指定一个主机或一个组来执行命令。以下是检查与服务器的连接的命令示例：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e$ ansible -i inventory all -m\x3cspan class=\x22hljs-built_in\x22\x3e ping\n\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e-i\x3c\/code\x3e 指定清单文件\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eall\x3c\/code\x3e 指定要操作的服务器或服务器组\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e-m\x27 指定一个 ansible 模块，在这种情况下为\x3c\/code\x3eping`\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面是命令输出：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3edbserver | \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eSUCCESS\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22changed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22ping\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22pong\x22\x3c\/span\x3e\n}\nweb1 | \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eSUCCESS\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22changed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22ping\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22pong\x22\x3c\/span\x3e\n}\nweb2 | \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eSUCCESS\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22changed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22ping\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22pong\x22\x3c\/span\x3e\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e服务器以不同的顺序响应，这只取决于谁先响应，但是这个没有关系，因为 ansible 独立保持每台服务器的状态。\x3c\/p\x3e\n\x3cp\x3e你也可以使用另外一个选项来运行任何命令：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e-a \x26lt;command\x26gt;\x3c\/code\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs ruby\x22\x3e$ ansible -i inventory all -a uptime\nweb1 \x3cspan class=\x22hljs-params\x22\x3e| SUCCESS |\x3c\/span\x3e rc=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-meta\x22\x3e\x26gt;\x26gt;\n \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e43\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e27\x3c\/span\x3e up \x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e min,  \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e user,  load \x3cspan class=\x22hljs-symbol\x22\x3eaverage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e00\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e01\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e05\x3c\/span\x3e\n\ndbserver \x3cspan class=\x22hljs-params\x22\x3e| SUCCESS |\x3c\/span\x3e rc=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-meta\x22\x3e\x26gt;\x26gt;\n \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e43\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e27\x3c\/span\x3e up \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e min,  \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e user,  load \x3cspan class=\x22hljs-symbol\x22\x3eaverage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e00\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e01\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e05\x3c\/span\x3e\n\nweb2 \x3cspan class=\x22hljs-params\x22\x3e| SUCCESS |\x3c\/span\x3e rc=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-meta\x22\x3e\x26gt;\x26gt;\n \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e43\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e27\x3c\/span\x3e up \x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e min,  \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e user,  load \x3cspan class=\x22hljs-symbol\x22\x3eaverage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e00\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e01\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e05\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这是只有一台服务器的另外一个例子：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e$ ansible -i inventory dbserver -a \x3cspan class=\x22hljs-string\x22\x3e\x22df -h \/\x22\x3c\/span\x3e\ndbserver | SUCCESS | rc=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26gt;\x26gt;\nFilesystem      Size  Used Avail Use% Mounted on\n\/dev\/sda1        \x3cspan class=\x22hljs-number\x22\x3e40\x3c\/span\x3eG  \x3cspan class=\x22hljs-number\x22\x3e1.4\x3c\/span\x3eG   \x3cspan class=\x22hljs-number\x22\x3e37\x3c\/span\x3eG   \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e% \/\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#剧本\x22\x3e\x3c\/a\x3e剧本\x3c\/h3\x3e\n\x3cp\x3e剧本（playbook）只是个 YAML 文件，它将清单文件中的服务器组与命令关联。在 ansible 中的对于关键字是 \x3ccode\x3etasks\x3c\/code\x3e，它可以是一个预期的状态、shell 命令或许多其它的选项。有关 ansible 可做的所有事情列表，可以查看\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/list_of_all_modules.html\x22\x3e所有模块的列表\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e下面是一个运行 shell 命令的剧本示例，将其保存为 \x3ccode\x3eplaybook1.yml\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e---\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e- hosts:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eall\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  tasks:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - shell:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3euptime\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e---\x3c\/code\x3e 是 YAML 文件的开始\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e- hosts\x3c\/code\x3e：指定要使用的组\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3etasks\x3c\/code\x3e：标记任务列表的开始\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e- shell\x3c\/code\x3e：指定第一个任务使用 [shell] (\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/shell_module.html\x22\x3ehttp:\/\/docs.ansible.com\/ansible\/shell_module.html\x3c\/a\x3e) 模块\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e记住：YAML 需要缩进结构，确保你始终遵循剧本中的正确结构\x3c\/strong\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e用下面的命令运行它：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs markdown\x22\x3e$ ansible-playbook -i inventory playbook1.yml\n\nPLAY [all] \x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-emphasis\x22\x3e***\x3c\/span\x3e*\n\nTASK [setup] \x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e**\nok: [web1]\nok: [web2]\nok: [dbmaster]\n\nTASK [command] \x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\nchanged: [web1]\nchanged: [web2]\nchanged: [dbmaster]\n\nPLAY RECAP \x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-strong\x22\x3e*****\x3c\/span\x3e\x3cspan class=\x22hljs-emphasis\x22\x3e***\x3c\/span\x3e*\ndbmaster                   : ok=2    changed=1    unreachable=0    failed=0\nweb1                       : ok=2    changed=1    unreachable=0    failed=0\nweb2                       : ok=2    changed=1    unreachable=0    failed=0\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e正如你所见，ansible 运行了 2 个任务，而不是只有剧本中的一个。\x3ccode\x3eTASK [setup]\x3c\/code\x3e 是一个隐式任务，它会首先运行以捕获服务器的信息，如主机名、IP、发行版和更多详细信息，然后可以使用这些信息运行条件任务。\x3c\/p\x3e\n\x3cp\x3e还有最后的 \x3ccode\x3ePLAY RECAP\x3c\/code\x3e，其中 ansible 显示了运行了多少个任务以及每个对应的状态。在我们的例子中，因为我们运行了一个 shell 命令，ansible 不知道结果的状态，它被认为是 \x3ccode\x3echanged\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#安装软件\x22\x3e\x3c\/a\x3e安装软件\x3c\/h4\x3e\n\x3cp\x3e我们将使用 \x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/apt_module.html\x22\x3eapt\x3c\/a\x3e 在我们的服务器上安装软件，因为我们需要 root 权限，所以我们必须使用 \x3ccode\x3ebecome\x3c\/code\x3e 语句，将这个内容保存在 \x3ccode\x3eplaybook2.yml\x3c\/code\x3e 中并运行它（\x3ccode\x3eansible-playbook playbook2.yml\x3c\/code\x3e）：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e---\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e- hosts:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ewebs\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become_user:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eroot\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  tasks:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - apt:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ename=git\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3estate=present\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e有一些语句可以应用于 ansible 中所有模块；一个是 \x3ccode\x3ename\x3c\/code\x3e 语句，可以让我们输出关于正在执行的任务的更具描述性的文本。要使用它，保持任务内容一样，但是添加 \x3ccode\x3ename ：描述性文本\x3c\/code\x3e 作为第一行，所以我们以前的文本将改成：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e---\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e- hosts:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ewebs\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become_user:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eroot\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  tasks:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - name:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eThis\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3etask\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ewill\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3emake\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esure\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3egit\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eis\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3epresent\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eon\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ethe\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esystem\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      apt:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ename=git\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3estate=present\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#使用-with_items\x22\x3e\x3c\/a\x3e使用 \x3ccode\x3ewith_items\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e当你要处理一个列表时，比如要安装的项目和软件包、要创建的文件，可以用 ansible 提供的 \x3ccode\x3ewith_items\x3c\/code\x3e。下面是我们如何在 \x3ccode\x3eplaybook3.yml\x3c\/code\x3e 中使用它，同时添加一些我们已经知道的其他语句：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e---\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e- hosts:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eall\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become_user:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eroot\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  become:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  tasks:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - name:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eInstalling\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3edependencies\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      apt:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ename=\x22{{\x22item\x22}}\x22\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3estate=present\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      with_items:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e        -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3egit\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e        -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3emysql-client\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e        -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3elibmysqlclient-dev\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e        -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ebuild-essential\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e        -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3epython-software-properties\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#使用-template-和-vars\x22\x3e\x3c\/a\x3e使用 \x3ccode\x3etemplate\x3c\/code\x3e 和 \x3ccode\x3evars\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3evars\x3c\/code\x3e 是一个定义变量语句，可以在 \x3ccode\x3etask\x3c\/code\x3e 语句或 \x3ccode\x3etemplate\x3c\/code\x3e 文件中使用。 \x3ca href=\x22http:\/\/jinja.pocoo.org\/docs\/dev\/\x22\x3eJinja2\x3c\/a\x3e 是 Ansible 中使用的模板引擎，但是关于它你不需要学习很多。在你的剧本中定义变量，如下所示：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e---\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e- hosts:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eall\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  vars:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - secret_key:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eVqnzCLdCV9a3jK\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - path_to_vault:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/opt\/very\/deep\/path\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  tasks:\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - name:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eSetting\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3econfiguration\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3efile\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eusing\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3etemplate\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      template:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esrc=myconfig.j2\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3edest=\x22{{\x22path_to_vault\x22}}\x22\/app.conf\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e正如你看到的，我可以使用 \x3ccode\x3e\x22{{\x22path_to_vault\x22}}\x22\x3c\/code\x3e 作为剧本的一部分，但也因为我使用了 \x3ccode\x3etemplate\x3c\/code\x3e语句，我可以使用 \x3ccode\x3emyconfig.j2\x3c\/code\x3e 中的任何变量，该文件必须存在一个名为 \x3ccode\x3etemplates\x3c\/code\x3e 的子文件夹中。你项目树应该如下所示：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e├── Vagrantfile\n├── inventory\n├── playbook1\x3cspan class=\x22hljs-selector-class\x22\x3e.yml\x3c\/span\x3e\n├── playbook2\x3cspan class=\x22hljs-selector-class\x22\x3e.yml\x3c\/span\x3e\n└── templates\n    └── myconfig\x3cspan class=\x22hljs-selector-class\x22\x3e.j2\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e当 ansible 找到一个 \x3ccode\x3etemplate\x3c\/code\x3e 语句后它会在 \x3ccode\x3etemplates\x3c\/code\x3e 文件夹内查找，并将把被 \x3ccode\x3e\x22{{\x22\x3c\/code\x3e 和 \x3ccode\x3e\x22}}\x22\x3c\/code\x3e 括起来的变量展开来。\x3c\/p\x3e\n\x3cp\x3e示例模板：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs xquery\x22\x3ethis is just an example vault_dir: \x22{{\x22path_to_vault\x22}}\x22 secret_password: \x22{{\x22secret_key\x22}}\x22\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e即使你不扩展变量你也可以使用 \x3ccode\x3etemplate\x3c\/code\x3e。考虑到将来会添加所以我先做了。比如创建一个 \x3ccode\x3ehosts.j2\x3c\/code\x3e 模板并加入主机名和 IP。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs css\x22\x3e10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.11\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eweb1\x3c\/span\x3e\n10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.12\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eweb2\x3c\/span\x3e\n10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.21\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3edbserver\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这里要用像这样的语句：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e  -  name: Installing the hosts file \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e all servers\n     template: \x3cspan class=\x22hljs-attribute\x22\x3esrc\x3c\/span\x3e=hosts.j2 \x3cspan class=\x22hljs-attribute\x22\x3edest\x3c\/span\x3e=\/etc\/hosts \x3cspan class=\x22hljs-attribute\x22\x3emode\x3c\/span\x3e=644\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#shell-命令\x22\x3e\x3c\/a\x3eshell 命令\x3c\/h4\x3e\n\x3cp\x3e你应该尽量使用模块，因为 Ansible 可以跟踪任务的状态，并避免不必要的重复，但有时 shell 命令是不可避免的。 对于这些情况，Ansible 提供两个选项：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/command_module.html\x22\x3ecommand\x3c\/a\x3e：直接运行一个命令，没有环境变量或重定向（\x3ccode\x3e|\x3c\/code\x3e，\x3ccode\x3e\x26lt;\x3c\/code\x3e，\x3ccode\x3e\x26gt;\x3c\/code\x3e 等）\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/shell_module.html\x22\x3eshell\x3c\/a\x3e：运行 \x3ccode\x3e\/bin\/sh\x3c\/code\x3e 并展开变量和支持重定向\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e\x3ca href=\x22#其他有用的模块\x22\x3e\x3c\/a\x3e其他有用的模块\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/apt_repository_module.html\x22\x3eapt_repository\x3c\/a\x3e - 在 Debian 系的发行版中添加\/删除包仓库\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/docs.ansible.com\/ansible\/yum_repository_module.html\x22\x3eyum_repository\x3c\/a\x3e - 在 RedHat 系的发行版中添加\/删除包仓库\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/service_module.html\x22\x3eservice\x3c\/a\x3e - 启动\/停止\/重新启动\/启用\/禁用服务\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/git_module.html\x22\x3egit\x3c\/a\x3e - 从 git 服务器部署代码\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/docs.ansible.com\/ansible\/unarchive_module.html\x22\x3eunarchive\x3c\/a\x3e - 从 Web 或本地源解开软件包\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e\x3ca href=\x22#只在一台服务器中运行任务\x22\x3e\x3c\/a\x3e只在一台服务器中运行任务\x3c\/h4\x3e\n\x3cp\x3eRails 使用 \x3ca href=\x22http:\/\/edgeguides.rubyonrails.org\/active_record_migrations.html\x22\x3emigrations\x3c\/a\x3e 来逐步更改数据库，但由于你有多个应用程序服务器，因此这些迁移任务不能被分配为组任务，而我们只需要一个服务器来运行迁移。在这种情况下，当使用 \x3ccode\x3erun_once\x3c\/code\x3e 时，\x3ccode\x3erun_once\x3c\/code\x3e 将分派任务到一个服务器，并直到这个任务完成继续下一个任务。你只需要在你的任务中设置 \x3ccode\x3erun_once：true\x3c\/code\x3e。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs yaml\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3e    - name:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Run db:migrate\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      shell:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ecd\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22{{\x22appdir\x22}}\x22;rails\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edb:migrate\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      run_once:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#会失败的任务\x22\x3e\x3c\/a\x3e会失败的任务\x3c\/h4\x3e\n\x3cp\x3e通过指定 \x3ccode\x3eignore_errors：true\x3c\/code\x3e，你可以运行可能会失败的任务，但不会影响剧本中剩余的任务完成。这是非常有用的，例如，当删除最初并不存在的日志文件时。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e    - name: \x3cspan class=\x22hljs-string\x22\x3e\x27Delete logs\x27\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eshell\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e: rm -f \/var\/\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e\/nginx\/errors.log\n\x3c\/span\x3e      ignore_errors: true\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#放到一起\x22\x3e\x3c\/a\x3e放到一起\x3c\/h3\x3e\n\x3cp\x3e现在用我们先前学到的，这里是每个文件的最终版：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eVagrantfile\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs coq\x22\x3eVMs = [\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22web1\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.11\x22\x3c\/span\x3e],\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22web2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.12\x22\x3c\/span\x3e],\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x22dbserver\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2210.1.1.21\x22\x3c\/span\x3e],\n  ]\n\nVagrant.configure(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3econfig\x3c\/span\x3e|\n  \x3cspan class=\x22hljs-type\x22\x3eVMs\x3c\/span\x3e.each { |\x3cspan class=\x22hljs-type\x22\x3evm\x3c\/span\x3e|\n    \x3cspan class=\x22hljs-type\x22\x3econfig\x3c\/span\x3e.vm.define vm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3ebox\x3c\/span\x3e|\n      \x3cspan class=\x22hljs-type\x22\x3ebox\x3c\/span\x3e.vm.box = \x3cspan class=\x22hljs-string\x22\x3e\x22ubuntu\/trusty64\x22\x3c\/span\x3e\n      box.vm.network \x3cspan class=\x22hljs-string\x22\x3e\x22private_network\x22\x3c\/span\x3e, ip: vm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n      box.vm.hostname = vm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n      box.vm.provider \x3cspan class=\x22hljs-string\x22\x3e\x22virtualbox\x22\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edo\x3c\/span\x3e |\x3cspan class=\x22hljs-type\x22\x3evb\x3c\/span\x3e|\n         \x3cspan class=\x22hljs-type\x22\x3evb\x3c\/span\x3e.memory = \x3cspan class=\x22hljs-string\x22\x3e\x22512\x22\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n  }\n\x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3einventory\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e[all:children]\nwebs\ndb\n\n[all:vars]\n\x3cspan class=\x22hljs-attribute\x22\x3eansible_user\x3c\/span\x3e=vagrant\n\x3cspan class=\x22hljs-attribute\x22\x3eansible_ssh_pass\x3c\/span\x3e=vagrant\n\n[webs]\nweb1 \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.11\nweb2 \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.12\n\n[db]\ndbserver \x3cspan class=\x22hljs-attribute\x22\x3eansible_host\x3c\/span\x3e=10.1.1.21\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3etemplates\/hosts.j2\x3c\/code\x3e:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs css\x22\x3e10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.11\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eweb1\x3c\/span\x3e\n10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.12\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eweb2\x3c\/span\x3e\n10\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.21\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3edbserver\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3etemplates\/my.cnf.j2\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs makefile\x22\x3e[client]\nport        = 3306\nsocket      = \/var\/run\/mysqld\/mysqld.sock\n\n[mysqld_safe]\nsocket      = \/var\/run\/mysqld\/mysqld.sock\nnice        = 0\n\n[mysqld]\nserver-id   = 1\nuser        = mysql\npid-file    = \/var\/run\/mysqld\/mysqld.pid\nsocket      = \/var\/run\/mysqld\/mysqld.sock\nport        = 3306\nbasedir     = \/usr\ndatadir     = \/var\/lib\/mysql\ntmpdir      = \/tmp\nlc-messages-dir = \/usr\/share\/mysql\nskip-external-locking\nbind-address        = 0.0.0.0\nkey_buffer      = 16M\nmax_allowed_packet  = 16M\nthread_stack        = 192K\nthread_cache_size       = 8\nmyisam-recover         = BACKUP\nquery_cache_limit   = 1M\nquery_cache_size        = 16M\nlog_error = \/var\/log\/mysql\/error.log\nexpire_logs_days    = 10\nmax_binlog_size         = 100M\n\n[mysqldump]\nquick\nquote-names\nmax_allowed_packet  = 16M\n\n[mysql]\n\n[isamchk]\nkey_buffer      = 16M\n\n!includedir \/etc\/mysql\/conf.d\/\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3efinal-playbook.yml\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs haml\x22\x3e-\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ehosts:\x3c\/span\x3e all\n\x3c\/span\x3e  become_user: root\n  become: true\n  tasks:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Install common software on all servers\x27\x3c\/span\x3e\n\x3c\/span\x3e      apt: name=\x22{{\x22item\x22}}\x22 state=present\n      with_items:\n        -\x3cspan class=\x22ruby\x22\x3e git\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e mysql-client\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e libmysqlclient-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e build-essential\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e python-software-properties\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Install hosts file\x27\x3c\/span\x3e\n\x3c\/span\x3e      template: src=hosts.j2 dest=\/etc\/hosts mode=644\n\n-\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ehosts:\x3c\/span\x3e db\n\x3c\/span\x3e  become_user: root\n  become: true\n  tasks:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Software for DB server\x27\x3c\/span\x3e\n\x3c\/span\x3e      apt: name=\x22{{\x22item\x22}}\x22 state=present\n      with_items:\n        -\x3cspan class=\x22ruby\x22\x3e mysql-server\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e percona-xtrabackup\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e mytop\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e mysql-utilities\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27MySQL config file\x27\x3c\/span\x3e\n\x3c\/span\x3e      template: src=my.cnf.j2 dest=\/etc\/mysql\/my.cnf\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Restart MySQL\x27\x3c\/span\x3e\n\x3c\/span\x3e      service: name=mysql state=restarted\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Grant access to web app servers\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: echo \x27GRANT ALL PRIVILEGES ON *.* TO \x22root\x22@\x22%\x22 WITH GRANT OPTION;FLUSH PRIVILEGES;\x27|mysql -u root mysql\n\n-\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ehosts:\x3c\/span\x3e webs\n\x3c\/span\x3e  vars:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3eappdir:\x3c\/span\x3e \/opt\/dummyapp\n\x3c\/span\x3e  become_user: root\n  become: true\n  tasks:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Add ruby-ng repo\x27\x3c\/span\x3e\n\x3c\/span\x3e      apt_repository: repo=\x27ppa:brightbox\/ruby-ng\x27\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Install rails software\x27\x3c\/span\x3e\n\x3c\/span\x3e      apt: name=\x22{{\x22item\x22}}\x22 state=present\n      with_items:\n        -\x3cspan class=\x22ruby\x22\x3e ruby-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e ruby-all-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e ruby2.\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e ruby2.\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e ruby-switch\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e libcurl4-openssl-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e libssl-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e zlib1g-dev\n\x3c\/span\x3e        -\x3cspan class=\x22ruby\x22\x3e nodejs\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Set ruby to 2.2\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: ruby-switch --set ruby2.2\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Install gems\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: gem install bundler rails\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Kill puma if running\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: file \/run\/puma.pid \x26gt;\/dev\/null \x26amp;\x26amp; kill `cat \/run\/puma.pid` 2\x26gt;\/dev\/null\n      ignore_errors: True\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Clone app repo\x27\x3c\/span\x3e\n\x3c\/span\x3e      git:\n           repo=https:\/\/github.com\/c0d5x\/rails_dummyapp.git\n           dest=\x22{{\x22appdir\x22}}\x22\n           version=staging\n           force=yes\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Run bundler\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: cd \x22{{\x22appdir\x22}}\x22;bundler\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Run db:setup\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: cd \x22{{\x22appdir\x22}}\x22;rails db:setup\n      run_once: true\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Run db:migrate\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: cd \x22{{\x22appdir\x22}}\x22;rails db:migrate\n      run_once: true\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-symbol\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Run rails server\x27\x3c\/span\x3e\n\x3c\/span\x3e      shell: cd \x22{{\x22appdir\x22}}\x22;rails server -b 0.0.0.0 -p 80 --pid \/run\/puma.pid -d\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#放在你的环境中\x22\x3e\x3c\/a\x3e放在你的环境中\x3c\/h3\x3e\n\x3cp\x3e将这些文件放在相同的目录，运行下面的命令打开你的开发环境：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3evagrant up\nansible-playbook -\x3cspan class=\x22hljs-selector-tag\x22\x3ei\x3c\/span\x3e inventory final-playbook\x3cspan class=\x22hljs-selector-class\x22\x3e.yml\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#部署新的代码\x22\x3e\x3c\/a\x3e部署新的代码\x3c\/h3\x3e\n\x3cp\x3e确保修改了代码并推送到了仓库中。接下来，确保你 git 语句中使用了正确的分支：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e    - name: \x3cspan class=\x22hljs-string\x22\x3e\x27Clone app repo\x27\x3c\/span\x3e\n      gi\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e\n           repo=http\x3cspan class=\x22hljs-variable\x22\x3es:\x3c\/span\x3e\/\/github.\x3cspan class=\x22hljs-keyword\x22\x3ecom\x3c\/span\x3e\/c0d5x\/rails_dummyapp.git\n           dest=\x22{{\x22appdir\x22}}\x22\n           \x3cspan class=\x22hljs-keyword\x22\x3eversion\x3c\/span\x3e=staging\n           force=yes\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e作为一个例子，你可以修改 \x3ccode\x3eversion\x3c\/code\x3e 字段为 \x3ccode\x3emaster\x3c\/code\x3e，再次运行剧本：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3eansible-playbook -\x3cspan class=\x22hljs-selector-tag\x22\x3ei\x3c\/span\x3e inventory final-playbook\x3cspan class=\x22hljs-selector-class\x22\x3e.yml\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e检查所有的 web 服务器上的页面是否已更改：\x3ccode\x3ehttp:\/\/10.1.1.11\x3c\/code\x3e 或 \x3ccode\x3ehttp:\/\/10.1.1.12\x3c\/code\x3e。将其更改为 \x3ccode\x3eversion = staging\x3c\/code\x3e 并重新运行剧本并再次检查页面。\x3c\/p\x3e\n\x3cp\x3e你还可以创建只包含与部署相关的任务的替代剧本，以便其运行更快。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#接下来是什么-\x22\x3e\x3c\/a\x3e接下来是什么 ？！\x3c\/h3\x3e\n\x3cp\x3e这只是可以做的很小一部分。我们没有接触角色（role）、过滤器（filter）、调试等许多其他很棒的功能，但我希望它给了你一个良好的开始！所以，请继续学习并使用它。如果你有任何问题，你可以在 \x3ca href=\x22https:\/\/twitter.com\/c0d5x\x22\x3etwitter\x3c\/a\x3e 或评论栏联系我，让我知道你还想知道哪些关于 ansible 的东西！\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3evia: \x3ca href=\x22https:\/\/gorillalogic.com\/blog\/getting-started-with-ansible\/?utm_source=webopsweekly\x26amp;utm_medium=email\x22\x3ehttps:\/\/gorillalogic.com\/blog\/getting-started-with-ansible\/?utm_source=webopsweekly\x26amp;utm_medium=email\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22https:\/\/gorillalogic.com\/author\/josehidalgo\/\x22\x3eJOSE HIDALGO\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/geekpi\x22\x3egeekpi\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 组织编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Ansible 起步指南</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/getting-started-with-ansible">https://www.zcfy.cc/article/getting-started-with-ansible</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/p2i1yh8wy3/" target="_blank">https://alili.tech/archive/p2i1yh8wy3/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/lfmj4xr00e/">2016年终总结--前端生涯从0到1的过程<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/ukfvl3yzohq/">ES6新语法疑点简析<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/adal5cm5rlr/">Icon 进化史<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/xwquh4g09bl/">JS 中 TDZ 的理解<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/13j072ppoyf/">Javascript 中 Y 组合子的推导<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/kn3l7fwd55/">Redux story-1:who creates it?<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/9gngp6sg77/">Redux概念之二: Redux的三大原则<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/ktc291v9lq/">V8 Object 内存结构与属性访问详解<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/62hk7sdq93k/">Vue&#43;MySQL&#43;Express小试牛刀<aside class="dates">2019-01-27</aside></a></li><li><a href="/archive/q9tzlra5qaj/">Vue2.0简易案例<aside class="dates">2019-01-27</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>