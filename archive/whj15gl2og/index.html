<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JS基础篇--搞清Image加载事件(onload)、加载状态(complete)后，实现图片的本地预览，并自适应于父元素内"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JS基础篇--搞清Image加载事件(onload)、加载状态(complete)后，实现图片的本地预览，并自适应于父元素内 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/whj15gl2og/",
				"appid": "1613049289050283", 
				"title": "JS基础篇--搞清Image加载事件(onload)、加载状态(complete)后，实现图片的本地预览，并自适应于父元素内 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-05T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/cmlfyaw6yif/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ucl5gdwezzo/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&text=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&text=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&title=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&is_video=false&description=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&title=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&title=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&title=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwhj15gl2og%2f&title=JS%e5%9f%ba%e7%a1%80%e7%af%87--%e6%90%9e%e6%b8%85Image%e5%8a%a0%e8%bd%bd%e4%ba%8b%e4%bb%b6%28onload%29%e3%80%81%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%28complete%29%e5%90%8e%ef%bc%8c%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e7%9a%84%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88%ef%bc%8c%e5%b9%b6%e8%87%aa%e9%80%82%e5%ba%94%e4%ba%8e%e7%88%b6%e5%85%83%e7%b4%a0%e5%86%85"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JS基础篇--搞清Image加载事件(onload)、加载状态(complete)后，实现图片的本地预览，并自适应于父元素内</h1><div class="meta"><div class="postdate"><time datetime="2019-01-05" itemprop="datePublished">2019-01-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eonload与complete介绍\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3ecomplete\x3c\/code\x3e只是HTMLImageElement对象的一个属性，可以判断图片加载完成，不管图片是不是有缓存；而\x3ccode\x3eonload\x3c\/code\x3e则是这个Image对象的load事件回调，当图片加载完成后执行onload绑定的函数。\x3c\/p\x3e\n\x3cp\x3e给下面一个例子，解释下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.getElementById(\x27load\x27).onclick = function() {  \n    var img = new Image();  \n    img.src=\x26quot;images\/avatar.png\x26quot;;  \n    if(img.complete) {  \n        console.log(\x27dd\x27);  \n    }  \n    img.onload = function() {  \n        console.log(\x27ff\x27);  \n    }  \n} \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e).onclick = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image();  \n    img.src=\x3cspan class=\x22hljs-string\x22\x3e\x22images\/avatar.png\x22\x3c\/span\x3e;  \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(img.complete) {  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dd\x27\x3c\/span\x3e);  \n    }  \n    img.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ff\x27\x3c\/span\x3e);  \n    }  \n} \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打印结果：\x3cbr\x3e第一次点击，谷歌浏览器结果为：dd;IE浏览器结果为：ff。\x3cbr\x3e第二次点击，谷歌浏览器结果为：dd,ff;IE浏览器结果为：ff。\x3cbr\x3e第三次点击，谷歌浏览器结果为：dd,ff;IE浏览器结果为：dd,ff。\x3cbr\x3e...\x3c\/p\x3e\n\x3cp\x3e例2：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.getElementById(\x27load\x27).onclick = function() {  \n    var img = new Image();  \n    if(img.complete) {  \n        console.log(\x27dd\x27);  \n    }  \n    img.onload = function() {  \n        console.log(\x27ff\x27)  \n    }  \n    img.src=\x26quot;images\/avatar.png\x26quot;;  \n} \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e).onclick = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image();  \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(img.complete) {  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dd\x27\x3c\/span\x3e);  \n    }  \n    img.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ff\x27\x3c\/span\x3e)  \n    }  \n    img.src=\x3cspan class=\x22hljs-string\x22\x3e\x22images\/avatar.png\x22\x3c\/span\x3e;  \n} \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打印结果：\x3cbr\x3e第一次点击，谷歌浏览器结果为：dd,ff;IE浏览器结果为：ff。\x3cbr\x3e第二次点击，谷歌浏览器结果为：dd,ff;IE浏览器结果为：ff。\x3cbr\x3e第二次点击，谷歌浏览器结果为：dd,ff;IE浏览器结果为：ff。\x3cbr\x3e...\x3c\/p\x3e\n\x3cp\x3e例3：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.getElementById(\x27load\x27).onclick = function() {  \n    var img = new Image(); \n    \n    if(img.complete) {  \n        console.log(\x27dd\x27);  \n    }  \n    img.onload = function() {  \n        console.log(\x27ff\x27)  \n    }  \n    img.src=\x26quot;\x26quot;;     \n}  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e).onclick = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image(); \n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(img.complete) {  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dd\x27\x3c\/span\x3e);  \n    }  \n    img.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ff\x27\x3c\/span\x3e)  \n    }  \n    img.src=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;     \n}  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打印结果：\x3cbr\x3e第一次点击，谷歌浏览器结果为：dd;IE浏览器结果为：空。\x3cbr\x3e第二次点击，谷歌浏览器结果为：dd;IE浏览器结果为：空。\x3cbr\x3e第二次点击，谷歌浏览器结果为：dd;IE浏览器结果为：空。\x3cbr\x3e...\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e根据结果得出：对于 complete 属性来讲，IE是根据图片是否显示过来判断，就是说当加载的图片显示出来后，complete 属性的值才为 true ，否则一直是 false ，和以前是否加载过该张图片没有关系，即和缓存没有关系！但是其它浏览器表现出来的确不一样，只要以前加载过该图，浏览器有缓存，也无论src是否有值，成功与否，只要获取到image，就可以执行，complete 就为 true。所以这个complete在不同浏览器中结果是不一样的。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e本地图片预览\x3c\/h2\x3e\n\x3cp\x3e首先先写下布局，html代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;centerView\x26quot;\x3e\n    \x3cdiv class=\x26quot;localPreview\x26quot;\x3e\n        \x3cimg id=\x26quot;showViewImg\x26quot;\/\x3e\n    \x3c\/div\x3e\n    \x3ca class=\x26quot;inputParent\x26quot; href=\x26quot;javascript:void(0)\x26quot;\x3e\n        \x3ci\x3e点击上传文件\x3c\/i\x3e\n        \x3cinput type=\x26quot;file\x26quot; id=\x26quot;filePath\x26quot; onchange=\x26quot;getCurrFile()\x26quot;\/\x3e\n    \x3c\/a\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x26lt;div \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22centerView\x22\x3c\/span\x3e\x26gt;\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22localPreview\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22showViewImg\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22inputParent\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22javascript:void(0)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e\x26gt;\x3c\/span\x3e点击上传文件\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22filePath\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonchange\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22getCurrFile()\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ecss代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.centerView{\n    width:150px;\n}\n.localPreview{\n    position:relative;\n    width:150px;\n    height:150px;\n    line-height:150px;\n    text-align:center;\n    background:#ccc;\n}\n.localPreview img{\n    position: relative;\n    vertical-align: middle;\n}\n.inputParent{\n    position:relative;\n    display:block;\n    margin:10px auto;\n    cursor:pointer;\n    width:80px;\n    height:30px;\n    line-height:30px;\n    background:#27bb6e;\n    text-align: center;\n    font-size:12px;\n    color:#fff;\n}\n.inputParent i{\n    font-style: normal;\n    color:#fff;\n}\n.inputParent #filePath{\n    position:absolute;\n    width:100%;\n    height:100%;\n    top:0;\n    left:0;\n    filter:alpha(opacity=0); \n    opacity: 0;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.centerView\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e150px\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.localPreview\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e:relative;\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e150px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e150px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eline-height\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e150px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3etext-align\x3c\/span\x3e:center;\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e#ccc\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.localPreview\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eimg\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: relative;\n    \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: middle;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.inputParent\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e:relative;\n    \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e:block;\n    \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e auto;\n    \x3cspan class=\x22hljs-attribute\x22\x3ecursor\x3c\/span\x3e:pointer;\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e80px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e30px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eline-height\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e30px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e#27bb6e\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3etext-align\x3c\/span\x3e: center;\n    \x3cspan class=\x22hljs-attribute\x22\x3efont-size\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e12px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3ecolor\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e#fff\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.inputParent\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ei\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3efont-style\x3c\/span\x3e: normal;\n    \x3cspan class=\x22hljs-attribute\x22\x3ecolor\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e#fff\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-selector-class\x22\x3e.inputParent\x3c\/span\x3e \x3cspan class=\x22hljs-selector-id\x22\x3e#filePath\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e:absolute;\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3efilter\x3c\/span\x3e:\x3cspan class=\x22hljs-built_in\x22\x3ealpha\x3c\/span\x3e(opacity=0); \n    \x3cspan class=\x22hljs-attribute\x22\x3eopacity\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e静态页面的效果如图所示：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVR15E?w=327\x26amp;h=259\x22 src=\x22https:\/\/static.alili.tech\/img\/bVR15E?w=327\x26amp;h=259\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e梳理一下思路，我们要实现图片的本地预览，需要如下几点：\x3cbr\x3e1.点击file上传文件按钮后，选中图片后，获得图片的路径。\x3cbr\x3e2.根据图片实例一个new Image()得到图片的实际的大小。\x3cbr\x3e3.得到图片的实际大小，再根据显示区域的宽高来处理图片的宽高，让其自适应于父元素区域中。\x3cbr\x3e4.在IE9以及低版本浏览器中需要使用滤镜来实现图片的预览。\x3c\/p\x3e\n\x3cp\x3e根据以上几点我们就写如下代码，首先我们先创建一个构造函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function DealPic(width,height){\n    this.oriWidth = width;\n    this.oriHeight = height;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3efunction DealPic(\x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e,height){\n    this\x3cspan class=\x22hljs-selector-class\x22\x3e.oriWidth\x3c\/span\x3e = \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e;\n    this\x3cspan class=\x22hljs-selector-class\x22\x3e.oriHeight\x3c\/span\x3e = \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个oriWidth与oriHeight指的是父区域的宽高，也就是图片要跟该宽高进行比较的值。\x3c\/p\x3e\n\x3cp\x3e接下来实现一个getObjectURL，干嘛的呢，如果支持file对象支持files，就返回只包含url的一个对象，如果是IE9以及低版本浏览器返回的对象中还包括滤镜图片的原始大小。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22DealPic.prototype.getObjectURL = function(fileObj){\n    var result = {} ;\n    var file;\n    if(fileObj.files){\n        file = fileObj.files[0];\n        if (window.createObjectURL!=undefined) { \/\/ basic\n            result.url = window.createObjectURL(file) ;\n        }else if (window.URL!=undefined) { \/\/ mozilla(firefox)\n            result.url = window.URL.createObjectURL(file) ;\n        }else if (window.webkitURL!=undefined) { \/\/ webkit or chrome\n            result.url = window.webkitURL.createObjectURL(file) ;\n        }\n    }else{\n       var hiddenAlphaImageWidth,hiddenAlphaImageHeight;\n        var hiddenAlphaImage = document.createElement(\x27img\x27);\n        document.body.appendChild(hiddenAlphaImage);\n        fileObj.select();\n        fileObj.blur();\n        result.url = document.selection.createRange().text;\n        hiddenAlphaImage.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)\x26quot;;\n        hiddenAlphaImage.filters.item(\x26quot;DXImageTransform.Microsoft.AlphaImageLoader\x26quot;).src = result.url;\n        \/\/但是当滤镜使用的图片超过10M大小，使用上面的代码页面会报错，说hiddenAlphaImage出现未指明的错误；\n        \/\/解决办法就是使用下面的注释的方式，注释上面的两行代码\n        \/\/使用下面代码滤镜图片超过10M后本地预览不了，通过这个滤镜得到的图片的宽高始终是28*30\n        \/\/hiddenAlphaImage.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=\x27image\x27,src=\\\x26quot;\x26quot; \x2b result.url \x2b \x26quot;\\\x26quot;)\x26quot;; \n        \n        result.width = hiddenAlphaImage.offsetWidth;\n        result.height = hiddenAlphaImage.offsetHeight;\n        if(hiddenAlphaImage.parentNode){\n            hiddenAlphaImage.parentNode.removeChild(hiddenAlphaImage);\n        }\n    }\n    return result;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eDealPic.prototype.getObjectURL = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efileObj\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = {} ;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(fileObj.files){\n        file = fileObj.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.createObjectURL!=\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ basic\x3c\/span\x3e\n            result.url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.createObjectURL(file) ;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL!=\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ mozilla(firefox)\x3c\/span\x3e\n            result.url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL.createObjectURL(file) ;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.webkitURL!=\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ webkit or chrome\x3c\/span\x3e\n            result.url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.webkitURL.createObjectURL(file) ;\n        }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hiddenAlphaImageWidth,hiddenAlphaImageHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hiddenAlphaImage = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27img\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(hiddenAlphaImage);\n        fileObj.select();\n        fileObj.blur();\n        result.url = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.selection.createRange().text;\n        hiddenAlphaImage.style.filter = \x3cspan class=\x22hljs-string\x22\x3e\x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)\x22\x3c\/span\x3e;\n        hiddenAlphaImage.filters.item(\x3cspan class=\x22hljs-string\x22\x3e\x22DXImageTransform.Microsoft.AlphaImageLoader\x22\x3c\/span\x3e).src = result.url;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/但是当滤镜使用的图片超过10M大小，使用上面的代码页面会报错，说hiddenAlphaImage出现未指明的错误；\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/解决办法就是使用下面的注释的方式，注释上面的两行代码\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/使用下面代码滤镜图片超过10M后本地预览不了，通过这个滤镜得到的图片的宽高始终是28*30\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/hiddenAlphaImage.style.filter = \x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=\x27image\x27,src=\\\x22\x22 \x2b result.url \x2b \x22\\\x22)\x22; \x3c\/span\x3e\n        \n        result.width = hiddenAlphaImage.offsetWidth;\n        result.height = hiddenAlphaImage.offsetHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(hiddenAlphaImage.parentNode){\n            hiddenAlphaImage.parentNode.removeChild(hiddenAlphaImage);\n        }\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在IE低版本浏览器为什么要这样处理呢，如果我们要得到滤镜图片的元素大小，首先得创建一个img元素，然后通过IE浏览器的document.selection.createRange().text得到图片路径，然后给这个img元素进行设置，这儿关键得用到filter的sizingMethod属性。\x3c\/p\x3e\n\x3cp\x3esizingMethod属性：可选值，设置或检索的方式来显示一个图像在对象边界显示方式。有三个值：crop裁剪图像以适应对象的尺寸；image，默认值，扩大或减少对象的边界,以适应图像的尺寸；scale，伸展或收缩图像填充对象的边界；\x3c\/p\x3e\n\x3cp\x3e这儿使用image才能得到滤镜图片的原始大小。然后返回。\x3cbr\x3e如果一开始只是把这个url返回回去，没有返回滤镜图片的实际大小，就不能达到自适应的效果。\x3c\/p\x3e\n\x3cp\x3e当然上面获取图片的url用到的是\x3ccode\x3ewindow.createObjectURL\x3c\/code\x3e，也可以用\x3ccode\x3eFileReader.readAsDataURL\x3c\/code\x3e读取指定Blob或File的内容。\x3cbr\x3e简单实现一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (input.files \x26amp;\x26amp; input.files[0]) {\n    var reader = new FileReader();\n    reader.onload = function (e) { \n        var showImg = document.getElementById(\x27showViewImg\x27);\n        showImg.src = e.target.result;\n        showImg.style.width = \x27150px\x27;\n        showImg.style.height = \x2780px\x27;        \n    };\n    reader.readAsDataURL(input.files[0]);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (input.files \x26amp;\x26amp; input.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e reader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FileReader();\n    reader.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{ \n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e showImg = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27showViewImg\x27\x3c\/span\x3e);\n        showImg.src = e.target.result;\n        showImg.style.width = \x3cspan class=\x22hljs-string\x22\x3e\x27150px\x27\x3c\/span\x3e;\n        showImg.style.height = \x3cspan class=\x22hljs-string\x22\x3e\x2780px\x27\x3c\/span\x3e;        \n    };\n    reader.readAsDataURL(input.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这儿就不详细介绍了，只是这儿得到的url是base64编码的字符串，所以我一般还是选中上面第一种方式。 \x3c\/p\x3e\n\x3cp\x3e接下来就是图片自适应的比较方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22DealPic.prototype.getPicResult = function(targetWidth,targetHeight,callback){\n    if(this.oriWidth \/ this.oriHeight \x3e targetWidth \/ targetHeight){\n        var th = this.oriHeight;\n        var tw = this.oriHeight \/ targetHeight * targetWidth; \n    }else{\n       var tw = this.oriWidth;\n       var th = this.oriWidth \/ targetWidth * targetHeight;\n    }\n    if(callback){\n        callback(tw,th);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3eDealPic.prototype.getPicResult = function(targetWidth,targetHeight,callback){\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriWidth \/ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriHeight \x26gt; targetWidth \/ targetHeight){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e th = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tw = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriHeight \/ targetHeight * targetWidth; \n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tw = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriWidth;\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e th = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.oriWidth \/ targetWidth * targetHeight;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(callback){\n        callback(tw,th);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这儿就不细说了。\x3c\/p\x3e\n\x3cp\x3e最后就是绑定到file按钮上的change事件的方法了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getCurrFile(){\n    var fileObj = document.getElementById(\x27filePath\x27);\n    var showImgObj = document.getElementById(\x27showViewImg\x27);\n    var newPicObj = new DealPic(150,150);\n    var resultFileObj = newPicObj.getObjectURL(fileObj);\n    if(fileObj.files){\n        var newImg = new Image();\n        newImg.onload = function(){\n            newPicObj.getPicResult(newImg.width,newImg.height,function(tw,th){\n                showImgObj.style.width = tw \x2b \x27px\x27;\n                showImgObj.style.height = th \x2b \x27px\x27;\n            });    \n        }\n        newImg.src = resultFileObj.url;\n        showImgObj.setAttribute(\x27src\x27,resultFileObj.url);\n    }else{\n        showImgObj.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)\x26quot;;\n        showImgObj.filters.item(\x26quot;DXImageTransform.Microsoft.AlphaImageLoader\x26quot;).src = resultFileObj.url;\n        \/\/IE9低版本不设置图片src会显示裂图，所以设置一个透明图片或者base64的透明图片\n        showImgObj.setAttribute(\x27src\x27,\x27.\/images\/transparent.png\x27);\n        \/\/showImgObj.src = \x27data:image\/gif;base64,R0lGODlhAQABAIAAAP\/\/\/wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\x27;\n        newPicObj.getPicResult(resultFileObj.width,resultFileObj.height,function(resw,resh){\n            showImgObj.style.width = resw \x2b \x27px\x27;\n            showImgObj.style.height = resh \x2b \x27px\x27;\n        });    \n    }   \n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetCurrFile\x3c\/span\x3e\x3c\/span\x3e(){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fileObj = document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27filePath\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e showImgObj = document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27showViewImg\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eDealPic\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e150\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e150\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e resultFileObj = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getObjectURL(fileObj);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(fileObj.files){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eImage\x3c\/span\x3e();\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getPicResult(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.width,\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.height,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(tw,th){\n                showImgObj.style.width = tw \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n                showImgObj.style.height = th \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n            });    \n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.src = resultFileObj.url;\n        showImgObj.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e,resultFileObj.url);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        showImgObj.style.filter = \x3cspan class=\x22hljs-string\x22\x3e\x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)\x22\x3c\/span\x3e;\n        showImgObj.filters.item(\x3cspan class=\x22hljs-string\x22\x3e\x22DXImageTransform.Microsoft.AlphaImageLoader\x22\x3c\/span\x3e).src = resultFileObj.url;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/IE9低版本不设置图片src会显示裂图，所以设置一个透明图片或者base64的透明图片\x3c\/span\x3e\n        showImgObj.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27.\/images\/transparent.png\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/showImgObj.src = \x27data:image\/gif;base64,R0lGODlhAQABAIAAAP\/\/\/wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\x27;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getPicResult(resultFileObj.width,resultFileObj.height,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(resw,resh){\n            showImgObj.style.width = resw \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n            showImgObj.style.height = resh \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n        });    \n    }   \n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后的js代码总结：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function DealPic(width,height){\n    this.oriWidth = width;\n    this.oriHeight = height;\n}\n\nDealPic.prototype.getObjectURL = function(fileObj){\n    var result = {} ;\n    var file;\n    if(fileObj.files){\n        file = fileObj.files[0];\n        if (window.createObjectURL!=undefined) { \/\/ basic\n            result.url = window.createObjectURL(file) ;\n        }else if (window.URL!=undefined) { \/\/ mozilla(firefox)\n            result.url = window.URL.createObjectURL(file) ;\n        }else if (window.webkitURL!=undefined) { \/\/ webkit or chrome\n            result.url = window.webkitURL.createObjectURL(file) ;\n        }\n    }else{\n       var hiddenAlphaImageWidth,hiddenAlphaImageHeight;\n        var hiddenAlphaImage = document.createElement(\x27img\x27);\n        document.body.appendChild(hiddenAlphaImage);\n        fileObj.select();\n        fileObj.blur();\n        result.url = document.selection.createRange().text;\n        hiddenAlphaImage.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)\x26quot;;\n        hiddenAlphaImage.filters.item(\x26quot;DXImageTransform.Microsoft.AlphaImageLoader\x26quot;).src = result.url;\n        \/\/但是当滤镜使用的图片超过10M大小，使用上面的代码页面会报错，说hiddenAlphaImage出现未指明的错误；\n        \/\/解决办法就是使用下面的注释的方式，注释上面的两行代码\n        \/\/使用下面代码滤镜图片超过10M后本地预览不了，通过这个滤镜得到的图片的宽高始终是28*30\n        \/\/hiddenAlphaImage.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=\x27image\x27,src=\\\x26quot;\x26quot; \x2b result.url \x2b \x26quot;\\\x26quot;)\x26quot;; \n        \n        result.width = hiddenAlphaImage.offsetWidth;\n        result.height = hiddenAlphaImage.offsetHeight;\n        if(hiddenAlphaImage.parentNode){\n            hiddenAlphaImage.parentNode.removeChild(hiddenAlphaImage);\n        }\n    }\n    return result;\n}\n\nDealPic.prototype.getPicResult = function(targetWidth,targetHeight,callback){\n    if(this.oriWidth \/ this.oriHeight \x3e targetWidth \/ targetHeight){\n        var th = this.oriHeight;\n        var tw = this.oriHeight \/ targetHeight * targetWidth; \n    }else{\n       var tw = this.oriWidth;\n       var th = this.oriWidth \/ targetWidth * targetHeight;\n    }\n    if(callback){\n        callback(tw,th);\n    }\n}\n\nfunction getCurrFile(){\n    var fileObj = document.getElementById(\x27filePath\x27);\n    var showImgObj = document.getElementById(\x27showViewImg\x27);\n    var newPicObj = new DealPic(150,150);\n    var resultFileObj = newPicObj.getObjectURL(fileObj);\n    if(fileObj.files){\n        var newImg = new Image();\n        newImg.onload = function(){\n            newPicObj.getPicResult(newImg.width,newImg.height,function(tw,th){\n                showImgObj.style.width = tw \x2b \x27px\x27;\n                showImgObj.style.height = th \x2b \x27px\x27;\n            });    \n        }\n        newImg.src = resultFileObj.url;\n        showImgObj.setAttribute(\x27src\x27,resultFileObj.url);\n    }else{\n        showImgObj.style.filter = \x26quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)\x26quot;;\n        showImgObj.filters.item(\x26quot;DXImageTransform.Microsoft.AlphaImageLoader\x26quot;).src = resultFileObj.url;\n        \/\/IE9低版本不设置图片src会显示裂图，所以设置一个透明图片或者base64的透明图片\n        showImgObj.setAttribute(\x27src\x27,\x27.\/images\/transparent.png\x27);\n        \/\/showImgObj.src = \x27data:image\/gif;base64,R0lGODlhAQABAIAAAP\/\/\/wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\x27;\n        newPicObj.getPicResult(resultFileObj.width,resultFileObj.height,function(resw,resh){\n            showImgObj.style.width = resw \x2b \x27px\x27;\n            showImgObj.style.height = resh \x2b \x27px\x27;\n        });    \n    }   \n}  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDealPic\x3c\/span\x3e\x3c\/span\x3e(width,height){\n    \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriWidth = width;\n    \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriHeight = height;\n}\n\nDealPic.prototype.getObjectURL = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(fileObj){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = {} ;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(fileObj.files){\n        file = fileObj.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (window.createObjectURL!=undefined) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ basic\x3c\/span\x3e\n            result.url = window.createObjectURL(file) ;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (window.URL!=undefined) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ mozilla(firefox)\x3c\/span\x3e\n            result.url = window.URL.createObjectURL(file) ;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (window.webkitURL!=undefined) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ webkit or chrome\x3c\/span\x3e\n            result.url = window.webkitURL.createObjectURL(file) ;\n        }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hiddenAlphaImageWidth,hiddenAlphaImageHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hiddenAlphaImage = document.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27img\x27\x3c\/span\x3e);\n        document.body.appendChild(hiddenAlphaImage);\n        fileObj.select();\n        fileObj.blur();\n        result.url = document.selection.createRange().text;\n        hiddenAlphaImage.style.filter = \x3cspan class=\x22hljs-string\x22\x3e\x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)\x22\x3c\/span\x3e;\n        hiddenAlphaImage.filters.item(\x3cspan class=\x22hljs-string\x22\x3e\x22DXImageTransform.Microsoft.AlphaImageLoader\x22\x3c\/span\x3e).src = result.url;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/但是当滤镜使用的图片超过10M大小，使用上面的代码页面会报错，说hiddenAlphaImage出现未指明的错误；\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/解决办法就是使用下面的注释的方式，注释上面的两行代码\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/使用下面代码滤镜图片超过10M后本地预览不了，通过这个滤镜得到的图片的宽高始终是28*30\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/hiddenAlphaImage.style.filter = \x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=\x27image\x27,src=\\\x22\x22 \x2b result.url \x2b \x22\\\x22)\x22; \x3c\/span\x3e\n        \n        result.width = hiddenAlphaImage.offsetWidth;\n        result.height = hiddenAlphaImage.offsetHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(hiddenAlphaImage.parentNode){\n            hiddenAlphaImage.parentNode.removeChild(hiddenAlphaImage);\n        }\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n}\n\nDealPic.prototype.getPicResult = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(targetWidth,targetHeight,\x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriWidth \/ \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriHeight \x26gt; targetWidth \/ targetHeight){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e th = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriHeight;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tw = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriHeight \/ targetHeight * targetWidth; \n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tw = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriWidth;\n       \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e th = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.oriWidth \/ targetWidth * targetHeight;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e(tw,th);\n    }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetCurrFile\x3c\/span\x3e\x3c\/span\x3e(){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fileObj = document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27filePath\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e showImgObj = document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27showViewImg\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eDealPic\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e150\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e150\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e resultFileObj = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getObjectURL(fileObj);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(fileObj.files){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eImage\x3c\/span\x3e();\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getPicResult(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.width,\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.height,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(tw,th){\n                showImgObj.style.width = tw \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n                showImgObj.style.height = th \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n            });    \n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.src = resultFileObj.url;\n        showImgObj.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e,resultFileObj.url);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        showImgObj.style.filter = \x3cspan class=\x22hljs-string\x22\x3e\x22progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)\x22\x3c\/span\x3e;\n        showImgObj.filters.item(\x3cspan class=\x22hljs-string\x22\x3e\x22DXImageTransform.Microsoft.AlphaImageLoader\x22\x3c\/span\x3e).src = resultFileObj.url;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/IE9低版本不设置图片src会显示裂图，所以设置一个透明图片或者base64的透明图片\x3c\/span\x3e\n        showImgObj.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27.\/images\/transparent.png\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/showImgObj.src = \x27data:image\/gif;base64,R0lGODlhAQABAIAAAP\/\/\/wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\x27;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ePicObj\x3c\/span\x3e.getPicResult(resultFileObj.width,resultFileObj.height,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(resw,resh){\n            showImgObj.style.width = resw \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n            showImgObj.style.height = resh \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n        });    \n    }   \n}  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后本地预览的效果如图所示：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVR4Kb?w=284\x26amp;h=233\x22 src=\x22https:\/\/static.alili.tech\/img\/bVR4Kb?w=284\x26amp;h=233\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JS基础篇&ndash;搞清Image加载事件(onload)、加载状态(complete)后，实现图片的本地预览，并自适应于父元素内</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010465626">https://segmentfault.com/a/1190000010465626</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/whj15gl2og/" target="_blank">https://alili.tech/archive/whj15gl2og/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5x6tenwjeux/">ES6中的异步编程：Generators函数&#43;Promise:最强大的异步处理方式<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/nvtmua2a1hd/">GreenSock (TweenMax) 极简入门指南<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/7kt5s47oysx/">HTML5 中 canvas 的使用总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/41pgo3a2iyp/">JavaScript 开发者所需要知道的 V8（一）：V8 In NodeJS<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/krb1zm7x38j/">JavaScript 时间与日期处理实战:你肯定被坑过<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/yh2lq30d0x/">JavaScript中的各种宽高属性<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/eydwczesyv/">Muse UI — 基于 Vue2.0 的 Material Design UI 库<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/y62oejm8cr/">Nodejs基础：路径处理模块path总结<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/06cwh88ankmd/">PhantomJS &amp; NodeJS 在京东网站前端监控平台的最佳实践<aside class="dates">2019-01-31</aside></a></li><li><a href="/archive/z4ymvs0jz2h/">Promise 的链式调用与中止<aside class="dates">2019-01-31</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>