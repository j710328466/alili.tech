<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="理解async"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>理解async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/bg0lveo07vu/",
				"appid": "1613049289050283", 
				"title": "理解async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-18T02:30:35"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/b8n0atmlvzh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/3imfkn9gw2h/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&text=%e7%90%86%e8%a7%a3async"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&text=%e7%90%86%e8%a7%a3async"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&title=%e7%90%86%e8%a7%a3async"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&is_video=false&description=%e7%90%86%e8%a7%a3async"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%90%86%e8%a7%a3async&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&title=%e7%90%86%e8%a7%a3async"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&title=%e7%90%86%e8%a7%a3async"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&title=%e7%90%86%e8%a7%a3async"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbg0lveo07vu%2f&title=%e7%90%86%e8%a7%a3async"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">理解async</h1><div class="meta"><div class="postdate"><time datetime="2019-01-18" itemprop="datePublished">2019-01-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e写在前面\x3c\/h2\x3e\n\x3cp\x3e本文将要实现一个顺序读取文件的最优方法，实现方式从最古老的回调方式到目前的\x3ccode\x3easync\x3c\/code\x3e，也会与大家分享下本人对于\x3ccode\x3ethunk\x3c\/code\x3e库与\x3ccode\x3eco\x3c\/code\x3e库的理解。实现的效果：顺序读取出\x3ccode\x3ea.txt\x3c\/code\x3e与\x3ccode\x3eb.txt\x3c\/code\x3e，将读出的内容拼接成为一个字符串。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e同步读取\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readTwoFile = () =\x3e {\n    const f1 = fs.readFileSync(\x27.\/a.txt\x27),\n        f2 = fs.readFileSync(\x27.\/b.txt\x27);\n    return Buffer.concat([f1, f2]).toString();\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readTwoFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e f1 = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.txt\x27\x3c\/span\x3e),\n        f2 = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.txt\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Buffer.concat([f1, f2]).toString();\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方式最利于我们理解，代码也很清楚，没有过多的嵌套，很好的维护，但是这种有着最大的问题，那就是性能，\x3ccode\x3enode\x3c\/code\x3e所倡导的就是异步\x3ccode\x3ei\/o\x3c\/code\x3e来处理密集\x3ccode\x3ei\/o\x3c\/code\x3e，而同步的读取，很大的程度上浪费着服务器的\x3ccode\x3ecpu\x3c\/code\x3e，这种方式的弊端明显的大于好处，所以直接pass掉。（\x3cstrong\x3e其实\x3ccode\x3enode\x3c\/code\x3e的任何异步编程的解决方案的目标都是要达到同步的语义，异步的执行。\x3c\/strong\x3e）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e利用回调读取\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readTwoFile = () =\x3e {\n    let str = null;\n    fs.readFile(\x27.\/a.txt\x27, (err, data) =\x3e {\n        if (err) throw new Error(err);\n        str = data;\n        fs.readFile(\x27.\/b.txt\x27, (err, data) =\x3e {\n            if (err) throw new Error(err);\n            str = Buffer.concat([str, data]).toString();\n        });\n    });\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readTwoFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e str = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    fs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.txt\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(err);\n        str = data;\n        fs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.txt\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(err);\n            str = Buffer.concat([str, data]).toString();\n        });\n    });\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e利用回调的方式，实现起来很简单，直接的嵌套下去就好，但是这种情况下很容易造成的就是不易维护，难以读懂的情况，最为极致的情况的就是回调地狱。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3ePromise实现\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readFile = file =\x3e \n    new Promise((reslove, reject) =\x3e {\n        fs.readFile(file, (err, data) =\x3e {\n            if (err) reject(err);\n            reslove(data);\n        });\n    });\nconst readTwoFile = () =\x3e {\n    let bf = null;\n    readFile(\x27.\/a.txt\x27)\n        .then(\n            data =\x3e {\n                bf = data;\n                return readFile(\x27.\/b.txt\x27);\n            }, \n            err =\x3e { throw new Error(err) }\n        )\n        .then(\n            data =\x3e {\n                console.log(Buffer.concat([bf, data]).toString())\n            }, \n            err =\x3e { throw new Error(err) }\n        );\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efile\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ereslove, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        fs.readFile(file, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) reject(err);\n            reslove(data);\n        });\n    });\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readTwoFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e bf = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.txt\x27\x3c\/span\x3e)\n        .then(\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                bf = data;\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.txt\x27\x3c\/span\x3e);\n            }, \n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(err) }\n        )\n        .then(\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(Buffer.concat([bf, data]).toString())\n            }, \n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(err) }\n        );\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePromise\x3c\/code\x3e可以将横向增长的回调转化为纵向增长，能解决一些问题，但是\x3ccode\x3ePromise\x3c\/code\x3e造成的问题就是代码冗余，一眼看过去，全部是\x3ccode\x3ethen\x3c\/code\x3e，也不是很爽，但是相比于回调函数嵌套来说，已经有了很大的提升。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eyield\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eGenerator\x3c\/code\x3e很多语言中都有，本质上是\x3cstrong\x3e协程\x3c\/strong\x3e，下面就来看一下\x3cstrong\x3e协程，线程，进程\x3c\/strong\x3e的区别与联系：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e进程：操作系统中分配资源的基本单位\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e线程：操作系统中调度资源的基本单位\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e协程：比线程更小的的执行单元，自带\x3ccode\x3ecpu\x3c\/code\x3e上下文，一个协程一个栈\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e一个进程中可能存在多个线程，一个线程中可能存在多个协程，进程、线程的切换由操作系统控制，而协程的切换由程序员自身控制。异步\x3ccode\x3ei\/o\x3c\/code\x3e利用回调的方式来应对\x3ccode\x3ei\/o\x3c\/code\x3e密集，同样的使用协程也可以来应对，协程的切换并没有很大的资源浪费，将一个\x3ccode\x3ei\/o\x3c\/code\x3e操作写成一个协程，这样进行\x3ccode\x3ei\/o\x3c\/code\x3e时可以吧\x3ccode\x3ecpu\x3c\/code\x3e让给其他协程。\x3cbr\x3e\x3ccode\x3ejs\x3c\/code\x3e同样支持协程，那就是\x3ccode\x3eyield\x3c\/code\x3e。使用\x3ccode\x3eyield\x3c\/code\x3e给我们直观的感受就是，执行到了这个地方停了下来，其他的代码继续跑，到你想让他继续执行了，他就是会继续执行。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function *readTwoFile() {\n    const f1 = yield readFile(\x27.\/a.txt\x27);\n    const f2 = yield readFile(\x27.\/b.txt\x27);  \n    return Buffer.concat([f1, f2]).toString();\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e *\x3cspan class=\x22hljs-title\x22\x3ereadTwoFile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e f1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.txt\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e f2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.txt\x27\x3c\/span\x3e);  \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Buffer.concat([f1, f2]).toString();\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eyield\x3c\/code\x3e下的顺序读取呈现的也是一种顺序读取的方式，对于\x3ccode\x3ereadFile\x3c\/code\x3e来看有两种不同的实现方式，\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e利用\x3ccode\x3ethunkify\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const thunkify = (fn, ctx) =\x3e (...items) =\x3e (done) =\x3e {\n    ctx = ctx || null;\n    let called = false;\n    items.push((...args) =\x3e {\n        if (called) return void 0;\n        called = true;\n        done.apply(ctx, args);\n    });\n    try {\n        fn.apply(ctx, items);    \n    } catch(err) {\n        done(err);\n    }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e thunkify = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3efn, ctx\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (...items) =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edone\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    ctx = ctx || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e called = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    items.push(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (called) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        called = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        done.apply(ctx, args);\n    });\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        fn.apply(ctx, items);    \n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(err) {\n        done(err);\n    }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ethunkify\x3c\/code\x3e函数就是一种柯里化得思想，最后的传入参数\x3ccode\x3edone\x3c\/code\x3e就为回调函数，利用\x3ccode\x3ethunkify\x3c\/code\x3e可以很轻松的实现\x3ccode\x3eyield\x3c\/code\x3e函数的自动化流程：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const run = fn =\x3e {\n    const gen = fn();\n    let res;\n    (function next(err, data) {\n        let g = gen.next(data);\n        if (g.done) return void 0;\n        g.value(next);\n    })();\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e run = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e gen = fn();\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e res;\n    (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e g = gen.next(data);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (g.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        g.value(next);\n    })();\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e利用\x3ccode\x3ePromise\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readFile = file =\x3e \n    new Promise((reslove, reject) =\x3e {\n        fs.readFile(file, (err, data) =\x3e {\n            if (err) reject(err);\n            reslove(data);\n        });\n    });\nconst run = fn =\x3e {\n    const gen = fn();\n    let str = null;\n    (function next(err, data) {\n        let res = gen.next(data);\n        if (res.done) return void 0;\n        res.value.then(\n            data =\x3e {\n                next(null, data);\n            }, \n            err =\x3e { throw new Error(err); }\n        );\n    })();\n};\nrun(readTwoFile);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efile\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ereslove, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        fs.readFile(file, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) reject(err);\n            reslove(data);\n        });\n    });\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e run = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e gen = fn();\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e str = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e res = gen.next(data);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        res.value.then(\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                next(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, data);\n            }, \n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(err); }\n        );\n    })();\n};\nrun(readTwoFile);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面两种方式都可以达到自动执行\x3ccode\x3eyield\x3c\/code\x3e的过程，那么有没有一种方式，可以兼容这两种实现方式呢，tj大神又给出了一个库，那就是\x3ccode\x3eco\x3c\/code\x3e库，先来看下用法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ readTwoFile的实现与上面类似,readFile既可以利用Promise也可以利用thunkify\n\/\/ co库返回一个Promise对象\nco(readTwoFile).then(data =\x3e console.log(data));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ readTwoFile的实现与上面类似,readFile既可以利用Promise也可以利用thunkify\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ co库返回一个Promise对象\x3c\/span\x3e\nco(readTwoFile).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e =\x26gt; console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e来看下\x3ccode\x3eco\x3c\/code\x3e库的实现，\x3ccode\x3eco\x3c\/code\x3e库默认会返回一个\x3ccode\x3ePromise\x3c\/code\x3e对象，对于\x3ccode\x3eyield\x3c\/code\x3e之后的值（如上面的\x3ccode\x3eres.value\x3c\/code\x3e），\x3ccode\x3eco\x3c\/code\x3e库会将其转换为一个\x3ccode\x3ePromise\x3c\/code\x3e。实现思想很简单，基本还是利用递归的方式，大体的思路如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const baseHandle = handle =\x3e res =\x3e {\n    let ret;\n    try {\n        ret = gen[handle](res);\n    } catch(e) {\n        reject(e);\n    }\n    next(ret);\n};\nfunction co(gen) {\n    const ctx = this,\n        args = Array.prototype.slice.call(arguments, 1);\n    return new Promise((reslove, reject) =\x3e {\n        if (typeof gen === \x27function\x27) gen = gen.apply(ctx, args);\n        if (!gen || typeof gen.next !== \x27function\x27) return resolve(gen);\n\n        const onFulfilled = baseHandle(\x27next\x27),\n            onRejected = baseHandle(\x27throw\x27);\n\n        onFulfilled();\n\n        function next(ret) {\n            if (ret.done) reslove(ret.value);\n            \/\/ 将yield的返回值转换为Proimse\n            const value = toPromise.call(ctx, ret.value);\n            if (value \x26amp;\x26amp; isPromise(value)) return value.then(onFulfilled, onRejected);\n            return onRejected(new TypeError(\x27yield type error\x27));\n        }\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e baseHandle = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ehandle\x3c\/span\x3e =\x26gt;\x3c\/span\x3e res =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ret;\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        ret = gen[handle](res);\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(e) {\n        reject(e);\n    }\n    next(ret);\n};\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eco\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ctx = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e,\n        args = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype.slice.call(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ereslove, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e gen === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) gen = gen.apply(ctx, args);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!gen || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e gen.next !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e resolve(gen);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e onFulfilled = baseHandle(\x3cspan class=\x22hljs-string\x22\x3e\x27next\x27\x3c\/span\x3e),\n            onRejected = baseHandle(\x3cspan class=\x22hljs-string\x22\x3e\x27throw\x27\x3c\/span\x3e);\n\n        onFulfilled();\n\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eret\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ret.done) reslove(ret.value);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将yield的返回值转换为Proimse\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e value = toPromise.call(ctx, ret.value);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value \x26amp;\x26amp; isPromise(value)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value.then(onFulfilled, onRejected);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e onRejected(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eTypeError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27yield type error\x27\x3c\/span\x3e));\n        }\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etoPromise\x3c\/code\x3e就是将一些类型转换为\x3ccode\x3ePromise\x3c\/code\x3e，从这里我们可以看出的是可以将哪些类型放在\x3ccode\x3eyield\x3c\/code\x3e后面，这里就来看一个常用的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 把thunkify之后的函数转化为Promise的形式\nfunction thunkToPromise(fn) {\n    const ctx = this;\n    return new Promise(function (resolve, reject) {\n        fn.call(ctx, function (err, res) {\n            if (err) return reject(err);\n            if (arguments.length \x3e 2) res = slice.call(arguments, 1);\n            resolve(res);\n        });\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把thunkify之后的函数转化为Promise的形式\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkToPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ctx = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        fn.call(ctx, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, res\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(err);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) res = slice.call(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n            resolve(res);\n        });\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最近\x3ccode\x3eNode\x3c\/code\x3e已经支持了\x3ccode\x3easync\/await\x3c\/code\x3e，可以利用其来做异步操作：\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e终极解决\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readFile = file =\x3e \n    new Promise((reslove, reject) =\x3e {\n        fs.readFile(file, (err, data) =\x3e {\n            if (err) reject(err);\n            reslove(data);\n        });\n    });\nconst readTwoFile = async function() {\n    const f1 = await readFile(\x27.\/a.txt\x27);\n    const f2 = await readFile(\x27.\/b.txt\x27);    \n    return Buffer.concat([f1, f2]).toString();\n};\nreadTwoFile().then(data =\x3e {\n    console.log(data);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efile\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ereslove, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        fs.readFile(file, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) reject(err);\n            reslove(data);\n        });\n    });\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readTwoFile = \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e f1 = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.txt\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e f2 = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.txt\x27\x3c\/span\x3e);    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Buffer.concat([f1, f2]).toString();\n};\nreadTwoFile().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3easync\/await\x3c\/code\x3e做的就是将\x3ccode\x3ePromise\x3c\/code\x3e对象给串联起来，避免了\x3ccode\x3ethen\x3c\/code\x3e的调用方式，代码非常的易读，就是一种同步的方式。不再需要借助其他外界类库（比如\x3ccode\x3eco\x3c\/code\x3e库）就可以优雅的解决回调的问题。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>理解async</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008687414">https://segmentfault.com/a/1190000008687414</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/bg0lveo07vu/" target="_blank">https://alili.tech/archive/bg0lveo07vu/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5328xogjarn/">IndexedDB--HTML5本地存储<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/xpccu0hsqbr/">JS学习系列 01 - 编译原理和作用域<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/shv09bbtbfd/">Vue2 SSR 的优化之旅<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5vj1ojfo6h6/">[2016年末巨献] — HTML5可交互地铁线路图（第二季：帝都进阶版）<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/m02hlm4bzh/">vue2.0开发聊天程序（三）组件的通信<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/mz5o7n90plg/">《很高兴我没有猝死》- 前端新人的 2016 年总结和感悟<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/3vhoe2mo09k/">一道颇有难度的JavaScript题<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/uj12mb7thp/">使用CANVAS实现交互性圆形马赛克效果<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/ja636h8hcxa/">写于 2016 年末<aside class="dates">2019-01-28</aside></a></li><li><a href="/archive/5uomnoq1kmi/">前端学习资源整理<aside class="dates">2019-01-28</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>