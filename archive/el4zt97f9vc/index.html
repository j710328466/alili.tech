<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/el4zt97f9vc/",
				"appid": "1613049289050283", 
				"title": "使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/pp753xxfeq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/xyxahwqu05s/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&text=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&text=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&title=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&is_video=false&description=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&title=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&title=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&title=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fel4zt97f9vc%2f&title=%e4%bd%bf%e7%94%a8%20Docker%20%e5%92%8c%20Elasticsearch%20%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#使用-docker-和-elasticsearch-构建一个全文搜索应用程序\x22\x3e\x3c\/a\x3e使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序\x3c\/h1\x3e\n\x3cp\x3e\x3cem\x3e如何在超过 500 万篇文章的 Wikipedia 上找到与你研究相关的文章？\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e如何在超过 20 亿用户的 Facebook 中找到你的朋友（并且还拼错了名字）？\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e谷歌如何在整个因特网上搜索你的模糊的、充满拼写错误的查询？\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e在本教程中，我们将带你探索如何配置我们自己的全文搜索应用程序（与上述问题中的系统相比，它的复杂度要小很多）。我们的示例应用程序将提供一个 UI 和 API 去从 100 部经典文学（比如，《彼得·潘》 、  《弗兰肯斯坦》 和  《金银岛》）中搜索完整的文本。\x3c\/p\x3e\n\x3cp\x3e你可以在这里（\x3ca href=\x22https:\/\/search.patricktriest.com\/\x22\x3ehttps:\/\/search.patricktriest.com\x3c\/a\x3e）预览该教程应用的完整版本。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/p0.ssl.qhimg.com\/t01d5f6d4e25c29a960.png\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01d5f6d4e25c29a960.png\x22 alt=\x22preview webapp\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这个应用程序的源代码是 100% 开源的，可以在 GitHub 仓库上找到它们 —— \x3ca href=\x22https:\/\/github.com\/triestpa\/guttenberg-search\x22\x3ehttps:\/\/github.com\/triestpa\/guttenberg-search\x3c\/a\x3e 。\x3c\/p\x3e\n\x3cp\x3e在应用程序中添加一个快速灵活的全文搜索可能是个挑战。大多数的主流数据库，比如，\x3ca href=\x22https:\/\/www.postgresql.org\/\x22\x3ePostgreSQL\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/www.mongodb.com\/\x22\x3eMongoDB\x3c\/a\x3e，由于受其查询和索引结构的限制只能提供一个非常基础的文本搜索功能。为实现高质量的全文搜索，通常的最佳选择是单独的数据存储。\x3ca href=\x22https:\/\/www.elastic.co\/\x22\x3eElasticsearch\x3c\/a\x3e 是一个开源数据存储的领导者，它专门为执行灵活而快速的全文搜索进行了优化。\x3c\/p\x3e\n\x3cp\x3e我们将使用 \x3ca href=\x22https:\/\/www.docker.com\/\x22\x3eDocker\x3c\/a\x3e 去配置我们自己的项目环境和依赖。Docker 是一个容器化引擎，它被 \x3ca href=\x22https:\/\/www.uber.com\/\x22\x3eUber\x3c\/a\x3e、\x3ca href=\x22https:\/\/www.spotify.com\/us\/\x22\x3eSpotify\x3c\/a\x3e、\x3ca href=\x22https:\/\/www.adp.com\/\x22\x3eADP\x3c\/a\x3e 以及 \x3ca href=\x22https:\/\/www.paypal.com\/us\/home\x22\x3ePaypal\x3c\/a\x3e 使用。构建容器化应用的一个主要优势是，项目的设置在 Windows、macOS、以及 Linux 上都是相同的 —— 这使我写这个教程快速又简单。如果你还没有使用过 Docker，不用担心，我们接下来将经历完整的项目配置。\x3c\/p\x3e\n\x3cp\x3e我也会使用 \x3ca href=\x22https:\/\/nodejs.org\/en\/\x22\x3eNode.js\x3c\/a\x3e （使用 \x3ca href=\x22http:\/\/koajs.com\/\x22\x3eKoa\x3c\/a\x3e 框架）和 \x3ca href=\x22https:\/\/vuejs.org\/\x22\x3eVue.js\x3c\/a\x3e，用它们分别去构建我们自己的搜索 API 和前端 Web 应用程序。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#1---elasticsearch-是什么\x22\x3e\x3c\/a\x3e1 - Elasticsearch 是什么？\x3c\/h3\x3e\n\x3cp\x3e全文搜索在现代应用程序中是一个有大量需求的特性。搜索也可能是最难的一项特性 —— 许多流行的网站的搜索功能都不合格，要么返回结果太慢，要么找不到精确的结果。通常，这种情况是被底层的数据库所局限：大多数标准的关系型数据库局限于基本的 \x3ccode\x3eCONTAINS\x3c\/code\x3e 或 \x3ccode\x3eLIKE\x3c\/code\x3e SQL 查询上，它仅提供最基本的字符串匹配功能。\x3c\/p\x3e\n\x3cp\x3e我们的搜索应用程序将具备：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cstrong\x3e快速\x3c\/strong\x3e - 搜索结果将快速返回，为用户提供一个良好的体验。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e灵活\x3c\/strong\x3e - 我们希望能够去修改搜索如何执行的方式，这是为了便于在不同的数据库和用户场景下进行优化。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e容错\x3c\/strong\x3e - 如果所搜索的内容有拼写错误，我们将仍然会返回相关的结果，而这个结果可能正是用户希望去搜索的结果。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e全文\x3c\/strong\x3e - 我们不想限制我们的搜索只能与指定的关键字或者标签相匹配 —— 我们希望它可以搜索在我们的数据存储中的任何东西（包括大的文本字段）。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/2c2cf39b39e354fa114dc2e395f071f7cbcd57fe\/68747470733a2f2f73746f726167652e676f6f676c65617069732e636f6d2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f456c61737469637365617263682d4c6f676f2e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01f01a9c33d21ad14b.png\x22 alt=\x22Elastic Search Logo\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e为了构建一个功能强大的搜索功能，通常最理想的方法是使用一个为全文搜索任务优化过的数据存储。在这里我们使用 \x3ca href=\x22https:\/\/www.elastic.co\/\x22\x3eElasticsearch\x3c\/a\x3e，Elasticsearch 是一个开源的内存中的数据存储，它是用 Java 写的，最初是在 \x3ca href=\x22https:\/\/lucene.apache.org\/core\/\x22\x3eApache Lucene\x3c\/a\x3e 库上构建的。\x3c\/p\x3e\n\x3cp\x3e这里有一些来自 \x3ca href=\x22https:\/\/www.elastic.co\/guide\/en\/elasticsearch\/guide\/2.x\/getting-started.html\x22\x3eElastic 官方网站\x3c\/a\x3e 上的 Elasticsearch 真实使用案例。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eWikipedia 使用 Elasticsearch 去提供带高亮搜索片断的全文搜索功能，并且提供按类型搜索和 “did-you-mean” 建议。\x3c\/li\x3e\n\x3cli\x3eGuardian 使用 Elasticsearch 把社交网络数据和访客日志相结合，为编辑去提供新文章的公众意见的实时反馈。\x3c\/li\x3e\n\x3cli\x3eStack Overflow 将全文搜索和地理查询相结合，并使用 “类似” 的方法去找到相关的查询和回答。\x3c\/li\x3e\n\x3cli\x3eGitHub 使用 Elasticsearch 对 1300 亿行代码进行查询。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3\x3e\x3ca href=\x22#与-普通的-数据库相比elasticsearch-有什么不一样的地方\x22\x3e\x3c\/a\x3e与 “普通的” 数据库相比，Elasticsearch 有什么不一样的地方？\x3c\/h3\x3e\n\x3cp\x3eElasticsearch 之所以能够提供快速灵活的全文搜索，秘密在于它使用反转索引inverted index 。\x3c\/p\x3e\n\x3cp\x3e“索引” 是数据库中的一种数据结构，它能够以超快的速度进行数据查询和检索操作。数据库通过存储与表中行相关联的字段来生成索引。在一种可搜索的数据结构（一般是 \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/B-tree\x22\x3eB 树\x3c\/a\x3e）中排序索引，在优化过的查询中，数据库能够达到接近线性的时间（比如，“使用 ID=5 查找行”）。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/e9430c97798dcc54b8b55faf2ed9d51ba8a957af\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f64625f696e6465782e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01fabb369654386c4a.png\x22 alt=\x22Relational Index\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以将数据库索引想像成一个图书馆中老式的卡片式目录 —— 只要你知道书的作者和书名，它就会告诉你书的准确位置。为加速特定字段上的查询速度，数据库表一般有多个索引（比如，在 \x3ccode\x3ename\x3c\/code\x3e 列上的索引可以加速指定名字的查询）。\x3c\/p\x3e\n\x3cp\x3e反转索引本质上是不一样的。每行（或文档）的内容是分开的，并且每个独立的条目（在本案例中是单词）反向指向到包含它的任何文档上。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/be8e9a5f0fc431a49e1e34cfbe8f6a01709d63f7\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f696e766572746564496e6465782e6a7067\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01aa89048178e8e982.jpg\x22 alt=\x22Inverted Index\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这种反转索引数据结构可以使我们非常快地查询到，所有出现 “football” 的文档。通过使用大量优化过的内存中的反转索引，Elasticsearch 可以让我们在存储的数据上，执行一些非常强大的和自定义的全文搜索。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#2---项目设置\x22\x3e\x3c\/a\x3e2 - 项目设置\x3c\/h3\x3e\n\x3ch4\x3e\x3ca href=\x22#20---docker\x22\x3e\x3c\/a\x3e2.0 - Docker\x3c\/h4\x3e\n\x3cp\x3e我们在这个项目上使用 \x3ca href=\x22https:\/\/www.docker.com\/\x22\x3eDocker\x3c\/a\x3e 管理环境和依赖。Docker 是个容器引擎，它允许应用程序运行在一个独立的环境中，不会受到来自主机操作系统和本地开发环境的影响。现在，许多公司将它们的大规模 Web 应用程序主要运行在容器架构上。这样将提升灵活性和容器化应用程序组件的可组构性。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/ed55ce4779b16a1123e3bfe95769d1b4012c6cec\/68747470733a2f2f73746f726167652e676f6f676c65617069732e636f6d2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f646f636b65722e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01632f00208703b43c.png\x22 alt=\x22Docker Logo\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e对我来说，使用 Docker 的优势是，它对本教程的作者非常方便，它的本地环境设置量最小，并且跨 Windows、macOS 和 Linux 系统的一致性很好。我们只需要在 Docker 配置文件中定义这些依赖关系，而不是按安装说明分别去安装 Node.js、Elasticsearch 和 Nginx，然后，就可以使用这个配置文件在任何其它地方运行我们的应用程序。而且，因为每个应用程序组件都运行在它自己的独立容器中，它们受本地机器上的其它 “垃圾” 干扰的可能性非常小，因此，在调试问题时，像“它在我这里可以工作！”这类的问题将非常少。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#21---安装-docker--docker-compose\x22\x3e\x3c\/a\x3e2.1 - 安装 Docker \x26amp; Docker-Compose\x3c\/h4\x3e\n\x3cp\x3e这个项目只依赖 \x3ca href=\x22https:\/\/www.docker.com\/\x22\x3eDocker\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/docs.docker.com\/compose\/\x22\x3edocker-compose\x3c\/a\x3e，docker-compose 是 Docker 官方支持的一个工具，它用来将定义的多个容器配置 _组装_  成单一的应用程序栈。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e安装 Docker - \x3ca href=\x22https:\/\/docs.docker.com\/engine\/installation\/\x22\x3ehttps:\/\/docs.docker.com\/engine\/installation\/\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e安装 Docker Compose - \x3ca href=\x22https:\/\/docs.docker.com\/compose\/install\/\x22\x3ehttps:\/\/docs.docker.com\/compose\/install\/\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e\x3ca href=\x22#22---设置项目主目录\x22\x3e\x3c\/a\x3e2.2 - 设置项目主目录\x3c\/h4\x3e\n\x3cp\x3e为项目创建一个主目录（名为 \x3ccode\x3eguttenberg_search\x3c\/code\x3e）。我们的项目将工作在主目录的以下两个子目录中。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e\/public\x3c\/code\x3e - 保存前端 Vue.js Web 应用程序。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e\/server\x3c\/code\x3e - 服务器端 Node.js 源代码。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e\x3ca href=\x22#23---添加-docker-compose-配置\x22\x3e\x3c\/a\x3e2.3 - 添加 Docker-Compose 配置\x3c\/h4\x3e\n\x3cp\x3e接下来，我们将创建一个 \x3ccode\x3edocker-compose.yml\x3c\/code\x3e 文件来定义我们的应用程序栈中的每个容器。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3ccode\x3egs-api\x3c\/code\x3e - 后端应用程序逻辑使用的 Node.js 容器\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3egs-frontend\x3c\/code\x3e - 前端 Web 应用程序使用的 Ngnix 容器。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3egs-search\x3c\/code\x3e - 保存和搜索数据的 Elasticsearch 容器。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs http\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eversion\x3c\/span\x3e: \x273\x27\n\n\x3cspan class=\x22routeros\x22\x3eservices:\n  api: # Node.js App\n    container_name: gs-api\n    build: .\n    ports:\n      - \x3cspan class=\x22hljs-string\x22\x3e\x223000:3000\x22\x3c\/span\x3e # Expose API\x3cspan class=\x22hljs-built_in\x22\x3e port\n\x3c\/span\x3e      - \x3cspan class=\x22hljs-string\x22\x3e\x229229:9229\x22\x3c\/span\x3e # Expose Node process \x3cspan class=\x22hljs-builtin-name\x22\x3edebug\x3c\/span\x3e\x3cspan class=\x22hljs-built_in\x22\x3e port \x3c\/span\x3e(\x3cspan class=\x22hljs-builtin-name\x22\x3edisable\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e production)\n    environment: # \x3cspan class=\x22hljs-builtin-name\x22\x3eSet\x3c\/span\x3e ENV vars\n     - \x3cspan class=\x22hljs-attribute\x22\x3eNODE_ENV\x3c\/span\x3e=local\n     - \x3cspan class=\x22hljs-attribute\x22\x3eES_HOST\x3c\/span\x3e=elasticsearch\n     - \x3cspan class=\x22hljs-attribute\x22\x3ePORT\x3c\/span\x3e=3000\n    volumes: # Attach local book data directory\n      - .\/books:\/usr\/src\/app\/books\n\n  frontend: # Nginx\x3cspan class=\x22hljs-built_in\x22\x3e Server \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFor\x3c\/span\x3e Frontend App\n    container_name: gs-frontend\n    image: nginx\n    volumes: # Serve local \x3cspan class=\x22hljs-string\x22\x3e\x22public\x22\x3c\/span\x3e dir\n      - .\/public:\/usr\/share\/nginx\/html\n    ports:\n      - \x3cspan class=\x22hljs-string\x22\x3e\x228080:80\x22\x3c\/span\x3e # Forward site \x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3e localhost:8080\n\n  elasticsearch: # Elasticsearch\x3cspan class=\x22hljs-built_in\x22\x3e Instance\n\x3c\/span\x3e    container_name: gs-search\n    image: docker.elastic.co\/elasticsearch\/elasticsearch:6.1.1\n    volumes: # Persist ES data \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e seperate \x3cspan class=\x22hljs-string\x22\x3e\x22esdata\x22\x3c\/span\x3e volume\n      - esdata:\/usr\/share\/elasticsearch\/data\n    environment:\n      - bootstrap.\x3cspan class=\x22hljs-attribute\x22\x3ememory_lock\x3c\/span\x3e=\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      - \x3cspan class=\x22hljs-string\x22\x3e\x22ES_JAVA_OPTS=-Xms512m -Xmx512m\x22\x3c\/span\x3e\n      - discovery.\x3cspan class=\x22hljs-attribute\x22\x3etype\x3c\/span\x3e=single-node\n    ports: # Expose Elasticsearch ports\n      - \x3cspan class=\x22hljs-string\x22\x3e\x229300:9300\x22\x3c\/span\x3e\n      - \x3cspan class=\x22hljs-string\x22\x3e\x229200:9200\x22\x3c\/span\x3e\n\nvolumes: # Define seperate volume \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e Elasticsearch data\n  esdata:\n\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个文件定义了我们全部的应用程序栈 —— 不需要在你的本地系统上安装 Elasticsearch、Node 和 Nginx。每个容器都将端口转发到宿主机系统（\x3ccode\x3elocalhost\x3c\/code\x3e）上，以便于我们在宿主机上去访问和调试 Node API、Elasticsearch 实例和前端 Web 应用程序。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#24---添加-dockerfile\x22\x3e\x3c\/a\x3e2.4 - 添加 Dockerfile\x3c\/h4\x3e\n\x3cp\x3e对于 Nginx 和 Elasticsearch，我们使用了官方预构建的镜像，而 Node.js 应用程序需要我们自己去构建。\x3c\/p\x3e\n\x3cp\x3e在应用程序的根目录下定义一个简单的 \x3ccode\x3eDockerfile\x3c\/code\x3e 配置文件。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# Use Node v8.9.0 LTS\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e node:carbon\n\n\x3cspan class=\x22hljs-comment\x22\x3e# Setup app working directory\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eWORKDIR\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \/usr\/src\/app\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# Copy package.json and package-lock.json\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCOPY\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e package*.json .\/\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# Install app dependencies\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e npm install\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# Copy sourcecode\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCOPY\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e . .\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# Start app\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCMD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e [ \x3cspan class=\x22hljs-string\x22\x3e\x22npm\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e ]\n\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个 Docker 配置扩展了官方的 Node.js 镜像、拷贝我们的应用程序源代码、以及在容器内安装 NPM 依赖。\x3c\/p\x3e\n\x3cp\x3e我们也增加了一个 \x3ccode\x3e.dockerignore\x3c\/code\x3e 文件，以防止我们不需要的文件拷贝到容器中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs cpp\x22\x3enode_modules\/\nnpm-debug.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e\nbooks\/\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e\/\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e请注意：我们之所以不拷贝 \x3ccode\x3enode_modules\x3c\/code\x3e 目录到我们的容器中 —— 是因为我们要在容器构建过程里面运行 \x3ccode\x3enpm install\x3c\/code\x3e。从宿主机系统拷贝 \x3ccode\x3enode_modules\x3c\/code\x3e 到容器里面可能会引起错误，因为一些包需要为某些操作系统专门构建。比如说，在 macOS 上安装 \x3ccode\x3ebcrypt\x3c\/code\x3e 包，然后尝试将这个模块直接拷贝到一个 Ubuntu 容器上将不能工作，因为 \x3ccode\x3ebcyrpt\x3c\/code\x3e 需要为每个操作系统构建一个特定的二进制文件。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e\x3ca href=\x22#25---添加基本文件\x22\x3e\x3c\/a\x3e2.5 - 添加基本文件\x3c\/h4\x3e\n\x3cp\x3e为了测试我们的配置，我们需要添加一些占位符文件到应用程序目录中。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3epublic\/index.html\x3c\/code\x3e 文件中添加如下内容。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x26lt;html\x26gt;\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3eHello World From The Frontend Container\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e接下来，在 \x3ccode\x3eserver\/app.js\x3c\/code\x3e 中添加 Node.js 占位符文件。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stata\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Koa = require(\x27koa\x27)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e = new Koa()\n\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(async (ctx, next) =\x26gt; {\n  ctx.body = \x27Hello World From the Backend Container\x27\n})\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e port = process.env.PORT || 3000\n\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.listen(port, \x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e) console.\x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e)\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(`\x3cspan class=\x22hljs-keyword\x22\x3eApp\x3c\/span\x3e Listening \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3e Port \x3cspan class=\x22hljs-variable\x22\x3e${port}\x3c\/span\x3e`)\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e最后，添加我们的 \x3ccode\x3epackage.json\x3c\/code\x3e  Node 应用配置。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22guttenberg-search\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.0.1\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22description\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Source code for Elasticsearch tutorial using 100 classic open source books.\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22node --inspect=0.0.0.0:9229 server\/app.js\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22repository\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22git\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22url\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22git\x2bhttps:\/\/github.com\/triestpa\/guttenberg-search.git\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22patrick.triest@gmail.com\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22license\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22MIT\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22bugs\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22url\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/github.com\/triestpa\/guttenberg-search\/issues\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22homepage\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/github.com\/triestpa\/guttenberg-search#readme\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22elasticsearch\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2213.3.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22joi\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2213.0.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22koa\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222.4.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22koa-joi-validate\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.5.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22koa-router\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x227.2.1\x22\x3c\/span\x3e\n  }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个文件定义了应用程序启动命令和 Node.js 包依赖。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e注意：不要运行 \x3ccode\x3enpm install\x3c\/code\x3e —— 当它构建时，依赖会在容器内安装。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch4\x3e\x3ca href=\x22#26---测试它的输出\x22\x3e\x3c\/a\x3e2.6 - 测试它的输出\x3c\/h4\x3e\n\x3cp\x3e现在一切新绪，我们来测试应用程序的每个组件的输出。从应用程序的主目录运行 \x3ccode\x3edocker-compose build\x3c\/code\x3e，它将构建我们的 Node.js 应用程序容器。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/44ae53569dcc8edab0fa15db370dd9a44190a0b7\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f305f332e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t0148e9e3b7531867b7.png\x22 alt=\x22docker build output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e接下来，运行 \x3ccode\x3edocker-compose up\x3c\/code\x3e 去启动整个应用程序栈。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/86471791c63cb38324db0acbdbfb4d00f19b2fd4\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f305f322e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01b05997ff28d082aa.png\x22 alt=\x22docker compose output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e这一步可能需要几分钟时间，因为 Docker 要为每个容器去下载基础镜像。以后再次运行，启动应用程序会非常快，因为所需要的镜像已经下载完成了。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e在你的浏览器中尝试访问 \x3ccode\x3elocalhost:8080\x3c\/code\x3e —— 你将看到简单的 “Hello World” Web 页面。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/39984892bca00bd4cb2ffe0bc576201e1d9b2933\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f305f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01a9dd7c0bc93a3851.png\x22 alt=\x22frontend sample output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e访问 \x3ccode\x3elocalhost:3000\x3c\/code\x3e 去验证我们的 Node 服务器，它将返回 “Hello World” 信息。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/f31dfae60c63849760a9cb809d9192f7798a83ae\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f305f312e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01f8dcdc3b90109ee9.png\x22 alt=\x22backend sample output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e最后，访问 \x3ccode\x3elocalhost:9200\x3c\/code\x3e 去检查 Elasticsearch 运行状态。它将返回类似如下的内容。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22SLTcfpI\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22cluster_name\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22docker-cluster\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22cluster_uuid\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22iId8e0ZeS_mgh9ALlWQ7-w\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e : {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22number\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x226.1.1\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22build_hash\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22bd92e7f\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22build_date\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x222017-12-17T20:23:25.338Z\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22build_snapshot\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22lucene_version\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x227.1.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22minimum_wire_compatibility_version\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x225.6.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22minimum_index_compatibility_version\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x225.0.0\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22tagline\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22You Know, for Search\x22\x3c\/span\x3e\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e如果三个 URL 都显示成功，祝贺你！整个容器栈已经正常运行了，接下来我们进入最有趣的部分。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#3---连接到-elasticsearch\x22\x3e\x3c\/a\x3e3 - 连接到 Elasticsearch\x3c\/h3\x3e\n\x3cp\x3e我们要做的第一件事情是，让我们的应用程序连接到我们本地的 Elasticsearch 实例上。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#30---添加-es-连接模块\x22\x3e\x3c\/a\x3e3.0 - 添加 ES 连接模块\x3c\/h4\x3e\n\x3cp\x3e在新文件 \x3ccode\x3eserver\/connection.js\x3c\/code\x3e 中添加如下的 Elasticsearch 初始化代码。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e elasticsearch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27elasticsearch\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Core ES variables for this project\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e index = \x3cspan class=\x22hljs-string\x22\x3e\x27library\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e type = \x3cspan class=\x22hljs-string\x22\x3e\x27novel\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e port = \x3cspan class=\x22hljs-number\x22\x3e9200\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e host = process.env.ES_HOST || \x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e client = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e elasticsearch.Client({ \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: { host, port } })\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/** Check the ES connection status *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckConnection\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isConnected = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (!isConnected) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Connecting to ES\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e health = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e client.cluster.health({})\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(health)\n      isConnected = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Connection Failed, Retrying...\x27\x3c\/span\x3e, err)\n    }\n  }\n}\n\ncheckConnection()\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在，我们重新构建我们的 Node 应用程序，我们将使用 \x3ccode\x3edocker-compose build\x3c\/code\x3e 来做一些改变。接下来，运行 \x3ccode\x3edocker-compose up -d\x3c\/code\x3e 去启动应用程序栈，它将以守护进程的方式在后台运行。\x3c\/p\x3e\n\x3cp\x3e应用程序启动之后，在命令行中运行 \x3ccode\x3edocker exec gs-api \x22node\x22 \x22server\/connection.js\x22\x3c\/code\x3e，以便于在容器内运行我们的脚本。你将看到类似如下的系统输出信息。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs less\x22\x3e{ \x3cspan class=\x22hljs-attribute\x22\x3ecluster_name\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27docker-cluster\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27yellow\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3etimed_out\x3c\/span\x3e: false,\n  \x3cspan class=\x22hljs-attribute\x22\x3enumber_of_nodes\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3enumber_of_data_nodes\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3eactive_primary_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3eactive_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3erelocating_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3einitializing_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3eunassigned_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3edelayed_unassigned_shards\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3enumber_of_pending_tasks\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3enumber_of_in_flight_fetch\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3etask_max_waiting_in_queue_millis\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3eactive_shards_percent_as_number\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e }\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e继续之前，我们先删除最下面的 \x3ccode\x3echeckConnection()\x3c\/code\x3e 调用，因为，我们最终的应用程序将调用外部的连接模块。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#31---添加函数去重置索引\x22\x3e\x3c\/a\x3e3.1 - 添加函数去重置索引\x3c\/h4\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/connection.js\x3c\/code\x3e 中的 \x3ccode\x3echeckConnection\x3c\/code\x3e 下面添加如下的函数，以便于重置 Elasticsearch 索引。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** Clear the index, recreate it, and add mappings *\/\x3c\/span\x3e\nasync function resetIndex (index) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (await client\x3cspan class=\x22hljs-selector-class\x22\x3e.indices\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.exists\x3c\/span\x3e({ index })) {\n    await client\x3cspan class=\x22hljs-selector-class\x22\x3e.indices\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.delete\x3c\/span\x3e({ index })\n  }\n\n  await client\x3cspan class=\x22hljs-selector-class\x22\x3e.indices\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.create\x3c\/span\x3e({ index })\n  await putBookMapping()\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#32---添加图书模式\x22\x3e\x3c\/a\x3e3.2 - 添加图书模式\x3c\/h4\x3e\n\x3cp\x3e接下来，我们将为图书的数据模式添加一个 “映射”。在 \x3ccode\x3eserver\/connection.js\x3c\/code\x3e 中的 \x3ccode\x3eresetIndex\x3c\/code\x3e 函数下面添加如下的函数。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** Add book section schema mapping to ES *\/\x3c\/span\x3e\nasync function putBookMapping () {\n  const schema = {\n    title: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27keywor\x3c\/span\x3ed\x27 },\n    author: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27keywor\x3c\/span\x3ed\x27 },\n    location: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27intege\x3c\/span\x3er\x27 },\n    text: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27tex\x3c\/span\x3et\x27 }\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e client.indices.putMapping({ index, \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e, \x3cspan class=\x22hljs-title\x22\x3ebody\x3c\/span\x3e\x3c\/span\x3e: { properties: schema } })\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这是为 \x3ccode\x3ebook\x3c\/code\x3e 索引定义了一个映射。Elasticsearch 中的 \x3ccode\x3eindex\x3c\/code\x3e 大概类似于 SQL 的 \x3ccode\x3etable\x3c\/code\x3e 或者 MongoDB 的  \x3ccode\x3ecollection\x3c\/code\x3e。我们通过添加映射来为存储的文档指定每个字段和它的数据类型。Elasticsearch 是无模式的，因此，从技术角度来看，我们是不需要添加映射的，但是，这样做，我们可以更好地控制如何处理数据。\x3c\/p\x3e\n\x3cp\x3e比如，我们给 \x3ccode\x3etitle\x3c\/code\x3e 和 \x3ccode\x3eauthor\x3c\/code\x3e 字段分配 \x3ccode\x3ekeyword\x3c\/code\x3e 类型，给 \x3ccode\x3etext\x3c\/code\x3e 字段分配 \x3ccode\x3etext\x3c\/code\x3e 类型。之所以这样做的原因是，搜索引擎可以区别处理这些字符串字段 —— 在搜索的时候，搜索引擎将在 \x3ccode\x3etext\x3c\/code\x3e 字段中搜索可能的匹配项，而对于 \x3ccode\x3ekeyword\x3c\/code\x3e 类型字段，将对它们进行全文匹配。这看上去差别很小，但是它们对在不同的搜索上的速度和行为的影响非常大。\x3c\/p\x3e\n\x3cp\x3e在文件的底部，导出对外发布的属性和函数，这样我们的应用程序中的其它模块就可以访问它们了。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs fortran\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e.exports = {\n  client, \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e, checkConnection, resetIndex\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#4---加载原始数据\x22\x3e\x3c\/a\x3e4 - 加载原始数据\x3c\/h3\x3e\n\x3cp\x3e我们将使用来自 \x3ca href=\x22https:\/\/www.gutenberg.org\/\x22\x3e古登堡项目\x3c\/a\x3e 的数据 ——  它致力于为公共提供免费的线上电子书。在这个项目中，我们将使用 100 本经典图书来充实我们的图书馆，包括《福尔摩斯探案集》、《金银岛》、《基督山复仇记》、《环游世界八十天》、《罗密欧与朱丽叶》 和《奥德赛》。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/a5f71ecec9dcda5efe89e6fa0f53844aeeeab1da\/68747470733a2f2f73746f726167652e676f6f676c65617069732e636f6d2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f626f6f6b732e6a7067\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t018438f7bb5e86dd56.jpg\x22 alt=\x22Book Covers\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#41---下载图书文件\x22\x3e\x3c\/a\x3e4.1 - 下载图书文件\x3c\/h4\x3e\n\x3cp\x3e我将这 100 本书打包成一个文件，你可以从这里下载它 —— \x3ca href=\x22https:\/\/cdn.patricktriest.com\/data\/books.zip\x22\x3ehttps:\/\/cdn.patricktriest.com\/data\/books.zip\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e将这个文件解压到你的项目的 \x3ccode\x3ebooks\/\x3c\/code\x3e 目录中。\x3c\/p\x3e\n\x3cp\x3e你可以使用以下的命令来完成（需要在命令行下使用 \x3ca href=\x22https:\/\/www.gnu.org\/software\/wget\/\x22\x3ewget\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/theunarchiver.com\/command-line\x22\x3eThe Unarchiver\x3c\/a\x3e）。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs armasm\x22\x3e\x3cspan class=\x22hljs-symbol\x22\x3ewget\x3c\/span\x3e https:\/\/cdn.patricktriest.com\/\x3cspan class=\x22hljs-meta\x22\x3edata\x3c\/span\x3e\/\x3cspan class=\x22hljs-keyword\x22\x3ebooks.zip\n\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3eunar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ebooks.zip\n\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#42---预览一本书\x22\x3e\x3c\/a\x3e4.2 - 预览一本书\x3c\/h4\x3e\n\x3cp\x3e尝试打开其中的一本书的文件，假设打开的是 \x3ccode\x3e219-0.txt\x3c\/code\x3e。你将注意到它开头是一个公开访问的协议，接下来是一些标识这本书的书名、作者、发行日期、语言和字符编码的行。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs http\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eTitle\x3c\/span\x3e: Heart of Darkness\n\n\x3cspan class=\x22http\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eAuthor\x3c\/span\x3e: Joseph Conrad\n\n\x3cspan class=\x22sql\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRelease\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e: February \x3cspan class=\x22hljs-number\x22\x3e1995\x3c\/span\x3e [EBook #\x3cspan class=\x22hljs-number\x22\x3e219\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3eLast\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eUpdated\x3c\/span\x3e: September \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2016\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eLanguage\x3c\/span\x3e: English\n\n\x3cspan class=\x22hljs-built_in\x22\x3eCharacter\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eencoding\x3c\/span\x3e: UTF\x3cspan class=\x22hljs-number\x22\x3e-8\x3c\/span\x3e\n\n\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在 \x3ccode\x3e*** START OF THIS PROJECT GUTENBERG EBOOK HEART OF DARKNESS ***\x3c\/code\x3e 这些行后面，是这本书的正式内容。\x3c\/p\x3e\n\x3cp\x3e如果你滚动到本书的底部，你将看到类似 \x3ccode\x3e*** END OF THIS PROJECT GUTENBERG EBOOK HEART OF DARKNESS ***\x3c\/code\x3e 信息，接下来是本书更详细的协议版本。\x3c\/p\x3e\n\x3cp\x3e下一步，我们将使用程序从文件头部来解析书的元数据，提取 \x3ccode\x3e*** START OF\x3c\/code\x3e 和 \x3ccode\x3e***END OF\x3c\/code\x3e 之间的内容。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#43---读取数据目录\x22\x3e\x3c\/a\x3e4.3 - 读取数据目录\x3c\/h4\x3e\n\x3cp\x3e我们将写一个脚本来读取每本书的内容，并将这些数据添加到 Elasticsearch。我们将定义一个新的 Javascript 文件 \x3ccode\x3eserver\/load_data.js\x3c\/code\x3e 来执行这些操作。\x3c\/p\x3e\n\x3cp\x3e首先，我们将从 \x3ccode\x3ebooks\/\x3c\/code\x3e 目录中获取每个文件的列表。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/load_data.js\x3c\/code\x3e 中添加下列内容。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e esConnection = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/connection\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/** Clear ES index, parse and index all files from the books directory *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadAndInsertBooks\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Clear previous ES index\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e esConnection.resetIndex()\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Read books directory\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e files = fs.readdirSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/books\x27\x3c\/span\x3e).filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efile\x3c\/span\x3e =\x26gt;\x3c\/span\x3e file.slice(\x3cspan class=\x22hljs-number\x22\x3e-4\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x27.txt\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Found \x3cspan class=\x22hljs-subst\x22\x3e${files.length}\x3c\/span\x3e Files`\x3c\/span\x3e)\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Read each book file, and index each paragraph in elasticsearch\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e file \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e files) {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Reading File - \x3cspan class=\x22hljs-subst\x22\x3e${file}\x3c\/span\x3e`\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e filePath = path.join(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/books\x27\x3c\/span\x3e, file)\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { title, author, paragraphs } = parseBookFile(filePath)\n      \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e insertBookData(title, author, paragraphs)\n    }\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err)\n  }\n}\n\nreadAndInsertBooks()\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我们将使用一个快捷命令来重构我们的 Node.js 应用程序，并更新运行的容器。\x3c\/p\x3e\n\x3cp\x3e运行 \x3ccode\x3edocker-compose up -d --build\x3c\/code\x3e 去更新应用程序。这是运行  \x3ccode\x3edocker-compose build\x3c\/code\x3e 和 \x3ccode\x3edocker-compose up -d\x3c\/code\x3e 的快捷命令。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/e584463ffe367ef40c9ec56e75007443146449fc\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f315f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01d68f69e4616834f3.png\x22 alt=\x22docker build output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e为了在容器中运行我们的 \x3ccode\x3eload_data\x3c\/code\x3e 脚本，我们运行 \x3ccode\x3edocker exec gs-api \x22node\x22 \x22server\/load_data.js\x22\x3c\/code\x3e 。你将看到 Elasticsearch 的状态输出 \x3ccode\x3eFound 100 Books\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这之后，脚本发生了错误退出，原因是我们调用了一个没有定义的辅助函数（\x3ccode\x3eparseBookFile\x3c\/code\x3e）。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/5a0ab75bd9d3d97cc49fc54915f776013b48f71a\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f315f312e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01bf78ff371f162823.png\x22 alt=\x22docker exec output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#44---读取数据文件\x22\x3e\x3c\/a\x3e4.4 - 读取数据文件\x3c\/h4\x3e\n\x3cp\x3e接下来，我们读取元数据和每本书的内容。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/load_data.js\x3c\/code\x3e 中定义新函数。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** Read an individual book text file, and extract the title, author, and paragraphs *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eparseBookFile\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3efilePath\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Read text file\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e book = fs.readFileSync(filePath, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Find book title and author\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e title = book.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/^Title:\\s(.\x2b)$\/m\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e authorMatch = book.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/^Author:\\s(.\x2b)$\/m\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e author = (!authorMatch || authorMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].trim() === \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) ? \x3cspan class=\x22hljs-string\x22\x3e\x27Unknown Author\x27\x3c\/span\x3e : authorMatch[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Reading Book - \x3cspan class=\x22hljs-subst\x22\x3e${title}\x3c\/span\x3e By \x3cspan class=\x22hljs-subst\x22\x3e${author}\x3c\/span\x3e`\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Find Guttenberg metadata header and footer\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e startOfBookMatch = book.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/^\\*{3}\\s*START OF (THIS|THE) PROJECT GUTENBERG EBOOK.\x2b\\*{3}$\/m\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e startOfBookIndex = startOfBookMatch.index \x2b startOfBookMatch[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].length\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e endOfBookIndex = book.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/^\\*{3}\\s*END OF (THIS|THE) PROJECT GUTENBERG EBOOK.\x2b\\*{3}$\/m\x3c\/span\x3e).index\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Clean book text and split into array of paragraphs\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e paragraphs = book\n    .slice(startOfBookIndex, endOfBookIndex) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Remove Guttenberg header and footer\x3c\/span\x3e\n    .split(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\n\\s\x2b\\n\/g\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Split each paragraph into it\x27s own array entry\x3c\/span\x3e\n    .map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e =\x26gt;\x3c\/span\x3e line.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\r\\n\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e).trim()) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Remove paragraph line breaks and whitespace\x3c\/span\x3e\n    .map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e =\x26gt;\x3c\/span\x3e line.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Guttenberg uses \x22_\x22 to signify italics.  We\x27ll remove it, since it makes the raw text look messy.\x3c\/span\x3e\n    .filter(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (line \x26amp;\x26amp; line.length !== \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Remove empty lines\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Parsed \x3cspan class=\x22hljs-subst\x22\x3e${paragraphs.length}\x3c\/span\x3e Paragraphs\\n`\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { title, author, paragraphs }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个函数执行几个重要的任务。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e从文件系统中读取书的文本。\x3c\/li\x3e\n\x3cli\x3e使用正则表达式（关于正则表达式，请参阅 \x3ca href=\x22https:\/\/blog.patricktriest.com\/you-should-learn-regex\/\x22\x3e这篇文章\x3c\/a\x3e ）解析书名和作者。\x3c\/li\x3e\n\x3cli\x3e通过匹配 “古登堡项目” 的头部和尾部，识别书的正文内容。\x3c\/li\x3e\n\x3cli\x3e提取书的内容文本。\x3c\/li\x3e\n\x3cli\x3e分割每个段落到它的数组中。\x3c\/li\x3e\n\x3cli\x3e清理文本并删除空白行。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e它的返回值，我们将构建一个对象，这个对象包含书名、作者、以及书中各段落的数组。\x3c\/p\x3e\n\x3cp\x3e再次运行 \x3ccode\x3edocker-compose up -d --build\x3c\/code\x3e 和 \x3ccode\x3edocker exec gs-api \x22node\x22 \x22server\/load_data.js\x22\x3c\/code\x3e，你将看到输出同之前一样，在输出的末尾有三个额外的行。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/24bd4ac518d3a977766ff7df68c41901a5e0bea1\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f325f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t0142945801c7c2f953.png\x22 alt=\x22docker exec output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e成功！我们的脚本从文本文件中成功解析出了书名和作者。脚本再次以错误结束，因为到现在为止，我们还没有定义辅助函数。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#45---在-es-中索引数据文件\x22\x3e\x3c\/a\x3e4.5 - 在 ES 中索引数据文件\x3c\/h4\x3e\n\x3cp\x3e最后一步，我们将批量上传每个段落的数组到 Elasticsearch 索引中。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eload_data.js\x3c\/code\x3e 中添加新的 \x3ccode\x3einsertBookData\x3c\/code\x3e 函数。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs qml\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** Bulk index the book data in Elasticsearch *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einsertBookData\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etitle, author, paragraphs\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e bulkOps = [] \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Array to store bulk operations\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Add an index operation for each section in the book\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; paragraphs.length; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Describe action\x3c\/span\x3e\n    bulkOps.push({ \x3cspan class=\x22hljs-attribute\x22\x3eindex\x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3e_index\x3c\/span\x3e: esConnection.index, \x3cspan class=\x22hljs-attribute\x22\x3e_type\x3c\/span\x3e: esConnection.type } })\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Add document\x3c\/span\x3e\n    bulkOps.push({\n      author,\n      title,\n      \x3cspan class=\x22hljs-attribute\x22\x3elocation\x3c\/span\x3e: i,\n      \x3cspan class=\x22hljs-attribute\x22\x3etext\x3c\/span\x3e: paragraphs[i]\n    })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; i % \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Do bulk insert in 500 paragraph batches\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e esConnection.client.bulk({ \x3cspan class=\x22hljs-attribute\x22\x3ebody\x3c\/span\x3e: bulkOps })\n      bulkOps = []\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Indexed Paragraphs \x3cspan class=\x22hljs-subst\x22\x3e${i - 499}\x3c\/span\x3e - \x3cspan class=\x22hljs-subst\x22\x3e${i}\x3c\/span\x3e`\x3c\/span\x3e)\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Insert remainder of bulk ops array\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e esConnection.client.bulk({ \x3cspan class=\x22hljs-attribute\x22\x3ebody\x3c\/span\x3e: bulkOps })\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Indexed Paragraphs \x3cspan class=\x22hljs-subst\x22\x3e${paragraphs.length - (bulkOps.length \/ 2)}\x3c\/span\x3e - \x3cspan class=\x22hljs-subst\x22\x3e${paragraphs.length}\x3c\/span\x3e\\n\\n\\n`\x3c\/span\x3e)\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个函数将使用书名、作者和附加元数据的段落位置来索引书中的每个段落。我们通过批量操作来插入段落，它比逐个段落插入要快的多。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e我们分批索引段落，而不是一次性插入全部，是为运行这个应用程序的内存稍有点小（1.7 GB）的服务器  \x3ccode\x3esearch.patricktriest.com\x3c\/code\x3e 上做的一个重要优化。如果你的机器内存还行（4 GB 以上），你或许不用分批上传。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e运行 \x3ccode\x3edocker-compose up -d --build\x3c\/code\x3e 和 \x3ccode\x3edocker exec gs-api \x22node\x22 \x22server\/load_data.js\x22\x3c\/code\x3e 一次或多次 —— 现在你将看到前面解析的 100 本书的完整输出，并插入到了 Elasticsearch。这可能需要几分钟时间，甚至更长。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/da296f74143398443b3251835fdd7a68d1cb117a\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f335f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01b01e8f5cfbaf2472.png\x22 alt=\x22data loading output\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#5---搜索\x22\x3e\x3c\/a\x3e5 - 搜索\x3c\/h3\x3e\n\x3cp\x3e现在，Elasticsearch 中已经有了 100 本书了（大约有 230000 个段落），现在我们尝试搜索查询。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#50---简单的-http-查询\x22\x3e\x3c\/a\x3e5.0 - 简单的 HTTP 查询\x3c\/h4\x3e\n\x3cp\x3e首先，我们使用 Elasticsearch 的 HTTP API 对它进行直接查询。\x3c\/p\x3e\n\x3cp\x3e在你的浏览器上访问这个 URL - \x3ccode\x3ehttp:\/\/localhost:9200\/library\/_search?q=text:Java\x26amp;pretty\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e在这里，我们将执行一个极简的全文搜索，在我们的图书馆的书中查找 “Java” 这个词。\x3c\/p\x3e\n\x3cp\x3e你将看到类似于下面的一个 JSON 格式的响应。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22took\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22timed_out\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22_shards\x22\x3c\/span\x3e : {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22total\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22successful\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22skipped\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22failed\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22hits\x22\x3c\/span\x3e : {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22total\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e13\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22max_score\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e14.259304\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22hits\x22\x3c\/span\x3e : [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_index\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22library\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_type\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22novel\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_id\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22p_GwFWEBaZvLlaAUdQgV\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_score\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e14.259304\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_source\x22\x3c\/span\x3e : {\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22Charles Darwin\x22\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22On the Origin of Species\x22\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22location\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e1080\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22Java, plants of, 375.\x22\x3c\/span\x3e\n        }\n      },\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_index\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22library\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_type\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22novel\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_id\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22wfKwFWEBaZvLlaAUkjfk\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_score\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e10.186235\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22_source\x22\x3c\/span\x3e : {\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22Edgar Allan Poe\x22\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22The Works of Edgar Allan Poe\x22\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22location\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e827\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22After many years spent in foreign travel, I sailed in the year 18-- , from the port of Batavia, in the rich and populous island of Java, on a voyage to the Archipelago of the Sunda islands. I went as passenger--having no other inducement than a kind of nervous restlessness which haunted me as a fiend.\x22\x3c\/span\x3e\n        }\n      },\n      ...\n    ]\n  }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e用 Elasticseach 的 HTTP 接口可以测试我们插入的数据是否成功，但是如果直接将这个 API 暴露给 Web 应用程序将有极大的风险。这个 API 将会暴露管理功能（比如直接添加和删除文档），最理想的情况是完全不要对外暴露它。而是写一个简单的 Node.js API 去接收来自客户端的请求，然后（在我们的本地网络中）生成一个正确的查询发送给 Elasticsearch。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#51---查询脚本\x22\x3e\x3c\/a\x3e5.1 - 查询脚本\x3c\/h4\x3e\n\x3cp\x3e我们现在尝试从我们写的 Node.js 脚本中查询 Elasticsearch。\x3c\/p\x3e\n\x3cp\x3e创建一个新文件，\x3ccode\x3eserver\/search.js\x3c\/code\x3e。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3econst { client, \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3etype\x3c\/span\x3e } = require(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/connection\x27\x3c\/span\x3e)\n\nmodule.exports = {\n  \/** Query ES \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e the provided term *\/\n  queryTerm (term, offset = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    const body = {\n      from: offset,\n      query: { \x3cspan class=\x22hljs-keyword\x22\x3ematch\x3c\/span\x3e: {\n        tex\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e {\n          query: term,\n          operator: \x3cspan class=\x22hljs-string\x22\x3e\x27and\x27\x3c\/span\x3e,\n          fuzzines\x3cspan class=\x22hljs-variable\x22\x3es:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27auto\x27\x3c\/span\x3e\n        } } },\n      highligh\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e { field\x3cspan class=\x22hljs-variable\x22\x3es:\x3c\/span\x3e { tex\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e {} } }\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e client.\x3cspan class=\x22hljs-built_in\x22\x3esearch\x3c\/span\x3e({ \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3etype\x3c\/span\x3e, body })\n  }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我们的搜索模块定义一个简单的 \x3ccode\x3esearch\x3c\/code\x3e 函数，它将使用输入的词 \x3ccode\x3ematch\x3c\/code\x3e 查询。\x3c\/p\x3e\n\x3cp\x3e这是查询的字段分解 -\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3efrom\x3c\/code\x3e - 允许我们分页查询结果。默认每个查询返回 10 个结果，因此，指定 \x3ccode\x3efrom: 10\x3c\/code\x3e 将允许我们取回 10-20 的结果。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3equery\x3c\/code\x3e - 这里我们指定要查询的词。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eoperator\x3c\/code\x3e - 我们可以修改搜索行为；在本案例中，我们使用 \x3ccode\x3eand\x3c\/code\x3e 操作去对查询中包含所有字元（要查询的词）的结果来确定优先顺序。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3efuzziness\x3c\/code\x3e - 对拼写错误的容错调整，\x3ccode\x3eauto\x3c\/code\x3e 的默认为 \x3ccode\x3efuzziness: 2\x3c\/code\x3e。模糊值越高，结果越需要更多校正。比如，\x3ccode\x3efuzziness: 1\x3c\/code\x3e 将允许以 \x3ccode\x3ePatricc\x3c\/code\x3e 为关键字的查询中返回与 \x3ccode\x3ePatrick\x3c\/code\x3e 匹配的结果。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3ehighlights\x3c\/code\x3e - 为结果返回一个额外的字段，这个字段包含 HTML，以显示精确的文本字集和查询中匹配的关键词。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你可以去浏览 \x3ca href=\x22https:\/\/www.elastic.co\/guide\/en\/elasticsearch\/reference\/current\/full-text-queries.html\x22\x3eElastic Full-Text Query DSL\x3c\/a\x3e，学习如何随意调整这些参数，以进一步自定义搜索查询。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#6---api\x22\x3e\x3c\/a\x3e6 - API\x3c\/h3\x3e\n\x3cp\x3e为了能够从前端应用程序中访问我们的搜索功能，我们来写一个快速的 HTTP API。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#60---api-服务器\x22\x3e\x3c\/a\x3e6.0 - API 服务器\x3c\/h4\x3e\n\x3cp\x3e用以下的内容替换现有的 \x3ccode\x3eserver\/app.js\x3c\/code\x3e 文件。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs typescript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Koa = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Router = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-router\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e joi = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27joi\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e validate = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-joi-validate\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e search = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/search\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Koa()\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Router()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Log each request to the console\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx, next) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e start = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now()\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e next()\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ms = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now() - start\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${ctx.method}\x3c\/span\x3e \x3cspan class=\x22hljs-subst\x22\x3e${ctx.url}\x3c\/span\x3e - \x3cspan class=\x22hljs-subst\x22\x3e${ms}\x3c\/span\x3e`\x3c\/span\x3e)\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Log percolated errors to the console\x3c\/span\x3e\napp.on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27Server Error\x27\x3c\/span\x3e, err)\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Set permissive CORS header\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx, next) =\x26gt; {\n  ctx.set(\x3cspan class=\x22hljs-string\x22\x3e\x27Access-Control-Allow-Origin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next()\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ADD ENDPOINTS HERE\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e port = process.env.PORT || \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods())\n  .listen(port, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`App Listening on Port \x3cspan class=\x22hljs-subst\x22\x3e${port}\x3c\/span\x3e`\x3c\/span\x3e)\n  })\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这些代码将为 \x3ca href=\x22http:\/\/koajs.com\/\x22\x3eKoa.js\x3c\/a\x3e Node API 服务器导入服务器依赖，设置简单的日志，以及错误处理。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#61---使用查询连接端点\x22\x3e\x3c\/a\x3e6.1 - 使用查询连接端点\x3c\/h3\x3e\n\x3cp\x3e接下来，我们将在服务器上添加一个端点，以便于发布我们的 Elasticsearch 查询功能。\x3c\/p\x3e\n\x3cp\x3e在  \x3ccode\x3eserver\/app.js\x3c\/code\x3e 文件的 \x3ccode\x3e\/\/ ADD ENDPOINTS HERE\x3c\/code\x3e  下面插入下列的代码。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dart\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x3cspan class=\x22markdown\x22\x3e\/**\n * GET \/search\n * Search for \x3c\/span\x3ea\x3cspan class=\x22markdown\x22\x3e term in \x3c\/span\x3ethe\x3cspan class=\x22markdown\x22\x3e library\n *\/\x3c\/span\x3e\x3c\/span\x3e\nrouter.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/search\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx, next) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { term, offset } = ctx.request.query\n    ctx.body = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e search.queryTerm(term, offset)\n  }\n)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e使用 \x3ccode\x3edocker-compose up -d --build\x3c\/code\x3e 重启动应用程序。之后在你的浏览器中尝试调用这个搜索端点。比如，\x3ccode\x3ehttp:\/\/localhost:3000\/search?term=java\x3c\/code\x3e 这个请求将搜索整个图书馆中提到 “Java” 的内容。\x3c\/p\x3e\n\x3cp\x3e结果与前面直接调用 Elasticsearch HTTP 界面的结果非常类似。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22took\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e242\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22timed_out\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22_shards\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22total\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22successful\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22skipped\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22failed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22hits\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22total\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e93\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22max_score\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e13.356944\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22hits\x22\x3c\/span\x3e: [{\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_index\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22library\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22novel\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22eHYHJmEBpQg9B4622421\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_score\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e13.356944\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_source\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Charles Darwin\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22On the Origin of Species\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22location\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1080\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Java, plants of, 375.\x22\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22highlight\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;em\x26gt;Java\x26lt;\/em\x26gt;, plants of, 375.\x22\x3c\/span\x3e]\n            }\n        }, {\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_index\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22library\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22novel\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222HUHJmEBpQg9B462xdNg\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_score\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9.030668\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22_source\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Unknown Author\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22The King James Bible\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22location\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e186\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2210:4 And the sons of Javan; Elishah, and Tarshish, Kittim, and Dodanim.\x22\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22highlight\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x2210:4 And the sons of \x26lt;em\x26gt;Javan\x26lt;\/em\x26gt;; Elishah, and Tarshish, Kittim, and Dodanim.\x22\x3c\/span\x3e]\n            }\n        }\n        ...\n      ]\n   }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#62---输入校验\x22\x3e\x3c\/a\x3e6.2 - 输入校验\x3c\/h3\x3e\n\x3cp\x3e这个端点现在还很脆弱 —— 我们没有对请求参数做任何的校验，因此，如果是无效的或者错误的值将使服务器出错。\x3c\/p\x3e\n\x3cp\x3e我们将添加一些使用 \x3ca href=\x22https:\/\/github.com\/hapijs\/joi\x22\x3eJoi\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/github.com\/triestpa\/koa-joi-validate\x22\x3eKoa-Joi-Validate\x3c\/a\x3e 库的中间件，以对输入做校验。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e\/**\n * GET \/\x3cspan class=\x22hljs-built_in\x22\x3esearch\x3c\/span\x3e\n * Search \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ea\x3c\/span\x3e term in the library\n * Query Params -\n * term: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e under \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e characters\n * offse\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e positive integer\n *\/\nrouter.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/search\x27\x3c\/span\x3e,\n  validate({\n    query: {\n      term: joi.\x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e().\x3cspan class=\x22hljs-built_in\x22\x3emax\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e).required(),\n      offse\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e joi.\x3cspan class=\x22hljs-keyword\x22\x3enumber\x3c\/span\x3e().integer().\x3cspan class=\x22hljs-built_in\x22\x3emin\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).default(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n    }\n  }),\n  async (ctx, \x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e) =\x26gt; {\n    const { term, offset } = ctx.request.query\n    ctx.body = await \x3cspan class=\x22hljs-built_in\x22\x3esearch\x3c\/span\x3e.queryTerm(term, offset)\n  }\n)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在，重启服务器，如果你使用一个没有搜索关键字的请求（\x3ccode\x3ehttp:\/\/localhost:3000\/search\x3c\/code\x3e），你将返回一个带相关消息的 HTTP 400 错误，比如像 \x3ccode\x3eInvalid URL Query - child \x22term\x22 fails because [\x22term\x22 is required]\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果想从 Node 应用程序中查看实时日志，你可以运行 \x3ccode\x3edocker-compose logs -f api\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#7---前端应用程序\x22\x3e\x3c\/a\x3e7 - 前端应用程序\x3c\/h3\x3e\n\x3cp\x3e现在我们的 \x3ccode\x3e\/search\x3c\/code\x3e 端点已经就绪，我们来连接到一个简单的 Web 应用程序来测试这个 API。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#70---vuejs-应用程序\x22\x3e\x3c\/a\x3e7.0 - Vue.js 应用程序\x3c\/h4\x3e\n\x3cp\x3e我们将使用 Vue.js 去协调我们的前端。\x3c\/p\x3e\n\x3cp\x3e添加一个新文件 \x3ccode\x3e\/public\/app.js\x3c\/code\x3e，去控制我们的 Vue.js 应用程序代码。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs kotlin\x22\x3econst vm = new Vue ({\n  el: \x3cspan class=\x22hljs-string\x22\x3e\x27#vue-instance\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e () {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      baseUrl: \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:3000\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ API url\x3c\/span\x3e\n      searchTerm: \x3cspan class=\x22hljs-string\x22\x3e\x27Hello World\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Default search term\x3c\/span\x3e\n      searchDebounce: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Timeout for search bar debounce\x3c\/span\x3e\n      searchResults: [], \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Displayed search results\x3c\/span\x3e\n      numHits: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Total search results found\x3c\/span\x3e\n      searchOffset: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Search result pagination offset\x3c\/span\x3e\n\n      selectedParagraph: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Selected paragraph object\x3c\/span\x3e\n      bookOffset: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Offset for book paragraphs being displayed\x3c\/span\x3e\n      paragraphs: [] \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Paragraphs being displayed in book preview window\x3c\/span\x3e\n    }\n  },\n  async created () {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchResults = await \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.search() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Search for default term\x3c\/span\x3e\n  },\n  methods: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Debounce search input by 100 ms *\/\x3c\/span\x3e\n    onSearchInput () {\n      clearTimeout(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchDebounce)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchDebounce = setTimeout(async () =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchResults = await \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.search()\n      }, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e)\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Call API to search for inputted term *\/\x3c\/span\x3e\n    async search () {\n      const response = await axios.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(`${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.baseUrl}\/search`, { params: { term: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchTerm, offset: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset } })\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.numHits = response.\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.hits.total\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response.\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.hits.hits\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Get next page of search results *\/\x3c\/span\x3e\n    async nextResultsPage () {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.numHits \x26gt; \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset \x2b= \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset \x2b \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.numHits) { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.numHits - \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e}\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchResults = await \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.search()\n        document.documentElement.scrollTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      }\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Get previous page of search results *\/\x3c\/span\x3e\n    async prevResultsPage () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset -= \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset \x26lt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchOffset = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e }\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.searchResults = await \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.search()\n      document.documentElement.scrollTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    }\n  }\n})\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个应用程序非常简单 —— 我们只定义了一些共享的数据属性，以及添加了检索和分页搜索结果的方法。为防止每次按键一次都调用 API，搜索输入有一个 100 毫秒的除颤功能。\x3c\/p\x3e\n\x3cp\x3e解释 Vue.js 是如何工作的已经超出了本教程的范围，如果你使用过 Angular 或者 React，其实一些也不可怕。如果你完全不熟悉 Vue，想快速了解它的功能，我建议你从官方的快速指南入手 —— \x3ca href=\x22https:\/\/vuejs.org\/v2\/guide\/\x22\x3ehttps:\/\/vuejs.org\/v2\/guide\/\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#71---html\x22\x3e\x3c\/a\x3e7.1 - HTML\x3c\/h4\x3e\n\x3cp\x3e使用以下的内容替换 \x3ccode\x3e\/public\/index.html\x3c\/code\x3e 文件中的占位符，以便于加载我们的 Vue.js 应用程序和设计一个基本的搜索界面。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs django\x22\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eElastic Library\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22description\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22Literary Classic Search Engine.\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22viewport\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/normalize\/7.0.0\/normalize.min.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/css\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/cdn.muicss.com\/mui-0.9.20\/css\/mui.min.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/css\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/fonts.googleapis.com\/css?family=EB\x2bGaramond:400,700|Open\x2bSans\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22styles.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app-container\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22vue-instance\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Search Bar Header --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-panel\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-textfield\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-model\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22searchTerm\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:keyup\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onSearchInput()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3eSearch\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Search Metadata Card --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-panel\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-headline\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 numHits \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e Hits\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-subhead\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eDisplaying Results \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 searchOffset \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e - \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 searchOffset \x2b 9 \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Top Pagination Card --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-panel pagination-panel\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22prevResultsPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3ePrev Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22nextResultsPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eNext Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Search Results Card List --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22search-results\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22searchResults\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-panel\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22hit in searchResults\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22showBookModal(hit)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-title\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-html\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22hit.highlight.text[0]\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-divider\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-subhead\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 hit._source.title \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e - \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 hit._source.author \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-body2\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eLocation \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 hit._source.location \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Bottom Pagination Card --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-panel pagination-panel\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22prevResultsPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3ePrev Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22nextResultsPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eNext Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- INSERT BOOK MODAL HERE --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/cdn.muicss.com\/mui-0.9.28\/js\/mui.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/vue\/2.5.3\/vue.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/axios\/0.17.0\/axios.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#72---css\x22\x3e\x3c\/a\x3e7.2 - CSS\x3c\/h4\x3e\n\x3cp\x3e添加一个新文件 \x3ccode\x3e\/public\/styles.css\x3c\/code\x3e，使用一些自定义的 UI 样式。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs css\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3efont-family\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27EB Garamond\x27\x3c\/span\x3e, serif; }\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.mui-textfield\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-tag\x22\x3einput\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-class\x22\x3e.mui-btn\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-class\x22\x3e.mui--text-subhead\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-class\x22\x3e.mui-panel\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-class\x22\x3e.mui--text-headline\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3efont-family\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Open Sans\x27\x3c\/span\x3e, sans-serif;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.all-caps\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3etext-transform\x3c\/span\x3e: uppercase; }\n\x3cspan class=\x22hljs-selector-class\x22\x3e.app-container\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e16px\x3c\/span\x3e; }\n\x3cspan class=\x22hljs-selector-class\x22\x3e.search-results\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eem\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3efont-weight\x3c\/span\x3e: bold; }\n\x3cspan class=\x22hljs-selector-class\x22\x3e.book-modal\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-tag\x22\x3ebutton\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e; }\n\x3cspan class=\x22hljs-selector-class\x22\x3e.search-results\x3c\/span\x3e \x3cspan class=\x22hljs-selector-class\x22\x3e.mui-divider\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e14px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; }\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.search-results\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: flex;\n  \x3cspan class=\x22hljs-attribute\x22\x3eflex-direction\x3c\/span\x3e: row;\n  \x3cspan class=\x22hljs-attribute\x22\x3eflex-wrap\x3c\/span\x3e: wrap;\n  \x3cspan class=\x22hljs-attribute\x22\x3ejustify-content\x3c\/span\x3e: space-around;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.search-results\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3eflex-basis\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e45%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-sizing\x3c\/span\x3e: border-box;\n  \x3cspan class=\x22hljs-attribute\x22\x3ecursor\x3c\/span\x3e: pointer;\n}\n\n@\x3cspan class=\x22hljs-keyword\x22\x3emedia\x3c\/span\x3e (max-width: \x3cspan class=\x22hljs-number\x22\x3e600px\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-selector-class\x22\x3e.search-results\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e { \x3cspan class=\x22hljs-attribute\x22\x3eflex-basis\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e; }\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.paragraphs-container\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3emax-width\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e800px\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e auto;\n  \x3cspan class=\x22hljs-attribute\x22\x3emargin-bottom\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e48px\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.paragraphs-container\x3c\/span\x3e \x3cspan class=\x22hljs-selector-class\x22\x3e.mui--text-body1\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-class\x22\x3e.paragraphs-container\x3c\/span\x3e \x3cspan class=\x22hljs-selector-class\x22\x3e.mui--text-body2\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3efont-size\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.8rem\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eline-height\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e35px\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.book-modal\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e40px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e10%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-sizing\x3c\/span\x3e: border-box;\n  \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e auto;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground-color\x3c\/span\x3e: white;\n  \x3cspan class=\x22hljs-attribute\x22\x3eoverflow-y\x3c\/span\x3e: scroll;\n  \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: fixed;\n  \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.pagination-panel\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: flex;\n  \x3cspan class=\x22hljs-attribute\x22\x3ejustify-content\x3c\/span\x3e: space-between;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.title-row\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: flex;\n  \x3cspan class=\x22hljs-attribute\x22\x3ejustify-content\x3c\/span\x3e: space-between;\n  \x3cspan class=\x22hljs-attribute\x22\x3ealign-items\x3c\/span\x3e: flex-end;\n}\n\n@\x3cspan class=\x22hljs-keyword\x22\x3emedia\x3c\/span\x3e (max-width: \x3cspan class=\x22hljs-number\x22\x3e600px\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-selector-class\x22\x3e.title-row\x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-attribute\x22\x3eflex-direction\x3c\/span\x3e: column; \n    \x3cspan class=\x22hljs-attribute\x22\x3etext-align\x3c\/span\x3e: center;\n    \x3cspan class=\x22hljs-attribute\x22\x3ealign-items\x3c\/span\x3e: center\n  }\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.locations-label\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3etext-align\x3c\/span\x3e: center;\n  \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8px\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.modal-footer\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: fixed;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebottom\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: flex;\n  \x3cspan class=\x22hljs-attribute\x22\x3ejustify-content\x3c\/span\x3e: space-around;\n  \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: white;\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#73---尝试输出\x22\x3e\x3c\/a\x3e7.3 - 尝试输出\x3c\/h4\x3e\n\x3cp\x3e在你的浏览器中打开 \x3ccode\x3elocalhost:8080\x3c\/code\x3e，你将看到一个简单的带结果分页功能的搜索界面。在顶部的搜索框中尝试输入不同的关键字来查看它们的搜索情况。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/acd5151556e06cf9a620e496d6af03917df9dc8b\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f345f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/camo.githubusercontent.com\/acd5151556e06cf9a620e496d6af03917df9dc8b\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f345f302e706e67\x22 alt=\x22preview webapp\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e你没有必要重新运行 \x3ccode\x3edocker-compose up\x3c\/code\x3e 命令以使更改生效。本地的 \x3ccode\x3epublic\x3c\/code\x3e 目录是装载在我们的 Nginx 文件服务器容器中，因此，在本地系统中前端的变化将在容器化应用程序中自动反映出来。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e如果你尝试点击任何搜索结果，什么反应也没有 —— 因为我们还没有为这个应用程序添加进一步的相关功能。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#8---分页预览\x22\x3e\x3c\/a\x3e8 - 分页预览\x3c\/h3\x3e\n\x3cp\x3e如果能点击每个搜索结果，然后查看到来自书中的内容，那将是非常棒的体验。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#80---添加-elasticsearch-查询\x22\x3e\x3c\/a\x3e8.0 - 添加 Elasticsearch 查询\x3c\/h3\x3e\n\x3cp\x3e首先，我们需要定义一个简单的查询去从给定的书中获取段落范围。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/search.js\x3c\/code\x3e 文件中添加如下的函数到 \x3ccode\x3emodule.exports\x3c\/code\x3e 块中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs xquery\x22\x3e\/** Get the specified range \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e paragraphs from a book *\/\ngetParagraphs (bookTitle, startLocation, endLocation) {\n  const filter = [\n    { term: { title: bookTitle } },\n    { range: { location: { gte: startLocation, lte: endLocation } } }\n  ]\n\n  const body = {\n    size: endLocation - startLocation,\n    sort: { location: \x3cspan class=\x22hljs-string\x22\x3e\x27asc\x27\x3c\/span\x3e },\n    query: { bool: { filter } }\n  }\n\n  return client.search({ index, type, body })\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个新函数将返回给定的书的开始位置和结束位置之间的一个排序后的段落数组。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#81---添加-api-端点\x22\x3e\x3c\/a\x3e8.1 - 添加 API 端点\x3c\/h4\x3e\n\x3cp\x3e现在，我们将这个函数链接到 API 端点。\x3c\/p\x3e\n\x3cp\x3e添加下列内容到 \x3ccode\x3eserver\/app.js\x3c\/code\x3e 文件中最初的 \x3ccode\x3e\/search\x3c\/code\x3e 端点下面。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e\/**\n * GET \/paragraphs\n * Get \x3cspan class=\x22hljs-keyword\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3erange\x3c\/span\x3e of paragraphs from the specified book\n * Query Params -\n * bookTitle: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e under \x3cspan class=\x22hljs-number\x22\x3e256\x3c\/span\x3e characters\n * \x3cspan class=\x22hljs-keyword\x22\x3estar\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e positive integer\n * end: positive integer greater than start\n *\/\nrouter.\x3cspan class=\x22hljs-built_in\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/paragraphs\x27\x3c\/span\x3e,\n  validate({\n    query: {\n      bookTitle: joi.\x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e().\x3cspan class=\x22hljs-built_in\x22\x3emax\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e256\x3c\/span\x3e).required(),\n      \x3cspan class=\x22hljs-keyword\x22\x3estar\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e joi.\x3cspan class=\x22hljs-keyword\x22\x3enumber\x3c\/span\x3e().integer().\x3cspan class=\x22hljs-built_in\x22\x3emin\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).default(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e),\n      end: joi.\x3cspan class=\x22hljs-keyword\x22\x3enumber\x3c\/span\x3e().integer().greater(joi.ref(\x3cspan class=\x22hljs-string\x22\x3e\x27start\x27\x3c\/span\x3e)).default(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\n    }\n  }),\n  async (ctx, \x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e) =\x26gt; {\n    const { bookTitle, start, end } = ctx.request.query\n    ctx.body = await \x3cspan class=\x22hljs-built_in\x22\x3esearch\x3c\/span\x3e.getParagraphs(bookTitle, start, end)\n  }\n)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#82---添加-ui-功能\x22\x3e\x3c\/a\x3e8.2 - 添加 UI 功能\x3c\/h4\x3e\n\x3cp\x3e现在，我们的新端点已经就绪，我们为应用程序添加一些从书中查询和显示全部页面的前端功能。\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3e\/public\/app.js\x3c\/code\x3e 文件的 \x3ccode\x3emethods\x3c\/code\x3e 块中添加如下的函数。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs cs\x22\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/** Call the API to get current page of paragraphs *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetParagraphs\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ebookTitle, offset\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bookOffset = offset\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e start = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bookOffset\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e end = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bookOffset \x2b \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e response = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e axios.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(`${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.baseUrl}\/paragraphs`, { \x3cspan class=\x22hljs-keyword\x22\x3eparams\x3c\/span\x3e: { bookTitle, start, end } })\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response.data.hits.hits\n      } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        console.error(err)\n      }\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Get next page (next 10 paragraphs) of selected book *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enextBookPage\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bookModal.scrollTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.paragraphs = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getParagraphs(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selectedParagraph._source.title, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bookOffset \x2b \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Get previous page (previous 10 paragraphs) of selected book *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprevBookPage\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bookModal.scrollTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.paragraphs = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getParagraphs(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selectedParagraph._source.title, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bookOffset - \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Display paragraphs from selected book in modal window *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eshowBookModal\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esearchHit\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        document.body.style.overflow = \x3cspan class=\x22hljs-string\x22\x3e\x27hidden\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selectedParagraph = searchHit\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.paragraphs = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getParagraphs(searchHit._source.title, searchHit._source.location - \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e)\n      } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        console.error(err)\n      }\n    },\n    \x3cspan class=\x22hljs-comment\x22\x3e\/** Close the book detail modal *\/\x3c\/span\x3e\n    closeBookModal () {\n      document.body.style.overflow = \x3cspan class=\x22hljs-string\x22\x3e\x27auto\x27\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selectedParagraph = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    }\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这五个函数提供了通过页码从书中下载和分页（每次十个段落）的逻辑。\x3c\/p\x3e\n\x3cp\x3e现在，我们需要添加一个 UI 去显示书的页面。在 \x3ccode\x3e\/public\/index.html\x3c\/code\x3e 的 \x3ccode\x3e\x26lt;!-- INSERT BOOK MODAL HERE --\x26gt;\x3c\/code\x3e 注释下面添加如下的内容。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs django\x22\x3e\x3cspan class=\x22xml\x22\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Book Paragraphs Modal Window --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-if\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22selectedParagraph\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22bookModal\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22book-modal\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22paragraphs-container\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Book Section Metadata --\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22title-row\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-display2 all-caps\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 selectedParagraph._source.title \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-display1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 selectedParagraph._source.author \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebr\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-divider\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-subhead locations-label\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eLocations \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 bookOffset - 5 \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e to \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 bookOffset \x2b 5 \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-divider\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebr\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Book Paragraphs --\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22paragraph in paragraphs\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-if\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22paragraph._source.location === selectedParagraph._source.location\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-body2\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estrong\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 paragraph._source.text \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estrong\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-else\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui--text-body1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 paragraph._source.text \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebr\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- Book Pagination Footer --\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22modal-footer\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22prevBookPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3ePrev Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22closeBookModal()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eClose\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22mui-btn mui-btn--flat\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-on:click\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22nextBookPage()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eNext Page\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e再次重启应用程序服务器（\x3ccode\x3edocker-compose up -d --build\x3c\/code\x3e），然后打开 \x3ccode\x3elocalhost:8080\x3c\/code\x3e。当你再次点击搜索结果时，你将能看到关键字附近的段落。如果你感兴趣，你现在甚至可以看这本书的剩余部分。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/ba9b4db3b7c61d0f07599bb31cd5153ad55d4023\/68747470733a2f2f63646e2e7061747269636b7472696573742e636f6d2f626c6f672f696d616765732f706f7374732f656c61737469632d6c6962726172792f73616d706c655f355f302e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01aef6adb3917a4400.png\x22 alt=\x22preview webapp book page\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e祝贺你！你现在已经完成了本教程的应用程序。\x3c\/p\x3e\n\x3cp\x3e你可以去比较你的本地结果与托管在这里的完整示例 —— \x3ca href=\x22https:\/\/search.patricktriest.com\/\x22\x3ehttps:\/\/search.patricktriest.com\/\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#9---elasticsearch-的缺点\x22\x3e\x3c\/a\x3e9 - Elasticsearch 的缺点\x3c\/h3\x3e\n\x3ch4\x3e\x3ca href=\x22#90---耗费资源\x22\x3e\x3c\/a\x3e9.0 - 耗费资源\x3c\/h4\x3e\n\x3cp\x3eElasticsearch 是计算密集型的。\x3ca href=\x22https:\/\/www.elastic.co\/guide\/en\/elasticsearch\/guide\/current\/hardware.html\x22\x3e官方建议\x3c\/a\x3e 运行 ES 的机器最好有 64 GB 的内存，强烈反对在低于 8 GB 内存的机器上运行它。Elasticsearch 是一个 \x3cem\x3e内存中\x3c\/em\x3e 数据库，这样使它的查询速度非常快，但这也非常占用系统内存。在生产系统中使用时，\x3ca href=\x22https:\/\/www.elastic.co\/guide\/en\/elasticsearch\/guide\/2.x\/distributed-cluster.html\x22\x3e他们强烈建议在一个集群中运行多个 Elasticsearch 节点\x3c\/a\x3e，以实现高可用、自动分区和一个节点失败时的数据冗余。\x3c\/p\x3e\n\x3cp\x3e我们的这个教程中的应用程序运行在一个 $15\/月 的 GCP 计算实例中（ \x3ca href=\x22https:\/\/search.patricktriest.com\/\x22\x3esearch.patricktriest.com\x3c\/a\x3e），它只有 1.7 GB 的内存，它勉强能运行这个 Elasticsearch 节点；有时候在进行初始的数据加载过程中，整个机器就 ”假死机“ 了。在我的经验中，Elasticsearch 比传统的那些数据库，比如，PostgreSQL 和 MongoDB 耗费的资源要多很多，这样会使托管主机的成本增加很多。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#91---与数据库的同步\x22\x3e\x3c\/a\x3e9.1 - 与数据库的同步\x3c\/h3\x3e\n\x3cp\x3e对于大多数应用程序，将数据全部保存在 Elasticsearch 并不是个好的选择。可以使用 ES 作为应用程序的主要事务数据库，但是一般不推荐这样做，因为在 Elasticsearch 中缺少 ACID，如果大量读取数据的时候，它能导致写操作丢失。在许多案例中，ES 服务器更多是一个特定的角色，比如做应用程序中的一个文本搜索功能。这种特定的用途，要求它从主数据库中复制数据到 Elasticsearch 实例中。\x3c\/p\x3e\n\x3cp\x3e比如，假设我们将用户信息保存在一个 PostgreSQL 表中，但是用 Elasticsearch 去提供我们的用户搜索功能。如果一个用户，比如，“Albert”，决定将他的名字改成 “Al”，我们将需要把这个变化同时反映到我们主要的 PostgreSQL 数据库和辅助的 Elasticsearch 集群中。\x3c\/p\x3e\n\x3cp\x3e正确地集成它们可能比较棘手，最好的答案将取决于你现有的应用程序栈。这有多种开源方案可选，从 \x3ca href=\x22https:\/\/github.com\/mongodb-labs\/mongo-connector\x22\x3e用一个进程去关注 MongoDB 操作日志\x3c\/a\x3e 并自动同步检测到的变化到 ES，到使用一个 \x3ca href=\x22https:\/\/github.com\/zombodb\/zombodb\x22\x3ePostgresSQL 插件\x3c\/a\x3e 去创建一个定制的、基于 PSQL 的索引来与 Elasticsearch 进行自动沟通。\x3c\/p\x3e\n\x3cp\x3e如果没有有效的预构建选项可用，你可能需要在你的服务器代码中增加一些钩子，这样可以基于数据库的变化来手动更新 Elasticsearch 索引。最后一招，我认为是一个最后的选择，因为，使用定制的业务逻辑去保持 ES 的同步可能很复杂，这将会给应用程序引入很多的 bug。\x3c\/p\x3e\n\x3cp\x3e让 Elasticsearch 与一个主数据库同步，将使它的架构更加复杂，其复杂性已经超越了 ES 的相关缺点，但是当在你的应用程序中考虑添加一个专用的搜索引擎的利弊得失时，这个问题是值的好好考虑的。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#总结\x22\x3e\x3c\/a\x3e总结\x3c\/h3\x3e\n\x3cp\x3e在很多现在流行的应用程序中，全文搜索是一个非常重要的功能 —— 而且是很难实现的一个功能。对于在你的应用程序中添加一个快速而又可定制的文本搜索，Elasticsearch 是一个非常好的选择，但是，在这里也有一个替代者。\x3ca href=\x22https:\/\/lucene.apache.org\/solr\/\x22\x3eApache Solr\x3c\/a\x3e 是一个类似的开源搜索平台，它是基于 Apache Lucene 构建的，与 Elasticsearch 的核心库是相同的。\x3ca href=\x22https:\/\/www.algolia.com\/\x22\x3eAlgolia\x3c\/a\x3e 是一个搜索即服务的 Web 平台，它已经很快流行了起来，并且它对新手非常友好，很易于上手（但是作为折衷，它的可定制性较小，并且使用成本较高）。\x3c\/p\x3e\n\x3cp\x3e“搜索” 特性并不是 Elasticsearch 唯一功能。ES 也是日志存储和分析的常用工具，在一个 ELK（Elasticsearch、Logstash、Kibana）架构配置中通常会使用它。灵活的全文搜索功能使得 Elasticsearch 在数据量非常大的科学任务中用处很大 —— 比如，在一个数据集中正确的\/标准化的条目拼写，或者为了类似的词组搜索一个文本数据集。\x3c\/p\x3e\n\x3cp\x3e对于你自己的项目，这里有一些创意。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e添加更多你喜欢的书到教程的应用程序中，然后创建你自己的私人图书馆搜索引擎。\x3c\/li\x3e\n\x3cli\x3e利用来自 \x3ca href=\x22https:\/\/scholar.google.com\/\x22\x3eGoogle Scholar\x3c\/a\x3e 的论文索引，创建一个学术抄袭检测引擎。\x3c\/li\x3e\n\x3cli\x3e通过将字典中的每个词索引到 Elasticsearch，创建一个拼写检查应用程序。\x3c\/li\x3e\n\x3cli\x3e通过将 \x3ca href=\x22https:\/\/aws.amazon.com\/public-datasets\/common-crawl\/\x22\x3eCommon Crawl Corpus\x3c\/a\x3e 加载到 Elasticsearch 中，构建你自己的与谷歌竞争的因特网搜索引擎（注意，它可能会超过 50 亿个页面，这是一个成本极高的数据集）。\x3c\/li\x3e\n\x3cli\x3e在 journalism 上使用 Elasticsearch：在最近的大规模泄露的文档中搜索特定的名字和关键词，比如， \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Panama_Papers\x22\x3ePanama Papers\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Paradise_Papers\x22\x3eParadise Papers\x3c\/a\x3e。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e本教程中应用程序的源代码是 100% 公开的，你可以在 GitHub 仓库上找到它们 —— \x3ca href=\x22https:\/\/github.com\/triestpa\/guttenberg-search\x22\x3ehttps:\/\/github.com\/triestpa\/guttenberg-search\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e我希望你喜欢这个教程！你可以在下面的评论区，发表任何你的想法、问题、或者评论。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e作者简介：\x3c\/p\x3e\n\x3cp\x3e全栈工程师，数据爱好者，学霸，“构建强迫症患者”，探险爱好者。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3evia: \x3ca href=\x22https:\/\/blog.patricktriest.com\/text-search-docker-elasticsearch\/\x22\x3ehttps:\/\/blog.patricktriest.com\/text-search-docker-elasticsearch\/\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22https:\/\/blog.patricktriest.com\/author\/patrick\/\x22\x3ePatrick Triest\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/qhwdw\x22\x3eqhwdw\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 原创编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>使用 Docker 和 Elasticsearch 构建一个全文搜索应用程序</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/building-a-full-text-search-app-using-docker-and-elasticsearch">https://www.zcfy.cc/article/building-a-full-text-search-app-using-docker-and-elasticsearch</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/el4zt97f9vc/" target="_blank">https://alili.tech/archive/el4zt97f9vc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/dc9tmbt89lc/">CSS3 巧妙实现聊天气泡<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/awfhylei7vr/">Element 一套优雅的 Vue 2 组件库是如何开发的<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/5n6e7oj31zb/">Ionic2入坑基础教程和安装指南<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/k9uktrr2ck/">JavaScript arguments 对象全面介绍<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/d31ygsiurr7/">JavaScript 版俄罗斯方块——重构<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/f1goxj498pc/">JavaScript中this绑定详解<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/fpk9tyls8sb/">Markcook2.0，使用Vue2.0和Vuex2.0进行完全重构升级<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/rnj4z8l02t/">N3-components - 强劲的 Vue UI组件库<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/7njdijhy2um/">Node.js &#43; React Native 毕设：农业物联网监测系统的开发手记<aside class="dates">2019-02-02</aside></a></li><li><a href="/archive/f8zzbybr4tl/">Redux、Flux、Vuex<aside class="dates">2019-02-02</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>